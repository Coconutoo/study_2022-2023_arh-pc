(()=>{var __webpack_modules__={20797:e=>{e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%" %attrs%>\n  <span class="ui_rmenu_item_label ">%label%</span>\n</a>',im_right_menu_tpl_redesign:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%" %attrs%>\n  %extra%<span class="ui_rmenu_item_label "><span class="ui_rmenu_label-text">%label%</span></span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<span class="ui_rmenu_count im-right-menu--count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button><span class="im-right-menu--text _im_r_tx">%name%</span>',im_right_menu_ct_redesign:'<div class="ui_rmenu_extra_label"><span class="ui_rmenu_count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button></div>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',sImDialogImRowPhoto:'<div class="im_grid">%photo%</div>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',sImContactAvatar:' <div class="ContactAvatar ContactAvatar--%size% %classes%">%name%</div>',sImUserAvatar:'<div class="ImUserAvatar _online %online_class% %classes%"> <img src="%src%" class="ImUserAvatar__img" alt=""> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> <span class="im-page--title-main-donut _im_chat_donut"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> %more_children%</div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',sImSimpleNameBusinessNotifyLabel:'<span class="im-page--title-main-business-notify _im_chat_business_notify">%text%</span>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> <div class="im-page--dialogs-empty--icon">%icon%</div> %msg%</li>',im_dialogs_active_folder_button:'<li class="im-page--dialogs-folder-button %class_name%" data-list-id="all"> <button class="im-page--dialogs-folder-button--back _im_dialog_folder_back"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg></button> <span class="im-page--dialogs-folder-button--text">%msg%</span> %actions%</li>',im_dialogs_active_folder_button_actions:'<button type="button" class="im-page--dialogs-folder-button--actions _im_dialog_folder_actions" data-folder="%folder%"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M9.53 6.42a.75.75 0 0 1 .94 0l5.25 4.25a.75.75 0 1 1-.94 1.16L10 7.96l-4.78 3.87a.75.75 0 1 1-.94-1.16z" fill="currentColor"/></svg></button>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="message_request_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 2C4.44 2 1.5 4.52 1.5 7.75c0 1.09.34 2.12.95 3.02-.09.4-.36 1.04-.82 1.87a1.08 1.08 0 0 0 .46 1.49c.17.08.36.12.54.12A5.5 5.5 0 0 0 6 13.23a7.4 7.4 0 0 0 2 .28c3.56 0 6.5-2.52 6.5-5.76C14.5 4.52 11.56 2 8 2Zm0 1.5c-2.92 0-5 2.02-5 4.25 0 .8.25 1.55.73 2.22l.13.19a.75.75 0 0 1 .13.57l-.04.23a7.08 7.08 0 0 1-.65 1.74c.87-.1 1.44-.36 1.8-.66l.23-.21a.75.75 0 0 1 .7-.15l.31.1c.52.15 1.08.23 1.66.23 2.92 0 5-2.02 5-4.26 0-2.23-2.08-4.25-5-4.25Zm8.16 5.07a.75.75 0 1 1 1.18-.91A5.46 5.46 0 0 1 18.5 11a5.42 5.42 0 0 1-.91 3.01c.08.41.34 1.05.78 1.9a1.09 1.09 0 0 1-.99 1.59 5.18 5.18 0 0 1-3.23-1.01 6.8 6.8 0 0 1-1.9.27 6.73 6.73 0 0 1-2.57-.5.75.75 0 0 1 .57-1.39 5.22 5.22 0 0 0 2 .39 5.3 5.3 0 0 0 1.57-.24l.3-.09a.75.75 0 0 1 .71.16l.23.2c.33.3.85.54 1.66.65a7.34 7.34 0 0 1-.63-1.74l-.04-.23a.75.75 0 0 1 .12-.55l.13-.19A3.92 3.92 0 0 0 17 11c0-.9-.3-1.73-.84-2.43Z"/></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> </li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice BannerInfo BannerInfo--noMargin"> %msg% </div> </li>',im_dialogs_business_notify_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-business-notify-button _im_toggle_business_notify_tab %class_name%" data-list-id="business_notify_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 0 1-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 0 1-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8ZM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13Zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 0 0-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 0 0-.33-.33c-.2-.1-.39-.15-.98-.16Zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 0 0-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 0 0-.1-.63l-.06-.1a.77.77 0 0 0-.33-.33l-.1-.05a2.6 2.6 0 0 0-.94-.1Z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',sImBusinessNotifyDisableBoxContent:'<div class="im_bussiness_notify_disable_box"> <div class="im_bussiness_notify_disable_box_text"> %text% </div> </div>',im_dialogs_archives_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-archives-button _im_toggle_archives_tab %class_name%" data-list-id="archive_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M7 10.75c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--mentions" data-mentions="%mentions%"><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',im_dialogs_archive_notice:'<li class="im-page--dialogs-archive-notice-w _im_archive_notice" data-list-id="archive_notice"> <div class="im-page--dialogs-archive-notice"> <span class="im-page--dialogs-archive-notice--title">%title%</span> <span class="im-page--dialogs-archive-notice--text">%text%</span> <button class="im-page--dialogs-archive-notice--close _im_archive_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_dialogs_archive_notice_button:'<button class="im-page--dialogs-archive-notice--button _im_archive_notice_settings">%text%</button>',im_dialogs_new_ui_notice:'<li class="im-page--dialogs-new-ui-notice-w _im_new_ui_notice" data-list-id="new_ui_notice"> <div class="im-page--dialogs-new-ui-notice"> <span class="im-page--dialogs-new-ui-notice--title">%title%</span> <span class="im-page--dialogs-new-ui-notice--text">%text%</span> <button class="im-page--dialogs-new-ui-notice--close _im_new_ui_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody% </span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd %modifier%"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%text%</span> <span class="im-fwd--date">%date%</span> </span> <span class="im-fwd--close _im_fwd_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> <a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a> </div> </div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_actions_menu:'<button type="button" class="nim-dialog--actions _im_dialog_actions" data-peer="%peer_id%"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M13 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/></svg></button>',im_drow_close_button:'<button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer_id%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button>',im_page_inline_menu:'<ul class="im-page--inline-menu-list"> %actions%</ul>',im_page_inline_menu_item:'<li class="im-page--inline-menu--list-item"> <button class="im-page--inline-menu--button %class_name%" data-action="%action%"> <div class="im-page--inline-menu--button-icon">%icon%</div> <span class="im-page--inline-menu--button-text">%name%</span> </button> </li>',im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-cmid="%cmid%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m9.49 3.95 2.56 2.56-6.14 6.14a4.82 4.82 0 0 1-2 1.2l-2.1.64a.24.24 0 0 1-.3-.3l.64-2.1a4.82 4.82 0 0 1 1.2-2L9.5 3.95Zm3.67-2.13 1.02 1.02c.4.4.42 1.03.08 1.45l-1.17 1.18-2.56-2.56 1.1-1.1c.42-.42 1.1-.42 1.53 0Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m5.75 3.87-.43 1c-.03.06-.04.1-.07.12a.23.23 0 0 1-.07.06c-.03.02-.07.02-.15.03l-.62.1c-1.77.24-2.65.37-3.02.78a1.53 1.53 0 0 0-.37 1.32c.11.55.81 1.1 2.2 2.22l.24.2c.06.05.1.07.11.1a.23.23 0 0 1 .04.1l-.02.15-.07.38c-.39 2.06-.58 3.09-.28 3.59a1.53 1.53 0 0 0 1.24.73c.59.02 1.4-.65 3-1.99l.28-.22c.08-.08.12-.11.17-.12a.23.23 0 0 1 .13 0c.05.01.09.04.17.11l.28.24c1.6 1.33 2.41 2 3 1.98a1.53 1.53 0 0 0 1.24-.73c.3-.5.11-1.53-.28-3.6l-.07-.37a.51.51 0 0 1-.02-.15.23.23 0 0 1 .04-.1l.11-.1.24-.2c1.39-1.11 2.09-1.67 2.2-2.22a1.53 1.53 0 0 0-.37-1.32c-.37-.41-1.25-.54-3.02-.79l-.62-.09c-.08 0-.12-.01-.15-.03a.23.23 0 0 1-.07-.06c-.03-.02-.04-.06-.07-.13l-.43-1c-.71-1.63-1.06-2.45-1.56-2.7a1.52 1.52 0 0 0-1.37 0c-.5.25-.85 1.07-1.56 2.7Z"/></svg></span> </div> <div class="im-mess--check fl_l"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zM6 7.94a.75.75 0 1 0-1 1.12l1.46 1.3c.44.38 1.1.33 1.49-.1l.04-.05 2.9-3.75a.75.75 0 1 0-1.19-.92L7.1 8.91 6 7.94z"/></svg></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<button class="_im_peer_mute_unmute im-chat-input-block-control im-chat-input-block-control--with-icon im-chat-input-block-control--%type%">%text%</button>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<button class="_im_peer_return_to_chat im-chat-input-block-control">%text%</button>',sImCallSnippet:'<article class="CallSnippet %classes%" %attributes%> <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:' <span class="MessageKeyboard__cell"> <%tagName% class="MessageKeyboard__button MessageKeyboard__button--%modifier% Button Button--size-s Button--%appearance% _im_mess_btn" %attributes% > <span class="MessageKeyboard__label">%label%</span> </%tagName%> </span>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message " data-last-msgid="%id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sUiActionsMenuSeparator:'<div class="ui_actions_menu_sep"></div>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem _im_dialog_peer_tag" data-id="%tag_id%" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>'},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImPeerTagsFilterItem:'<div class="PeerTagsFilterItem"> <input class="PeerTagsFilterItem__checkbox _im_peer_tags_filter_checkbox" type="checkbox" id="peer_tag_%tag_id%" %checked%> <label class="PeerTagsFilterItem__label" for="peer_tag_%tag_id%"> <span class="PeerTagsFilterItem__checkboxOff"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05 2.53C4.79 2.13 5.52 2 7.13 2h5.74c1.61 0 2.34.14 3.08.53.65.35 1.17.87 1.52 1.52.4.74.53 1.47.53 3.08v5.74c0 1.61-.14 2.34-.53 3.08a3.64 3.64 0 0 1-1.52 1.52c-.74.4-1.47.53-3.08.53H7.13c-1.61 0-2.34-.14-3.08-.53a3.64 3.64 0 0 1-1.52-1.52c-.4-.74-.53-1.47-.53-3.08V7.13c0-1.61.14-2.34.53-3.08.35-.65.87-1.17 1.52-1.52Zm3.08.97c-1.53 0-1.96.14-2.38.36-.38.2-.69.5-.9.9-.21.4-.35.84-.35 2.37v5.74c0 1.53.14 1.96.36 2.38.2.38.5.69.9.9.4.21.84.35 2.37.35h5.74c1.53 0 1.96-.14 2.38-.36.38-.2.69-.5.9-.9.21-.4.35-.84.35-2.37V7.13c0-1.53-.14-1.96-.36-2.38-.2-.38-.5-.69-.9-.9-.4-.21-.84-.35-2.37-.35H7.13Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__checkboxOn"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74Zm12.2 3.8a.9.9 0 1 0-1.28-1.27L8.7 11.38 6.64 9.33a.9.9 0 0 0-1.28 1.27l2.7 2.69a.9.9 0 0 0 1.27 0l5.3-5.3Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterItem__name">%name%</span> <span class="PeerTagsFilterItem__count">%count%</span> </label> </div>',sImPeerTagsFilterPaneItem:'<div class="PeerTagsFilterPaneItem _im_peer_tags_filter_pane_item" data-id="%tag_id%"> <span class="PeerTagsFilterPaneItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterPaneItem__name">%name%</span> <span class="PeerTagsFilterPaneItem__remove"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:function(){return'<button class="FlatButton FlatButton--secondary FlatButton--size-s _im_call_banner_join_btn _im_top_banner_button" type="button" data-link="%call_link%" >\n  <span class="FlatButton__in FlatButton__in--noPointerEvents">\n    \n    <span class="FlatButton__content">'+getLang("mail_join_chat")+"</span>\n    \n  </span>\n</button>"},sImAudioMsgPlayerASRToggle:' <button onclick="return AudioMessagePlayer.toggleTranscript(this, event);" class="audio-msg-track--transcriptToggle _msg_asr_toggle" > <span class="audio-msg-track--transcriptToggleShow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M1.89 12.11c.46 0 .73-.23.9-.8L3.22 10h3.05l.45 1.33c.15.55.42.78.92.78.51 0 .88-.34.88-.83a1.56 1.56 0 0 0-.11-.56L6.1 4.42c-.25-.69-.66-1-1.36-1-.66 0-1.08.32-1.33 1.01l-2.3 6.29a1.82 1.82 0 0 0-.12.56c0 .5.34.83.9.83ZM3.6 8.63l1.1-3.47h.04l1.12 3.46H3.61Zm7.62 3.47c.78 0 1.57-.4 1.92-1.06h.03v.32c.04.5.36.76.82.76.49 0 .83-.29.83-.86V7.68c0-1.26-1.04-2.1-2.66-2.1-1.3 0-2.3.47-2.6 1.22a.9.9 0 0 0-.09.38c0 .39.3.66.72.66a.86.86 0 0 0 .68-.32c.38-.49.7-.66 1.22-.66.64 0 1.05.34 1.05.93v.41l-1.58.1c-1.57.1-2.45.75-2.45 1.9 0 1.13.91 1.9 2.1 1.9Zm.56-1.24c-.58 0-.96-.29-.96-.76 0-.44.36-.73 1-.78l1.32-.08v.46c0 .68-.61 1.16-1.36 1.16Z"/></svg></span> <span class="audio-msg-track--transcriptToggleHide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="currentColor" viewBox="0 0 16 12"><path d="M4.45 8.31a.9.9 0 0 1-1.1-1.42l4.1-3.2a.9.9 0 0 1 1.1 0l4.1 3.2a.9.9 0 1 1-1.1 1.42L8 5.54 4.45 8.31Z"/></svg></span> </button>',sImCarousel:'<div class="Carousel _im_carousel" data-scroll-count="%scroll_count%"> <button class="Carousel__control Carousel__control--prev Carousel__control--hidden _im_carousel_control _im_carousel_control_left %controls_class%" data-direction="-1"><svg fill="none" height="16" viewBox="0 0 12 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="m4.77 8 3.37 3.36a.9.9 0 1 1-1.28 1.28l-4-4a.9.9 0 0 1 0-1.28l4-4a.9.9 0 1 1 1.28 1.28z" fill="currentColor"/></svg></button> <button class="Carousel__control Carousel__control--next _im_carousel_control _im_carousel_control_right %controls_class%" data-direction="1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" fill="none" viewBox="0 0 12 16"><path fill="currentColor" d="M7.23 8 3.86 4.64a.9.9 0 0 1 1.28-1.28l4 4a.9.9 0 0 1 0 1.28l-4 4a.9.9 0 0 1-1.28-1.28L7.23 8Z"/></svg></button> <div class="Carousel__viewport _im_carousel_viewport"> <div class="Carousel__layer _im_carousel_layer"> %content% </div> </div> </div>',sImBotCarousel:'<div class="BotCarousel _im_bot_carousel _im_bot_carousel_%msg_id%"> %content%</div>',sImBotCarouselSlide:'<div class="BotCarousel__slide" data-index="%index%">%content%</div>',sImBotCarouselSlideTitle:'<div class="BotCarousel__slideTitle">%content%</div>',sImBotCarouselSlideDescription:'<div class="BotCarousel__slideDescription">%content%</div>',sImBotCarouselSlideContent:'<div class="BotCarousel__slideContent">%content%</div>',sImBotCarouselSlideLinkWrapper:'<a href="%url%" class="BotCarousel__slideLinkWrapper" target="_blank" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhotoLinkWrapper:'<a href="#" class="BotCarousel__slideLinkWrapper" onclick="return showPhoto(\'%photo_id%\', \'mail%msg_id%\', {}, event)" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhoto:"<img class=\"BotCarousel__slideImage\" src='%url%' alt='%alt%' />",sImBotCarouselSlideButtons:'<div class="BotCarousel__slideButtons">%content%</div>',sImBotCarouselSlideButton:' <%tag_name% class="BotCarousel__slideButton BotCarousel__slideButton--%modifier% Button Button--size-m Button--wide Button--overflow Button--%appearance% _im_mess_btn" %attributes% > <span class="BotCarousel__slideButtonLabel"> %label% </span> </%tag_name%>',sImConvoRecommendListUser:function(){return'<li class="ConvoRecommendList__item"> <a href="%link%" class="ConvoRecommendList__button _im_dialog _convoRecommendUser" data-peer="%id%" data-position="%position%" data-trackcode="%track_code%"> <div class="ConvoRecommendList__avatar"> %photo% <button class="ConvoRecommendList__removeItem _convoRecommendUserRemove" aria-label="'+getLang("mail_recommend_block_remove_item")+'"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg> </button> </div> <span class="ConvoRecommendList__name">%name%</span> </a> </li>'},sImConvoRecommendListButton:'<li class="ConvoRecommendList__item"> <%tag_name% %attributes% class="ConvoRecommendList__button %classes%"> <span class="ConvoRecommendList__avatar ConvoRecommendList__icon" aria-hidden="true"> %icon% </span> <span class="ConvoRecommendList__name">%title%</span> </%tag_name%> </li>',sImConvoRecommendList:'<ul class="ConvoRecommendList" data-list-id="recommend_list"> %list_content%</ul>',sImEmptyDialogStub:' <div class="EmptyDialogStub %classes%"> <div class="EmptyDialogStub__main"> <div class="EmptyDialogStub__avatar">%avatar%</div> <div class="EmptyDialogStub__name">%name%</div> <div class="EmptyDialogStub__savedAs">%saved_as%</div> <div class="EmptyDialogStub__description">%stub_text%</div> </div> %secondary_block% </div> <div class="_im_stickers_panel_placeholder"></div>',sImEmptyDialogStubUserInfo:function(){return' <div class="EmptyDialogStub__secondary"> <div class="EmptyDialogStub__additional"> <div class="EmptyDialogStub__additionalIcon">%additional_icon%</div> %additional_info% </div> %mutual_friends% <div class="EmptyDialogStub__actions"> <a class="FlatButton FlatButton--secondary FlatButton--size-m" draggable="false" href="%profile_href%" > <span class="FlatButton__in"> <span class="FlatButton__content">'+getLang("mail_view_profile")+"</span> </span> </a> %subscribe_button% </div> </div>"},sImEmptyDialogStubSubscribeButton:'<button class="FlatButton FlatButton--primary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">%button_text%</span>\n    \n  </span>\n</button>',sImEmptyDialogStubUnsubscribeButton:'<button class="FlatButton FlatButton--secondary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">%button_text%</span>\n    \n  </span>\n</button>',sImEmptyDialogStubMutualFriends:' <div class="EmptyDialogStub__mutualFriends"> <div class="EmptyDialogStub__mutualFriendsPhotos">%friends%</div> <div class="EmptyDialogStub__mutualFriendsCount">%text%</div> </div>',sImEmptyDialogStubMutualFriend:' <img src="%src%" class="EmptyDialogStub__mutualFriendPhoto" alt="%name%" />',sImEmptyDialogStickers:'<div class="EmptyDialogStickers"> %content%</div>',sImEmptyDialogSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogAnimatedSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animation_url%"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogLastMessage:function(){return'<span class="nim-dialog--preview nim-dialog--preview-empty-label">'+getLang("mail_empty_message")+"</span>"}}},69823:(e,t,a)=>{"use strict";a.d(t,{default:()=>g});a(19371);var i=a(85893),n=a(67294),s=a(18793),r=a(41650),o=a(63729),l=a(64891),c=a(83295);const d=(0,a(63192).makeIcon)("Icon24List","list_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="list_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5Zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5Zm0 12a1.5 1.5 0 1 0-.001 2.999A1.5 1.5 0 0 0 4 16.5ZM21 18a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1Zm0-6a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1ZM8 7h12a1 1 0 0 0 0-2H8a1 1 0 1 0 0 2Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var _=r.default.getLang;class u extends n.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,a=e.showSettingsPopup,n=e.showCreatingTemplatePopup,r=e.isNeededRendering,o=this.state.isShowDropDown;if(!r())return null;var u=t();return(0,i.jsxs)("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1),children:[(0,i.jsx)("div",{className:(0,c.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":o}),"aria-hidden":o,children:(0,i.jsx)("div",{className:"TemplatesDropDown__container",children:(0,i.jsx)(s.Scroll,{className:"TemplatesDropDown__scroll-wrapper",children:(0,i.jsxs)("div",{children:[" ",(0,i.jsxs)("header",{className:"TemplatesDropDown__header",children:[(0,i.jsx)("h2",{className:"TemplatesDropDown__title",children:_("mail_community_templates")}),(0,i.jsx)("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:a,children:_("mail_settings_configure")})]}),u.length?(0,i.jsx)("ul",{className:"TemplatesDropDown__list",children:u.map((e=>(0,i.jsxs)("li",{className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id),children:[(0,i.jsx)("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),(0,i.jsx)("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}})]},e.id)))}):(0,i.jsxs)("div",{className:"TemplatesDropDown__not-found-container",children:[(0,i.jsx)("span",{children:_("mail_community_templates_not_found")}),(0,i.jsx)(l.default,{onClick:n,children:_("mail_add_community_template")})]})]})})})}),(0,i.jsx)("button",{className:"TemplatesDropDown__icon",children:(0,i.jsx)(d,{})})]})}}const g=(0,o.connect)(u)},69361:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MAIN:()=>h,EDIT:()=>v,default:()=>b});a(59357),a(19371),a(75115),a(40851),a(96253);var i=a(85893),n=a(67294),s=a(41650),r=a(68959),o=a(63729),l=a(88420),c=a(18793),d=a(64891),_=a(21963),u=a(42918),g=a(54593),m=a(59397),p=a(54612),h="main",v="edit";class f extends n.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,a=e.name,i=e.text;return new Promise((e=>this.setState({editableMessage:{id:t,name:a,text:i}},e)))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:(0,m.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then((()=>this.state.section!==h?this.go(h):Promise.resolve())).then((()=>this.props.store.set(g.deleteTemplate.bind(null,e)))).catch((()=>{(0,p.showFastBox)((0,s.getLang)("mail_error"),(0,s.getLang)("mail_community_templates_delete_error"))})),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,a=t.name,i=t.text;a.length>200||a.length<2||a.length>2e3||i.length<5?(0,p.showFastBox)((0,s.getLang)("mail_error"),(0,s.getLang)("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch((()=>{(0,p.showFastBox)((0,s.getLang)("mail_error"),(0,s.getLang)("mail_community_templates_save_error"))})).then((()=>this.go(h)))},this.addHint=(e,t)=>{t.preventDefault();var a=this.state.editableMessage,i=a.id,n=void 0===i?null:i,s=a.name,r=a.text;return(0,_.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:n,name:s,text:`${r}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e,t){var a=void 0===t?{}:t,i=a.id,n=void 0===i?null:i,s=a.name,r=void 0===s?"":s,o=a.text,l=void 0===o?"":o;return new Promise((t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:n,name:r,text:l}},(()=>{this.props.popup.updateBoxCoords(),t()})):t()}))}render(){var e=this.props,t=e.getTemplates,a=e.closePopup,o=this.state,g=o.section,m=o.editableMessage,p=t();return(0,i.jsxs)("section",{className:"TemplatesSettings",children:[(0,i.jsx)(r.default,{title:(0,i.jsxs)("span",{className:"TemplatesSettings__title",children:[g===h&&(0,s.getLang)("mail_community_templates"),g===v&&(0,s.getLang)("mail_add_community_template")]}),onCloseClick:a}),(0,i.jsxs)("main",{className:"TemplatesSettings__content",children:[g===h&&(p.length?(0,i.jsx)(c.Scroll,{className:"TemplatesSettings__scroll-wrapper",children:(0,i.jsx)("div",{className:"TemplatesSettings__list",children:p.map((e=>(0,i.jsxs)("section",{className:"TemplatesSettings__item",children:[(0,i.jsx)("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),(0,i.jsx)("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),(0,i.jsxs)("div",{className:"TemplatesSettings__buttons-row",children:[(0,i.jsx)(d.default,{onClick:()=>this.go(v,e),className:"TemplatesSettings__item-button",children:(0,s.getLang)("mail_settings_edit")}),(0,i.jsxs)("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true",children:[" ","·"," "]}),(0,i.jsx)(d.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button",children:(0,s.getLang)("mail_delete")})]})]},e.id)))})}):(0,i.jsxs)("div",{className:"TemplatesSettings__not-found-container",children:[(0,i.jsx)("span",{children:(0,s.getLang)("mail_community_templates_not_found")}),(0,i.jsx)(d.default,{onClick:()=>this.go(v),children:(0,s.getLang)("mail_add_community_template")})]})),g===v&&(0,i.jsxs)("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate,children:[(0,i.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,i.jsxs)("label",{className:"TemplatesSettings__label",htmlFor:"name",children:[(0,s.getLang)("mail_name"),":"]}),(0,i.jsxs)("div",{className:"TemplatesSettings__input-container",children:[(0,i.jsx)(_.default,{id:"name",type:"text",initialValue:m.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),(0,i.jsx)("span",{className:"TemplatesSettings__notice",children:(0,s.getLang)("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")})]})]}),(0,i.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,i.jsxs)("label",{className:"TemplatesSettings__label",htmlFor:"text",children:[(0,s.getLang)("mail_text"),":"]}),(0,i.jsxs)("div",{className:"TemplatesSettings__input-container",children:[(0,i.jsx)(_.WithEmoji,{title:(0,s.getLang)("global_emoji_hint"),children:(0,i.jsx)(_.default,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:m.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")})}),(0,i.jsx)("span",{className:"TemplatesSettings__notice",children:(0,s.getLang)("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")})]})]}),(0,i.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,i.jsxs)("label",{className:"TemplatesSettings__label",children:[(0,s.getLang)("mail_hints"),":"]}),(0,i.jsx)("div",{className:"TemplatesSettings__input-container",children:(0,u.default)().map((e=>(0,i.jsx)(l.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",children:e.label},e.id)))})]})]})]}),(0,i.jsxs)("footer",{className:"TemplatesSettings__footer",children:[g===h&&(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)(d.default,{onClick:()=>this.go(v),children:(0,s.getLang)("mail_add_community_template")}),(0,i.jsx)(l.default,{onClick:a,children:(0,s.getLang)("mail_close")})]}),g===v&&(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)("div",{children:m.id&&(0,i.jsx)(d.default,{onClick:this.deleteTemplate.bind(null,m.id),children:(0,s.getLang)("mail_delete_community_template")})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(l.default,{appearance:"tertiary",onClick:()=>this.go(h),children:(0,s.getLang)("mail_cancel")}),(0,i.jsx)(l.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit",children:(0,s.getLang)("mail_save")})]})]})]})]})}}f.defaultProps={section:h};const b=(0,o.connect)(f)},42918:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});a(59357);var i=a(49892),n=a(41650),s=a(93421),r=n.default.getLang;const o=()=>[{id:"user name",label:r("mail_community_templates_hint_name"),process:e=>(0,i.oCacheGet)(e,(0,s.getPeer)(e)).first_name},{id:"user surname",label:r("mail_community_templates_hint_last_name"),process(e){var t=(0,i.oCacheGet)(e,(0,s.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:r("mail_community_templates_hint_your_name"),process:e=>(0,i.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:r("mail_community_templates_hint_your_last_name"),process(e){var t=(0,i.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:r("mail_community_templates_hint_community"),process:e=>(0,i.oCacheGet)(e,e.get().id).name},{id:"greeting",label:r("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return r(t>=3&&t<12?"mail_greeting_good_morning":t>=12&&t<17?"mail_greeting_good_afternoon":t>=17&&t<=23?"mail_greeting_good_evening":"mail_greeting_good_night")}}]},93498:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(75115),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26271),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(95724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15544),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(49535),_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(86409),_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(35676),_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(35429),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(87481),_web_helpers_isRedesign__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(69413);function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},_extends.apply(this,arguments)}var DATA_ATTR_SUBMENU_NAVIGABLE="data-uirmenu-submenu-navigable",uiRightMenu={initMenu:function(e,t){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"ui_rmenu_sliding")){var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item",e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",e),n=i||a,s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(n)[1],r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(n)[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(e)[1],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_slider",e);if(!t){var l={height:s,top:i?r:0};(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.setStyle)(o,l),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_sliding")}}},go:function(e,t,a,i){if(void 0===i&&(i={}),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.checkEvent)(t))return!0;var n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e),s=i,r=s.navOptions,o=s.ignoreSelected,l=void 0!==o&&o,c=s.switchMenuOptions;if(!l&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",n)==e)return!1;if(uiRightMenu.switchMenu(e,void 0,c),uiRightMenu.showProgress(e),!1===a)return!1;var d={onDone:function(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];null==r||null==r.onDone||r.onDone(...a),uiRightMenu.hideProgress(e)}},_=_extends({},r||void 0,{},d);return nav.go(a||e,t,_)},switchMenu:function(e,t,a){void 0===a&&(a={});var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",i),s=a.preventSubmenuExpand,r=void 0!==s&&s;if(e==n&&!t)return!1;uiRightMenu.initMenu(i);var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(e)[1],l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(e)[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(i)[1],c=[],d=[];if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(i,"_ui_rmenu_auto_expand")){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass)("_ui_rmenu_sublist",i),u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"_ui_rmenu_subitem")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("_ui_rmenu_sublist",e):!!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domNS)(e),"_ui_rmenu_sublist")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domNS)(e);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(_,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(this)&&this!==u&&(c.push(this),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hide)(this))})),r||!u||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(u)||(d.push(u),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.show)(u)),l=e.offsetTop,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(c,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.show)(this)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(d,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hide)(this)}))}var g=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_slider",i),m=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(g.style.top),p={height:o};return _shared_lib_browser__WEBPACK_IMPORTED_MODULE_1__.browser.msie_edge?p.marginTop=l-m+"px":p[cssTransformProp]="translateY("+(l-m)+"px)",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.setStyle)(g,p),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(n,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(i,"_ui_rmenu_auto_expand")?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(c.concat(d),(function(){uiRightMenu.toggleSubmenu(this)})):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"_ui_rmenu_subitem")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domPN)(e))&&uiRightMenu.toggleSubmenu((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domPN)(e)),!1},fixScroller:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e);if(t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(e)){var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(t,"ui_rmenu_sliding"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(e)[1];a&&uiRightMenu.hideSliding(t);var n=e.offsetTop,s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_slider",t),r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(s.style.top),o={height:i};_shared_lib_browser__WEBPACK_IMPORTED_MODULE_1__.browser.msie_edge?o.marginTop=n-r+"px":o[cssTransformProp]="translateY("+(n-r)+"px)",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.setStyle)(s,o),e.offsetLeft,a&&uiRightMenu.showSliding(t)}},unselectAll:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(e,"ui_rmenu_sliding"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",e),"ui_rmenu_item_sel")},hideSliding:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(e,"ui_rmenu_sliding")},showSliding:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_sliding")},showProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e));var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_loading_item",e);t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(t,"ui_rmenu_loading_item");var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",e);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.hideProgress)(e),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.showProgress)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domFC)(a).parentNode,"","",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_loading"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(a,"ui_rmenu_loading_item")},hideProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e)),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.hideProgress)(e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(e,"ui_rmenu_loading"),uiRightMenu.hideSliding(t);var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_loading_item",t);a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(a,"ui_rmenu_loading_item")},toggleSubmenu:function toggleSubmenu(name,ref,event){if(!event||!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.checkEvent)(event)){var isSubmenuNavigatedResult=toggleSubmenuNavigable(ref);if(isSubmenuNavigatedResult.navigated)return isSubmenuNavigatedResult.navGoResult;var menu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",ref),el,submenu;if("string"==typeof name?submenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_"+name+"_list",menu):(submenu=name,name=submenu.getAttribute("data-sublist-id")),el=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_"+name+"_toggle",menu),!submenu)return!1;void 0!==ref&&uiRightMenu.hideSliding(menu),el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.toggleClass)(el,"ui_rmenu_item_expanded",!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(submenu)),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideToggle)(submenu,submenu&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(submenu)[1]?100:0),setTimeout(_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_7__.updateNarrow,100);var onToggle=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domData)(el,"on-toggle");return onToggle&&setTimeout((function(){try{eval(onToggle)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,onToggle)}}),150),!1}},selectLabelNode:e=>(0,_web_helpers_isRedesign__WEBPACK_IMPORTED_MODULE_9__.isRedesign)()&&e?e.querySelector(".ui_rmenu_label-text"):e};function isItemSubmenuNavigable(e){return null==e||null==e.hasAttribute?void 0:e.hasAttribute(DATA_ATTR_SUBMENU_NAVIGABLE)}function toggleSubmenuNavigable(e){if(isItemSubmenuNavigable(e)&&!e.classList.contains("ui_rmenu_item_sel"))return{navigated:!0,navGoResult:uiRightMenu.go(e,void 0,void 0,{switchMenuOptions:{preventSubmenuExpand:!0}})};return{navigated:!1}}const __WEBPACK_DEFAULT_EXPORT__=uiRightMenu},21963:(e,t,a)=>{"use strict";a.d(t,{setHTML:()=>l,WithEmoji:()=>c,default:()=>_});a(75115),a(91181),a(56997),a(96253);var i=a(85893),n=a(67294),s=a(59397),r=a(47650);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},o.apply(this,arguments)}function l(e,t){var a=!!window.getSelection&&window.getSelection(),i=!1;if(a&&a.rangeCount){var n=a.getRangeAt(0);i=n.commonAncestorContainer?n.commonAncestorContainer:n.parentElement?n.parentElement():n.item(0)}for(var s=i;s&&s!==e;)s=s.parentNode;window.Emoji&&(s||window.Emoji.editableFocus(e,!1,!0),window.Emoji.insertHTML(t))}var c=n.memo((e=>{var t=e.title,a=e.children,o=n.useRef(),l=n.useRef({}),c=n.useMemo((()=>{var e=n.Children.only(a);return n.cloneElement(e,{ref:t=>{e.ref&&e.ref(t),l.current=t||{}},className:(0,s.classNames)(e.props.className,"WithEmoji__textbox")})}),[a]);return n.useEffect((()=>{window.Emoji&&window.Emoji.init(l.current.container,{noStickers:!0,onSend:()=>{},ctrlSend:()=>!0,noLineBreaks:!c.props.isMultiLine})}),[]),(0,i.jsxs)("div",{className:"WithEmoji__field _emoji_field_wrap",children:[c,(0,i.jsx)("div",{className:"WithEmoji__smile emoji_smile_wrap _emoji_wrap",children:(0,i.jsx)("div",{className:"emoji_smile _emoji_btn",ref:o,title:t,onMouseOver:e=>{e.persist(),window.Emoji&&window.Emoji.show(o.current,e)},onMouseOut:e=>{e.persist(),window.Emoji&&window.Emoji.hide(o.current,e)},children:(0,i.jsx)(r.default,{})})})]})}));class d extends n.Component{constructor(){super(...arguments),this.onChange=()=>{this.props.onChange&&window.Emoji&&this.props.onChange(window.Emoji.val(this.container))},this.containerRef=n.createRef(),this.state={value:this.props.initialValue}}componentDidMount(){if(this.container=this.containerRef.current,this.container&&!this.isMount){this.isMount=!0;var e=this.props.initialValue;window.Emoji&&window.Emoji.val(this.container,window.Emoji.emojiToHTML(e))}}componentWillUnmount(){this.container&&this.isMount&&(this.isMount=!1)}render(){var e=this.props,t=e.tabIndex,a=e.isMultiLine,n=(e.initialValue,function(e,t){if(null==e)return{};var a,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)a=s[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,["tabIndex","isMultiLine","initialValue"]));return(0,i.jsx)("div",o({role:"textbox",ref:this.containerRef,tabIndex:t,contentEditable:!0,"aria-multiline":a,onInput:this.onChange},n))}}d.defaultProps={isMultiLine:!1,tabIndex:0,initialValue:""};const _=d},35666:function(e,t,a){!function(t){"use strict";var a,i=Object.prototype,n=i.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag",c=t.regeneratorRuntime;if(c)e.exports=c;else{(c=t.regeneratorRuntime=e.exports).wrap=b;var d="suspendedStart",_="suspendedYield",u="executing",g="completed",m={},p={};p[r]=function(){return this};var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==i&&n.call(v,r)&&(p=v);var f=E.prototype=C.prototype=Object.create(p);w.prototype=f.constructor=E,E.constructor=w,E[l]=w.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(f),e},c.awrap=function(e){return{__await:e}},S(T.prototype),T.prototype[o]=function(){return this},c.AsyncIterator=T,c.async=function(e,t,a,i){var n=new T(b(e,t,a,i));return c.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},S(f),f[l]="Generator",f[r]=function(){return this},f.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var a in e)t.push(a);return t.reverse(),function a(){for(;t.length;){var i=t.pop();if(i in e)return a.value=i,a.done=!1,a}return a.done=!0,a}},c.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=a)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,n){return o.type="throw",o.arg=e,t.next=i,n&&(t.method="next",t.arg=a),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],o=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var l=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var r=s?s.completion:{};return r.type=e,r.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),I(a),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===e){var i=a.completion;if("throw"===i.type){var n=i.arg;I(a)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:P(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=a),m}}}function b(e,t,a,i){var n=t&&t.prototype instanceof C?t:C,s=Object.create(n.prototype),r=new k(i||[]);return s._invoke=function(e,t,a){var i=d;return function(n,s){if(i===u)throw new Error("Generator is already running");if(i===g){if("throw"===n)throw s;return A()}for(a.method=n,a.arg=s;;){var r=a.delegate;if(r){var o=M(r,a);if(o){if(o===m)continue;return o}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===d)throw i=g,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=u;var l=y(e,t,a);if("normal"===l.type){if(i=a.done?g:_,l.arg===m)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(i=g,a.method="throw",a.arg=l.arg)}}}(e,a,r),s}function y(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}function C(){}function w(){}function E(){}function S(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function T(e){function a(t,i,s,r){var o=y(e[t],e,i);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?Promise.resolve(c.__await).then((function(e){a("next",e,s,r)}),(function(e){a("throw",e,s,r)})):Promise.resolve(c).then((function(e){l.value=e,s(l)}),r)}r(o.arg)}var i;"object"==typeof t.process&&t.process.domain&&(a=t.process.domain.bind(a)),this._invoke=function(e,t){function n(){return new Promise((function(i,n){a(e,t,i,n)}))}return i=i?i.then(n,n):n()}}function M(e,t){var i=e.iterator[t.method];if(i===a){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=a,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=y(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=a),t.delegate=null,m):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function P(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=a,t.done=!0,t};return s.next=s}}return{next:A}}function A(){return{value:a,done:!0}}}("object"==typeof a.g?a.g:"object"==typeof window?window:"object"==typeof self?self:this)},45110:(e,t,a)=>{"use strict";var i,n,s,r;a.d(t,{MarusiaState:()=>i,MarusiaEvent:()=>n,CommunicationType:()=>s,MarusiaError:()=>r}),function(e){e[e.READY=0]="READY",e[e.TYPING=1]="TYPING",e[e.LOADING=2]="LOADING",e[e.LISTEN=3]="LISTEN",e[e.ANSWERING=4]="ANSWERING",e[e.ERROR=5]="ERROR"}(i||(i={})),function(e){e.PHRASE_START="phraseStart",e.PHRASE_UPDATE="phraseUpdate",e.PHRASE_FINISH="phraseFinish",e.ERROR="error",e.SUGGEST_UPDATE="suggestUpdate",e.SUGGEST_CLICK="suggestClick"}(n||(n={})),function(e){e.kws="kws",e.listen_command="listen_command",e.button="button",e.text="text",e.suggest="suggest",e.skill="skill",e.widget="widget",e.other="other"}(s||(s={})),function(e){e.HIDDEN="HIDDEN",e.BACKEND_COMMAND_TIMEOUT="BACKEND_COMMAND_TIMEOUT",e.USER_INTERRUPT="USER_INTERRUPT",e.ATTACH_LOAD_TIMEOUT="ATTACHES_LOAD_TIMEOUT",e.API_ERROR="API_ERROR"}(r||(r={}))},71623:(e,t,a)=>{"use strict";var i;a.d(t,{MarusiaMediaType:()=>i}),function(e){e[e.music=1]="music",e[e.radio=2]="radio",e[e.noise=3]="noise",e[e.tale=4]="tale",e[e.podcast=5]="podcast",e[e.books=6]="books",e[e.video=8]="video"}(i||(i={}))},57646:(e,t,a)=>{"use strict";a.d(t,{MARUSIA_PEER_ID:()=>n,IM_PAGE_HISTORY_CLASS:()=>s,IM_PAGE_HISTORY_MARUSIA_CLASS:()=>r,uuid:()=>o,isPayloadForCommand:()=>l,isSuggestCommand:()=>c,isInActiveTab:()=>d,disableMarusiaTextInput:()=>_,enableMarusiaTextInput:()=>u});var i=a(70655),n=(a(71623),-194070336),s="_im_page_history",r="im-page--marusia";function o(e){return void 0===e&&(e=32),(0,i.__spreadArray)([],(0,i.__read)(Array(e).keys()),!1).reduce((function(e){return""+e+Math.floor(16*Math.random()).toString(16)}),"")}function l(e,t){if(!e.voice_assistant)return!1;var a,i,n=e.voice_assistant;return!(n.phrase_id!==t.phraseId||(a=n.command_ids,i=t.commandIds,a.length!==i.length||!a.every((function(e){return i.includes(e)}))))}function c(e){return"event_suggest"===e.type||"text_suggest"===e.type}function d(){return!document.hidden}function _(e){e.contentEditable="false",e.classList.add("im-chat-input--text_disabled")}function u(e){e.contentEditable="true",e.classList.remove("im-chat-input--text_disabled")}},11279:(e,t,a)=>{"use strict";var i=a(70655),n=(a(79665),a(95767),a(30522),a(66108),a(83276),a(35666),a(96409),a(75115),a(50110),a(20075),a(19371),a(40851),a(59357),a(21466),a(98184),a(76774),a(98837),a(91181),a(56997),a(96253),a(88416),a(76142),a(54593)),s=a(75632),r=a(40906),o=a(86067),l=a(86125),c=a(95724),d=a(49535),_=a(39464),u=a(4837),g=a(94940),m=a(99349),p=a(82452),h=a(15544),v=a(10124),f=a(45523);function b(e,t,a,i){var s=(0,c.intval)((0,h.domData)(i,"msgid"));if(!(0,p.getSelectionText)()&&!(0,_.checkSelectClick)(a)){var r=(0,c.intval)((0,h.domData)(i,"peer"));return e.set(n.cancelSearch.bind(null,r)),e.get().longpoll.push([(0,f.changePeer)(r,s,!1,!1,t)]),!1}}function y(e,t){return{isAll:e=>(0,n.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return(0,n.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):(0,n.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){(0,v.destroyModule)(t)}}}function C(e){return e.findIndex((e=>"number"==typeof e.peerId&&e.href))>-1}function w(e,t,a){var i=b.bind(null,t,a);return y(0,(0,v.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",i)}}))}var E=a(54692),S=a(12439),T=a(80309);function M(e,t){return(0,p.toArray)(e).find((e=>(0,h.domData)(e,"list-id")===t))}function L(e,t){return(0,p.toArray)(e).findIndex((e=>(0,h.domData)(e,"list-id")===t))}function I(e,t,a,i){if(a){k(e,t,i);var n=(0,h.domData)(a,"list-id"),s=n&&M(t.children,n);s&&i.forEach((e=>(0,h.addClass)(s,e))),e.setState({hoveredListItemId:n})}}function k(e,t,a){var i=(0,h.domQuery)("."+a.join("."),t);i&&(0,p.toArray)(i).forEach((e=>{a.forEach((t=>(0,h.removeClass)(e,t)))})),e.setState({hoveredListItemId:null})}function P(e,t){var a=t&&(0,h.domQuery)("."+t.join("."),e)[0];return a?(0,h.domData)(a,"list-id"):null}function A(e,t,a){return e.map(t).reduce(((e,t)=>(e[t]=!0,e)),a)}function B(e,t,a){return{ids:A(a.get().elements,e,{}),scrolls:t,activated:!0}}function x(e,t,a){return a.elements=a.elements.filter((a=>t(a)!==e)),delete a.ids[e],Promise.resolve(a)}function D(e,t,a){var i=[];a.elements=a.elements.map((a=>{var n=t(a),s=e.filter((e=>t(e)===n))[0];return i.push(n),s||a}));var n=e.filter((e=>!(0,c.inArray)(t(e),i)));return a.elements=a.elements.concat(n),Promise.resolve(a)}function R(e){var t={};return e.forEach((e=>{"r"===e[0]&&t[`a,${e[1]}`]?delete t[`a,${e[1]}`]:t[`${e[0]},${e[1]}`]=e})),Object.keys(t).map((e=>t[e]))}function O(e,t,a,i,n,s,r){for(var o=0;o<i;o++)e=(0,h.domNS)(e);var l=(0,h.se)(n(t));return(0,h.domData)(l,"list-id",a),e?s.insertBefore(l,e):s.appendChild(l),r&&r(l),e}function N(e,t,a,i,n){var s=i.get(),r=s.limit,o=s.offset,l=function(e,t){var a=t.get();return!a._sortedEls&&e&&t.setState({elements:a.elements.sort(e),_sortedEls:!0}),t.get().elements}(a().sortFn,i).slice(0,o+r),c=(0,p.toArray)(e.children).map((e=>(0,h.domData)(e,"list-id"))).filter((e=>!!e)),d=l.map((e=>a().idFn(e).toString())),_=function(e,t){for(var a=[],i=Math.max(e.length,t.length),n=0;n<i;n++){var s=e[n],r=t[n];!s&&r?a.push(["a",r,n]):s&&!r?a.push(["r",s,n]):s!==r&&(a.push(["r",s,n]),a.push(["a",r,n]))}var o=R(a),l=R(a.reverse());return o.length>l.length?l:o}(c,d);if(function(e,t,a,i,n){if(0!==t.length){var s=(t=t.sort(((e,t)=>e[2]-t[2]))).filter((e=>"a"===e[0])),r=t.filter((e=>"r"===e[0]));if(r.map((t=>e.children[t[2]])).forEach((e=>(0,h.re)(e))),0!==s.length)for(var o=s.shift(),l=o[2],c=(O(e.children[l],a[o[2]],o[1],0,i,e,n),0);c<s.length;c++)o=s[c],O(e.children[l],a[o[2]],o[1],o[2]-l,i,e,n),l=o[2]}}(e,_,l,a().renderFn,a().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(i,t),n)return _.filter((e=>"a"==e[0])).map((e=>parseInt(e[1])))}function F(e,t,a,i,n,s,r){void 0===n&&(n=!1),void 0===s&&(s=0),void 0===r&&(r=0);var o=e.get(),l=t.getContainer().children,c=L(l,i||o.hoveredListItemId);c<0||(o.limit+o.offset<c?e.setState({offset:c-o.limit+1}).then(N.bind(null,t.getContainer(),t,a)):Promise.resolve()).then((()=>{var e=l[c],a=t.scrollTop(),i=t.getScrollHeight(),o=e.offsetHeight;s="center"===s?-.5*i:s,r="center"===r?i/2:r;var d=n?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),_=a+s>e.offsetTop,u=o+e.offsetTop>a+i-r;_?d(e.offsetTop-s):u&&d(e.offsetTop-i+o+r)}))}function U(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var a=arguments.length,i=new Array(a>2?a-2:0),n=2;n<a;n++)i[n-2]=arguments[n];return t(...i).then((()=>{e.get().loading=!1}))}function H(e,t,a){return a.scrolls||(a.scrolls={}),a.scrolls[e]&&!t||(a.scrolls[e]={scrolled:a.scrolled||0,scrollItem:a.scrollItem}),Promise.resolve(a)}function j(e,t,a,i){var n=e.get(),s=n.elements,r=i.getContainer(),o=e.setState({offset:n.offset+n.limit}).then((()=>{var a,o=n.offset,l=n.limit;return l+o>s.length?a=t().more(o,l).then((t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t))).then(K.bind(null,e,r,i,t,n.pipeId)):(a=Promise.resolve(),N(r,i,t,e)),a}));if(!a){var l=s.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";(0,_.wrapLoading)(r)(o,"bottom",l)}return o}function q(e,t){var a=e.get().pipeId;return!(void 0!==a&&void 0!==t&&a!==t)}function K(e,t,a,i,n,s){return!!q(e,n)&&e.setState(function(e,t,a){var i=e.filter((e=>!a.ids[t(e)]));return{_sortedEls:!1,els:i,ids:A(i,t,a.ids),elements:a.elements.concat(i)}}(s,i().idFn,e.get())).then(N.bind(null,t,a,i))}function G(e,t,a){var i=U.bind(null,t,j.bind(null,t,a)),n=(e,i)=>{(t.get().activated||e)&&(void 0!==i&&t.get().elements.length>0&&t.setState({scrolled:i}),a().onScroll&&a().onScroll())},s=(0,T.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:n.bind(null,!1),more:!!a().more&&i.bind(null,!1)}),r=(0,v.createModule)({handlers:(i,n)=>{n(e,"click",t.get().elCls,a().onClick)}});return t.setState(B(a().idFn,{},t)),{pipe:(e,i)=>(t.setState({pipeId:i}),e.then(K.bind(null,t,s.getContainer(),s,a,i))),replacePreserveOrder:e=>t.set(D.bind(null,e,a().idFn)).then(N.bind(null,s.getContainer(),s,a)),pipeReplace:(e,i,n)=>(void 0===n&&(n=!1),t.setState({pipeId:i,stop:!1}),e.then((e=>{if(q(t,i))return t.setState({elements:e,_sortedEls:!1,ids:A(e,a().idFn,{})}).then(N.bind(null,s.getContainer(),s,a,t,n))}))),wipe(){s.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,a)=>t.set(H.bind(null,e,a)),updateScroll(){s.update(!1,!0)},toTop(e,t){void 0===t&&(t=!1),t?s.smoothScroll(-s.scrollTop()):s.scrollTop(0),e&&n(e,0)},scrollTop:e=>s.scrollTop(e),restoreScroll(e){var a=t.get().scrolls,i=a[e];return i&&(t.setState({scrolls:(0,c.extend)({},a,{[e]:null})}),s.scrollTop(i.scrolled)),!!i},unsetScroll(e){t.setState({scrolls:(0,c.extend)({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var a=s.scroll.scroller,i=s.scrollTop(),n=i+("up"===e?-1:1)*a.clientHeight;t?s.smoothScroll(n-i):s.scrollTop(n)},scrollToElement(e,i,n,r){F(t,s,a,e,i,n,r)},getScroller:()=>s.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?i(e,s):Promise.resolve([]),add:(e,i)=>K(t,s.getContainer(),s,a,i,e),hoverNextElement(e,i,n){void 0===n&&(n={});var r=s.getContainer(),o=r.children,l=L(o,t.get().hoveredListItemId||P(r,i)),c=(0,p.toArray)(o).slice(l+1).find(a().hoverableFn);I(t,r,c,e),F(t,s,a,null,!1,n.top,n.bottom)},hoverPrevElement(e,i,n){void 0===n&&(n={});var r=s.getContainer(),o=r.children,l=L(o,t.get().hoveredListItemId||P(r,i)),c=l>=0&&(0,p.toArray)(o).slice(0,l).reverse().find(a().hoverableFn);I(t,r,c,e),F(t,s,a,null,!1,n.top,n.bottom)},hoverFirstElement(e,i){var n=s.getContainer(),r=n.children,o=(0,p.toArray)(r).findIndex(a().hoverableFn),l=r[o];!t.get().hoveredListItemId&&l&&(I(t,n,l,e),F(t,s,a,o,!1,i.top,i.bottom))},hoverElement(e,i,n){var r=s.getContainer(),o=r.children,l=L(o,e),c=o[l];c&&(I(t,r,c,i),F(t,s,a,l,!1,n.top,n.bottom))},unhoverElements(e){k(t,s.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(B(a().idFn,e,t))},getHoveredElement:()=>M(s.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(x.bind(null,e,a().idFn)).then(N.bind(null,s.getContainer(),s,a))},unmount(){(0,v.destroyModule)(r),s.destroy()}}}var W=a(63825),V=a(12202),z=a(49892),Y=a(59554),$=a(76852),Z=a(75053),Q=a(26338),X=a(89824),J=a(26271),ee=a(9720),te="_im_carousel",ae="_im_carousel_control",ie="Carousel__control--hidden";function ne(e){return(0,h.domClosest)(te,e.target)}function se(e,t){var a=t.querySelector("._im_carousel_control_left"),i=t.querySelector("._im_carousel_control_right"),n=t.querySelector("._im_carousel_viewport"),s=t.querySelector("._im_carousel_layer");if(i&&a&&n instanceof HTMLElement&&s instanceof HTMLElement){var r=n.offsetWidth,o=s.offsetWidth,l=r<o;a.classList.toggle(ie,!l||e<=0),i.classList.toggle(ie,!l||e+r>=o)}}function re(e){var t=ne(e),a=(0,h.domClosest)(ae,e.target),i=Number(a.dataset.direction);if(t){var n=t.querySelector("._im_carousel_viewport"),s=t.querySelector("._im_carousel_layer");if(n&&s&&i){var r=Number(t.dataset.scrollCount)||1,o=Math.floor(s.offsetWidth/s.childElementCount),l=(Math.floor(n.scrollLeft/o)+i*r)*o;se(l,t),n.scrollTo({left:l,behavior:"smooth"})}}}var oe=(0,ee.debounce)((function(e){var t=ne(e),a=t&&t.querySelector("._im_carousel_viewport");a&&se(a.scrollLeft,t)}),20);function le(e){var t=ne(e);(t&&t.querySelector("._im_carousel_viewport")).addEventListener("scroll",oe)}function ce(e){var t=ne(e);(t&&t.querySelector("._im_carousel_viewport")).removeEventListener("scroll",oe)}function de(e){return{unmount:function(){(0,v.destroyModule)(e)}}}var _e=a(93421),ue=a(27749),ge=a(7381),me=a(79288),pe=[],he=0,ve=!1;function fe(e){pe=pe.reduce(((t,a)=>{var i=a[0],n=a[1];return n(e)?t:t.concat([[i,n]])}),[])}function be(e,t){return void 0===t&&(t=[]),he++,{stop(){he--,function(e){pe=pe.filter((t=>t[0]!==e)),0===he&&(document.body.removeEventListener("click",fe,!0),ve=!1)}(e)},replaceOrAdd(a){var i=pe.filter((t=>{var a=t[0];return e===a})),n=function(e,t){return 0===t.length?t=>(e(t),!0):a=>{var i=t.reduce(((e,t)=>e&&!(0,h.domClosest)(t,a.target)),!0);return i&&e(a),i}}(a,t);i.length>0?function(e,t){pe=pe.map((a=>{var i=a[0],n=a[1];return i===e?[e,t]:[i,n]}))}(e,n):function(e,t){!1===ve&&(ve=!0,document.body.addEventListener("click",fe,!0)),pe=pe.concat([[e,t]])}(e,n)}}}var ye=a(54612),Ce=a(27181),we=(a(51876),a(25489)),Ee=a(79957),Se=a(50167),Te=a(10304),Me=a(51976),Le=a(66372),Ie=function(){var e=function(){for(var e,t,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,n=a.length,s={};i<n;i++)if((e=a[i])&&e[1]in document){for(i=0,t=e.length;i<t;i++)s[a[0][i]]=e[i];return s}return!1}(),t={request:function(t){var a=e.requestFullscreen;(t=t||document.documentElement)[a]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}();function ke(){window.cur.videoAutoplayScrollHandler&&window.cur.videoAutoplayScrollHandler()}var Pe=a(61381),Ae=a(87481),Be=a(86409),xe=a(76567);var De,Re,Oe,Ne,Fe,Ue,He,je,qe,Ke,Ge,We,Ve,ze,Ye,$e=J.browser.msie&&(0,c.intval)(J.browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function Ze(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var Qe=!1,Xe=!1,Je=100;function et(e){var t=e.get().peer;(0,_.isFullyLoadedTab)(e,t)&&!(0,_.isAnyMessageBeingEdited)(e)&&Date.now()-((0,_.getTab)(e,t).lastTyping||0)>1e3*n.ACTIVITY_PERIOD&&e.set(n.sendRecordingAudio.bind(null,t))}function tt(e){if(!Xe){Xe=!0,(0,_.lockButton)(Ue);var t={peer:qe.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise(((t,a)=>{var i=e.getFormData(),n=new $e;n.onload=n.onerror=function(e){var i=e.currentTarget.response;200==this.status&&i.length>0&&"{"==i[0]?(i=JSON.parse(i),t(i)):a()},n.open("POST",Ye.upload_url,!0),n.send(i)}))})(e).then((e=>e.file?new Promise(((a,i)=>{ajax.post("/docs.php",(0,c.extend)({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,i)=>{rt(),We([["doc",e+"_"+i,"audiomsg"]],{},t.peer),ut(),a()},onFail:function(e){i(e)},progress:null})})):Promise.reject())).then((()=>{(0,_.unlockButton)(Ue),Xe=!1})).catch((()=>{Xe=!1,(0,_.unlockButton)(Ue),(0,ye.showFastBox)((0,o.getLang)("global_error"),(0,o.getLang)("mail_audio_message_upload_error"))}))}}function at(){ze(),Re.innerHTML=Ze(Qe.duration),Qe.duration>=600&&_t()}function it(e){e.set(n.cancelRecording).then(ct)}function nt(){ze(),window.stManager.add(["voice_message_player.js","speech.js"],(function(){Qe||(Qe=Speech.newRecorder(),(0,d.addEvent)(Qe,"progress",at)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),Qe.record().then((()=>{var e;e=qe,Ye.isRecording=!0,(0,s.cancelStackPush)("audio_message_cancel",it.bind(null,e)),(0,Be.hideProgress)((0,h.geByClass1)("im-audio-message-send-wrapper",De)),Re.innerHTML="0:00",(0,h.addClass)(De,"im-audio-message_recording"),(0,h.removeClass)(De,"im-audio-message_recorded"),function(){De&&De.classList&&De.classList.remove("im-audio-message-input--hidden");(0,h.geByClass1)("_im_chat_input_parent",je).classList.add("im-chat-input--hidden")}(),(Ge=Speech.createVisualization("wave",Qe.source,Oe,{color:getComputedStyle(document.body).getPropertyValue("--white")})).start();var t=Oe.getBoundingClientRect();Je=(t.right-t.left)/3})).catch((e=>{AudioMessagePlayer.resumeGlobalMedia();var t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t="mail_audio_message_device_error";break;case"PermissionDeniedError":case"PermissionDismissedError":t="mail_audio_message_permission_error";break;case"Unsupported":t="mail_audio_message_unsupported_error"}(0,ye.showFastBox)((0,o.getLang)("global_error"),(0,o.getLang)(t)),console.error(e)}))}))}function st(){Qe&&Qe.stop(),Ge&&(Ge.destroy(),Ge=null)}function rt(){Ye.isRecording=!1,(0,s.cancelStackFilter)("audio_message_cancel")}function ot(){lt(),tt(Qe)}function lt(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),(0,d.removeEvent)(Qe,"finish",lt),(0,d.removeEvent)(Qe,"finish",ot),e=URL.createObjectURL(Qe.buffer),(0,h.domData)(Ke,"duration",Qe.duration),(0,h.domData)(Ke,"ogg",e),(0,h.domData)(Ke,"mp3",e),(0,h.geByClass1)("audio-msg-track--duration",Ke).innerHTML=Ze(Qe.duration),(0,h.geByClass1)("audio-msg-track--wave-wrapper",Ke).innerHTML=AudioMessagePlayer.getWave(Qe.wave,Je),(0,h.removeClass)(De,"im-audio-message_recording"),(0,h.addClass)(De,"im-audio-message_recorded")}function ct(e){void 0===e&&(e=!0),rt(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),(0,d.removeEvent)(Qe,"finish",lt),(0,d.removeEvent)(Qe,"finish",ot),st(),ut(),e&&Ve()}function dt(){Qe.isRecording?((0,d.addEvent)(Qe,"finish",ot),(0,d.removeEvent)(Qe,"finish",lt),st()):tt(Qe)}function _t(){(0,d.addEvent)(Qe,"finish",lt),(0,d.removeEvent)(Qe,"finish",ot),st()}function ut(){(0,h.removeClass)(De,"im-audio-message_recorded"),(0,h.removeClass)(De,"im-audio-message_recording"),De&&De.classList&&De.classList.add("im-audio-message-input--hidden"),(0,h.geByClass1)("_im_chat_input_parent",je).classList.remove("im-chat-input--hidden")}function gt(){(0,h.ge)("audiomsg_record"),Ke=(0,h.ge)("audiomsg_player"),je=(0,h.geByClass1)("_im_chat_input_w"),De=(0,h.geByClass1)("im-audio-message-input",je),Re=(0,h.geByClass1)("audio-msg-track--duration",De),Oe=(0,h.geByClass1)("audio-msg-track--wave",De),Fe=(0,h.geByClass1)("im-audio-message--cancel-btn",De),Ue=(0,h.geByClass1)("_im_audio_send",De),He=(0,h.geByClass1)("audio-msg-track--btn",De),(0,h.geByClass1)("im-chat-input--text",je);var e=(0,h.geByClass1)("im-chat-input--textarea",je);(0,h.addClass)(e,"_voice_field_wrap"),(0,d.addEvent)(Ne,"click",nt),(0,d.addEvent)(Fe,"click",ct),(0,d.addEvent)(Ue,"click",dt),(0,d.addEvent)(He,"click",_t)}function mt(){!function(){Qe&&(0,d.removeEvent)(Qe,"progress",at);(0,d.removeEvent)(Ne,"click",nt),(0,d.removeEvent)(Fe,"click",ct),(0,d.removeEvent)(Ue,"click",dt),(0,d.removeEvent)(He,"click",_t)}(),Ke=De=Re=Oe=Ne=Fe=Ue=He=null}function pt(e,t,a){return{cancelRecording:ct,start:function(){nt()},unmount(){ct(!1),mt()}}}function ht(e,t,a,i,s){var r;return qe=t,Ye=t.get().audio_msg,ze=et.bind(null,t),We=a,Ve=s,(r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia)&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(e){return new Promise((function(t,a){r?r.call(navigator,e,t,a):a(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var a={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode),(0,_.getAvailableMicrophones)().then((e=>{var a=e.length>0;a?(gt(),i()):(0,xe.setCookie)("remixvoice","0",7),t.set(n.setVoiceMessageAvail.bind(null,a))})).catch((e=>{throw(0,xe.setCookie)("remixvoice","0",7),e})),(0,(0,v.createMutations)(pt).bindMutations)(e,t,a)}var vt=a(85893),ft=a(67294),bt=a(73935),yt=a(18793),Ct=a(63729),wt=a(83295),Et=(a(83946),a(88420)),St=a(84137),Tt=a(75234),Mt=a(61540);function Lt(){return Lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},Lt.apply(this,arguments)}class It extends ft.Component{constructor(e){super(e),this.onLinkClick=e=>{var t=this.props.action.link;if(new RegExp(`^https:\\/\\/(.+\\.)?${Mt.VK_SITE_REGEX_SOURCE_UNSAFE}\\/gifts580392144\\?act=send&ref=[^&]+$`).test(t))return(0,ye.showBox)("al_gifts.php",{act:"get_gift_box",mid:580392144,fr:0,ref:t.split("&ref=")[1]},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),(0,d.cancelEvent)(e)},this.onButtonClick=()=>{var e=this.props,t=e.action,a=e.sendMessage,i=e.appHash,n=e.keyboardAuthorId,s=e.store,r=(0,Y.getCurrentTab)(s);if(r)return(0,Le.handleButtonClick)(t,a,s,{keyboardAuthorId:n,appHash:i,peerId:r.peerId,onBeforeSend:this.onBeforeCallbackActionSend,onSendSuccess:e=>{this.onCallbackActionSendSuccess(s,r.peerId,e)},onSendFail:this.onCallbackActionSendFail})},this.onBeforeCallbackActionSend=()=>{this.setState({isLoading:!0})},this.onCallbackActionSendSuccess=(e,t,a)=>{var i=()=>{this.setState({callbackTimeout:void 0,isLoading:!1})},n=setTimeout(i,Le.CALLBACK_TIMEOUT_MS),s={timeout:n,onCallback:i};e.set((e=>(0,Tt.setPressedCallbackButton)({peerId:t,eventId:a},s,e))),this.setState({isLoading:!0,callbackTimeout:n})},this.onCallbackActionSendFail=()=>{this.setState({isLoading:!1})},this.state={isLoading:!1,callbackTimeout:void 0}}componentWillUnmount(){this.state.callbackTimeout&&clearTimeout(this.state.callbackTimeout)}render(){var e=this.props,t=e.action,a=(e.sendMessage,e.appHash,e.keyboardAuthorId,function(e,t){if(null==e)return{};var a,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)a=s[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,["action","sendMessage","appHash","keyboardAuthorId"])),i=(0,Le.getButtonAppearance)(this.props),n=(0,Le.getButtonLabel)(this.props),s=t.type,r=(0,vt.jsx)(Et.default,Lt({wide:!0,overflow:!0},a,{type:t.type,appearance:i,className:`BotButton BotButton--${s} ${this.state.isLoading?"BotButton--isLoading":""}`,onClick:this.onButtonClick,children:(0,vt.jsx)("span",{className:"BotButtonLabel Button--overflow",dangerouslySetInnerHTML:{__html:n}})}));return t.type===Le.BUTTON_TYPE_OPEN_LINK?this.wrapLinkButton(r):r}wrapLinkButton(e){var t=this.props.action,a=(0,St.wrapAwayIfExternal)(t.link,!0);return(0,vt.jsx)("a",{href:a,className:"Keyboard__buttonWrapper",target:"_blank",rel:"nofollow noopener",onClick:this.onLinkClick,children:e})}}It.defaultProps={color:Le.BUTTON_COLOR_DEFAULT};const kt=It;class Pt extends ft.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props.store,t=this.props.send,a=e.get(),i=(0,u.getCurrentKeyboard)(e),n=a.keyboard_app_hash;return i&&i.buttons?(0,vt.jsx)("div",{className:(0,wt.classNames)("Keyboard",{"Keyboard--hidden":i.hide}),children:(0,vt.jsx)(yt.Scroll,{className:"Keyboard__scroll-wrapper",children:(0,vt.jsx)("div",{className:"Keyboard__container",children:i.buttons.map(((a,s)=>(0,vt.jsx)("div",{className:"Keyboard__row",children:a.map(((s,r)=>(0,vt.jsx)("div",{className:"Keyboard__button",style:{width:Pt.getButtonWidth(a.length)},children:(0,vt.jsx)(kt,{sendMessage:t,appHash:n,keyboardAuthorId:i.author_id,action:s.action,type:s.action.type,color:s.color,store:e})},`cell-${r}`)))},`row-${s}`)))})})}):null}}const At=(0,Ct.connect)(Pt);function Bt(){return document.getElementById("_im_keyboard_container")}function xt(e,t,a){return{init(){return new Promise((e=>{this.isMounted=!0,function(e,t,a){var i=Bt();if(i){var n=(0,vt.jsx)(Ct.default,{value:e,children:(0,vt.jsx)(At,{send:t})});bt.render(n,i,a)}}(t,a,e)}))},toggle:(e,a,i)=>t.set(n.toggleKeyboard.bind(null,e,a,i)),unmount(){var t=Bt();t&&this.isMounted&&bt.unmountComponentAtNode(t),this.isMounted=!1,(0,v.destroyModule)(e)}}}var Dt=a(42918),Rt=a(59397),Ot=a(95283),Nt=a(69823).default,Ft=a(69361).default,Ut=a(69361),Ht=Ut.MAIN,jt=Ut.EDIT;function qt(e,t){return(0,Dt.default)().reduce((function(t,a){return t.replace(new RegExp("({"+a.id+"})","gi"),a.process(e))}),t).replace(/&lt;br&gt;/gi,"<br>")}function Kt(e,t,a,s,r){var o;return{closeSettingsPopup:function(){o&&o.hide()},showSettingsPopup:function(e){var a=this,n="TemplatesSettings",s={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:function(){var s=document.getElementById(n);s&&bt.render((0,vt.jsx)(Ct.default,(0,i.__assign)({value:t},{children:(0,vt.jsx)(Ft,{popup:o,section:e,getTemplates:function(){return(0,u.getTemplates)(t)},saveTemplate:a.saveTemplate.bind(a),deleteTemplate:a.deleteTemplate.bind(a),closePopup:a.closeSettingsPopup.bind(a)},void 0)}),void 0),s),requestAnimationFrame((function(){return o.updateBoxCoords()}))}};(o=new ye.MessageBox(s).content('<div id="'+n+'"></div>')).show()},applyTemplate:function(e){var a=(0,u.getTemplates)(t).find((function(t){return t.id===e}));(0,Te.statlogsCommunityTemplatesClickEvent)(),s(qt(t,(0,Ot.prepareToWriting)(a.text)))},getPreparedTemplates:function(){return(0,u.getTemplates)(t).map((function(e){return Object.assign({},e,{name:e.name,text:qt(t,e.text)})}))},saveTemplate:function(e){var a=(0,Rt.decodeHTMLEntities)(e.name),i=(0,Rt.decodeHTMLEntities)(e.text);return t.set(e.id?n.updateTemplate.bind(null,e.id,a,i):n.createTemplate.bind(null,a,i))},deleteTemplate:function(e){return t.set(n.deleteTemplate.bind(null,e))},isNeedRenderTemplates:function(){var e=(0,_e.getPeer)(t);if(!e)return!1;if(!(0,u.isCommunityInterface)(t))return!1;var a=(0,Y.getCurrentTab)(t);return(!a||!(0,u.isChannelPeer)(a))&&!(0,u.isCommunityChat)(t,e)},toggleImText:function(e){void 0===e&&(e=this.isNeedRenderTemplates()),r(e)},update:function(){this.toggleImText()},unmount:function(){this.toggleImText(!1)}}}var Gt=a(76473),Wt=a(91040),Vt=a(19331);function zt(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function Yt(e,t){var a=t.queues[e].currEv;return a?(t.queues[e].errored.push(a),zt(e,t)):Promise.resolve(t)}function $t(e,t,a){return a.queues[e]?(a.queues[e].errored=t?[]:a.queues[e].errored.concat(a.queues[e].evs),a.queues[e].evs=[],zt(e,a)):Promise.resolve(a)}function Zt(e,t,a,i){var n=i.get().queues[e];if(n&&!n.currEv&&n.evs.length>0&&!n.pause){var s=Zt.bind(null,e,t,a,i),r=n.evs.shift();n.currEv=r,t(e,r).then((()=>{i.get().opts.waitCommit||i.set(zt.bind(null,e))})).then(s).catch((t=>i.set(Yt.bind(null,e)).then((()=>{a(e,function(e,t){var a=ea(e,t.get()).errored;return a.length>0&&a[a.length-1]}(e,i),t)})).then(s)))}}function Qt(e,t,a){var i=a.queues[e];return i.errored.filter((e=>e.mess.messageId===t)).forEach((e=>{e.failed=!1,i.evs.push(e)})),i.errored=i.errored.filter((e=>e.mess.messageId!==t)),Promise.resolve(a)}function Xt(e){var t=Date.now();return Object.keys(e.queues).forEach((a=>Jt(a,e,t,18e5))),Promise.resolve(e)}function Jt(e,t,a,i){void 0===a&&(a=0),void 0===i&&(i=0);var n=t.queues[e],s=[];return n.errored.forEach((e=>{e.ts>=a-i?(e.failed=!1,n.evs.push(e)):s.push(e)})),n.errored=s,Promise.resolve(t)}function ea(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function ta(e,t,a){return ea(e,a).pause=t,Promise.resolve(a)}function aa(e,t,a){return t.ts=Date.now(),ea(e,a).evs.push(t),Promise.resolve(a)}function ia(e){Object.keys(e.get().queues).forEach((t=>{e.set(Yt.bind(null,t)),e.set($t.bind(null,t,!1))}))}function na(e,t,a){var i=(0,S.default)({queues:{},debug:a&&a.debug,opts:(0,c.extend)({},a)},a);return a&&a.store?(i.setState(function(e){for(var t={},a=Object.keys(e.queues),i=a.length,n=0;n<i;n++){var s=a[n],r=e.queues[s];(r.currEv||r.evs.length||r.errored.length)&&(t[s]=r)}return{queues:t,opts:e.opts}}(i.get())),ia(i)):ia(i),{pushMessage:(a,n)=>i.set(aa.bind(null,a,n)).then((i=>{(0,Vt.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[n.rid].push("queue push message"),Zt(a,e,t,i)})),resend:(a,n)=>(void 0===n&&(n=null),i.set(Qt.bind(null,a,n)).then((()=>{var s=i.get().queues[a].evs.filter((e=>e.mess.messageId===n))[0];return Zt(a,e,t,i),s}))),resendAll:()=>i.set(Xt).then((()=>{Object.keys(i.get().queues).forEach((a=>{Zt(a,e,t,i)}))})),resendPeer:a=>i.set(Jt.bind(null,a)).then((()=>{Zt(a,e,t,i)})),reset:a=>i.set($t.bind(null,a,!0)).then((i=>{Zt(a,e,t,i)})),setErrored:(e,t)=>i.set((a=>(ea(e,a).errored=t,Promise.resolve(a)))),pause(e){i.set(ta.bind(null,e,!0))},isPaused:e=>!!ea(e,i.get()).pause,complete(a,n){var s=i.get();s.queues[a].currEv&&s.queues[a].currEv.rid===n&&i.set(zt.bind(null,a)).then((()=>{Zt(a,e,t,i)}))},resume(a){i.set(ta.bind(null,a,!1)).then((0,Wt.pause)(.1)).then((()=>{Zt(a,e,t,i)}))},inspectQueue(e,t){if(void 0===t&&(t=!1),!i.get().queues[e])return[];var a=i.get().queues[e];return(t&&a.currEv?[a.currEv]:[]).concat(a.evs.slice()).concat(a.errored.slice().map((e=>(0,c.extend)({},e,{failed:!0})))).sort(((e,t)=>e.ts-t.ts))}}}a(81303);var sa=a(76270),ra=a(59121),oa=a(20820),la=(a(3834),"avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf torrent".split(" "));function ca(e){var t=la.slice(0,la.length);if("types"===e){for(var a=t.length,i=0;i<a;++i)t.push(t[i].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+la.join(",."):""}function da(e){if(!cur.leaving){var t=(0,o.getLang)("video_upload_changed"),a=!1;if((0,c.each)(window.cur.videoUploaders,((e,t)=>{Upload.isSomethingUploading(t)&&(a=!0)})),1===e){if(!a)return!0;var i=(0,ye.showFastBox)({title:(0,o.getLang)("global_warning"),dark:!0},t,(0,o.getLang)("global_continue"),(function(){cur.leaving=!0,i.hide(),cur.onContinueCb&&cur.onContinueCb()}),(0,o.getLang)("global_cancel"),(function(){i.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return a?(0,r.winToUtf)(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function _a(e,t,a,i,n){if(a){i=i||cur,(n=n||{}).onUploadStart||(n.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,a){if(!1===da(1))return cur.onContinueCb=nav.go.pbind(a),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=da,n.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),n.onUploadStartDone&&n.onUploadStartDone()}),n.onUploadComplete||(n.onUploadComplete=(e,t)=>{var a=(0,oa.parseJSON)(t);a.video_id?ua(e,a,i):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);n.onUploadCompleteDone&&n.onUploadCompleteDone(),setTimeout((()=>{n.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&n.onUploadAllCompleteDone()}))}),n.onUploadProgress||(n.onUploadProgress=(e,t,a)=>{var n=void 0!==e.ind?e.ind:e;(0,h.show)("_im_media_preview"),i.showMediaProgress&&i.showMediaProgress("video",n,function(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,a))}),n.onUploadError||(n.onUploadError=(e,t)=>{(0,Ee.statlogsValueEvent)("upload_video_fails",1,a.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,a=e.fileName?t+"_"+e.fileName:e;if((0,h.re)("upload"+a+"_progress_wrap"),!(0,h.geByClass1)("popup_box_container")){var i=(0,o.getLang)("video_upload_error");setTimeout((0,ye.showFastBox)({title:(0,o.getLang)("global_error")},i).hide,2e3)}(0,ra.topError)("Upload failed",{dt:-1,type:102,url:((0,h.ge)("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var s=cur.maxFiles-(cur.savedVideos||[]).length,r=J.browser.safari?"":"video/*,"+ca("accept");a.lang&&(cur.lang=(0,c.extend)(cur.lang||{},a.lang));var l={accept:r,file_input:null,file_name:"video_file",file_size_limit:1024*(a.options.file_size_limit_in_GB||5)*1024*1024,file_types_description:"Video files",file_types:ca("types"),chooseBox:1,chunked:1,chunkSize:4194304,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:t,from:a.vars.from,lang:a.lang,max_attempts:3,max_files:s,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!a.options.hasOwnProperty("visible_dropbox")||a.options.visible_dropbox},d=Upload.init(e,"",{},Object.assign(l,n));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(d),d}}function ua(e,t,a,i){a=a||cur;var n=void 0!==e.ind?e.ind:e,s=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),r=s?n+"_"+s:e,l=t.owner_id+"_"+t.video_id,d=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo,_=(0,h.ge)("upload"+r+"_progress_wrap");_&&(0,h.hide)((0,h.geByClass1)("progress_x",_)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:l},{onDone:e=>{d||a.chooseMedia("video",l,(0,c.extend)(e[l],{upload_ind:r,upload_new:!0}));var n=t.owner_id,s=t.video_id,_=t.video_hash,u=0,g=()=>{ajax.post("al_video.php?act=encode_progress",{owner_id:n,vid:s,hash:_,need_thumb:1},{onDone:t=>{var _,u=!0;if(t){if(t.error)return _=(0,o.getLang)("video_upload_encode_error"),void setTimeout((0,ye.showFastBox)({title:(0,o.getLang)("global_error")},_).hide,2e3);t.thumb&&100===parseInt(t.percents,10)&&(u=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:n,vid:s},{onDone:t=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(l,t),void(0,h.re)("upload"+r+"_progress_wrap");a.hasChosenMedia("video",l)?a.updateChosenMedia("video",l,(0,c.extend)(t,{upload_ind:r,upload_new:!0})):i&&i(e,l)}}))}u&&(d||a.hasChosenMedia("video",l))&&setTimeout(g,1e3)},onFail:()=>{++u<3&&setTimeout(g,2e3*u)}})};g()}})}var ga="_im_upload_dropbox",ma="jpg jpeg png gif heic heif".split(" "),pa=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function ha(e){var t=ma.slice(0,ma.length);if("types"===e){for(var a=t.length,i=0;i<a;++i)t.push(t[i].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+ma.join(",."):"mask"===e?ma.join("|"):""}function va(e,t,a){var i=void 0!==t.ind?t.ind:t,n=t.fileName?i+"_"+t.fileName:t;if((0,h.re)("upload"+n+"_progress_wrap"),e().unchoose(n),!(0,h.geByClass1)("popup_box_container")){var s=(0,o.getLang)("mail_add_doc_error");"wrong_music_file"===a?s=(0,o.getLang)("mail_upload_music_fail"):"wrong_arch_file"===a||"wrong_arch_mp3_file"===a?s=(0,o.getLang)("mail_upload_arch_fail"):"photo"===Upload.options[i].file_name?s=(0,o.getLang)("mail_add_photo_error"):"video_file"===Upload.options[i].file_name?s=(0,o.getLang)("video_upload_error"):"wrong_mp3_file"===a&&(s=(0,o.getLang)("docs_upload_mp3_fail")),setTimeout((0,ye.showFastBox)({title:(0,o.getLang)("global_error")},s).hide,2e3)}(0,ra.topError)("Upload failed",{dt:-1,type:102,url:((0,h.ge)("file_uploader_form"+i)||{}).action}),Upload.embed(i)}function fa(e){var t=void 0!==e.ind?e.ind:e,a=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),i=a?t+"_"+a:e,n=(0,h.ge)("upload"+i+"_progress_wrap");return n&&(0,h.hide)((0,h.geByClass1)("progress_x",n)),i}function ba(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var a="^("+ha("mask")+")";return[].slice.call(t.items).every((e=>{var t=e.type.split("/");return new RegExp(a,"i").test(t[1])}))?"photo":[].slice.call(t.items).every((e=>"video"===e.type.split("/")[0]||~pa.indexOf(e.type)))?"video":"doc"}function ya(e){var t=(0,h.geByClass1)(ga),a=(0,h.geByClass1)("im-page--chat-header").getBoundingClientRect(),i=(0,h.geByClass1)("im-chat-input").getBoundingClientRect();(a.width<10||i.bottom-a.bottom<10)&&(e="none"),t.style.top=a.bottom+"px",t.style.left=a.left+1+"px",t.style.width=a.width-2+"px",t.style.height=i.bottom-a.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function Ca(){(0,h.geByClass1)(ga).classList.remove("im-dropbox--visible")}function wa(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function Ea(e,t,a,i){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),i().reHeight(a)}function Sa(e,t,a,i,n){var s=t.get().upload_opts,r=(0,h.geByClass1)("_im_upload_photo",n),o=(0,h.geByClass1)("_im_drop_photo",n);return Upload.init(r,s.url,s.params,{accept:ha("accept"),file_name:"photo",file_size_limit:26214400,file_types:ha("types"),file_match:s.opts.ext_re,lang:s.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:s.opts.server,error:s.opts.default_error,error_hash:s.opts.error_hash,dropbox:o,dragEl:bodyNode,onNoFilteredCallback(e){Upload.onFileApiSend(i,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,i){var n=(0,oa.parseJSON)(i);n.photos?function(e,t,a,i){var n=fa(e);ajax.post("al_photos.php",(0,c.extend)({act:"choose_uploaded"},t),{onDone:function(e,t){i().choose("photo",e,(0,c.extend)(t,{upload_ind:n}))},onFail:va.bind(null,i,e)})}(e,n,0,a):Ea(e,i,t,a)},onUploadProgress(e,t,i){var n=void 0!==e.ind?e.ind:e;a().progress("photo",n,wa(e,t,i))},onUploadError(e,t){(0,Ee.statlogsValueEvent)("upload_photo_fails",1,s.opts.server,t),va(a,e,t)},onDragEnter(e){if(!(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,Q.isMarusiaPeer)(t.get().peer)){var i=(0,h.geByClass1)("im-audio-message_recording");e.dataTransfer&&!i&&ya(ba(a,e.dataTransfer))}},onDragOut(){Ca()},onDrop(){Ca()}})}function Ta(e,t,a,i){var n=t.get().upload_doc_opts,s=(0,h.geByClass1)("_im_upload_doc",i),r=(0,h.geByClass1)("_im_drop_doc",i);return Upload.init(s,n.url,n.params,{file_name:"file",file_size_limit:1024*(parseInt(n.opts.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:n.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:n.opts.server,error:n.opts.default_error,error_hash:n.opts.error_hash,dropbox:r,dragEl:bodyNode,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,i){var s=(0,oa.parseJSON)(i);s.file?function(e,t,a,i){var n=fa(e),s={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};a.opts.imhash&&(s=(0,c.extend)(s,{from_place:"from_gim",imhash:a.opts.imhash})),ajax.post("docs.php",(0,c.extend)(s,t),{onDone:function(e,t,a){i().choose("doc",e+"_"+t,(0,c.extend)(a,{upload_ind:n}))},onFail:va.bind(null,i,e)})}(e,s,n,a):Ea(e,i,t,a)},onUploadProgress(e,t,i){var n=void 0!==e.ind?e.ind:e;a().progress("doc",n,wa(e,t,i))},onUploadError(e,t){(0,Ee.statlogsValueEvent)("upload_doc_fails",1,n.opts.server,t),va(a,e,t)}})}function Ma(e,t,a){(0,d.removeEvent)(bodyNode,"dragover dragenter");var i=(0,h.geByClass1)(ga),s=Ta(0,t,a,i),r=function(e,t,a,i,s){var r=t.get().upload_video_params;if(r){var o=(0,h.geByClass1)("_im_upload_video",s),l=(0,h.geByClass1)("_im_drop_video",s);return r.options.visible_dropbox=!1,_a(o,l,r,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,i){var s=(0,oa.parseJSON)(i);s.video_id?ua(e,s,t.get().textMediaSelector,((e,a)=>{var i=document.querySelector('[data-video="'+a+'"]'),s=e.editable.sizes.x[0]||e.thumb;if(i&&s){i.style.backgroundImage=`url(${s})`;var r=(0,h.gpeByClass)("_im_mess",i);"im"===cur.module&&r&&(0,n.updateVideoThumb)(t,r)}})):Ea(e,i,t,a)},onUploadProgress:function(e,t,i){var n=void 0!==e.ind?e.ind:e;a().progress("video",n,wa(e,t,i))},onUploadError:function(e,t){(0,Ee.statlogsValueEvent)("upload_video_fails",1,r.options.server,t),va(a,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(i,e)},onDragEnter:function(e){if(!(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,Q.isMarusiaPeer)(t.get().peer)){var i=(0,h.geByClass1)("im-audio-message_recording");e.dataTransfer&&!i&&ya(ba(a,e.dataTransfer))}},onDragOut:function(){Ca()},onDrop:function(){Ca()}})}}(0,t,a,s,i),l=Sa(0,t,a,r,i);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var c=(0,v.createModule)({handlers:e=>{var t=(0,h.ge)("im_full_upload");e(t,"change",(function i(n){if(window.Upload&&n.target.files){if(a().canAddMedia()){var s=Array.from(n.target.files),d=s.filter((e=>Upload.checkFileType(e.name,ha("types")))),_=s.filter((e=>Upload.checkFileType(e.name,ca("types"))));Upload.onFileApiSend(l,d),Upload.onFileApiSend(r,_)}else(0,ye.showFastBox)((0,o.getLang)("global_error"),(0,o.getLang)("global_error"));(0,v.destroyModule)(c);var u=t.cloneNode();u.value="",t.parentNode.replaceChild(u,t),e(t=u,"change",i)}}))}});return{paste(e){Upload.onFileApiSend(l,e)},unmount(){(0,v.destroyModule)(c),Upload.deinit(l),Upload.deinit(r),Upload.deinit(s)}}}var La=a(9971),Ia=a(29164),ka=a(21963),Pa=a(40367),Aa=a(17791),Ba=a(48743),xa=a(45110),Da=a(57646);function Ra(e,t,a,i,n,s,r){try{var o=e[s](r),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(i,n)}function Oa(e){return function(){var t=this,a=arguments;return new Promise((function(i,n){var s=e.apply(t,a);function r(e){Ra(s,i,n,r,o,"next",e)}function o(e){Ra(s,i,n,r,o,"throw",e)}r(void 0)}))}}var Na=2e3,Fa="_mr_button_accept",Ua="_mr_button_reject",Ha="_im_submit_btn",ja="_im_media_preview",qa="MassMentionWarning",Ka="MassMentionWarning--hidden";function Ga(){return Promise.all([a.e(68592),a.e(38838),a.e(89855)]).then(a.bind(a,77729)).then((e=>e.marusiaSdk))}function Wa(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function Va(e,t,a,i,n,s,o){if(void 0===o&&(o=!0),Li(t,i))return Promise.resolve(!1);var l=ei(i),d=(0,u.getTab)(i,t);l.getBoundAttach(a.message)&&(a.message=""),a.share_url=l.getShareUrl(),a.cancelled_shares=l.getCancelledShares();var g,m=function(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,r.intval)((0,r.rand)(0,2147483647).toFixed(0))}(),p={peerId:t,messageId:"rid"+m,flags:W.FLAG_OUTBOUND,date:(0,c.intval)(Date.now()/1e3)-i.get().timeshift,subject:"",text:(0,_.replaceSpecialSymbols)((0,c.clean)(a.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:i.get().gid?vk.id:null},type:W.ADD_MESSAGE,attaches:(g=a.attaches,g.map((e=>({id:e[1],type:e[0],kind:e[2]||null})))),minorSortId:d.minor_sort_id};return(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,Q.isMarusiaPeer)(t)&&(p.kludges.payload=a.payload),(0,Vt.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog[m]=[{text:p.text,timestamp:Date.now(),ts:window.lpConnect.options.ts}]),a.rid=m,a.mess=p,e(t,a),i.get().longpoll.push([p]),o&&s().clearText(t,i),n().newMessage(i),Promise.resolve(!0)}function za(e,t,a,i,n,s,r,o){void 0===o&&(o=!1),o||(o=e.get().peer);var l=ei(e),d=Ya(l,r),_=d?l.dData.attaches.map((e=>[e.type,e.id])):[],u={message:"",attaches:[].concat(_,s)};r&&(0,c.extend)(u,r),$a(e,t,!1).then((()=>Va(a,o,u,e,t,i,!1).then((a=>(d&&gi(e,n,t),Promise.resolve(a)))))).catch((t=>{(0,Ae.debugLog)(t),Ja(e,n)}))}function Ya(e,t){var a=e.dData,i=t&&t.sticker_referrer,n=i&&0===i.indexOf("suggestion"),s=t&&t.is_hintach_item;return(!a.txt.trim()||n||s)&&0===a.attaches.filter((e=>"reply"!==e.type)).length}function $a(e,t,a){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(n.changePeer.bind(null,e.get().peer,!1,!1)).then((()=>e.set((t=>(0,Aa.loadPeer)(t,e.get().peer,-1,!0,!1,"toEnd"))))).then((()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),a)))):Promise.resolve(a)}function Za(e,t,a){var i=!!(0,c.intval)((0,h.domData)(a,"val"));i!==cur.ctrl_submit&&(cur.ctrl_submit=i,(0,Pa.setInfo)("messages_multiline_input",String(Number(i))).then((()=>{})),e.set((e=>(0,Tt.setLocalSettingsValue)("ctrl_submit",Number(i),e))))}function Qa(e,t,a,i){return!e.get().delayed_ts&&setTimeout((()=>{e.set(n.setDelayedMessage.bind(null,!1,!1)).then((()=>{a(...i)}))}),t)}function Xa(e){void 0===e&&(e=(0,o.getLang)("mail_send_error"));var t=(0,o.getLang)("global_error");(0,ye.showFastBox)({title:t},e,(0,o.getLang)("mail_ok"),(()=>{nav.reload({force:!0})}))}function Ja(e,t){document.activeElement&&document.activeElement.blur(),Xa();var a=(0,h.geByClass1)("_im_send",t);return e.set(n.toggleSendingAbility.bind(null,!0)).then((()=>{(0,_.lockButton)(a)}))}function ei(e){return e.get().tfdraft||new Ia.ImDraft}function ti(e,t,a,i,s,r){var o=(0,_e.getPeer)(e),l=(0,u.getCurrentKeyboard)(e)||{},c=l.one_time,d=void 0!==c&&c,g=(0,h.geByClass1)("_im_send",i);return Promise.resolve().then((()=>{if((0,u.isSendingAvailable)(e)){if((0,n.isAnythingLoading)(e.get())||!(0,_.isFullyLoadedTab)(e,e.get().peer)){var i=Qa(e,Na,ti,(0,p.toArray)(arguments));return e.set(n.setDelayedMessage.bind(null,!0,i)).then((()=>{(0,_.lockButton)(g)}))}return clearTimeout(e.get().delayed_ts),e.set(n.setDelayedMessage.bind(null,!1,!1)).then((()=>(0,_.unlockButton)(g))).then($a.bind(null,e,t)).then((()=>{var i=r.keyboardAuthorId,n=r.action||{},l=n.attaches||[],c=(0,Rt.decodeHTMLEntities)(n.payload||""),d=(0,Rt.decodeHTMLEntities)(n.label||"");(0,_.isChatPeer)(o)&&(d=`@${(0,z.oCacheGet)(e,i).link.slice(1)} ${d}`);return(0,V.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,o,i),Va(a,o,{message:d,attaches:l,payload:c},e,t,s,!1)})).then((()=>d?e.set(n.deleteKeyboard.bind(null,o)):Promise.resolve())).then((()=>s().fixKeyboard()))}})).catch((t=>{(0,Ae.debugLog)(t),Ja(e,i)}))}function ai(e,t,a,i,s,r,l,c){return void 0===l&&(l=[]),Promise.resolve().then((()=>{var d=(0,h.geByClass1)("_im_send",i);if(!(0,u.isSendingAvailable)(e))return!1;if((0,n.isAnythingLoading)(e.get())||!(0,_.isFullyLoadedTab)(e,e.get().peer)){var g=Qa(e,Na,ai,(0,p.toArray)(arguments));return e.set(n.setDelayedMessage.bind(null,!0,g)).then((()=>{(0,_.lockButton)(d)}))}clearTimeout(e.get().delayed_ts),s().saveText(e);var m=!1,v=ei(e),b=v.dData.attaches.map((e=>{var t;if("poll"==e.type){var a=r.pollData();return a||(m=!0),[e.type,e.id,a]}return"share"==e.type&&(null==(t=e.object)?void 0:t.extpage_raw)?[e.type,e.object.extpage_raw]:[e.type,e.id]})).concat(l);if(m)return!1;var y=e.set(n.setDelayedMessage.bind(null,!1,!1)).then((()=>{(0,_.unlockButton)(d)})),C=(0,_e.getPeer)(e);return y.then((()=>{var n=v.dData.txt,r=t().getEditingMessage();if(r||n||b.length){if(r)return n||b.length&&!v.hasOnlyReplies(r)?(0,_.isMessageTooLong)(n)?void(0,ye.showFastBox)((0,o.getLang)("global_error"),(0,o.getLang)("mail_err_edit_too_long")):(t().cancelEditing(),void((0,La.wasMessageReallyModified)(e,r,v)&&((0,La.replaceMsgAfterEdit)(e,r,n,b,v.getShareUrl(),v.getCancelledShares()),t().sendEditMessage(e,r),e.get().longpoll.push([(0,f.editMessageLocallyEvent)(r)])))):void ii(e,t,i,r.messageId);var l=(0,_.splitMessageToParts)(n,b).map((i=>{var n={message:i.msgText||"",attaches:i.attaches||[]};return(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,Q.isMarusiaPeer)(C)&&c&&(n.payload=JSON.stringify(c)),Va(a,C,n,e,t,s)}));return Promise.all(l)}})).then($a.bind(null,e,t))})).catch((t=>{(0,Ae.debugLog)(t),Ja(e,i)}))}function ii(e,t,a,i){var s=e.get(),r=s.peer,l=(0,ye.showFastBox)({title:(0,o.getLang)("mail_dialog_msg_delete_title"),dark:1},(0,o.getLang)("mail_dialog_msg_delete_for_all"),(0,o.getLang)("mail_delete"),(function(e){(0,n.removeMessageSend)([i],r,null,"deleteforall",s),l.hide(),t().cancelEditing()}),(0,o.getLang)("global_cancel"),(function(){l.hide(),li((0,h.geByClass1)("_im_text",a))}))}function ni(e,t,a){return e.set(n.deliverMessage.bind(null,t,a,{}))}function si(e,t,a,i){e.get().longpoll.push([(0,f.failedMessage)(t,a.mess,i)])}function ri(e,t,a,i,s,r,o,l,c){var d,g=(0,ee.debounce)(Ii.bind(null,e,a),500);var m=Emoji.init((0,h.geByClass1)("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>Ri(e,t).then(function(){var t=Oa(regeneratorRuntime.mark((function t(a){var n,s,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=void 0,s=e.get().peer,!(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,Q.isMarusiaPeer)(s)){t.next=10;break}return t.next=5,Ga();case 5:if(r=t.sent,n={communication_type:xa.CommunicationType.text},r.canSentMessage()){t.next=10;break}return r.onClick(),t.abrupt("return");case 10:return t.abrupt("return",a&&i([],n));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(a,i){var s=e.get().peer,r=Emoji.val(i);(0,_.isReservedPeer)(s)||Li(s,e)||ei(e).dData.txt==r||!r||function(e){var t=e.get().peer;(0,_.isFullyLoadedTab)(e,t)&&!(0,u.isAnyMessageBeingEdited)(e)&&Date.now()-((0,u.getTab)(e,t).lastTyping||0)>1e3*n.ACTIVITY_PERIOD&&e.set(n.sendTyping.bind(null,t))}(e),Oi(e,t,r),Fi(e,t,r),g(i);var o=t.offsetHeight;if(d&&d!==o){var c=l().updateScroll();l().scrollFix(e,e.get().peer,c)}d=o},onStickerSend:(e,t,a)=>s([["sticker",e,a]],{sticker_referrer:t}),onHintachSend:(e,t)=>r([[e,t]],{is_hintach_item:!0}),uploadActions:o,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){c().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(m,{},(()=>l().renderStickersPanel(e))),e.setState({emojiOptId:m}),(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,Q.isMarusiaPeer)(e.get().peer)&&Emoji.toggleStickers(m,!0),m}function oi(e,t,a){var i=e.get().peer;if(!(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,Q.isMarusiaPeer)(i)){var n=Emoji.val((0,h.geByClass1)("_im_text",t));(0,u.isAnyMessageBeingEdited)(e)&&""!==n||Ri(e,t).then((t=>{var i=(0,c.intval)((0,h.domData)(a.target,"tttype"));(2===i&&!0!==t||1===i&&!0===t||3!==i&&""===n)&&window.tooltips&&tooltips.destroy(a.target,{fasthide:!0});var s=ei(e).dData.attaches.length>0;if((0,u.isAnyMessageBeingEdited)(e)&&""===n&&!s)return(0,h.domData)(a.target,"tttype",3),(0,$.showTooltip)(a.target,{text:(0,o.getLang)("mail_delete_for_all"),black:!0,force:3!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return(0,h.domData)(a.target,"tttype",1),(0,$.showTooltip)(a.target,{text:(0,_.isCommunityInterface)(e)?(0,o.getLang)("mail_send2"):(0,o.getLang)("mail_added_audiomsg"),black:!0,force:1!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});(0,h.domData)(a.target,"tttype",2);var r;return(0,$.showTooltip)(a.target,{text:(r=e.get().settings.ctrl_submit?1:0,(0,c.getTemplate)("ctrl_submit_hint",{enter_on:r?"":"on",ctrl_on:r?"on":""})),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==i,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:(0,p.toArray)((0,h.geByClass)(Ha)),val:e.get().settings.ctrl_submit?1:0}},onHide(){window.tooltips&&tooltips.destroy(a.target,{fasthide:!0})}})}))}}function li(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function ci(e,t){Emoji.val(e,(0,c.clean)(t)),li(e)}function di(e,t,a,i){var n=e.getFwdRaw(),s=t.querySelector("._im_media_fwd"),r=t.parentNode.querySelector("._im_replied_content");if(!((0,u.getCurrentKeyboard)(i)||{}).hide&&n&&a.toggleKeyboard(!0),s.innerHTML="",r.innerHTML="",n){var l=function(e,t){if(e.get().isEditing){var a=(0,_.getNowEditingMessage)(e);return a&&(0,Gt.hasReply)(a)}return"reply"===t.type}(i,n),d=l?r:s,g=n.object;d.innerHTML=l?ui(g):function(e,t,a,i){if(a.object&&a.object.authorName){var n=(0,_.renderShortText)(0,"",i.text,!0,(0,Q.convertKludgesToAttaches)(i.kludges,0));return(0,c.getTemplate)("im_attach_mess",{messages:n,text:i.authorName,date:(0,o.getSmDate)(i.date,e.get().timeshift),modifier:"im-fwd_msg"})}return(0,c.getTemplate)("im_attach_mess",{messages:(0,o.getLang)("mail_title_X_msgs",t.getFwdCount()),text:(0,o.getLang)("mail_im_fwd_msgs_title"),date:"",modifier:""})}(i,e,n,g)}}function _i(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),a=e.getFwdRaw();if(a){var i=a.object;t&&(t.innerHTML=ui(i))}else t.innerHTML=""}function ui(e){var t=(0,_.renderShortText)(0,"",e.text,!0,(0,Q.convertKludgesToAttaches)(e.kludges,0));return(0,c.getTemplate)("im_replied_message",{authorName:e.authorName,text:t})}function gi(e,t,a){return e.set(n.forwardMessages.bind(null,null,ei(e),!1)).then((()=>{var i=t.querySelector("._im_media_fwd"),n=t.parentNode.querySelector("._im_replied_content"),s=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");n&&n.children.length&&(n.innerHTML="",hi(e,a)),s&&s.children.length&&(s.innerHTML="",hi(e,a)),i&&i.children.length&&(i.innerHTML="",hi(e,a)),Oi(e,t)}))}function mi(e,t,a){var i=(0,_e.getPeer)(e);e.set(n.acceptMessageRequest.bind(null,i)).then((()=>{Di(e,i,t),a()})).catch((()=>Xa()))}function pi(e,t,a){var i=(0,_e.getPeer)(e);e.set((e=>(0,n.rejectMessageRequest)(i,!1,e))).then((()=>{(0,_.isClassicInterface)(e)&&t(e),a(e,i),i===e.get().peer&&e.get().longpoll.push([(0,f.resetPeer)()])})).catch((()=>Xa()))}function hi(e,t){var a=t().updateScroll();t().scrollFix(e,e.get().peer,a)}function vi(e,t,a,i){var s=e.get().peer,r=(0,c.inArray)(s,e.get().mutedPeers);e.set(n.toggleMutePeer.bind(null,s,!r,-1)).then(a().updateState.bind(null,s)),(0,d.cancelEvent)(i)}function fi(e,t,a,i){var s=e.get().peer;e.set(n.returnToChat.bind(null,s)).then((e=>e.set(n.getPinnedMessage.bind(null,s)))).then(a().updateChatTopic.bind(null,s)),(0,d.cancelEvent)(i)}var bi="close",yi="open",Ci="hide";function wi(e,t,a,i,n,s,r,o){if(r!==bi&&r!==yi&&r!==Ci)throw new Error(`Action "${r}" not found`);var l=e.get(),c=(0,u.getCurrentKeyboard)(e),d=(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,Q.isMarusiaPeer)(l.peer);((0,_.isCommunityInterface)(e)||!c||l.isEditing||d)&&(r=Ci);var g=r===bi||r===Ci,m=Promise.resolve();g||a.isMounted||(m=a.init());var p=!c&&r!==yi;return m.then((()=>((0,h.toggleClass)(t,"im-chat-input_open-keyboard",!g),(0,h.toggleClass)(t,"im-chat-input_close-keyboard",g&&r!==Ci),(0,h.toggleClass)(i,"im_chat-input--keyboard-button_hidden",r===Ci),a.toggle(l.peer,g,s)))).then((()=>{if(!p||o){var t=n().updateScroll();return n().scrollFix(e,l.peer,t)}}))}function Ei(e,t){if((0,u.isAnyMessageBeingEdited)(e))return!1;var a=e.get();if((0,_.isCommunityInterface)(e))return!1;if(!(0,Y.getCurrentTab)(e).moneyTransferAvail)return!1;if((0,_.isCommunityPeer)(t))return a.moneyTransferCommAvail;if((0,_.isUserPeer)(t)){var i=(0,c.inArray)(t,a.moneyTransferExcept);return t!=vk.id&&!i&&!(0,_.isContactPeer)(t)}return!1}function Si(e,t){return!(0,u.isAnyMessageBeingEdited)(e)&&(!!e.get().moneyRequestAvail&&(!!(0,Y.getCurrentTab)(e).moneyRequestAvail&&(!(!(0,_.isCommunityPeer)(t)&&!(0,_.isChatPeer)(t))||!!(0,_.isUserPeer)(t)&&(t!=vk.id&&!(0,_.isContactPeer)(t)))))}function Ti(e,t,a,i,n,s,r,o,l,d,g,m,p,f,b,y){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[(0,_e.getPeer)(e)])},toggleKeyboard:(t,a)=>(void 0===t&&(t=!(0,u.getCurrentKeyboard)(e).hide),void 0===a&&(a=!0),wi(e,i,m,g,s,a,t?bi:yi)),initKeyboard(){if(!e.get().peer||!(0,u.getCurrentKeyboard)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[(0,_e.getPeer)(e)];return wi(e,i,m,g,s,!0,t?bi:yi)},fixKeyboard(){var t,a=(0,u.getCurrentKeyboard)(e);return t=a?a.hide?bi:yi:Ci,wi(e,i,m,g,s,!0,t,!0)},hideKeyboard:()=>wi(e,i,m,g,s,!1,Ci),updateMediaSelectorOptions(e){var t=e.get().peer,a={gift:(0,_.isGiftOptionAvailableForPeer)(e,t)&&!(0,u.isAnyMessageBeingEdited)(e),money:(0,_.isMoneyOptionAvailableForPeer)(e,t)&&!(0,u.isAnyMessageBeingEdited)(e),poll:(0,_.isChatPeer)(t)},n=(0,h.geByClass1)("ms_items_more",i);Object.entries(a).forEach((e=>{var t=e[0],a=e[1],i=(0,h.geByClass1)("ms_item_"+t,n);(0,h.toggleClass)(i,"ms_item--hidden",!a),a?(0,h.show)(i):(0,h.hide)(i)}))},restoreDraft(e,n,r){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1})),this.updateMediaSelectorOptions(e);var o=e.get().peer,l={im:!0,fromId:-(0,u.getGroupId)(e)||vk.id,peer:o,moneyTransfer:{request:Si(e,o),send:Ei(e,o)}},c=(0,_e.getEmojiOptId)(e);if(void 0===c?e.setState({suggestionsConfig:l}):Emoji.setSuggestionsConfig(c,l),(0,_.isReservedPeer)(o))return Promise.resolve();var d=ei(e);return Emoji.val(a)!==d.dData.txt?(ci(a,d.dData.txt),Fi(e,i,d.dData.txt)):li(a),(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&((0,Q.isMarusiaPeer)(o)?(Ga().then((t=>{var i,n,s;(0,Q.isMarusiaPeer)(e.get().peer)&&t.init({iconContainer:document.querySelector("._im_send"),suggestContainer:document.querySelector("._marusia_suggest"),draftText:d.dData.txt,unreadMessages:null!=(i=null==(n=e.get().tabs[o])?void 0:n.unread)?i:0,needOnboarding:null==(s=e.get().tabs[o])?void 0:s.is_new,textInput:a,audioPlayer:(0,Se.getAudioPlayer)(),setTextValue:ci})})),void 0!==c&&Emoji.toggleStickers(c,!0)):(Ga().then((e=>{e.stopListening(),e.hide()})),void 0!==c&&Emoji.toggleStickers(c,!1))),d.prepareObjects(e.get().gid,n&&n.messageId).then((()=>{if(!Di(e,o,a)&&o==e.get().peer){for(var n=d.dData.attaches,l=0;l<n.length;l++)t.chooseMedia(n[l].type,n[l].id,n[l].object||{});if(di(d,i,this,e),r){var c=s().updateScroll();s().scrollFix(e,o,c)}Oi(e,i,d.dData.txt)}}))},sendMessage(){n([])},sendMessageFromKeyboard(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return ti.call(null,e,s,f,i,...a)},choose(e,a,i){t.chooseMedia(e,a,i)},updateChosenMedia(e,a,i){t.updateChosenMedia(e,a,i)},canAddMedia:()=>!t.hasRestrictingAttach()&&!Li(e.get().peer,e),isEmpty:e=>!(0,c.trim)(Emoji.val(a))&&!ei(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,a,i){t.showMediaProgress(e,a,i)},updateState(e){this.restoreKeyboard(),Di(e,e.get().peer,a)},focusOn(e){Emoji.editableFocus(a,!1,!0)},setDraft(e,t,a){void 0===a&&(a=!0);var i=(0,u.getTab)(e,e.get().peer);(0,Y.doesChatTabHaveFlag)(i,1024)&&!e.get().gid||(p&&p.update(),e.setState({tfdraft:t}),t&&this.restoreDraft(e,s().getEditingMessage(),a))},clearText(e,n){ei(n).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(a,""),gi(n,i,s);var r=s().updateScroll();s().scrollFix(n,n.get().peer,r)},attachMessages(e,t){if(e.get().peer===t){di(ei(e),i,this,e);var a=s().updateScroll();s().scrollFix(e,t,a),Oi(e,i)}},detachMessages(t){var a=ei(e).getFwdRaw();if(a&&!!a.id.split(";").find((e=>Math.abs(e)===t.messageId)))return gi(e,i,s).then((()=>{var t=s().updateScroll();s().scrollFix(e,e.get().peer,t)}));return Promise.resolve()},cancelRecording(){null==d||d.cancelRecording()},reHeight(e){var t=s().updateScroll();s().scrollFix(e,e.get().peer,t)},isBlocked:()=>Li(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers((0,_e.getEmojiOptId)(e),!t)},saveText(e){ei(e).setText(Emoji.val((0,h.geByClass1)("_im_text",i)))},resendAll(){b()},resendPeer(){y(e.get().peer)},unmount(){(0,v.destroyModule)(l),t.destroy(),o.unmount(),m.unmount(),p&&p.unmount(),Emoji.destroy((0,_e.getEmojiOptId)(e)),null==d||d.unmount()}}}function Mi(e,t){return!!(0,_.isChatPeer)(e)&&t.get().tabs[e].data.kicked}function Li(e,t){return Mi(e,t)||(0,u.getTab)(t,e)&&(0,u.getTab)(t,e).block_error>0||(0,_.isLocksAvailable)(t)&&(0,_.isPeerBlocked)(e,t)}function Ii(e,t,a){var i=e.get().peer,n=Emoji.val(a);(0,_.isReservedPeer)(i)||ei(e).dData.txt==n||Li(i,e)||(t.checkMessageURLs(n,!0,Na),ei(e).setText(n))}function ki(e){var t=ei(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function Pi(e,t){e.disabled=!0,e.contentEditable="false",(0,h.addClass)(e,"im-chat-input--text_disabled"),(0,h.addClass)(t,"im-chat-input_error"),(0,h.addClass)((0,h.geByClass1)("_im_page_history"),"is_tf_blocked")}function Ai(e,t){e.disabled=!1,e.contentEditable="true",(0,h.removeClass)(e,"im-chat-input--text_disabled"),(0,h.removeClass)(t,"im-chat-input_error"),(0,h.removeClass)((0,h.geByClass1)("_im_page_history"),"is_tf_blocked")}var Bi="renewSubscriptionButton",xi="im-chat-input--donut";function Di(e,t,a){var i,n=(0,h.gpeByClass)("_im_chat_input_parent",a),s=(0,h.geByClass1)("_im_chat_input_error",n),r=(0,h.geByClass1)("im-chat-input--error",n),l=(0,u.getTab)(e,t),d=Li(t,e);if(d){Pi(a,n);var g=function(e,t,a){switch(a.block_error){case 7:case 5:return(0,o.getLang)("mail_peer_deleted");case 14:return(0,o.getLang)("mail_community_deleted");case 11:return(0,o.getLang)("mail_group_banned_messages");case 28:return(0,o.getLang)("mail_cant_send_messages_by_time");case 29:return(0,o.getLang)("mail_cant_send_messages_by_web_bot");case 4:case 6:case 9:case 19:case 20:case 13:return(0,_.isCommunityPeer)(t)?(0,o.getLang)("mail_send_privacy_community_error"):(0,o.getLang)("mail_send_privacy_error");case 23:var i=(0,z.oCacheGet)(e,t);return(0,o.langSex)(i.sex,(0,o.getLang)("mail_blacklist_user","raw")).replace("{user}",i.kick_name);case 12:return(0,o.getLang)("mail_cant_send_messages_to_community");case 16:return(0,o.getLang)("mail_chat_youre_kicked");case 26:return(0,o.getLang)("mail_chats_is_disabled");case 0:if(Mi(t,e))return(0,o.getLang)("mail_chat_youre_kicked");var n=e.get().block_states[t].name;return(0,o.getLang)("mail_community_answering").replace("{username}",n);case 62:return(0,o.getLang)("mail_chats_user_not_don_error");default:return(0,o.getLang)("mail_send_privacy_error")}}(e,t,l),m=function(e,t){var a;return 62===(null==(a=(0,u.getTab)(t,e))?void 0:a.block_error)}(t,e),p=r.querySelector('[data-type="renewSubscriptionButton"]');if(m&&(null==r||r.classList.add(xi),!p)){var v=document.createElement("button");v.textContent=(0,o.getLang)("mail_renew_subscription"),v.classList.add("flat_button"),v.dataset.type=Bi,v.onclick=()=>(0,Se.showDonutSubscribePopup)(null,null,l.ownerId,"im",{type:"subscribe",params:{act:"subscribe_popup"}}),r.append(v)}if(p&&!m&&(null==r||r.classList.remove(xi),p.remove()),(0,u.isChannelPeer)(l)&&(0,h.addClass)((0,h.geByClass1)("_im_page_history"),"is_channel"),(0,Y.isBusinessNotifyTab)(l)&&(null==r||r.classList.add("im-chat-input--business-notify")),(0,_.isFvkcomgroup)(e,t)&&!e.get().gid){(0,h.addClass)(n,"is-f-vkcomgroup");var f=(0,c.inArray)(t,e.get().mutedPeers);g=(0,u.isChatActive)(l)?(0,c.getTemplate)("sImPeerMuteUnmute",{text:f?(0,o.getLang)("mail_im_unmute"):(0,o.getLang)("mail_im_mute"),type:f?"unmute":"mute"}):(0,c.getTemplate)("sImPeerReturnToChat",{text:(0,o.getLang)("mail_return_to_vkcomgroup")})}else(0,h.removeClass)(n,"is-f-vkcomgroup");return(0,h.val)(s,g),!0}!d&&(null==r?void 0:r.classList.contains(xi))&&(null==r||r.classList.remove(xi),null==r||null==(i=r.querySelector('[data-type="renewSubscriptionButton"]'))||i.remove());return l&&(0,_.tabIsMessageRequest)(l)&&!(0,_.tabIsRejectedMessageRequest)(l)&&!(0,Vt.partConfigEnabled)("simplified_start_conversation")?(Pi(a,n),(0,h.addClass)(n,"is-message_request"),(0,h.val)(s,(0,c.getTemplate)("sImPeerAcceptOrRejectMessageRequest",{cls_accept:Fa,cls_reject:Ua})),!0):(n.classList.contains("is-message_request")&&(Ai(a,n),(0,h.removeClass)(n,"is-message_request"),(0,h.val)(s,"")),a.disabled&&((0,h.removeClass)(n,"is-f-vkcomgroup"),(0,h.removeClass)((0,h.geByClass1)("_im_page_history"),"is_channel"),Ai(a,n),(0,h.removeClass)(n,"is-message_request"),(0,h.val)(s,"")),!1)}function Ri(e,t,a){return Promise.resolve().then((()=>{var i=null!=a?a:Emoji.val((0,h.geByClass1)("_im_text",t));if((0,c.trim)(i))return!(0,u.isAnyMessageBeingEdited)(e)||!(0,_.isMessageTooLong)(i);var n=ei(e),s=(0,_.getNowEditingMessage)(e);return n.hasAttaches()&&!n.hasOnlyReplies(s)}))}function Oi(e,t,a){var i=(0,h.geByClass1)("_im_send",t.parentNode);Wa(i,{fasthide:!0}),Promise.all([Ri(e,t,a),(0,_.isVoiceMessageAvailable)(e)]).then((t=>{var a=t[0],n=t[1];if((0,u.isAnyMessageBeingEdited)(e))(0,h.toggleClass)(i,"is_input_empty",!a),(0,h.attr)(i,"aria-label",(0,o.getLang)("mail_im_edit"));else{(0,h.toggleClass)(i,"im-send-btn_audio",!a&&n),(0,h.toggleClass)(i,"im-send-btn_send",a),a&&(0,h.removeClass)(i,"im-send-btn_saudio");var s=a?(0,o.getLang)("mail_send2"):(0,o.getLang)("mail_added_audiomsg");(0,h.attr)(i,"aria-label",s)}}))}function Ni(e){var t=(0,h.geByClass1)(qa,e);t.classList.contains(Ka)||t.classList.add(Ka)}function Fi(e,t,a){var i=(0,Y.getCurrentTab)(e);if(i){if(!(0,_.isChatPeer)(i.peerId)||(0,u.isChannelPeer)(i))return Ni(t);var n=(a.match(Me.MASS_MENTION_REGEXP)||[]).map((e=>e.slice(1)));if(0===n.length)return Ni(t),void e.set((e=>(i.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e))));var s=(0,h.geByClass1)(qa,t),r=(0,h.geByClass1)("MassMentionWarning__title",s),l=(0,h.geByClass1)("MassMentionWarning__text",s),c=(e,t)=>{i.dontReopenWarningForCurrentMassMention||(r.innerHTML!==e&&(r.innerHTML=e),l.innerHTML!==t&&(l.innerHTML=t),s.classList.remove(Ka))},d=Me.MASS_MENTION_ALIASES.all.some((e=>n.includes(e))),g=Me.MASS_MENTION_ALIASES.online.some((e=>n.includes(e)));switch(!0){case d&&i.membersCount>=11:return c((0,o.getLang)("mail_im_mass_mention_warning_title"),(0,o.getLang)("mail_im_mass_mention_warning_many_people_mentioned_text",i.membersCount-1));case g&&i.membersCount>=30:return c((0,o.getLang)("mail_im_mass_mention_warning_title"),(0,o.getLang)("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return Ni(t)}}}function Ui(e,t,a,r,l){cur.share_timehash=t.get().share_timehash;var d=(0,v.createMutations)(Ti),g=d.callMutations,m=d.bindMutations,p=Ma(0,t,g),b=ni.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var y=na(b,si.bind(null,t),{store:!0,key:"im_send_queue_"+vk.id,waitCommit:!0}),C=y.pushMessage,w=y.inspectQueue,E=y.resend,S=y.resendAll,T=y.resendPeer,M=y.setErrored,L=y.complete,I=za.bind(null,t,l,C,g,e),k=za.bind(null,t,l,C,g,e),P=ki.bind(null,t);(0,h.hide)((0,h.geByClass1)("ms_items_more_helper",e));var A,B=t.get().mediaTypes||[["photo",(0,o.getLang)("mail_added_photo")],["video",(0,o.getLang)("profile_wall_video")],["audio",(0,o.getLang)("profile_wall_audio")],["doc",(0,o.getLang)("profile_wall_doc")],["map",(0,o.getLang)("profile_wall_map")],["gift",(0,o.getLang)("profile_wall_gift")]];(t.get().moneyTransferAvail||t.get().moneyRequestAvail)&&B.push(["money",(0,o.getLang)("profile_wall_money")]);var x=new window.MediaSelector((0,h.geByClass1)("_im_media_selector",e),ja,B,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(a,i,s,r){return a&&g().toggleKeyboard(!0),function(e,t,a,i,s,r,o,l,c){if(!t.get().removingMedias){if("album"===s||"page"===s||"mail"===s||"reply"===s)return!1;if("share"===s&&!o.title)return!1;var d,_;r&&"string"==typeof s?(l&&ei(t).addBindUrl(l,s,r),ei(t).addAttach(s,r,o)):(ei(t).syncWithSelector(c),"number"==typeof r&&c.chosenMedias[r]&&(d=c.chosenMedias[r],_=ei(t),("string"==typeof d[0]&&"string"==typeof d[1]&&d[1]||"string"==typeof d[0]&&"group"===d[0])&&_.dData.cancelled.push(`${d[0]},${d[1]}`)));var u=e().updateScroll();if(e().scrollFix(t,t.get().peer,u),t.get().delayed_message&&!(0,n.isAnythingLoading)(t.get()))return a([]),!1;Oi(t,i)}}(l,t,A,e,a,i,s,r,x)},onMediaChange:function(){return function(e,t,a,i,n){if(!t.get().removingMedias){var s=n.getMedias().find((e=>"poll"===e[0]));s&&ei(t).addAttach(s[0],s[1],n.pollData(!0,!0)),Oi(t,i)}}(0,t,0,e,x)},editable:1,onChangedSize:function(){var a,i,n=l().updateScroll();l().scrollFix(t,t.get().peer,n),a=e,i=(0,h.ge)(ja).offsetHeight,(0,h.toggleClass)(a,"im-chat-input--overflowed",i>400)},sortable:1,teWidth:150,mail:1,teHeight:100,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}});A=ai.bind(null,t,l,C,e,g,x);var D=oi.bind(null,t,e),R=(0,h.geByClass1)("_im_send",e),O=(0,_.isCommunityInterface)(t)?null:ht(e,t,za.bind(null,t,l,C,g,e),(()=>{(0,h.addClass)(R,"im-send-btn_audio"),(0,h.removeClass)(R,"im-send-btn_static")}),(()=>{g().restoreKeyboard()}));!function(e,t){var a=(0,h.geByClass1)("_im_text",e);(window.Wall?Promise.resolve():window.stManager.add(["page.js"])).then((function(){Wall.initComposer(a,{lang:{introText:(0,o.getLang)("profile_mention_start_typing"),noResult:(0,o.getLang)("profile_mention_not_found")},toup:!0,getValue:()=>Ba.Ranges.isChatOrChannelPeer(t.get().peer)?(window.Emoji&&Emoji.editableVal||h.val)(a):"",onShow:()=>{(0,h.addClass)(e,"im_mention_shown");var t=data(a,"composer");if(t&&t.wdd&&t.wdd.shown){var i=0,n=!1,r=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,(0,h.val)(t.wddInput,""),Composer.toggleSelectList(t)};(0,c.each)(t.wdd.shown,(function(){this[0]&&(i++,"@"+t.curTerm==this[2]&&(n=!0))})),!i||n&&1==i?r():(0,s.cancelStackPush)("im_mention",r)}},onHide:()=>{(0,h.removeClass)(e,"im_mention_shown"),(0,s.cancelStackFilter)("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=x,t.set(n.initTextStore.bind(null,w,E,M,L));var N=(0,h.geByClass1)("_im_text",e);setTimeout((()=>{(0,_e.getPeer)(t)&&g().setDraft(t,(0,u.getTabDraft)((0,Y.getCurrentTab)(t))),ri(t,e,x,A,I,k,p,l,g),g().updateMediaSelectorOptions(t)}),0);var F=gi.bind(null,t,e,l),U=mi.bind(null,t,N,(()=>{var e=l().updateScroll();l().scrollFix(t,(0,_e.getPeer)(t),e)})),H=pi.bind(null,t,a,r),j=vi.bind(null,t,e,l),q=fi.bind(null,t,e,l),K=Za.bind(null,t);Di(t,t.get().peer,N);var G=e.querySelector("._im_keyboard_button"),W=function(e,t,a,i,n){return(0,(0,v.createMutations)(xt).bindMutations)((0,v.createModule)({handlers:(e,t)=>{}}),t,i)}(0,t,0,ti.bind(null,t,l,C,e,g)),V=(0,_.isCommunityInterface)(t)?function(e,t,a,n){var s=(0,(0,v.createMutations)(Kt).bindMutations)((0,v.createModule)({handlers:function(){}}),e,t,a,n);if("function"!=typeof s){s.toggleImText();var r=(0,vt.jsx)(Ct.default,(0,i.__assign)({value:e},{children:(0,vt.jsx)(Nt,{getTemplates:s.getPreparedTemplates,applyTemplate:s.applyTemplate.bind(s),isNeededRendering:s.isNeedRenderTemplates,showSettingsPopup:s.showSettingsPopup.bind(s,Ht),showCreatingTemplatePopup:s.showSettingsPopup.bind(s,jt)},void 0)}),void 0);bt.render(r,t)}return s}(t,e.querySelector("._message_templates_container"),(e=>(0,ka.setHTML)(N,e)),(t=>(0,h.toggleClass)(e,"im-chat-input--textarea_show-templates",t))):null,z=(0,v.createModule)({handlers:(a,i)=>{a(R,"click",(()=>{Ni(e),Promise.resolve().then((()=>Ri(t,e))).then(function(){var e=Oa(regeneratorRuntime.mark((function e(a){var i,n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a&&!(0,u.isAnyMessageBeingEdited)(t)){e.next=14;break}if(i=void 0,n=t.get().peer,!(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,Q.isMarusiaPeer)(n)){e.next=11;break}return i={communication_type:xa.CommunicationType.text},e.next=7,Ga();case 7:if((s=e.sent).canSentMessage()){e.next=11;break}return s.onClick(),e.abrupt("return");case 11:A([],i),e.next=15;break;case 14:(0,Q.isMarusiaPeer)(t.get().peer)?(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&Ga().then((e=>{e.onClick()})):(0,_.isVoiceMessageAvailable)(t).then((e=>{if(e){var a=ei(t);Ya(a)&&_i(a),Wa(R,{fasthide:!0}),null==O||O.start(),setTimeout((()=>(0,h.removeClass)(R,"im-send-btn_saudio")),300)}}));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),a(R,"mouseover",D),a(N,"focus",(()=>{t.get().longpoll.push([(0,f.transitionEvent)("message")]),cur.focused=t.get().peer})),a(N,"blur",(()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([(0,f.transitionEvent)(e)]),cur.focused=!1})),a(G,"click",(()=>g().toggleKeyboard(void 0))),a(G,"mouseover",(()=>{(0,$.showTooltip)(G,{text(){var e=(0,u.getCurrentKeyboard)(t);return!e||e.hide?(0,o.getLang)("mail_show_keyboard"):(0,o.getLang)("mail_hide_keyboard")},black:!0,shift:[4,5]})})),a((0,h.geByClass1)("MassMentionWarning__close"),"click",(()=>{!function(e,t){Ni(t),e.set((e=>((0,Y.getCurrentTab)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e))))}(t,e),li(N)})),i(e.parentNode,"click","_im_peer_mute_unmute",j),i(e.parentNode,"click","_im_peer_return_to_chat",q),i(e.parentNode,"click","_im_remove_replied",F),i(e.parentNode,"click",Fa,U),i(e.parentNode,"click",Ua,H),i(e,"click","_im_fwd_close",F),i(e,"click","_im_will_fwd",P),i(e,"keydown","_im_text",(e=>function(e,t,a,i){if(38===i.which&&a().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!(0,sa.hasAccessibilityMode)()&&!(0,n.isAnythingLoading)(e.get())){var s=(0,La.findLastMessageToEdit)(e,(0,Y.getCurrentTab)(e));if(s){if((0,Q.isMarusiaPeer)(e.get().peer))return;t().startEditing((0,u.getMessage)(e,e.get().peer,s))}}}(t,l,g,e))),i(bodyNode,"click",Ha,K)}}),Z=m(t,x,N,e,A,l,w,p,z,O,G,W,V,C,S,T);return Z.initKeyboard(),(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&Ga().then((a=>{a.on(xa.MarusiaEvent.PHRASE_START,(e=>{(0,Q.isMarusiaPeer)(t.get().peer)&&(ci(N,e),(0,Da.disableMarusiaTextInput)(N))})),a.on(xa.MarusiaEvent.PHRASE_UPDATE,(e=>{(0,Q.isMarusiaPeer)(t.get().peer)&&ci(N,e)})),a.on(xa.MarusiaEvent.PHRASE_FINISH,(a=>{(0,Q.isMarusiaPeer)(t.get().peer)&&(ci(N,a),a&&ai(t,l,C,e,g,x,void 0,{communication_type:xa.CommunicationType.button}),(0,Da.enableMarusiaTextInput)(N))})),a.on(xa.MarusiaEvent.ERROR,(()=>{(0,Q.isMarusiaPeer)(t.get().peer)&&(ci(N,void 0),(0,Da.enableMarusiaTextInput)(N))})),a.on(xa.MarusiaEvent.SUGGEST_UPDATE,(()=>{if((0,_.isClassicInterface)(t)){var e=l().updateScroll();l().scrollFix(t,t.get().peer,e)}else l().scrollBottom()})),a.on(xa.MarusiaEvent.SUGGEST_CLICK,(e=>{Va(C,Da.MARUSIA_PEER_ID,{message:e,payload:JSON.stringify({communication_type:xa.CommunicationType.suggest}),attaches:[]},t,l,g)})),a.on(xa.MarusiaEvent.ERROR,(()=>{(0,Q.isMarusiaPeer)(t.get().peer)&&ci(N,void 0)}))})),Z}var Hi=a(40962),ji="im_hist_search";function qi(e,t,a,i,n,r){return{focus(e){uiSearch.focus(t),function(e,t,a,i){(0,s.cancelStackPush)(ji,zi.bind(null,e,t,a,i))}(e,t,a,i)},changePeer(e,a){uiSearch.getFieldEl(t).value=a.get().tabs[e].searchText||""},search(){r({})},unmount(){(0,v.destroyModule)(n),(0,s.cancelStackFilter)(ji),i.then((e=>e.destroy()))}}}function Ki(e,t,a,i){e.set(n.setCurrentSearchDate.bind(null,e.get().peer,`${i.d}.${i.m}.${i.y}`)).then(Wi.bind(null,e,t,a))}function Gi(e,t){e.then((e=>{(0,d.triggerEvent)((0,h.geByClass1)("datepicker_control",t),"mousedown",!1,!0)}))}function Wi(e,t,a){var i=e.get().peer;uiSearch.showProgress(a),(0,n.searchMessagesInplace)(i,e.get()).then((i=>{uiSearch.hideProgress(a),t().insertSearch(i,e),(0,Hi.updateCounters)(location.href,document.referrer)})).catch((()=>{uiSearch.focus(a),uiSearch.hideProgress(a)}))}function Vi(e,t,a,i,s,r){if("keyup"!==r.type||13==r.which){var o=(0,c.clean)(uiSearch.getFieldEl(t).value);e.set(n.setCurrentSearch.bind(null,o,e.get().peer)).then(s.bind(null,e,i,t))}}function zi(e,t,a,i){(0,s.cancelStackFilter)(ji),i.then((e=>{e.hide()})),e.set(n.cancelSearch.bind(null,e.get().peer)).then((()=>{uiSearch.getFieldEl(t).value="",a().cancelSearch(e)}))}function Yi(e,t,a,i){a.then((e=>{e.hide()})),e.set(n.clearDate.bind(null,e.get().peer)).then(Wi.bind(null,e,t,i))}function $i(e,t,a){var i=(0,h.geByClass1)("_im_search_date_input",e),n=(0,h.geByClass1)("_im_search_history_input",e),s=function(e,t,a,i){var n='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+(0,o.getLang)("wall_clear_date_filter")+"</button></td>";return new Promise((e=>{window.stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(a,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+n+"</tr>",addRowsM:'<tr id="im_month_clear">'+n+"</tr>",onUpdate:i,pastActive:!0,noFuture:!0});e(t)}))}))}(0,0,i,Ki.bind(null,t,a,n)),r=Gi.bind(null,s,e),l=Vi.bind(null,t,n,i,a,(0,ee.debounce)(Wi,300)),c=zi.bind(null,t,n,a,s),d=Yi.bind(null,t,a,s,n),_=(0,v.createModule)({handlers:(t,a)=>{t((0,h.geByClass1)("_im_search_date",e),"click",r),t(uiSearch.getFieldEl(n),"keyup",l),t((0,h.geByClass1)("_im_start_inplace_search",e),"click",l),t((0,h.geByClass1)("_im_cancel_inplace_search",e),"click",c),a(e,"click","_im_clear_date",d)}});return qi(0,n,a,s,_,l)}var Zi=a(34304),Qi="_im_mess_fav",Xi="_im_mess_reply",Ji="_im_mess_forward",en="_im_mess_edit";function tn(e,t,a,i,n){var s=(0,_.getHistoryTopIndent)(e);(0,$.showTooltip)(t,{shift:[a,10],black:1,className:"_im_history_tooltip "+i,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>s+37,text:n})}function an(e,t,a){var i=(0,h.gpeByClass)("_im_mess",a),s=(0,c.intval)((0,h.domData)(i,"msgid")),r=e.get().peer,o=(0,u.getMessage)(e,r,s),l=!(0,g.isImportant)(o);return e.get().longpoll.push([{peerId:r,messageId:s,type:l?W.SET_FLAGS:W.RESET_FLAGS,flags:W.FLAG_IMPORTANT}]),e.set(n.favMessage.bind(null,[s],l,r)),nn(e,-10,t,a,!0),!1}function nn(e,t,a,i,n){var s=(0,h.domData)((0,h.gpeByClass)("_im_mess",i),"msgid"),r=(0,u.getMessage)(e,e.get().peer,s),l=(0,o.getLang)("mail_im_unmark_important"),c=(0,o.getLang)("mail_im_toggle_important"),d=(0,g.isImportant)(r)?l:c,_=d.length>16;n&&window.tooltips&&tooltips.destroy(i),tn(e,i,_?84:34,_?"im-star-tt_long":"im-star-tt",r?d:"")}function sn(e,t,a,i){var s=e.get().peer,r=+(0,h.domData)((0,h.domClosest)("im-mess",i.target),"msgid");if((0,_.canForwardMessages)(e,[r]))return(0,Te.statlogsForwardFromChannel)(),(0,n.processFwd)([r],s,e).then((t=>e.set(n.prepareForward.bind(null,t)))).then((()=>{(0,Zi.mount)(a,e)})),!1}function rn(e,t,a){var i=e.get().peer,s=+(0,h.domData)((0,h.domClosest)("im-mess",a.target),"msgid");return(0,n.processFwd)([s],i,e).then((t=>e.set(n.forwardMessages.bind(null,t,e.get().tfdraft,!0)))).then((()=>t().respond(e,i))),!1}function on(e,t,a,i){tn(e,i,18,"im-reply-tt",(0,o.getLang)("mail_im_mark_forward"))}function ln(e,t,a,i){tn(e,i,18,"im-reply-tt",(0,o.getLang)("mail_im_reply"))}function cn(e,t,a,i){var n=(0,c.intval)((0,h.domData)((0,h.gpeByClass)("_im_mess",i),"msgid")),s=(0,u.getMessage)(e,e.get().peer,n);return s&&t().startEditing(s),!1}function dn(e,t,a){tn(e,a,18,"im-edit-tt",(0,o.getLang)("mail_im_edit"))}function _n(e,t,a){var i=nn.bind(null,t,0),n=an.bind(null,t),s=on.bind(null,t,0),r=sn.bind(null,t,e.querySelector("_im_dialog_actions"),a),o=ln.bind(null,t,0),l=rn.bind(null,t,a),c=dn.bind(null,t),d=cn.bind(null,t,a),u=(0,v.createModule)({handlers:(t,a)=>{a(e,"click",Qi,n),a(e,"mouseover",Qi,i),a(e,"click",Ji,r),a(e,"mouseover",Ji,s),a(e,"click",Xi,l),a(e,"mouseover",Xi,o),a(e,"click",en,d),a(e,"mouseover",en,c)}});return function(e,t){return{markImportant(t,a,i){(0,_.updateStar)(t,a,e)},unmount(){(0,v.destroyModule)(t)}}}(e,u)}var un=a(12827);function gn(e,t,a,i){var n=a.get(),s=n.observer;n.targets.forEach((function(e){return s.unobserve(e)}));var r=function(e,t,a){var i=(0,_e.getPeer)(e);if(!(0,Y.isFullyLoadedTab)(e,i))return[];var n=(0,Y.getTab)(e,i);return n&&n.msgs?Object.keys(n.msgs).reduce((function(e,i){if(!n.msgs)return e;var s=(0,un.parseMessage)(n.msgs[i]);if(!t(s,n))return e;var r=a||document,o=r.querySelector("._im_mess_"+i)||r.querySelector("._im_expired_message_"+i);return o&&e.push(o),e}),[]):[]}(e,i,t);a.setState({targets:r}),r.forEach((function(e){return s.observe(e)}))}function mn(e,t,a,i){var n=(0,S.default)({observer:new IntersectionObserver(a,{root:t}),targets:[]});gn(e,t,n,i);var s=(0,v.createModule)({handlers:function(){}}),r=!1;return{update:function(){r||gn(e,t,n,i)},unmount:function(){n.get().observer.disconnect(),(0,v.destroyModule)(s),r=!0}}}var pn=a(75783),hn=a(75629);const vn={onNewMessagesChunk:function(e){var t=(0,h.geByClass)("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach((e=>LongView.register(e,"im")))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}};function fn(){return fn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},fn.apply(this,arguments)}function bn(e,t,a,i){var n=e instanceof Array?e:(0,h.geByClass)("_im_bar_date",e),s=t.contHeight();vn.onNewMessagesChunk();var r=n.reduce(((e,t)=>(e[(0,h.domData)(t,"date")]=[t.offsetTop+10,s,t],e)),{}),o=!a&&i.barMap?i.barMap:{};return i.barMap=(0,c.extend)(o,r),i.barMapKeys=Object.keys(i.barMap).sort(),Promise.resolve(i)}function yn(e,t){return t.barMapKeys.forEach((a=>{t.barMap[a][0]-=e})),Promise.resolve(t)}function Cn(e,t,a,i,n){var s=e.get().barMap[t],r=(0,_.isClassicInterface)(n)?68:20;return a-(s[0]+a-s[1])+i-r}function wn(e,t,a,i){return i.barTransition=i.barMap[t][2],a>0?((0,h.addClass)(i.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,h.addClass)(e,"im-page--date-bar-transition-inverse")):a<0&&((0,h.removeClass)(i.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,h.removeClass)(e,"im-page--date-bar-transition-inverse")),(0,h.addClass)(i.barMap[t][2],"im-page--date-bar-transition"),(0,h.addClass)(e,"im-page--date-bar-transition"),Promise.resolve(i)}function En(e,t){return t.barTransition&&((0,h.removeClass)(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),(0,h.removeClass)(e,"im-page--date-bar-transition"),Promise.resolve(t)}function Sn(e,t,a,i,n){var s,r,o=e.get(),l=a-t;o.barMapKeys.forEach((t=>{var o=Cn(e,t,a,i,n);if(o>=l){var c=s?Cn(e,s,a,i,n):a;s=c>o?t:s}else if(o<l){var d=r?Cn(e,r,a,i,n):0;r=o>d?t:r}}));var c={};return[[r,"prev"],[s,"cur"]].forEach((t=>{var s=t[0],r=t[1];s&&(c[r+"Bar"]=function(e,t){var a=e.get().barMap[t][2];return{text:a.textContent,date:(0,h.domData)(a,"date")}}(e,s),c[r+"Left"]=Cn(e,s,a,i,n)-l)})),c}function Tn(e,t,a,i,s){var r=e.get(),l=(0,n.isEverythingLoaded)(r),d=t.get(),u=s.scrollTop(),g=d.lastTop?d.lastTop-u:0;d.lastTop=u;var m=(0,hn.isPinnedMessageVisibleInTab)(r,r.peer)?(0,_.getPinnedMessageHeight)(e):0,p=(0,n.isSearchingInplace)(r.peer,r)&&r.tabs[r.peer]&&r.tabs[r.peer].top_banner?50:0,v=((0,_.isClassicInterface)(e)?68+m+p:0)-16,f=Sn(t,u,s.contHeight(),v,e),b=f.prevBar,y=f.curBar,C=f.prevLeft,w="translateY(0px)",E=!1,S=!1,T=!1;y||l||(y=function(e){var t=(0,h.geByClass1)("_im_mess",e),a=(0,h.domData)(t,"ts");return t&&a?{text:(0,o.getShortDate)((0,c.intval)(a),!1,!0,(0,o.getLang)("months_of","raw")),date:a}:null}(i)),y?E=y:S=!0,b&&y&&C>-32&&C<0&&(T=!0,S=!1,E=y,w=`translateY(${-32-C}px)`),E&&function(e,t){(0,h.domData)(e,"ts")!==t.date&&(e.innerHTML=t.text,(0,h.domData)(e,"ts",t.date),e.style.visibility="visible")}(a,E),T?t.set(wn.bind(null,a,b.date,g)):t.set(En.bind(null,a)),w&&(a.style.transform=w),(0,h.toggleClass)(a,"im-page--top-date-bar_no-b",S)}function Mn(e,t){var a=(0,h.geByClass1)("_im_top_date_bar",t),i={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},n=(0,S.default)(i),s=null,r=null,o=null,l=(0,ee.debounce)((e=>{var a=n.get();Object.keys(a).length&&!a.isDisabled&&n.set(bn.bind(null,t,e,!1))}),500);return{reset(i){n.get().isDisabled||n.set(bn.bind(null,t,i,!0)).then(Tn(e,n,a,t,i))},disable(){n.setState(fn({},i,{isDisabled:!0}))},enable(){n.setState({isDisabled:!1})},heightIncreased(e,t){n.get().isDisabled||(l(t),n.set(yn.bind(null,e)))},parseMore(i,s){n.get().isDisabled||n.set(bn.bind(null,i,s,!1)).then((()=>{Tn(e,n,a,t,s)}))},toggle(e){n.get().isDisabled&&e||a.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){n.get().isDisabled||(r=Date.now(),o||((0,h.addClass)(t,"im-page--top-date-bar_visible"),o=setInterval((function(){Date.now()-r>2e3&&((0,h.removeClass)(t,"im-page--top-date-bar_visible"),clearInterval(o),o=null)}),100)))},update(i){n.get().isDisabled||(s&&(clearTimeout(s),s=null),s=setTimeout((function(){Tn(e,n,a,t,i)}),300),Tn(e,n,a,t,i))},unmount(){s&&(clearTimeout(s),s=null),o&&(clearInterval(o),o=null),n.unmount()}}}var Ln=a(83303),In=a(28238),kn=a(40157),Pn=a(20929),An=a(37867);function Bn(){return Bn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},Bn.apply(this,arguments)}var xn="_im_top_banner_hide",Dn="_im_top_banner_reject_mr",Rn="_im_top_banner_business_notify",On="_im_top_banner_friend_add",Nn="_im_top_banner_button_gifts",Fn="hiddenCallBanners";function Un(e){return!e.children.length}function Hn(e,t,a){void 0===a&&(a={});var i=(0,h.geByClass1)("_im_dialog_actions",e);(0,h.toggleClass)(i,"im-page--chat-header_top-banner",t),(0,h.toggleClass)(i,"im-page--chat-header_top-banner--mr",!!a.messageRequest),(0,h.toggleClass)(i,"im-page--chat-header_top-banner--business-notify",!!a.businessNotify),(0,h.toggleClass)(i,"im-page--chat-header_top-banner--spam",!!a.spam)}function jn(e,t){var a=(0,h.geByClass1)(xn,e);a&&window.tooltips&&tooltips.hide(a),Hn(e,!1),t.innerHTML=""}function qn(e,t,a){var i=t.participants,n=i.count>0?(0,o.langNumeric)(i.count,(0,o.getLang)("mail_im_n_chat_members","raw")):"";return(0,c.getTemplate)("sImCallBannerContent",{user_list:(0,An.renderCallUserList)(e,i.list),title:(0,o.getLang)("calls_group_call_banner_title"),desc:n,cls:a?"CallBanner--classic":""})}function Kn(e){var t=e.peerId;if((0,_.isChatPeer)(e.peerId)&&!(0,u.isChatActive)(e))return!1;var a=e.callInProgress,i=cur.imDb.selectByKey(Fn);return i?!(!a||i[t]&&i[t]===a.join_link):!!a}function Gn(e,t,a){var i=(0,h.geByClass1)("_im_top_banner",e),s=(0,v.createModule)({handlers:(s,r)=>{var l=(0,h.geByClass1)("_im_dialog_actions",e);r(e,"click",xn,(()=>{var s=t.get().peer,r=(0,u.getTab)(t,s);Kn(r)?function(e){var t=e.peerId,a=e.callInProgress,i=cur.imDb.selectByKey(Fn)||{};cur.imDb.updateByKey(Fn,Bn({},i,{[t]:a.join_link}))}(r):t.set((e=>(0,n.hideTopBannerAction)(s,e))),jn(e,i);var o=!!(0,_.renderPinnedMessage)(t);(0,_.compensateHistoryHeightChange)(t,o,!0,a)})),r(e,"click","_im_top_banner_button",(s=>{var r=function(e,t,a,i,s){var r=e.target,o=t.get().peer;if(r.classList.contains("_im_call_banner_join_btn")){var l=r.dataset.link;return(0,_.joinCallFromIm)(t,o,l,!1,_.CALL_ENTRY_POINT_JOIN_BANNER),!1}var c=r.dataset.payload;return c?(t.set((e=>(0,n.callbackTopBannerAction)(o,c,e))),jn(a,i),!0):(r.classList.contains(Dn)&&(s().showMessageRequestRejectDialog(t),e.originalEvent.preventDefault()),r.classList.contains(On),r.classList.contains(Rn)&&(s().showBusinessNotifyDialog(),e.originalEvent.preventDefault()),r.classList.contains(Nn)&&((0,ye.showBox)("al_gifts.php",{act:"get_gift_box",mid:o,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),(0,V.statlogsValueEvent)("gifts_im_birthday_banner","click",o),e.originalEvent.preventDefault()),!1)}(s,t,e,i,a),o=!r,l=!!(0,_.renderPinnedMessage)(t)||!r;(0,_.compensateHistoryHeightChange)(t,l,o,a)})),r(l,"mouseover",xn,((e,t)=>{(0,$.showTooltip)(t,{text:(0,o.getLang)("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:bodyNode})}))}});return{renderPeer(t){var n=(0,u.getTab)(t,t.get().peer);if(n){var s=n.top_banner,r=n.callInProgress,o=!Un(i),l=Kn(n);!l&&!s||(0,u.isSearchShown)(t)?o&&jn(e,i):(Hn(e,!0,{messageRequest:s&&"message_request_banner"===s.name,businessNotify:s&&"business_notify_banner"===s.name,spam:s&&"spam_dialog"===s.name}),i.innerHTML=l?function(e,t){return(0,c.getTemplate)("im_top_banner",{text:qn(e,t,(0,u.isClassicInterface)(e)),icon:"",buttons:[(0,c.getTemplate)("sImCallBannerButton",{call_link:t.join_link}),(0,c.getTemplate)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,r):function(e){var t=e.icon?(0,c.getTemplate)("im_top_banner_icon",{icon:e.icon}):"",a=e.text;"employees_banner"===e.name&&(a=(0,Pn.replaceHyperLinks)(a,(e=>(0,Pn.linksReplacer)(e))),a=(0,kn.replaceMentions)(a));var i=(e.buttons||[]).map((e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return(0,c.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"reject_mr":return t+=" _im_top_banner_reject_mr",(0,c.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"business_notify":return t+=" _im_top_banner_business_notify",(0,c.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"spam":return t+=" _im_top_banner_spam",(0,c.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=` ${Nn}`,(0,c.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"friend_add":return t+=" _im_top_banner_friend_add",(0,c.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t});default:return(0,c.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}}));return!1!==e.can_hide&&(i=i.concat([(0,c.getTemplate)("im_top_banner_hide_btn",{})])),(0,c.getTemplate)("im_top_banner",{text:a,icon:t,buttons:i.join(""),classes:{message_request_banner:"im-top-banner--mr",business_notify_banner:"im-top-banner--business-notify",spam_dialog:"im-top-banner--spam"}[e.name]})}(s),s&&"birthday"===s.name&&(0,V.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer));var d=!Un(i);(0,_.compensateHistoryHeightChange)(t,d,o,a)}},unmount(){(0,v.destroyModule)(s)}}}var Wn=a(68040),Vn=a(6542),zn=a(9756),Yn=a(6593),$n=a(12860),Zn=a(20503),Qn=a(49031);var Xn=a(22131),Jn=a(11417),es=a(70162),ts={},as=(e,t,a,i)=>{delete ts[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,a):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,a)};var is={toggleFavorite:function(e,t,a){if(t&&t.stopPropagation(),!e.classList.contains("on")&&((i=Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers)&&!(i.length<Emoji.favoriteLimit)))return function(){if(!Emoji.favoriteLimitNoticed){var e=(0,es.langStr)(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);setTimeout(window.showFastBox(getLang("global_error"),e).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0}}(),!1;var i,n=e.getAttribute("data-sticker-id"),s=e.getAttribute("data-hash");return!(!n||!s)&&(!ts[n]&&(ts[n]=1,e.classList.toggle("on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:n,hash:s},{onDone:as.pbind(a,n,e)})))},getStickerUrl:function(e,t){var a=String(t);if(Jn.colorScheme.isDarkScheme()&&(a=a.replace(/b$/,"")+"b"),window.Emoji){var i,n,s,r=null==(i=Emoji.stickersById)||null==(n=i[e])||null==(s=n.sticker[Emoji.STICKER_FIELD_IMAGES])?void 0:s[a];if(r)return r}var o={id:e,size:a};if((0,Mt.isMvk)()){if(window.stickers_cache){var l=window.stickers_cache.getStickerImage(e,a);if(l)return l}return window.store.stickers&&window.rs(window.store.stickers.url_template,{id:e,size:a})}return window.getTemplate("stickers_sticker_url",o)}};function ns(e){var t=(0,_e.getPeer)(e),a=(0,Q.isContactPeer)(t),n=t&&(0,Y.getTab)(e,t),s=(0,X.getEmptyScreenUserInfo)(e,t);if(n&&(0,Y.isCasperChatTab)(n))return(0,c.getTemplate)("sImEmptyCasper");var r=a||(0,Y.isUserEmptyScreenRich)(e,t)&&s&&0!==(null==s?void 0:s.canWrite);if(!n||!(0,Vt.partConfigEnabled)("messages_new_empty_dialog_screen")||!r)return(0,o.getLang)("mail_im_here_history");var l,d,_=a?(0,Xn.prepareContactName)(n.tab):(0,c.stripHTML)(n.tab),u=a?(0,Xn.prepareContactName)(n.name):n.name,g=n.contact_name,m=a?(0,o.getLang)("mail_empty_history_with_contact").replace("{user_name}",u):(0,o.langSex)(n.sex,(0,o.getLang)("mail_empty_history_with_user","raw")).replace("{user_name}",u),p=g?(0,o.langSex)(n.sex,(0,o.getLang)("mail_saved_in_contacts_as","raw")).replace("{contact_name}",g):"",h=n.photo?'<img src="'+n.photo+'" alt="'+u+'">':(0,c.getTemplate)("sImContactAvatar",{name:(0,Xn.getUserInitials)(u),size:80,classes:""}),v=n.is_subscribed,f=v?"sImEmptyDialogStubUnsubscribeButton":"sImEmptyDialogStubSubscribeButton",b=v?(0,o.getLang)("mail_friend_request_sent"):(0,o.getLang)("mail_add_to_friends"),y=a||n.is_friend?"":(0,c.getTemplate)(f,{button_text:b}),C=(0,i.__read)(s?function(e){if(e.occupation){var t=("work"===e.occupationType?(0,Qn.getIcon20WorkOutline)():{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="education_outline_20__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="education_outline_20__education_outline_20"><path id="education_outline_20__Bounds" d="M0 0h20v20H0z"/><path d="M17.5 9.06 16 9.9V13c0 2.8-2.72 5-6 5s-6-2.2-6-5V9.89l-2.35-1.3a1.25 1.25 0 0 1 0-2.19L9.4 2.15c.37-.2.83-.2 1.2 0l7.75 4.25c.42.24.66.68.65 1.13v5.22a.75.75 0 1 1-1.5 0V9.06Zm-3 1.65-3.9 2.14c-.37.2-.83.2-1.2 0L5.5 10.7V13c0 1.9 1.98 3.5 4.5 3.5s4.5-1.6 4.5-3.5v-2.3ZM10 3.54 2.77 7.5 10 11.46l7.23-3.96L10 3.54Z" id="education_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"education_outline_20"}).icon;return[e.occupation,t]}if(e.bdate){t='<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M10.1 1.78c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17C9.15 3.33 9 3.6 9 4a1 1 0 0 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/><path clip-rule="evenodd" d="M17.29 11.7c-.22.3-.49.53-.79.7v.68c0 .53 0 .98-.03 1.34-.03.38-.1.74-.27 1.08-.26.52-.68.94-1.2 1.2-.34.17-.7.24-1.08.27-.36.03-.8.03-1.34.03H7.42c-.53 0-.98 0-1.34-.03-.38-.03-.74-.1-1.08-.27a2.75 2.75 0 0 1-1.2-1.2 2.8 2.8 0 0 1-.27-1.08c-.03-.36-.03-.8-.03-1.34v-.69a2.5 2.5 0 0 1-.79-.69A4.45 4.45 0 0 1 2 9h.75H2v-.02a1.42 1.42 0 0 1 0-.12 2.44 2.44 0 0 1 .4-1.14C2.83 7.05 3.64 6.5 5 6.5h10c1.36 0 2.17.55 2.6 1.22a2.58 2.58 0 0 1 .4 1.26v.01c0 1.08-.2 2.02-.71 2.71zM3.5 9.01c0 .92.18 1.48.41 1.79.2.27.52.45 1.09.45.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.57 0 .88-.18 1.09-.45.23-.31.4-.87.41-1.79v-.02c0-.02 0-.06-.02-.1-.02-.1-.06-.24-.14-.36C16.2 8.33 15.89 8 15 8H5c-.9 0-1.2.33-1.34.53a1.08 1.08 0 0 0-.16.48zM17.25 9H18zm-4.4 2.78c.43.44 1.11.97 2.15.97v.3c0 .57 0 .96-.02 1.25-.03.29-.07.43-.12.52-.12.23-.3.42-.54.54-.1.05-.23.1-.52.12-.3.02-.68.02-1.25.02h-5.1c-.57 0-.96 0-1.25-.02a1.36 1.36 0 0 1-.52-.12 1.25 1.25 0 0 1-.54-.54c-.05-.1-.1-.23-.12-.52C5 14 5 13.62 5 13.05v-.3c1.04 0 1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3c.44.44 1.12.97 2.16.97s1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3z" fill-rule="evenodd"/><path d="M6.4 1.78c.03-.09.17-.09.2 0 .2.54.4.9.55 1.17.2.38.35.64.35 1.05a1 1 0 0 1-2 0c0-.41.14-.67.35-1.05.16-.28.35-.63.55-1.17zm7.2 0c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17-.2.38-.35.64-.35 1.05a1 1 0 1 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/></g></svg>';var a=(0,i.__read)(e.bdate.split("."),2),n=a[0],s=a[1],r=new Date;return r.setDate(+n),r.setMonth(+s-1),[(0,o.langDate)(r.getTime(),(0,o.getLang)("mail_birthday_day_month","raw"),0,(0,o.getLang)("months_of","raw"),!0),t]}if(e.city){t='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="home_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="home_outline_20__Icons-20/home_outline_20"><g id="home_outline_20__home_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M3 11h-.04l-.18-.01A2.04 2.04 0 0 1 1.67 7.4L8.2 1.8a2.75 2.75 0 0 1 3.58 0l6.54 5.6A2.04 2.04 0 0 1 17 11v4.25c0 1.24-1 2.25-2.25 2.25h-2.8a.95.95 0 0 1-.95-.95V13.5a1 1 0 0 0-2 0v3.05c0 .52-.43.95-.95.95h-2.8c-1.24 0-2.25-1-2.25-2.25V11Zm11.75 5c.41 0 .75-.34.75-.75v-4.9c0-.47.38-.85.85-.85H17a.54.54 0 0 0 .35-.96l-6.54-5.6c-.46-.4-1.16-.4-1.62 0l-6.54 5.6a.54.54 0 0 0-.06.77c.09.1.21.17.31.18l.1.01h.65c.47 0 .85.38.85.85v4.9c0 .41.34.75.75.75H7.5v-2.5a2.5 2.5 0 1 1 5 0V16h2.25Z" id="home_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>';return[e.city,t]}return["",""]}(s):["",""],2),w=C[0],E=C[1],S=(null==s?void 0:s.mutualFriends.length)?(d=(l=s).mutualFriends.map((function(e){return(0,c.getTemplate)("sImEmptyDialogStubMutualFriend",{name:e.name,src:e.photo})})).join(""),(0,c.getTemplate)("sImEmptyDialogStubMutualFriends",{friends:d,text:(0,o.langNumeric)(l.commonCount,(0,o.getLang)("mail_mutual_friends_count","raw"))})):"",T=a?"":(0,c.getTemplate)("sImEmptyDialogStubUserInfo",{profile_href:n.href,subscribe_button:y,additional_info:w,additional_icon:E,mutual_friends:S});return""+(0,c.getTemplate)("sImEmptyDialogStub",{avatar:h,name:_,stub_text:m,secondary_block:T,saved_as:p,classes:(0,_e.isClassicInterface)(e)?"EmptyDialogStub--classic":""})+ss(e)}function ss(e){var t,a,n=(0,_e.getPeer)(e),s=(0,Y.getTab)(e,n),r=(0,_e.getEmojiOptId)(e);if(!s)return"";var o=s.is_new,l=(null===(t=window.stickersKeywords)||void 0===t?void 0:t["привет"])||[],d=new Map;(l.reduce((function(e,t){var a,i=(null===(a=window.Emoji.stickersById)||void 0===a?void 0:a[t])||{},n=i.packId,s=i.sticker;return t<0||!s?e:e.set(t,[t,256,"",s[3],n])}),d),o)&&((null===(a=window.Emoji.stickers[Zn.Emoji.TAB_NEW_CONVO_STICKERS])||void 0===a?void 0:a.stickers)||[]).reduce((function(e,t){return e.set(t[0],t)}),d);var _=(0,i.__spreadArray)([],(0,i.__read)(d.values()),!1).reduce((function(e,t){var a=(0,i.__read)(t,5),n=a[0],s=a[3],o=a[4],l={sticker_id:n,sticker_url:is.getStickerUrl(n,((0,c.isRetina)()?256:128)+"b"),animation_url:s,set_id:o||0,opt_id:r},d=s?"sImEmptyDialogAnimatedSticker":"sImEmptyDialogSticker";return""+e+(0,c.getTemplate)(d,l)}),"");if(!_)return"";var u=(0,c.getTemplate)("sImCarousel",{content:_,controls_class:"",scroll_count:"3"});return(0,c.getTemplate)("sImEmptyDialogStickers",{content:u})}var rs=a(19672),os=a(88870),cs=-30,ds="._im_to_end",_s="._im_to_mention",us="_im_error",gs="im-page--error--visible",ms="_im_mess_srv",ps="im_srv_mess_link",hs="_im_mess",vs="_im_replied_message",fs="center",bs="_im-call-snippet",ys="_im_mess_callsnippet",Cs="_im_call_snippet_join_btn",ws="_im_mess_pinned",Es="_im_subscribe_button",Ss="im-mess-stack--lnk",Ts="_msg_asr_toggle",Ms="im_msg_audiomsg--transcription-shown",Ls="_im_asr_setting_hint",Is=!1,ks={};function Ps(e){return e.get().isMassMentionsMessageAllowed}function As(e){var t=(0,u.getTab)(e,e.get().peer);return!!(0,u.getPinnedMessage)(e)||!(!t||!t.top_banner)}function Bs(e,t){var a=(0,p.unpackStore)(e),i=(0,u.getTab)(a,t);return(0,_.isChatPeer)(t)&&(0,hn.isPinnedMessageVisibleInTab)(a,t)||!!i.top_banner&&!(0,u.isSearchShown)(t,a)}function xs(e){return(0,_.getPinnedMessageHeight)(e)}function Ds(e,t,a){var i=a||(0,h.clientHeight)();return Math.min(i-15,Math.max(0,e,742+t.offsetTop))}function Rs(e,t){var a=(0,c.intval)((0,h.domData)(t.target,"msgid")),i=(0,h.gpeByClass)(`_im_mess_${a}`,t.target),n=(0,h.geByClass1)("_im_log_body",i),s=(0,h.geByClass1)("_im_mess_susp_cont",i);n.innerHTML=s.innerHTML}function Os(e,t){return(0,h.geByClass1)("_im_mess_"+t,e)}function Ns(e,t,a){var i,n,s,r,o,l,c,u,g,m=(0,h.geByClass1)(e,t);r={onStartDrag:(e,t)=>{(0,h.addClass)(bodyNode,"cursor_ns_resize"),i=t,n=t},onDrop:()=>{(0,h.removeClass)(bodyNode,"cursor_ns_resize")},onDrag:(e,s)=>{var r=Ds(n-i+s,t);(0,_.setClassicChatHeight)(r),a().fixHeight()}},c=function(e){o=void 0!==e.clientX?e.clientX:e.touches[0].clientX,l=void 0!==e.clientY?e.clientY:e.touches[0].clientY,r.onDrag&&r.onDrag.call(s,o,l)},u=function e(t){r.onDrop&&r.onDrop.call(s,o,l),(0,d.removeEvent)(document,"mouseup touchend mouseleave",e),(0,d.removeEvent)(document,"mousemove touchmove",c)},g=function(e){(1===e.which||e.touches&&e.touches[0])&&((0,d.addEvent)(document,"mouseup touchend mouseleave",u),(0,d.addEvent)(document,"mousemove touchmove",c),o=void 0!==e.clientX?e.clientX:e.touches[0].clientX,l=void 0!==e.clientY?e.clientY:e.touches[0].clientY,r.onStartDrag&&r.onStartDrag.call(s,o,l),r.onDrag&&r.onDrag.call(s,o,l),(0,d.cancelEvent)(e))},(s=m).beginDragHandler=g,(0,d.addEvent)(s,"mousedown touchstart",g)}function Fs(e,t){var a;a=(0,h.geByClass1)(e,t),(0,d.removeEvent)(a,"mousedown touchstart",a.beginDragHandler)}function Us(e){e().hideError()}function Hs(e,t,a,i,s){if((0,d.checkEvent)(i))return!0;var r=(0,Wn.fromQueryString)(s.getAttribute("href")),o=(0,c.intval)(r.msgid);o&&e.set(n.changePeer.bind(null,e.get().peer,o,!1)).then((()=>Xs(a,t,o,e))),(0,d.cancelEvent)(i)}function js(e,t,a){var i=(0,u.getTab)(t,a),s=(0,n.strHistory)(i.history);(0,h.toggleClass)(e,"im-page--history_empty-hist",!s)}function qs(e,t,a,i){if((0,h.hasClass)(a.target,"_im_mess_marker")){var n=a.target,s=(0,p.toArray)((0,h.geByClass)(_.FAILED_CLASS,t));window.tooltips&&s.map((e=>(0,h.geByClass1)("_im_mess_marker",e))).filter((e=>e!==n)).forEach((e=>tooltips.hide(e,{fasthide:!0})));var r=(0,h.domData)(i,"msgid");(0,$.showTooltip)(n,{content:(0,c.getTemplate)("im_failed_menu",{count:s.length,modifiers:(0,wt.classNames)("im-settings_failed",{"im-settings_no_delete":r>0,"im-settings_single":1===s.length}),id:r}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function Ks(e){return(0,h.geByClass1)("_im_peer_history",e)}function Gs(e,t){var a=t.contHeight(),i=e.scrollTop+(a-e.contHeight);t.scrollTop(i)}function Ws(e,t,a,i,s,r,o,l,c,d,g){void 0===d&&(d=!0),void 0===g&&(g=!1);var m=(t.get().tabs||{})[a];s().hideError(),r.renderPeer(t),l.renderPeer(t),c.render(t);var p=(0,u.isCasperChat)(t,a);if((0,h.toggleClass)(e,"im-page--history_casper",p),!t.get().tabHistoryNotChanged){r.reRenderTitle(t),js(e,t,a);var v=(0,n.strHistory)(m.history);if(v){var f=(0,h.geByClass1)("_im_peer_history",e);(0,h.val)(f,v)}else s().showEmptyScreen();(0,Se.getAudioPlayer)().isPlaying()&&(0,Se.getAudioPlayer)().updateCurrentPlaying(),ur(t,i,e)}if((0,n.isSearchingInplace)(a,t.get())?s().showSearch(t):s().cancelSearch(t,!1),o.changePeer(a,t),t.get().msgid)Xs(i,e,t.get().msgid,t);else if(m.scrollBottom&&d){Gs(m,i);var b=(0,_.isMessagesVisible)(t,e,i)[0];m.skipped||setTimeout((()=>{m.unread&&!b&&(ar(t,e,!0),ir(t,e,!0)),zs(t,i,e),Ys(t,i,e)}),100)}else Qs(i,e,s,t,g)||i.scrollBottom(cs);(0,Ce.initWidgets)(e)}function Vs(e,t,a){void 0===a&&(a=!1);var i=a||t.scrollTop(),s=t.scrollBottom(),r=t.contHeight(),o=e.get().peer;e.set(n.saveHistoryScroll.bind(null,o,i,s,r))}function zs(e,t,a){var i=(0,u.isGoToMentionVisible)(e),n=(0,u.isGoToEndVisible)(e),s=t.getScrollHeight()/4,r=t.scrollTop()>0;t.scrollBottom()>s&&(!n||i)&&r&&ar(e,a,!0,40)}function Ys(e,t,a){if(Ps(e)){var i=t.getScrollHeight()/4,n=t.scrollTop()>0,s=(0,u.isGoToMentionVisible)(e);t.scrollBottom()>i&&!s&&n&&ir(e,a,!0,40)}}function $s(e,t,a,i,s,r,o,l,c){if(void 0===c&&(c=!0),(e.get().history_init||(e.get().history_init=!0,!(l.scrollTop()>0)))&&!Ie.isFullscreen){s.update(l),s.show();var d=e.get().peer;if(0!==d&&(0,_.isFullyLoadedTab)(e.get(),d)&&(vn.onHistoryScroll(l.scrollTop()),!layers.visible)){var g=(0,u.getTab)(e,d);g&&!g.skipped&&l.scrollBottom()>40?(zs(e,l,r),Ys(e,l,r)):g.skipped||g.unread||(hr(e,r),vr(e,r));var m=(0,_.wrapLoading)(a);if(!(0,n.isSearchingInplace)(d,e.get())&&c&&i(l),!Is&&(o<0||0===l.scrollBottom())&&l.scrollBottom()<1e3){if((0,n.isSearchingInplace)(d,e.get()))return;if(g.skipped>0&&!e.get().no_moving_down){var p=(0,h.gpeByClass)("_im_page_history",r),v=e.get();Is=!0;var f=e.set(n.loadLessHistory).then(t().loadHistory.bind(null,v.peer,{reversed:!0})).then((()=>{t().updateObserver(),Is=!1,ar(e,p),ir(e,p),g.skipped||e.set(n.changePeer.bind(null,e.get().peer,!1,!1))}));return cr(p,!0),void f.then(cr.bind(null,p,!1))}}if(!Is&&l.scrollTop()<1e3){if((0,n.isSearchingInplace)(d,e.get())){Is=!0;var b=t().getSearchResulstModule();return b.isAll(e)?void(Is=!1):void m(b.loadMore(e).then((a=>{Is=!1,a&&(t().loadHistory(e.get().peer,{},e,a),i(l))})),"up")}var y=e.get();g.allShown||(Is=!0,m(e.set(n.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,y.peer,{})).then((()=>{Is=!1,i(l)})),"up"))}o<0&&Sr(e,d,l.scrollBottom(),r,t),ke()}}}function Zs(e,t){return window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?Promise.resolve():e.set(n.readTillSpecificMessage.bind(null,t,e.get().peer))}function Qs(e,t,a,i,s){var r=(0,h.geByClass1)("_im_unread_bar_row",t);if(r){var o=i.get(),l=o.peer,c=r.getBoundingClientRect(),d=(0,h.geByClass1)("_im_chat_body_abs",t).getBoundingClientRect().top+20;(0,_.isClassicInterface)(i)&&(d+=47+(Bs(o,l)?xs(i):0));var u=e.scrollTop()-d+c.top;return e.scrollTop(u),Vs(i,e,u),setTimeout((()=>{l===i.get().peer&&$s(i,a,Ks(t),(function(){}),s,t,0,e)}),80),(0,Vt.partConfigEnabled)("mail_history_unread_counter_observer")?a().updateObserver():function(e){var t=e.get().peer;if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)&&t)e.set(n.readLastMessages.bind(null,t))}(i),!0}return!1}function Xs(e,t,a,i,n){void 0===n&&(n="top");var s=Os(t,a);if(s){var r=(0,_.isClassicInterface)(i),o=i.get().peer,l=r?(0,h.clientHeight)():(0,h.geByClass1)("_im_chat_body_abs",t).offsetHeight,c=s.offsetTop+(0,h.domPN)(s).offsetTop+(0,h.domPN)((0,h.domPN)(s)).offsetTop+(0,h.domPN)((0,h.domPN)((0,h.domPN)(s))).offsetTop;r&&Bs(i,o)&&(c-=xs(i)),"top"===n?e.scrollTop(c-e.getScrollHeight()/2+l/2):e.scrollTop(c-e.getScrollHeight()+l/4),(0,h.addClass)(s,"im-mess_light"),setTimeout((()=>{(0,h.removeClass)(s,"im-mess_light")}),2e3)}}function Js(e,t,a){a.updateLastSeen(e)}function er(e,t,a,i,s,r){var o=(0,h.domData)(r,"action"),l=(0,h.domData)(r,"msgid"),c=(0,h.geByClass1)("_im_mess_marker",Os(a,l)),d=Number(l)>0?"edit":"send",_=e.get().peer,u=Ks(a);switch(o){case"resend":(0,Te.statlogsSendingRetry)("retry",d),t(s,r);break;case"resend_all":(0,Te.statlogsSendingRetry)("retry",d),i().resendPeer();break;case"delete":(0,Te.statlogsSendingRetry)("delete",d),e.set((t=>(0,n.removeFailed)(e,u,_,l,t)));break;case"delete_all":(0,Te.statlogsSendingRetry)("delete",d),e.set((t=>(0,n.removeFailed)(e,u,_,void 0,t)))}tooltips.hide(c,{fasthide:!0})}function tr(){var e=(0,ye.showBox)("al_im.php",{act:"a_business_notify_info_content"},{title:!1,onDone:()=>{var t=()=>e.hide();document.querySelectorAll("._im_business_notify_info_box_hide").forEach((e=>e.addEventListener("click",t))),e.setOptions({hideButtons:!0})}})}function ar(e,t,a,i){void 0===i&&(i=0);var s=e.get().peer;if(!(0,_.isReservedPeer)(s)){var r=e.get().tabs[s],o=(t||document).querySelector(ds),l=!1;(a||r.skipped>0||r.unread>0)&&!(0,n.isSearchingInplace)(s,e.get())?(l=!0,nr(t,e),(0,h.addClass)(o,"im-navigation_shown")):pr(o,!0),e.set(n.updateGoToEndVisibility.bind(null,[l,+i]))}}function ir(e,t,a,i){if(void 0===i&&(i=0),!Ps(e))return!1;var s=e.get().peer;if(!(0,_.isReservedPeer)(s)){var r=e.get().tabs[s],o=r.mentions,l=void 0===o?[]:o,d=r.mention_cmids,u=void 0===d?[]:d,g=(t||document).querySelector(_s),m=(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?u.length:l.length,p=!1;r.unread>0&&m>0&&!(0,n.isSearchingInplace)(s,e.get())?(p=!0,function(e,t,a){(e||document).querySelector(_s).querySelector("._im_to_mention_label").innerHTML=a>0?(0,c.formatCount)(a):""}(t,0,m),(0,h.addClass)(g,"im-navigation_shown")):pr(g,!0),e.set(n.updateGoToMentionVisibility.bind(null,[p,+i]))}}function nr(e,t){var a=t.get().peer,i=(0,u.getTab)(t,a);(e||document).querySelector(ds).querySelector("._im_to_end_label").innerHTML=Number(i.unread)>0?(0,c.formatCount)(i.unread):""}function sr(e,t){return void 0===t&&(t=0),(0!==e.scrollTop()||0!==e.scrollBottom())&&e.scrollBottom()<(t?30+t:30)}function rr(e,t,a,i,n){var s=(0,h.domData)(n,"msgid"),r=e.get().peer,o=(0,u.getMessage)(e,r,s);o.type===W.EDIT_MESSAGE?(a().sendEditMessage(e,o),a().resendMessage(r,s)):e.get().imQueueResend(r,s).then((t=>{e.get().longpoll.push([(0,f.resendEvent)(r,t.mess)])}))}function or(e,t,a,i,s,r){var o=(0,c.intval)((0,h.domData)(r,"peer")),l=(0,c.intval)((0,h.domData)((0,h.gpeByClass)("_im_mess",r),"msgid")),d=(0,u.getTab)(e,o);return e.set(n.restoreMessage.bind(null,l,o)).then(_.restoreMessage.bind(null,l,o,Ks(t))).then((()=>ur(e,a,t))),(0,n.restoreMessageSend)(l,o,d.hash,e.get().gid).then((()=>{l>d.lastmsg&&(0,n.loadActualLastMessage)(e,o).then((()=>i().updateState(o,e)))})),!1}function lr(e,t){if(e){var a=e.querySelector(ds);(0,h.toggleClass)(a,"im-navigation_loading",t)}}function cr(e,t){if(e){var a=e.querySelector(ds);(0,h.toggleClass)(a,"im-navigation_loading",t)}}function dr(e,t,a,i){var s=t.get().peer,r=(0,u.getTab)(t,s);if((0,_.isFullyLoadedTab)(t,s)){var o=Object.keys(r.msgs).find((e=>{var t=r.msgs[e];return!Array.isArray(t)&&(0,g.isUnread)(r,t)}));if(!r.skipped)return o?Xs(i,a,o,t):i.scrollBottom(cs),ar(t,a),ir(t,a),Sr(t,s,0,a,e),void(0,n.readTillSpecificMessage)(r.lastmsg,s,t.get());lr(a,!0),t.set((e=>(0,Aa.loadPeer)(e,s,-1,!0,!1,"goToEnd"))).then((()=>{lr(a,!1),e().changePeer(t,!1,!1)}))}}function _r(e,t,a,i){var n,s=t.get().peer,r=(0,u.getTab)(t,s),o=r.mentions,l=void 0===o?[]:o,c=r.mention_cmids,d=void 0===c?[]:c,_=(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?d[0]:l[0],g=(0,Vt.partConfigEnabled)("me_web_read_by_cmid")&&_?null==(n=(0,Gt.getMessageByCmid)(t,s,_))?void 0:n.messageId:_;if(!r.skipped)return g&&Xs(i,a,g,t,fs),ar(t,a,!0),ir(t,a),Zs(t,g),void Sr(t,s,0,a,e);lr(a,!0),t.set((e=>(0,Aa.loadPeer)(e,s,g,!0,!1,"goToMention"))).then((()=>{lr(a,!1),e().changePeer(t,!1,!1),s===t.get().peer&&(Xs(i,a,g,t,fs),Zs(t,g))}))}function ur(e,t,a,i){if(void 0===i&&(i=!1),(0,_.isClassicInterface)(e)){var n=t.contHeight(),s=(0,h.geByClass1)("_im_chat_input_w",a),r=(0,h.geByClass1)("im-chat-input",a),o=(0,h.geByClass1)("_im_chat_resize",a),l=(0,h.geByClass1)("EmptyDialogStickers",a);if(!1!==(i=!1!==i?i:(0,_.getClassicChatHeight)())&&i>0){var c=(0,h.clientHeight)(),d=(0,h.geByClass1)("_im_chat_audio_input_parent",a),u=Ds(i,a,c),g=u-((0,h.hasClass)(d,"im-audio-message_recording")||(0,h.hasClass)(d,"im-audio-message_recorded")?d:(0,h.geByClass1)("_im_chat_input_parent",a)).offsetHeight;o.style.height=c-u-15+"px",(0,h.setStyle)(s,{top:g+"px",bottom:"auto"})}else o.style.height="0px",(0,h.setStyle)(s,{top:"auto",bottom:"0px"});var m=(0,h.geByClass1)("_im_peer_history_w",a),p=r.offsetHeight-45,v=s.offsetHeight-16;return(0,h.setStyle)(m,{borderBottomWidth:l?p:v}),t.contHeight()-n}var f=t.getScrollHeight();return t.update(!1,!0),f-t.getScrollHeight()}function gr(e,t,a,i){var n=t.offsetHeight;i(),e.heightIncreased(t.offsetHeight-n,a)}function mr(e,t){var a=t.getBoundingClientRect().top;(0,$.showTooltip)(t,{className:"im-page--admin-tt",text:(0,o.getLang)("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:a>200})}function pr(e,t){void 0===t&&(t=!1),(0,h.hasClass)(e,"im-navigation_shown")&&(t&&(0,h.addClass)(e,"im-navigation_fast"),(0,h.removeClass)(e,"im-navigation_shown"),t&&(e.offsetHeight,(0,h.removeClass)(e,"im-navigation_fast")))}function hr(e,t,a){void 0===a&&(a=!1);var i=t.querySelector(ds);e.set(n.updateGoToEndVisibility.bind(null,[!1,0])),pr(i,a)}function vr(e,t,a){void 0===a&&(a=!1);var i=t.querySelector(_s);e.set(n.updateGoToMentionVisibility.bind(null,[!1,0])),pr(i,a)}function fr(e,t,a){Ie.isFullscreen||0===t.get().peer||(0,_.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function br(e,t){var a=e.get(),i=a.peer,s=(0,h.domClosest)(ms,t.target),r=(0,c.intval)((0,h.domData)(s,"msgid")),o=(0,u.getMessage)(e,i,r),l=o&&(0,g.isServiceMsg)(o)&&o.kludges.source_act;if(l===_.CHAT_PIN_MESSAGE||l===_.CHAT_UNPIN_MESSAGE){var d=s.querySelector(".im_srv_mess_link");if(d&&"A"!==d.tagName){var m=o.kludges.source_chat_local_id;if(!m||ks[m])return;ks[m]=(0,n.getMessageLocalId)(i,m,a).then((e=>{var t=e[0];if(t){var a=`/im?sel=${(0,_.convertPeerToUrl)(i)}&msgid=${t}`,n=d.innerHTML;(0,h.domReplaceEl)(d,(0,An.getServiceLinkTemplate)(a,n,!0,ps)),delete ks[m]}}))}}}function yr(e,t,a){var i=e.get(),n=i.peer,s=a.target.href&&a.target.href.match(/msgid=([\d]+)/),r=s&&s[1];"A"!==a.target.tagName||!r||(0,_.isAlreadyDeleted)(e,n,r)||(0,d.checkEvent)(a)||((0,u.getMessage)(e,n,r)?(e.setState({msgid:r}),(0,Ln.updateLocation)({msgid:r}),t().focusOnMessage()):i.longpoll.push([(0,f.changePeer)(n,r,!1,!1,i.currentEntryPoint||"")]));(0,d.cancelEvent)(a)}function Cr(e){var t=(0,Y.getCurrentTab)(e);(0,_.isChatPeer)(t.peerId)&&(t.pinHideId=cur.imDb.select(In.PIN_HIDDEN_ID_OP,t.peerId))}function wr(e,t,a,i,n){e.setState({isEditing:!1}),(0,h.removeClass)(i,"im-mess_is_editing"),(0,h.removeClass)((0,h.geByClass1)("_im_page_history"),"is_msg_editing"),(0,s.cancelStackFilter)("cancel_edit"),a.setDraft(e,(0,_e.getPeer)(e)?(0,u.getTabDraft)((0,Y.getCurrentTab)(e)):null),a.toggleStickers(e,!0),a.restoreKeyboard(),Er(t)}function Er(e){(0,p.toArray)((0,h.geByClass)("_im_history_tooltip",e)).forEach((e=>(0,h.hide)(e)))}function Sr(e,t,a,i,s){var r=(0,u.getTab)(e,t);if(!(Date.now()-(r.lastReset||0)<1e3)&&(r&&r.msgs&&r.history&&!Is&&r.offset>300&&0==r.skipped&&a<50&&a>=0&&0===(e.get().selectedMessages||[]).length)){var o=Object.keys(r.msgs).filter((e=>e>0)).sort(((e,t)=>e-t)).slice(0,-50),l=o.slice(-1)[0];e.mutate(n.resetTabAll.bind(null,t)),e.set(n.removeMessages.bind(null,o,t)).then((()=>s().removeStartingFromMessage(l,t,e)))}}function Tr(e,t,a,i){var n=i.target,s=(0,h.domClosest)(vs,n),r=Number(s.getAttribute("data-msgid")),o=(0,h.domClosest)("im-mess",n),l=Number(o.getAttribute("data-msgid")),c=e.get().peer;r&&!(0,_.isAlreadyDeleted)(e,c,r)?(e.setState({msgid:r}),(0,Ln.updateLocation)({msgid:r}),(0,_.focusOnMessage)(e,t().focusOnMessage,c,r)):l&&(0,_.showRepliedBox)(e,l,i)}function Mr(e){(0,d.checkEvent)(e)||(0,d.cancelEvent)(e)}var Lr=new Map;function Ir(e,t){var a,i,n=t.closest(`.${_.AUDIO_MSG_CLASS}`),s=n.querySelector("._msg_asr_empty"),r=t.closest("._im_mess"),l=n.id.replace("audmsg",""),c=!!n.closest(".im-mess_fwd"),d=Boolean(n.dataset.asr_done),u=c?0:Number(null==r?void 0:r.dataset.msgid),g=!n.classList.contains(Ms),m=Number(null==r?void 0:r.dataset.peer)||void 0,p=Number(null==r?void 0:r.dataset.msgid),h=m&&(0,Gt.getMessage)(e,m,p),v=Number(null==r?void 0:r.dataset.cmid)||(null==h?void 0:h.chat_local_id),f="audio_message"+l;if(g){var b=(Lr.get(n.id)||0)+1;Lr.set(n.id,b),d||((0,Pa.recogniseAudioMessage)(u,l),v&&m&&(0,ue.collectVoiceStat)("transcript_loading",m,v,f)),b%3==0&&s?s.innerHTML=(i=(0,o.getLang)("me_voice_asr_status_empty_set").split("|"),null==(a=i[Math.floor(Math.random()*i.length)])?void 0:a.trim()):s&&(s.innerHTML=(0,o.getLang)("me_voice_asr_status_empty"))}(g&&!c&&(0,os.markAudioMessageAsListened)(e,p,m).catch((()=>{})),v&&m&&(0,ue.collectVoiceStat)("transcript_toggle",m,v,f,g,"user"),n.classList.toggle(Ms),window.tooltips&&tooltips.destroy(t,{fasthide:!0}),t.closest(".audio-msg-player"))&&n.querySelector(".audio-msg-track_player-attached .audio-msg-track--transcriptToggle").classList.toggle("audio-msg-track--transcript_on",t.classList.contains("audio-msg-track--transcript_on"))}function kr(e,t){function a(t,a){var i=a.closest("._im_mess");if(i){var n=a.id.replace("audiomsgpl_","audio_message"),s=Number(i.dataset.peer),r=Number(i.dataset.msgid);if(s&&r){var o=(0,Gt.getMessage)(e,s,r),l=Number(i.dataset.cmid)||(null==o?void 0:o.chat_local_id);switch(t){case"playing":(0,ue.collectVoiceStat)("play",s,l,n);break;case"paused":(0,ue.collectVoiceStat)("pause",s,l,n);break;case"finished":(0,ue.collectVoiceStat)("finish",s,l,n)}}}}window.AudioMessagePlayer.events.on("listened",(a=>function(e,t,a){var i=t.closest("._im_mess"),n=t.closest(".im_fwd_log_wrap");if(i&&!n){var s=Number(i.dataset.msgid),r=Number(i.dataset.peer);s&&r&&(0,os.markAudioMessageAsListened)((0,p.unpackStore)(e),s,r).then((()=>{a.markMessageAsListened(e,r,s)})).catch((()=>{}))}}(e,a,t()))),window.AudioMessagePlayer.events.on("transcription_toggle",(t=>Ir(e,t))),window.AudioMessagePlayer.events.on("playing",(e=>{a("playing",e)})),window.AudioMessagePlayer.events.on("paused",(e=>{a("paused",e)})),window.AudioMessagePlayer.events.on("finished",(e=>{a("finished",e)}))}function Pr(e){var t=e.target.closest("._msg_asr_toggle"),a=e.target.closest(`.${_.AUDIO_MSG_CLASS}`);(0,$.showTooltip)(t,{text:a.classList.contains(Ms)?(0,o.getLang)("me_voice_asr_toggle_close"):(0,o.getLang)("me_voice_asr_toggle_open"),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[6,12],showdt:400,onHide(){window.tooltips&&tooltips.destroy(t,{fasthide:!0})}})}function Ar(e,t,a){var i=a.target.closest("."+_.MESSAGE_KEYBOARD_BUTTON_CLASS),n=a.target.closest("."+_.MESSAGE_STACK_CLASS);if(i){var s=e.sendMessageFromKeyboard.bind(null,(()=>e)),r=(0,Le.getActionObjectFromElement)(i),o=n?n.dataset.peer:void 0,l=a.target.closest("._im_mess"),c=(0,Y.getCurrentTab)(t);if(!l||!i||!c)return;var d=Number(l.dataset.msgid),g=(0,u.parserMessage)(d?c.msgs[d]:c.pinned);if(!g)return;return(0,Le.handleButtonClick)(r,s,t,{keyboardAuthorId:o,peerId:g.peerId,message:g,onBeforeSend:()=>{(0,_.setCallbackButtonLoadingState)(i,!0)},onSendSuccess:e=>{var a={timeout:setTimeout((()=>{t.set((t=>(0,Tt.unsetPressedCallbackButton)({peerId:g.peerId,eventId:e},t))).then((()=>(0,_.setCallbackButtonLoadingState)(i,!1)))}),Le.CALLBACK_TIMEOUT_MS),onCallback:()=>{var e,t=Number(i.dataset.index);document.contains(i)?e=i:isNaN(t)||(e=(0,_.getCallbackButton)(document,Number(g.messageId),t)),e&&(0,_.setCallbackButtonLoadingState)(e,!1)}};t.set((t=>(0,Tt.setPressedCallbackButton)({peerId:g.peerId,eventId:e},a,t)))},onSendFail:e=>{e.error_msg&&(0,Le.handleShowSnackbar)({peerId:g.peerId,store:t,text:e.error_msg}),(0,_.setCallbackButtonLoadingState)(i,!1)}})}}function Br(e,t){var a=t.target.closest("._im-call-snippet"),i=a.closest("."+ys),n=a.dataset.type,s=a.dataset.participants,r=s&&s.split(",").reduce(((t,a)=>(+a!==e.get().id&&(0,_.isUserPeer)(+a)&&t.push(+a),t)),[]),o=+i.dataset.peer;(0,_.isCallToPeerAvailable)(e,o)&&(0,_.startCallFromIm)(e,o,"video"===n,r,_.CALL_ENTRY_POINT_SNIPPET)}function xr(e,t,a){var i=a.target.closest("._im_mess_pinned");(0,_.updateMessageEditableStatus)(e,e.get().peer,t,i)}function Dr(e,t,i,r,o,l,d,m,b,y,C,E,S,T,M,L,I,k,P){var A,B=(0,p.throttle)((function(){i.smoothScroll(...arguments)}),300);return{fixKeyboard(){o.fixKeyboard()},removeUnpinnedMessageEditable(e,a){var i=t.querySelector(`._im_mess_pinned:not(._im_mess_${a}`);i&&(i.classList.remove(ws),(0,_.updateMessageEditableStatus)(e,e.get().peer,t,i))},changePeer(e,n,s){void 0===n&&(n=!0),void 0===s&&(s=!0);var c=e.get().peer;if((0,we.revertLastInlineVideo)(t),0===c)return M.disable(),o.setDraft(e,null),(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&Promise.all([a.e(68592),a.e(38838),a.e(89855)]).then(a.bind(a,77729)).then((e=>e.marusiaSdk)).then((e=>{e.stopListening(),e.hide()})),function(e){(0,h.addClass)(e,"im-page--history_empty"),Ks(e).innerHTML=""}(t);if((0,_.isFullyLoadedTab)(e.get(),e.get().peer)){(0,h.removeClass)(t,"im-page--history_search"),r.deselectAll(e),r.changeActions(e),r.showActions(e);var d=e.get().prevPeer;(0,h.removeClass)(t,"im-page--history_loading"),(0,h.toggleClass)(t,"im-page--history_vkcomgroup",(0,_.isFvkcomgroup)(e,c)),n?o.setDraft(e,(0,u.getTabDraft)((0,Y.getCurrentTab)(e))):o.updateState(e),ar(e,t),ir(e,t),l().updateTyping(c,e),Js(e,0,r),(0,_.isReservedPeer)(d)&&!(0,_.isReservedPeer)(c)?function(e,t,a,i,n,s,r,o,l,c,d){(0,h.removeClass)(e,"im-page--history_empty"),Ws(e,t,a,i,n,s,r,o,l,c,d)}(t,e,c,i,l,r,m,L,k,s,M):(0,_.isReservedPeer)(d)||(0,_.isReservedPeer)(c)||Ws(t,e,c,i,l,r,m,L,k,s,M),(0,u.isCasperChat)(e,c)||(M.enable(),M.toggle(!0),M.reset(i)),(0,_.isReservedPeer)(c)||setTimeout((()=>{$s(e,l,Ks(t),S,M,t,0,i)})),(0,rs.ensureDomHasActions)(t),(0,_e.getPeer)(e)===Me.VK_OFFICIAL_PEER_ID&&(0,ue.collectOnboardingFindFriendsShowStats)(e.get().viewer_id),o.updateMediaSelectorOptions(e)}},preparePeer(e){var a=(0,_e.getPeer)(e);Cr(e),o.setDraft(e,(0,u.getTabDraft)((0,u.getTab)(e,a)),!1),l().updateTyping(a,e),l().hideError(),r.renderPeer(e),L.renderPeer(e),r.hideActions(e),m.changePeer(a,e),Js(e,0,r),M.toggle(!1),hr(e,t,!0),vr(e,t,!0)},saveScroll:e=>Vs(e,i),loadingPeer(e){(0,n.isAnythingLoading)(e.get())||((0,h.removeClass)(t,"im-page--history_empty"),(0,h.addClass)(t,"im-page--history_loading"))},stopLoading(e){(0,h.removeClass)(t,"im-page--history_loading")},deselectDialog(e){d().removeSelection(e)},replaceMessageAttrs(e,a){(0,_.replaceMessageAttrs)(a.get(),Ks(t),e)},cleanSelection(e){y.cleanSelection(e)},updateDialogFilters(e,t){d().updateDialogFilters(e,t)},getSearchResulstModule:()=>A,showSearchResults(e){e?((0,h.removeClass)(t,"im-page--history_search-empty"),Ks(t).innerHTML=e):((0,h.addClass)(t,"im-page--history_search-empty"),Ks(t).innerHTML=(0,_.renderEmptySearch)())},insertSearch(e,a){A||(r.deselectAll(a),A=w(t,a,"message_search")),(0,h.addClass)(t,"im-page--history_search"),l().showSearchResults(e),ur(a,i,t),i.scrollBottom(0),ar(a,t),ir(a,t),M.reset(i)},updateChatTopic(e,t){d().updateDialog(e,t),e===t.get().peer&&(r.renderPeer(t),r.renderActions(t),L.renderPeer(t))},updateActions(e){r.changeActions(e)},updateChatPhoto(e,a,n){if((0,_.isPeerActive)(e.peerId,n.get())){r.renderPeer(n),L.renderPeer(n);var s=sr(i);(0,_.addChatPhotoToUpdate)(e,a,n.get(),Ks(t)),s&&i.scrollBottom(cs)}},markImportant(e,a,i){Os(t,e)&&(r.changedMessageSelection(i),b.markImportant(e,a,i))},isNewMessagesVisible:e=>function(e,t){return(0,u.getUnreadScrollBottom)(e)>=(0,c.intval)(t.scrollBottom())}(e,i),loadHistory(e,a,n,s){void 0===s&&(s=!1);var r=n.get();if((0,_.isPeerActive)(e,r)){var o=s||r.tabs[e].historyToAppend;if(!o)return;var l=(0,h.geByClass1)("_im_peer_history",t),c=(0,h.domFC)(l),d=i.scrollBottom(),u=a.reversed?e=>l.appendChild(e):e=>l.insertBefore(e,c),g=0;a.reversed&&(g=l.offsetHeight);var m=(0,h.sech)(o),p=document.createDocumentFragment();m.forEach((e=>p.appendChild(e))),u(p),(0,Ce.initWidgets)(t),a.reversed&&M.heightIncreased(l.offsetHeight-g,i),a.reversed||i.scrollBottomFixSave(d),i.update(!1,!0);var v=m.filter((e=>(0,h.hasClass)(e,"_im_bar_date")));M.parseMore(v,i),(0,rs.ensureDomHasActions)(t)}},sendMessage(e){0!==e.get().peer&&o.sendMessage()},editMessage(e,a){if((0,_.isFullyLoadedTab)(e,a.peerId)&&(0,_.isPeerActive)(a.peerId,e.get())){if(!Os(t,a.messageId))return;Vs(e,i),(0,_.editAndReplaceMessage)(e.get(),a,t),Gs((0,u.getTab)(e,a.peerId),i),r.reRenderPinned(e),M.reset(i)}},addMessage(e,a){if(!(0,n.isSearchingInplace)(a.peerId,e.get())&&(0,_.isFullyLoadedTab)(e,a.peerId)&&(0,_.isPeerActive)(a.peerId,e.get())){if(Os(t,a.messageId))return;var s=Ks(t);gr(M,s,i,(()=>{var n=sr(i),r=(0,h.geByClass1)("_im_unread_bar_row",t),o=(0,_.isMessagesVisible)(e,t,i),c=o[0],d=o[1];(0,rs.appendMessageToHistory)(e.get(),a,s,!0,!c&&!r),(0,h.removeClass)(t,"im-page--history_empty-hist");var m=(0,u.getTab)(e,e.get().peer),p=(0,g.isServiceMsg)(a)&&a.userId===vk.id,v=a.kludges&&a.kludges.source_act,f=p&&v!==_.CHAT_PIN_MESSAGE&&v!==_.CHAT_UNPIN_MESSAGE;m.skipped||c||!(0,g.isUnread)(m,a)||(0,g.isOut)(a)||(ar(e,t,!0,d),ir(e,t,0,d)),(a.local||n||f)&&i.scrollBottom(0),l().updateTyping(a.peerId,e),nr(t,e),Er(t)}));var r=(0,h.domPS)((0,h.domLC)(s));if((0,h.hasClass)(r,"_im_bar_date")){var o=(0,h.ce)("div");o.innerHTML=r.outerHTML,M.parseMore(o,i)}l().hideError(),M.update(i),(0,n.updateMentions)(e.get()),Sr(e,a.peerId,i.scrollBottom(),0,l),this.updateObserver()}},setMessageErrored(e,a,i,n){i&&"string"==typeof i&&l().showError(i),(0,_.setMessageError)(e,a,t)},markMessagesAsRead(e,a){e.get().peer===a.peerId&&(0,_.markMessagesAsRead)(e.get(),a.peerId,t)},markMessageAsListened(e,a,i){(0,_e.getPeer)(e)===a&&(0,_.updateListenedMark)(t,i)},compensateHistoryHeightChange(e){i.scrollTop(i.scrollTop()+e*xs(E))},updateTyping(e,a){if(!(0,n.isSearchingInplace)(e,a.get())){var i=a.get();if(i.peer===e&&(0,_.isFullyLoadedTab)(i,e)){var s=(0,_.formatTyper)((0,u.getTab)(a,e).activity,e,!1,i),r=(0,h.geByClass1)(_.TYPING_CLASS,t);if(r||s){if(!r){var o=(0,h.geByClass1)("_im_typer_c",t);(0,h.val)(o,(0,c.getTemplate)("im_typing",{cls:(0,_.isClassicInterface)(a)?"im-activity_classic":""})),r=(0,h.geByClass1)(_.TYPING_CLASS,t)}(0,h.val)((0,h.geByClass1)("_im_typing_name",r),s);var d=(0,_.loadSummaryActivityType)((0,u.getTab)(a,e).activity||{})===n.ACTIVITY_TYPE_RECORDING_AUDIO;r.setAttribute("data-activity-type",d?"recording":"typing"),s?((0,h.addClass)(r,"im-page--typing_vis"),l().hideError()):(0,h.removeClass)(r,"im-page--typing_vis")}}}},scrollFix(e,t,a){M.heightIncreased(a,i),M.update(i),(0,_.isPeerActive)(t,e.get())&&sr(i,a)&&i.scrollBottom(cs)},scrollBottom(){i.scrollBottom(cs)},goToEnd(){dr((()=>this),E,t,i)},updateGoToEnd(e,a){var n=(0,u.getTab)(e,e.get().peer);n&&(n.skipped||n.unread)?ar(e,t):hr(e,t,a),C(0,i,!1);var s=e.get().peer;setTimeout((()=>{e.get().peer===s&&Vs(e,i)}))},updateGoToMention(e,a){var n=(0,u.getTab)(e,e.get().peer),s=n||{},r=s.mentions,o=void 0===r?[]:r,l=s.mention_cmids,c=void 0===l?[]:l,d=(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?c[0]:o[0];n&&d?ir(e,t):vr(e,t,a),C(0,i,!1);var _=e.get().peer;setTimeout((()=>{e.get().peer===_&&Vs(e,i)}))},newMessage(e){d().newMessage(e),hr(e,t,!0),vr(e,t,!0)},scroll(e,t,a,n){if(void 0===a&&(a=!1),void 0===n&&(n=!1),0!==e.get().peer){var s=a?i.getScrollHeight():40;!0===n&&(s=i.contHeight()),s="up"===t?-s:s,a||n?B(s,(()=>{C(s,i)})):(i.scrollTop(i.scrollTop()+s),C(s,i))}},showCreation(e,t){d().showCreation(e,t)},updateScroll:()=>ur(E,i,t),toggleBarDate(e){M.toggle(e)},changedMessageSelection(e){r.changedMessageSelection(e)},updateOnline(e,t){(0,_.isTabLoaded)(t.get(),e)&&e===t.get().peer&&r.renderPeer(t)},isEmpty:e=>o.isEmpty(e),replaceAttachmentPlaceholders(e,a){if((0,_.isPeerActive)(a.peerId,e.get()))gr(M,Ks(t),i,(()=>{var n=sr(i);(0,_.replaceAttaches)(t,a,e.get());var s=(0,u.getTab)(e,a.peerId);if(s.mediacontent[a.messageId].length>=3&&s.mediacontent[a.messageId][2].pinned){var o=(0,u.parserMessage)(s.pinned);o&&o.messageId==a.messageId&&(s.pinned=s.mediacontent[a.messageId][2].pinned,r.reRenderPinned(e))}n&&i.scrollBottom(0)})),M.update(i);else if((0,g.isMoneyRequest)(a)){var n=(0,u.getTab)(e,a.peerId);if(n.mediacontent[a.messageId].length>=3&&n.mediacontent[a.messageId][2].pinned){var s=(0,u.parserMessage)(n.pinned);s&&s.messageId==a.messageId&&(n.pinned=n.mediacontent[a.messageId][2].pinned)}}},replaceBotCarouselPlaceholder(e,a){var n=e.get();(0,_.isPeerActive)(a.peerId,n)&&(gr(M,Ks(t),i,(()=>{var e=sr(i);(0,_.replaceCarousel)(t,a,n),e&&i.scrollBottom(0)})),M.update(i))},removeMessages(e,a,n){n.get().peer===a&&((0,_.removeMessages)(e,Ks(t)),(0,_.removeExpiredMessagesStub)(e,Ks(t)),ur(n,i,t),r.changedMessageSelection(n),this.updateObserver())},removeStartingFromMessage(e,a,n){if(n.get().peer===a){var s=Ks(t),o=(0,h.geByClass1)("_im_mess_"+e,s);(0,_.removeStartingFromMessage)(o,s),ur(n,i,t),r.changedMessageSelection(n)}},hideGoToEnd(e){hr(E,t,e)},hideGoToMention(e){vr(E,t,e)},removeMessagesRestore(e,a,i,n){n.get().peer===a&&(0,_.removeMessagesWithRestore)(e,a,i,Ks(t))},removeExpiredFailedMessages(e){E.get().peer===e&&E.set(n.removeExpiredFailed.bind(null,Ks(t),e))},handleMessageExpiration(e){(0,_.isFullyLoadedTab)(E.get(),e.peerId)&&((0,_.replaceExpiredMessageWithPlaceholder)(E,t,e),(0,_.replaceExpiredRepliedMessageWithPlaceholder)(t,e),o.detachMessages(e))},updateState(e,t){d().updateState(e,t)},updateBanner(e){L.renderPeer(e)},updateHeader(e){r.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(r.changeActions(e),r.renderPeer(e),r.renderActions(e),L.renderPeer(e),o.updateState(e),(0,n.updateMentions)(e.get()))},updateConvoInList(e,t){d().updateConvoInList(e,t)},focustTxt(e){o.focusOn(e)},startSearch(e){e.get().peer&&(l().showSearch(e),m.changePeer(e.get().peer,e),m.search())},showSearch(e){(0,h.addClass)(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),As(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout((()=>m.focus(e)),10)},cancelSearch(e,a){if(void 0===a&&(a=!0),e.get().searchShown&&((0,h.removeClass)(t,"im-page--hisory_search-open"),(0,h.removeClass)(t,"im-page--history_search"),(0,h.removeClass)(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),As(e)&&this.updateChatTopic(e.get().peer,e),r.changedMessageSelection(e)),a&&!(0,_.isReservedPeer)(e.get().peer)&&A){var s=e.get().tabs[e.get().peer],o=(0,n.strHistory)(s.history);o?Ks(t).innerHTML=o:l().showEmptyScreen(),ur(e,i,t),i.scrollBottom(0),e.get().msgid&&(Xs(i,t,e.get().msgid,e),ar(e,t),ir(e,t)),S(i),M.reset(i)}A&&(A.unmount(),A=!1,(0,rs.ensureDomHasActions)(t))},showEmptyScreen(){var e=(0,h.geByClass1)("_im_peer_history",t);(0,h.addClass)(t,"im-page--history_empty-hist");var a=ns(E);(0,h.val)(e,a)},updateHistory(e){0!==E.get().peer&&e(t)},focusOnMessage(){Xs(i,t,E.get().msgid,E)},sendEditMessage(e,t){e.set(n.deliverEditedMessage.bind(null,(0,u.getTab)(e,t.peerId),t)).catch((a=>e.get().longpoll.push([(0,f.failedMessage)(t.peerId,t,a)])))},renderStickersPanel(e){var a=(0,_e.getPeer)(e),i=(0,u.getTab)(e,a);if(i&&!(i.block_error&&i.block_error>0)){var s=(0,n.strHistory)(i.history||""),r=t.querySelector("._im_stickers_panel_placeholder");if(r&&!s){var o=ss(e);if(!o)return;(0,h.domReplaceEl)(r,o)}}},deselectAll(e){r.deselectAll(e)},unmount(){(0,v.destroyModule)(e),i.destroy(),clearInterval(T),o.unmount(),r.unmount(),b.unmount(),y.unmount(),m.unmount(),M.unmount(),(0,s.cancelStackFilter)("forward"),I.unmount(),null==P||P.unmount(),Fs("_im_chat_resize_track",t),k.destroy()},removePeer(e,t){d().removePeer(e,t)},restoreScroll(e,t){var a=e.get().tabs[t];a.scrollBottom?Gs(a,i):i.scrollBottom(cs)},resendMessage(e,a){e===E.get().peer&&(0,_.startResendMessage)(e,a,t)},resendPeer(){o.resendPeer()},resendAll(){o.resendAll()},respond(e,t){o.attachMessages(e,t),o.focusOn(e);var a=(0,u.getTab)(e,t);a&&!a.skipped&&(i.scrollBottom(cs),S(i))},restoreDialogs(e,t,a){d().restoreDialogs(e,t,a)},cancelRecording(){o.cancelRecording()},flushDraft(e){o.saveText(e)},hideError(){(0,h.geByClass1)(us,t).classList.remove(gs)},showError(e){var a=(0,h.geByClass1)(us,t);a.innerHTML=e,a.classList.add(gs),i.scrollBottom(cs)},startEditing(e){if((0,n.isAnythingLoading)(E.get()))(0,_.showWaitUntilUploadedBox)();else{e=(0,u.parserMessage)(e);var a=(0,_.getNowEditingMessage)(E);if(!(o.isBlocked()||a&&a.messageId==e.messageId)){a&&this.cancelEditing(),Er(t),E.get().searchShown&&this.cancelSearch(E);var i=Os(t,e.messageId);i&&(this.cancelRecording(),function(e,t,a,i,n){e.setState({isEditing:!0}),a.saveText(e),(0,h.addClass)(i,"im-mess_is_editing"),(0,h.addClass)((0,h.geByClass1)("_im_page_history"),"is_msg_editing"),(0,s.cancelStackPush)("cancel_edit",(()=>wr(e,t,a,i)));var r=new Ia.ImDraft;r.dData.txt=(0,La.convertEmojiHtmlToRegularText)(n.text),r.dData.attaches=(0,Q.convertKludgesToAttaches)(n.kludges,n.messageId),a.toggleStickers(e,!1),a.setDraft(e,r),setTimeout((()=>a.focusOn(e)),0)}(E,t,o,i,e),o.hideKeyboard(),r.deselectAll(E))}}},cancelEditing(){var e=(0,_.getNowEditingMessage)(E);e&&wr(E,t,o,Os(t,e.messageId))},messageKeyboardButtonClick:e=>Ar(o,E,e),getEditingMessage:()=>(0,_.getNowEditingMessage)(E),focusEditingMessage(){var e=(0,_.getNowEditingMessage)(E);e&&Xs(i,t,e.messageId,E),o.focusOn(E)},setNetworkWaitingStatus(e,t){r.setNetworkWaitingStatus(e,t)},setNetworkReconnectingStatus(e){r.setNetworkReconnectingStatus(e)},clearNetworkStatus(){r.clearNetworkStatus()},updateCasperMessageStatus(e,a){void 0===a&&(a=!1),(0,_.isFullyLoadedTab)(E.get(),e.peerId)&&E.set(n.updateCasperMessageExpiringStatus.bind(null,e,a)).then((()=>{E.get().peer===e.peerId&&(0,_.setCasperMessageExpiringStatusDOM)(t,a,e.messageId)}))},updateObserver(){I.update(),null==P||P.update()},updateFolderCounters(e){d().updateFolderCounters(e)},renderPeerProfile(e){k.render(e)},destroyPeerProfile(){k.destroy()}}}function Rr(e,t,a,i,s){var r=(0,h.geByClass1)("_im_peer_history_w",e);(0,sa.hasAccessibilityMode)()&&(0,h.addClass)(r,"history_a11y");var l,m,b,y=(0,v.createMutations)(Dr),C=y.callMutations,w=y.bindMutations,E=(l=Vs.bind(null,t),m=(0,ee.debounce)(l,100),b=(0,p.throttle)(l,100),e=>{m(e),b(e)}),S=Mn(t,e),M=$s.bind(null,t,C,r,E,S,e),L=(0,T.createScroll)((0,h.geByClass1)("_im_chat_body_abs",e),{onScroll:function(){M(...arguments),(0,Vt.partConfigEnabled)("mail_history_mention_popover")&&window.reforgedME&&window.reforgedME.profileInfo&&window.reforgedME.profileInfo.mountProfileInfo(null)},nativeScroll:(0,_.isClassicInterface)(t),shadows:!1}),I=(0,_.isClassicInterface)(t)?void 0:L.scroll.container,k=mn(t,I,(e=>function(e,t,a){var i=(0,Y.getCurrentTab)(e);if(i){var s=a.reduce(((t,a)=>{if(a.isIntersecting){var n=+a.target.getAttribute("data-msgid")||+a.target.getAttribute("data-last-msgid"),s=(0,u.getMessage)(e,i.peerId,n);n&&s&&!(0,g.isOut)(s)&&t.push(n)}return t}),[]);if(s.length){var r=Math.max(...s);Zs(e,r).then((()=>{r===i.lastmsg&&e.set((e=>(0,n.setActions)(e))).then((()=>t().updateActions(e)))}))}}}(t,C,e)),((e,t)=>(0,g.isUnread)(t,e))),P=(0,_e.getLocalSettingsValue)(t,"transcript_auto_show")&&(0,p.unpackStore)(t).isASRSettingHintActive?mn(t,I,(e=>{var a,i,n,s,r,o=null!=(a=null==(i=cur)||null==(n=i.imDb)||null==n.selectByKey?void 0:n.selectByKey("shown_asr_hints"))?a:[];e.forEach((e=>{if(e.isIntersecting){var a=Number(e.target.dataset.msgid||e.target.dataset.lastMsgid);o&&!o.includes(a)&&e.target.querySelector("._im_asr_setting_hint")&&(o.length+1<3?o.push(a):(t.set((e=>(e.isASRSettingHintActive=!1,Promise.resolve(e)))),(0,Pa.hideHelpHint)("im:transcript_autoshow_setting"),P.unmount(),o=void 0))}})),null==(s=cur)||null==(r=s.imDb)||null==r.updateByKey||r.updateByKey("shown_asr_hints",o)}),g.isAudioMsg):void 0,A=(0,Pe.mount)((0,h.geByClass1)("_im_dialog_actions",e),t,C);setTimeout((function(){var a=t.get().peer;if(a){if(Cr(t),((0,Y.getCurrentTab)(t).pinned||(0,Y.getCurrentTab)(t).top_banner)&&(C().updateChatTopic(a,t),t.set(n.setActions),A.changeActions(t)),(0,Y.getCurrentTab)(t).callInProgress&&C().updateBanner(t),t.get().msgid)Xs(L,e,t.get().msgid,t);else if(!Qs(L,e,C,t,S)){L.scrollBottom(cs);var i=(0,Y.getCurrentTab)(t);(0,_.isTabMarkedUnread)(i)&&t.set((e=>(0,n.markDialogRead)(i.peerId,e)))}t.get().history_init=!1,(0,u.isCasperChat)(t,a)?S.disable():S.reset(L),ar(t,e),ir(t,e),$s(t,C,r,E,S,e,0,L),(0,rs.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(n.setInplaceSearch.bind(null,nav.objLoc.st,a)),C().startSearch(t)),window.nav.objLoc.open_settings&&(A.showSettings(t),delete window.nav.objLoc.open_settings,window.nav.setLoc(window.nav.objLoc))}else S.disable()}),15);var B=Ui((0,h.geByClass1)("_im_text_input",e),t,(0,_.isClassicInterface)(t)?i.updateMenu:void 0,((e,t)=>{a.removeDialog(e,t),a.restoreDialogs(e,!0)}),C),x=$i((0,h.geByClass1)("_im_dialog_actions",e),t,C),D=_n(e,t,C),R=Nr(e,t,(()=>({changedMessageSelection:A.changedMessageSelection}))),O=(0,pn.mount)(r);(0,hn.mount)(e,t,C);var N=Gn(e,t,(()=>({hidePinned(){(0,hn.pinnedMessageHide)(t,t.get().peer,C,!1)},compensateHistoryHeightChange(e){C().compensateHistoryHeightChange(e)},showPinned(){(0,hn.pinnedMessageUnHide)(t,t.get().peer,C,!1)},showMessageRequestRejectDialog(t){!function(e,t,a,i,s){var r=(0,o.getLang)("mail_mr_reject_confirmation"),l=(0,Vn.oCacheGet)(e,s),c=`<div class="checkbox _im_is_spam_checkbox" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,o.getLang)("mail_report_as_spam")}</div>`,d=l?l.first_name_gen:"",u=(0,ye.showFastBox)((0,o.getLang)("mail_message_request_reject_request"),r.replace("{name}",d),(0,o.getLang)("mail_message_request_reject"),(()=>{var r=(0,Be.isChecked)((0,h.geByClass1)("_im_is_spam_checkbox"),t),l=r?(0,o.getLang)("mail_message_request_rejected_and_spam"):(0,o.getLang)("mail_message_request_rejected");e.set((e=>(0,n.rejectMessageRequest)(s,r,e))).then((e=>{(0,_.isClassicInterface)(e)&&i.updateMenu(e),a.removeDialog(e,s),a.restoreDialogs(e,!0),s===e.get().peer&&e.get().longpoll.push([(0,f.resetPeer)()]),(0,_.hideAllBoxes)(),(0,zn.showNotification)({text:l})})).catch((e=>{(0,_.hideAllBoxes)(),(0,p.showErrorBox)(e)}))}));u.setControlsText(c)}(t,e,a,i,t.get().peer)},showBusinessNotifyDialog:tr})));(0,_.isReservedPeer)(t.get().peer)||t.set((e=>(0,Aa.restoreHistoryQueue)(e,t.get().peer))).then((()=>{(0,Aa.restoreQueuedMessagesInDom)(t.get(),t.get().peer,Ks(e)),js(e,t,t.get().peer)})),kr(t,C),Ns("_im_chat_resize_track",e,s);var F=rr.bind(null,t,e,C),U=or.bind(null,t,e,L,C),H=e=>{(0,d.cancelEvent)(e),function(e,t){e().showCreation(t)}(s,t)},j=dr.bind(null,C,t,e,L),q=_r.bind(null,C,t,e,L),K=qs.bind(null,t,e),G=_.showEditTimeTooltip.bind(null,t),W=_.showMessageInfoTooltip.bind(null,t),V=er.bind(null,t,F,e,C),z=Hs.bind(null,t,e,L),Z=fr.bind(null,C,t,L),Q=br.bind(null,t),X=yr.bind(null,t,C),J=Tr.bind(null,t,C,e),te=Ar.bind(null,B,t),ae=Us.bind(null,C),ie=_.showCasperExpiringTooltip.bind(null,t,e),ne=()=>(0,Se.showWiki)({w:"expired_messages"}),se=Br.bind(null,t),re=e=>function(e,t){var a=t.target.closest("."+Cs),i=a.closest("."+ys),n=a.dataset.link,s=+i.dataset.peer;((0,_.isCallToPeerFromSnippetAvailable)(e,s)||(0,_.isCallToPeerAvailable)(e,s))&&(0,_.joinCallFromIm)(e,s,n,!1,_.CALL_ENTRY_POINT_JOIN_SNIPPET)}(t,e),oe=xr.bind(null,t,e),le=e=>function(e,t){var a=t.target.closest("._im_subscribe_button"),i=(0,_e.getPeer)(e);if(!Yn.FlatButton.isLocked(a)&&i){var n=e.get().tabs[i].is_subscribed;Yn.FlatButton.lock(a),e.set((e=>(0,$n.setPeerSubscribedStatus)(i,n,e))).then((e=>{var t=(0,p.unpackStore)(e).tabs[i].is_subscribed,n=t?(0,o.getLang)("mail_friend_request_sent"):(0,o.getLang)("mail_add_to_friends"),s=t?Yn.FlatButtonAppearance.SECONDARY:Yn.FlatButtonAppearance.PRIMARY;Yn.FlatButton.unlock(a),Yn.FlatButton.setAppearance(a,s),Yn.FlatButton.setLabel(a,n)})).catch((()=>{Yn.FlatButton.unlock(a)}))}}(t,e),ce=e=>{var t=(0,h.domClosest)(Ss,e.target);if(t){var a=(0,h.domClosest)(_.MESSAGE_STACK_CLASS,t),i=parseInt((0,h.domData)(a,"peer"),10)||null;window.reforgedME&&window.reforgedME.profileInfo&&i&&window.reforgedME.profileInfo.mountProfileInfo({peerId:i,targetElement:t})}},de=(0,v.createModule)({handlers:(a,i)=>{i(e,"click",_.RESTORE_CLASS,U),i(e,"mouseover click",_.FAILED_CLASS,K),i(e,"mouseover","_im_edit_time",G),i(e,"mouseover","_im_page_info",W),i(e,"click","_im_mess_susp",Rs.bind(null,e)),i(e,"click","_im_failed_action",V),i(e,"click","_im_mess_link",z),i(e,"mouseover","_im_admin_name",mr),i(e,"mouseover",ms,Q),i(e,"mouseover","im-mess-stack--bomb",ie),i(e,"mouseover","mem_pseudolink",(e=>function(e,t){var a=e.target.dataset.mention,i=null;switch(!0){case Me.MASS_MENTION_ALIASES.all.includes(a):i=(0,o.getLang)("mail_im_mention_all");break;case Me.MASS_MENTION_ALIASES.online.includes(a):i=(0,o.getLang)("mail_im_mention_online")}i&&(window.tooltips&&window.tooltips.destroy(e.target),(0,$.showTooltip)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>(0,_.getHistoryTopIndent)(t)+37,text:i,noZIndex:!0}))}(e,t))),i(e,"mouseover",ws,oe),i(e,"mouseover",Ts,Pr),i(e,"click",_.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON,_.onASRCollapseToggleClick),i(e,"click",Ls,(()=>{s().openSettings()})),i(e,"click",ps,X),i(e,"click",us,ae),i(e,"click",vs,J),i(e,"click","_im_replied_author_link",Mr),i(e,"click","_chat_invitation",((e,a)=>{if((0,d.checkEvent)(e))return!0;if(!(0,h.gpeByClass)("wall_postlink_preview_btn",e.target)&&!(0,h.hasClass)(e.target,"wall_postlink_preview_btn"))return!0;var i=(0,h.geByClass1)("flat_button",a),s={invite_chat_id:(0,h.domData)(i,"inv-id"),invite_hash:(0,h.domData)(i,"hash")};(0,_.showInvitationBox)(t,s,n.leaveInvitation),(0,d.cancelEvent)(e)})),i(e,"click",_.JOIN_CALL_BY_LINK_CLASS,_.handleCallLinkClick),i(e,"click","_im_join_cancel",(()=>t.get().longpoll.push([(0,f.resetPeer)()]))),i(e,"click","_im_retry_media",(e=>function(e,t,a){var i=e.get(),s=(0,h.domClosest)(hs,a.target),r=(0,h.domData)(s,"msgid"),o=(0,u.getMessage)(i,i.peer,r),l=e=>t().replaceAttachmentPlaceholders(e,o);o&&((0,Te.statlogsSendingRetry)("retry_attach"),e.set(n.addAttachmentsToStoreData.bind(null,o,[(0,An.renderMessageMedia)(i,o)])).then(l),e.set(n.loadMedia.bind(null,o)).then(l))}(t,C,e))),i(e,"click",_.MESSAGE_KEYBOARD_BUTTON_CLASS,te),i(e,"click",bs,se),i(e,"click",Cs,re),a((0,h.geByClass1)("_im_peer_history_w",e),"mousemove",S.show),a((0,h.geByClass1)("_im_start_new",e),"click",H),a(e.querySelector(ds),"click",j),a(e.querySelector(_s),"click",q),i(e,"click",Es,le),a((0,h.geByClass1)("_im_cancel_edit",e),"click",(()=>(C().cancelEditing(),!1))),a((0,h.geByClass1)("_im_edit_focus_cur",e),"click",(()=>(C().focusEditingMessage(),!1))),Ie.raw&&a(document,Ie.raw.fullscreenchange,Z),a(window,"im_goToMessage",(e=>{var a=(0,c.intval)(e.msgid);if(a)return(0,Ee.statlogsValueEvent)("im_links_to_attachments",1,"to_message"),t.set(n.changePeer.bind(null,e.sel,a,!1)).then((()=>(0,_.focusOnMessage)(t,C().focusOnMessage,t.get().peer,a)))})),i(e,"click","im-expired-message--in",ne),(0,Vt.partConfigEnabled)("mail_history_mention_popover")&&i(e,"mouseover",Ss,ce)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?(0,hn.pinnedMessageHide)(t,e.peer,C,!1):(0,hn.pinnedMessageUnHide)(t,e.peer,C,!1)}],window.showForwardBox=e=>function(e,t){(0,_.applyMessageHandlers)((0,ye.showBox)("al_im.php",t,{params:{width:638,bodyStyle:"padding: 0px",containerClass:"im-show-message-box"},dark:1},{}),e)}(t,e);var ge=setInterval(Js.bind(null,t,e,A),1e4);(0,_e.getPeer)(t)===Me.VK_OFFICIAL_PEER_ID&&(0,ue.collectOnboardingFindFriendsShowStats)(t.get().viewer_id);var me=(0,_e.getPeer)(t),pe=(0,u.getTab)(t,me);return pe&&(0,Y.tabIsMessageRequest)(pe)&&(0,ue.collectOpenMessageRequestStats)(me),w(de,e,L,A,B,C,s,x,D,R,M,t,E,ge,S,N,k,O,P)}function Or(e,t,a,i,s){if(!(0,n.isSearchingInplace)(e.get().peer,e.get())&&!((0,h.hasClass)(s,_.FAILED_CLASS)||(0,h.hasClass)(s,_.SENDING_CLASS)||(0,h.hasClass)(s,"_im_mess_srv")||(0,_.checkSelectClick)(i,s)||(0,u.isAnyMessageBeingEdited)(e)||"A"===i.target.tagName||(0,h.domClosest)("_im_replied_message",i.target)||i.target.classList.contains("_im_retry_media")||i.target.closest("."+_.MESSAGE_KEYBOARD_BUTTON_CLASS)||i.target.closest("."+_.BOT_CAROUSEL_CLASS)||i.target.closest("."+Ce.WIDGET_ACTIONS)||i.target.closest("."+_.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON)||i.target.classList.contains(Ls)||(0,h.domClosest)("scroll-button--right",i.target)||(0,h.domClosest)("scroll-button--left",i.target))){var r,l,d=(0,c.intval)((0,h.domData)(s,"msgid")),g=e.get().peer;if(!(0,_.isAlreadyDeleted)(e,g,d))r=i.shiftKey?(0,u.getMessageRangeFromSelection)(e,g,d):[d],e.set(n.addSelection.bind(null,r)).then((()=>{var i=(0,u.getSelectedMessages)(e),n=!1;r.forEach((e=>{var t=(0,h.geByClass1)("_im_mess_"+e,a);if(t){var s=(0,c.inArray)(e,i);n|=s,(0,h.toggleClass)(t,"im-mess_selected",s);var r=s?(0,o.getLang)("mail_deselect_message"):(0,o.getLang)("mail_select_message"),l=(0,h.geByClass1)("_im_mess_blind_label_select",t);(0,h.attr)(l,"aria-label",r)}})),n&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)})).then((()=>{1!==e.get().selectedMessages.length||l?l&&l.hide():l=function(e){var t=e.get();if(t.pinnedMessagesPromo&&(0,_.isChatPeer)(t.peer)){var a=(0,h.geByClass1)("_mess-action-promo"),i=new ElementTooltip(a,{autoShow:!1,appendTo:a,content:(0,c.getTemplate)("im_pinned_messages_promo",{content:(0,o.getLang)("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),(0,n.hidePromoTooltip)()}});return i.show(),i}}(e)}))}}function Nr(e,t,a){var i=Or.bind(null,t,a,e),n=(0,v.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",i)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map((t=>(0,h.geByClass1)("_im_mess_"+t,e))).filter((e=>e)).forEach((e=>(0,h.removeClass)(e,"im-mess_selected")))},unmount(){(0,v.destroyModule)(t)}}}(e,n)}var Fr=a(67253),Ur="_im_spam_not_spam",Hr="_im_spam_spam";function jr(e,t,a,i){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var s=(0,h.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,_.wrapLoading)(s)((0,n.loadSpam)(e.offset,i.get().gid).then((t=>{t[0];var a=t[1],r=(t[2],t[3]);e.all=r.all,e.offset=r.offset,e.all?(0,h.addClass)(s,"im-important_all"):e.loading=!1,i.set((e=>(0,n.mergeTabs)(e,(0,_.tabFromIds)(r.msgs,r.hash))));var o=(0,h.ce)("div");o.innerHTML=a,s.appendChild(o),(0,rs.ensureDomHasActions)(s)})),"bottom")}}function qr(e,t){var a,i=t.get().selectedMessages,n=(0,h.geByClass1)("_im_spam_box",e.bodyNode),s=(0,h.geByClass1)("ui_tab_sel",e.bodyNode);if(i.length>0){var r=(0,o.getLang)("mail_selected",i.length);r=r.replace("{count}",i.length),(0,h.val)(s,r+(a=(0,Fr.getIcon16Cancel)().icon,`<button aria-label="${(0,o.getLang)("mail_deselect_all")}" type="button" class="im-deselect ${_.DESELECT_ALL_CLASS}">${a}</button>`))}else(0,h.val)(s,(0,o.getLang)("mail_spam"));if(0===i.length)(0,h.removeClass)(n,"im-important-box_with-sel");else{(0,h.addClass)(n,"im-important-box_with-sel");var l=document.querySelector("._im_spam_spam"),c=document.querySelector(`.${Ur}`);l&&c&&(Yn.FlatButton.setLabel(l,(0,o.getLang)("mail_im_mark_delspam",i.length)),Yn.FlatButton.setLabel(c,(0,o.getLang)("mail_im_mark_notspam",i.length)))}}function Kr(e,t,a){var i=e.get().selectedMessages;e.set(n.cleanSelected).then(a.cleanSelection.bind(null,i)).then((a=>qr(t,e)))}function Gr(e,t,a,i){var s=(0,h.gpeByClass)("_im_mess",i,t);if(s){var r=(0,c.intval)((0,h.domData)(s,"msgid"));s&&((0,n.removeMessageSend)([r],0,e.get().tabs[0].hash,"undel",e.get()),(0,_.restoreMessage)(r,0,t))}}function Wr(e,t,a){var i=e.get().selectedMessages;(0,n.removeMessageSend)(i,0,e.get().tabs[0].hash,"delete",e.get()),(0,_.removeMessagesWithRestore)(i,0,"delete",t),Kr(e,t,a)}function Vr(e,t,a){var i=e.get().selectedMessages;(0,n.removeMessageSend)(i,0,e.get().tabs[0].hash,"nospam",e.get()),i.map((e=>(0,h.geByClass1)("_im_mess_"+e))).filter((e=>e)).forEach((e=>{var t=(0,c.intval)((0,h.domData)(e,"peer")),a=(0,c.intval)((0,h.domData)(e,"msgid"));(0,h.val)(e,(0,_.renderGoTo)(t,a)),(0,h.addClass)(e,"im-mess_light")})),Kr(e,t,a)}function zr(e,t,a,i,n){var s=(0,h.gpeByClass)("_im_mess",n,t.bodyNode),r=(0,c.intval)((0,h.domData)(s,"peer")),o=(0,c.intval)((0,h.domData)(s,"msgid"));return t.hide(),a().unmount(),e.get().longpoll.push([(0,f.changePeer)(r,o,!1,!1,"spam_box")]),(0,d.stopEvent)(i),(0,d.cancelEvent)(i),!1}function Yr(e,t,a,i){var s=(0,ye.showFastBox)({title:(0,o.getLang)("mail_deleteall1"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},(0,o.getLang)("mail_delete_all_spam"),(0,o.getLang)("mail_delete"),(()=>{(0,n.flushSpam)(e,i).then((e=>{e[0];var t=e[1];(0,l.showDoneBox)(t)})),s.hide(),t.hide(),a().unmount()}),(0,o.getLang)("mail_close"),(()=>s.hide()))}function $r(e,t){return{unmount(){t.unmount(),(0,v.destroyModule)(e)}}}function Zr(e,t,a){var i=(0,h.ge)("box_layer_wrap"),n=(0,v.createMutations)($r),s=n.callMutations,r=n.bindMutations,o=(0,S.default)({peer:0,oCache:{},tabs:(0,_.tabFromIds)(a.msgs,a.hash),gid:t.get().gid}),l=jr.bind(null,{all:a.all,loading:!1,offset:a.offset},e,i,o),c=Gr.bind(null,o,e.bodyNode),d=zr.bind(null,t,e,s),u=Yr.bind(null,a.hash,e,s,t.get().gid),g=Nr(e.bodyNode,o,(t=>({changedMessageSelection:qr.bind(null,e)}))),m=Wr.bind(null,o,e.bodyNode,g),p=Vr.bind(null,o,e.bodyNode,g),f=Kr.bind(null,o,e,g);return(0,rs.ensureDomHasActions)(e.bodyNode),r((0,v.createModule)({handlers:(t,a)=>{t(i,"scroll",l),a(e.bodyNode,"click",Hr,m),a(e.bodyNode,"click",Ur,p),a(e.bodyNode,"click","_im_spam_flush",u),a(e.bodyNode,"click",_.RESTORE_CLASS,c),a(e.bodyNode,"click","_im_go_to",d),a(e.bodyNode,"click",_.DESELECT_ALL_CLASS,f)}}),g)}var Qr=a(7388),Xr=a(56568),Jr=(a(68641),a(29354),a(69303)),eo=a(93708);const to=(0,eo.makeIcon)("Icon28SendCircleFillGray","send_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="send_circle_fill_gray_28"><linearGradient id="send_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#send_circle_fill_gray_28_a)" /><path d="M10.16 16.628c-.458 1.298-.745 2.21-.863 2.737-.368 1.653-.637 2.026.738 1.24 1.375-.786 8.031-4.679 9.516-5.544 1.936-1.128 1.962-1.04-.104-2.237-1.573-.912-8.15-4.703-9.412-5.447-1.26-.745-1.106-.414-.738 1.24.12.533.41 1.453.875 2.761.324.915 1.079 1.586 1.992 1.772l3.843.781a.07.07 0 0 1 .052.083.068.068 0 0 1-.052.055l-3.852.78c-.916.186-1.673.86-1.996 1.779z" fill="#fff" /></symbol>',28,28,!1,void 0),ao=(0,eo.makeIcon)("Icon28VolumeCircleFillGray","volume_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="volume_circle_fill_gray_28"><linearGradient id="volume_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#volume_circle_fill_gray_28_a)" /><path clip-rule="evenodd" d="M6.923 11.5H9l3.293-3.293A1 1 0 0 1 14 8.914v10.172a1 1 0 0 1-1.707.707L9 16.5H6.923c-.669 0-.911-.07-1.156-.2-.244-.131-.436-.323-.567-.567s-.2-.487-.2-1.156v-1.154c0-.669.07-.911.2-1.156.131-.244.323-.436.567-.567.245-.13.487-.2 1.156-.2zm9.526-.788a.9.9 0 0 1 1.27.097A4.885 4.885 0 0 1 18.9 14c0 1.216-.444 2.33-1.177 3.186a.9.9 0 1 1-1.367-1.17A3.084 3.084 0 0 0 17.1 14c0-.772-.28-1.476-.747-2.018a.9.9 0 0 1 .096-1.27zm4.044-2.39a.9.9 0 1 0-1.251 1.294A6.08 6.08 0 0 1 21.1 14a6.08 6.08 0 0 1-1.859 4.384.9.9 0 0 0 1.252 1.294A7.88 7.88 0 0 0 22.9 14a7.88 7.88 0 0 0-2.407-5.677z" fill="#fff" fill-rule="evenodd" /></symbol>',28,28,!1,void 0),io=(0,eo.makeIcon)("Icon28UsersCircleFillGray","users_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="users_circle_fill_gray_28"><linearGradient id="users_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#users_circle_fill_gray_28_a)" /><path d="M10.5 15c2.25 0 4.5.9 4.5 2.846v.134c0 .295-.04.447-.114.585a.773.773 0 0 1-.32.321c-.14.075-.29.114-.586.114H7.02c-.295 0-.447-.04-.585-.114a.773.773 0 0 1-.321-.32c-.075-.14-.114-.29-.114-.586v-.134C6 15.9 8.25 15 10.5 15zm7 0c2.25 0 4.5.9 4.5 2.846v.134c0 .295-.04.447-.114.585a.773.773 0 0 1-.32.321c-.14.075-.29.114-.586.114H16.6c.084-.248.13-.508.144-.797l.006-.223v-.134c0-1.069-.358-1.957-.971-2.659A7.74 7.74 0 0 1 17.5 15zm-7-6a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5zm7 0a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5z" fill="#fff" /></symbol>',28,28,!1,void 0),no=(0,eo.makeIcon)("Icon28MessageUnreadCircleFillGray","message_unread_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="message_unread_circle_fill_gray_28"><linearGradient id="message_unread_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#message_unread_circle_fill_gray_28_a)" /><g fill="#fff"><path d="M19.87 12.17a3 3 0 0 1-4.09-3.935A6.77 6.77 0 0 0 13.999 8c-3.314 0-6 2.359-6 5.269 0 1.406.628 2.684 1.653 3.63a11.487 11.487 0 0 1-.404 1.688c-.055.173-.13.376-.224.606a.578.578 0 0 0 .017.475.606.606 0 0 0 .801.273l.159-.076c.152-.075.286-.145.401-.21a12 12 0 0 0 1.895-1.333c.54.14 1.11.215 1.702.215 3.314 0 6-2.359 6-5.268 0-.377-.045-.745-.13-1.099z" /><path d="M20 9.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" /></g></symbol>',28,28,!1,void 0),so=(0,eo.makeIcon)("Icon28ArchiveCircleFillGray","archive_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="archive_circle_fill_gray_28"><linearGradient id="archive_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#archive_circle_fill_gray_28_a)" /><g fill="#fff"><path d="M6.568 8.482c-.068.255-.068.565-.068 1.185 0 .31 0 .465.034.592a1 1 0 0 0 .707.707c.127.034.282.034.592.034h12.334c.31 0 .465 0 .592-.034a1 1 0 0 0 .707-.707c.034-.127.034-.282.034-.592 0-.62 0-.93-.068-1.185a2 2 0 0 0-1.414-1.414C19.763 7 19.453 7 18.833 7H9.167c-.62 0-.93 0-1.185.068a2 2 0 0 0-1.414 1.414z" /><path clip-rule="evenodd" d="M8 14.1c0-.56 0-.84.109-1.054a1 1 0 0 1 .437-.437C8.76 12.5 9.04 12.5 9.6 12.5h8.8c.56 0 .84 0 1.054.109a1 1 0 0 1 .437.437C20 13.26 20 13.54 20 14.1v2.1c0 1.68 0 2.52-.327 3.162a3 3 0 0 1-1.311 1.311C17.72 21 16.88 21 15.2 21h-2.4c-1.68 0-2.52 0-3.162-.327a3 3 0 0 1-1.311-1.311C8 18.72 8 17.88 8 16.2zm3.5.65a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 0 1.5h-3.5a.75.75 0 0 1-.75-.75z" fill-rule="evenodd" /></g></symbol>',28,28,!1,void 0),ro=(0,eo.makeIcon)("Icon28NotificationCircleFillGray","notification_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="notification_circle_fill_gray_28"><linearGradient id="notification_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#notification_circle_fill_gray_28_a)" /><path d="M15.817 19.5a1.85 1.85 0 0 1-3.634 0zM9.5 18c-1 0-1.5-.333-1.5-1 0-1 1.5-1 1.5-2.5v-3a4.501 4.501 0 0 1 3.7-4.43V7a.8.8 0 0 1 1.6 0v.071a4.501 4.501 0 0 1 3.7 4.429v3C18.5 16 20 16 20 17c0 .667-.5 1-1.5 1z" fill="#fff" /></symbol>',28,28,!1,void 0),oo=(0,eo.makeIcon)("Icon28TextCircleFillGray","text_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="text_circle_fill_gray_28"><path fill="url(#text_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14Z" /><path fill="#fff" d="M18.42 18.97c.996 0 2.09-.51 2.535-1.379H21v.419c.045.655.357.99.944.99.617 0 1.056-.38 1.056-1.12v-4.653c0-1.645-1.331-2.727-3.376-2.727-1.65 0-2.93.602-3.301 1.577a1.204 1.204 0 0 0-.112.502c0 .503.38.853.907.853.35 0 .625-.137.863-.41.483-.64.885-1.022 1.546-1.022.818 0 1.473.602 1.473 1.364v.54l-2.142.122c-1.993.122-3.108.989-3.108 2.474 0 1.47 1.153 2.47 2.67 2.47Zm.713-1.607c-.728 0-1.152-.381-1.152-.99 0-.58.394-.953 1.204-1.014L21 15.253v.594c0 .883-.915 1.516-1.867 1.516Z" /><path fill="#fff" fill-rule="evenodd" d="M6.189 19c.621 0 .971-.297 1.189-1.01l.59-1.67.095-.32h3.853l.1.32.59 1.693c.21.697.56.987 1.22.987.684 0 1.174-.438 1.174-1.054 0-.223-.039-.423-.148-.713l-3.077-7.971C11.441 8.386 10.897 8 9.981 8c-.886 0-1.438.4-1.764 1.27l-3.062 7.963c-.1.275-.155.527-.155.713C5 18.592 5.458 19 6.189 19Zm3.745-8.803h.054l1.456 4.303H8.51l1.425-4.303Z" clip-rule="evenodd" /><defs><linearGradient id="text_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#B1B6BD" /><stop offset="1" stop-color="#99A2AD" /></linearGradient></defs></symbol>',28,28,!1,void 0),lo=(0,eo.makeIcon)("Icon28SunglassesCircleFillGray","sunglasses_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="sunglasses_circle_fill_gray_28"><path fill="url(#sunglasses_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14Z" /><path fill="#fff" d="M5.84 15.44c-.186-1.213-.23-1.357-.555-1.816-.409-.577-.467-1.238.428-1.412 2.296-.446 4.782-.113 7.047.302a6.239 6.239 0 0 0 2.48 0c2.265-.415 4.75-.748 7.047-.302.895.174.837.835.428 1.412-.325.46-.369.603-.555 1.816-.278 1.82-1.807 2.56-3.7 2.56-2.08 0-2.773-1.187-3.418-2.805-.628-1.573-1.454-1.573-2.082 0C12.315 16.813 11.622 18 9.541 18c-1.894 0-3.423-.741-3.701-2.56Z" /><defs><linearGradient id="sunglasses_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#B1B6BD" /><stop offset="1" stop-color="#99A2AD" /></linearGradient></defs></symbol>',28,28,!1,void 0);var co=a(47066);const _o=(0,eo.makeIcon)("Icon12Chevron","chevron_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="chevron_12"><path fill-rule="evenodd" d="M4.22 2.47a.75.75 0 0 1 1.06 0l3 3a.75.75 0 0 1 0 1.06l-3 3a.75.75 0 0 1-1.06-1.06L6.69 6 4.22 3.53a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></symbol>',12,12,!1,void 0);a(27346);var uo=a(93839),go=a(11323),mo=a(84970),po=a(71851),ho=function(e){var t=e.isLoading,a=e.set,i=void 0===a?new Set(["ctrSubmit","soundNotifications","showRecommendations","countOnlyNotMuted","autoUnarchive","transcriptAutoShow","theme"]):a,n=e.profileInfoControl,s=(0,mo.useBrowserEnv)(),r=s.lang,o=s.browserNotifications,l=(0,mo.useViewer)().settings,c=(0,mo.useDispatch)();return ft.createElement("ul",{className:"Settings"},t&&ft.createElement(po.OptimizedSpinner,{className:"Settings__loader"}),n&&ft.createElement(Jr.OptionsListItemWrapper,{className:"Settings__profileOptionItem",isPadded:!1},n),i.has("ctrSubmit")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(to,null),title:r.use("me_settings_message_submit"),aside:ft.createElement(vo,{isCtrSubmitSelected:l.ctrSubmit,onChange:function(e){return c({type:"UserChangedSetting",setting:"ctrSubmit",value:e})}})}),i.has("soundNotifications")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(ao,null),title:r.use("me_settings_sound_notifications"),aside:ft.createElement(uo.Switch,{className:"Settings__switch",checked:l.soundNotifications,onChange:function(e){return c({type:"UserChangedSetting",setting:"soundNotifications",value:Boolean(e.target.checked)})}})}),i.has("showRecommendations")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(io,null),title:r.use("me_settings_show_recommendations"),aside:ft.createElement(uo.Switch,{className:"Settings__switch",checked:l.showRecommendations,onChange:function(e){return c({type:"UserChangedSetting",setting:"showRecommendations",value:Boolean(e.target.checked)})}})}),i.has("countOnlyNotMuted")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(no,null),title:r.use("me_settings_count_not_muted"),description:r.use("me_settings_count_not_muted_note"),aside:ft.createElement(uo.Switch,{className:"Settings__switch",checked:!l.countOnlyNotMuted,onChange:function(e){return c({type:"UserChangedSetting",setting:"countOnlyNotMuted",value:!Boolean(e.target.checked)})}})}),i.has("autoUnarchive")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(so,null),title:r.use("me_settings_auto_unarchive"),description:r.use("me_settings_auto_unarchive_note"),aside:ft.createElement(uo.Switch,{className:"Settings__switch",checked:l.autoUnarchive,onChange:function(e){return c({type:"UserChangedSetting",setting:"autoUnarchive",value:Boolean(e.target.checked)})}})}),o&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(ro,null),title:r.use("me_settings_browser_notifications"),aside:ft.createElement(fo,{browserNotifications:o})}),i.has("transcriptAutoShow")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(oo,null),title:r.use("me_settings_auto_transcript"),aside:ft.createElement(uo.Switch,{className:"Settings__switch",checked:l.transcriptAutoShow,onChange:function(e){return c({type:"UserChangedSetting",setting:"transcriptAutoShow",value:Boolean(e.target.checked)})}})}),i.has("theme")&&ft.createElement(Jr.OptionsListItem,{icon:ft.createElement(lo,null),title:"Тема",aside:ft.createElement(yo,{theme:l.theme,onChange:function(e){return c({type:"SettingThemeUpdated",value:e})}})}))},vo=function(e){var t=e.isCtrSubmitSelected,a=e.onChange,i=(0,mo.useBrowserEnv)().lang,n=(0,ft.useRef)(null),s=(0,ft.useState)(!1),r=(0,Xr.default)(s,2),o=r[0],l=r[1],c=(0,ft.useCallback)((function(e){if(e.target instanceof HTMLInputElement){var t=Boolean(Number(e.target.value));a(t)}}),[a]),d=t?i.use("me_settings_message_submit_option_ctr"):i.use("me_settings_message_submit_option_default");return ft.createElement("div",{className:"Settings__select"},ft.createElement(go.PopoutRoot,{popout:o?ft.createElement(uo.ActionSheet,{onClose:function(){return l(!1)},toggleRef:n,popupDirection:"bottom"},ft.createElement(uo.ActionSheetItem,{autoclose:!0,subtitle:i.use("me_settings_message_submit_option_default_note"),selectable:!0,checked:!t,value:"0",onChange:c},i.use("me_settings_message_submit_option_default")),ft.createElement(uo.ActionSheetItem,{autoclose:!0,subtitle:i.use("me_settings_message_submit_option_ctr_note"),selectable:!0,checked:t,value:"1",onChange:c},i.use("me_settings_message_submit_option_ctr"))):null},ft.createElement("button",{className:"Settings__button",ref:n,onClick:function(){return l(!0)}},d,ft.createElement("span",{className:"Settings__buttonChevron"},ft.createElement(co.default,null)))))},fo=function(e){var t=e.browserNotifications,a=(0,mo.useDispatch)(),i=(0,mo.useViewer)().settings,n=(0,mo.useBrowserEnv)().lang;return"external"===i.browserNotifications?ft.createElement("button",{className:"Settings__button",onClick:t.onExternal},n.use("me_settings_browser_notifications_external"),ft.createElement("span",{className:"Settings__buttonChevron"},ft.createElement(_o,null))):ft.createElement(uo.Switch,{className:"Settings__switch",checked:i.browserNotifications,onChange:function(e){return t.onChange(Boolean(e.target.checked)).then((function(e){return a({type:"UserChangedBrowserNotifications",value:e})}))}})},bo=["light","dark","system"],yo=function(e){var t=e.theme,a=e.onChange,i=(0,mo.useBrowserEnv)().lang,n=(0,ft.useRef)(null),s=(0,ft.useState)(!1),r=(0,Xr.default)(s,2),o=r[0],l=r[1],c=(0,ft.useCallback)((function(e){if(e.target instanceof HTMLInputElement)switch(e.target.value){case"light":case"dark":case"system":a(e.target.value)}}),[a]);return ft.createElement("div",{className:"Settings__select"},ft.createElement(go.PopoutRoot,{popout:o?ft.createElement(uo.ActionSheet,{onClose:function(){return l(!1)},toggleRef:n,popupDirection:"top"},bo.map((function(e){return ft.createElement(uo.ActionSheetItem,{key:e,autoclose:!0,selectable:!0,checked:t===e,value:e,onChange:c},i.use("me_settings_theme_".concat(e)))}))):null},ft.createElement("button",{className:"Settings__button",ref:n,onClick:function(){return l(!0)}},i.use("me_settings_theme_".concat(t)),ft.createElement("span",{className:"Settings__buttonChevron"},ft.createElement(co.default,null)))))},Co=a(35544),wo=a(14432),Eo=a(67075),So=function(e){var t=e.store,a=e.env,i=e.set,n=(0,ft.useState)(t.getState()),s=(0,Xr.default)(n,2),r=s[0],o=s[1];(0,ft.useEffect)((function(){return t.subscribe(o)}),[t]);var l=0===r.convoConn.pts,c=wo.safeGet(r.peers,r.viewer.id);return ft.createElement(Eo.ErrorBoundary,{fallbackRender:function(){return null},onError:function(e){return a.logger.error("[SettingsApp] Error",e)}},ft.createElement("div",{className:"SettingsApp vkui__root"},ft.createElement(Co.Provider,{env:a,state:r,dispatch:t.dispatch,featureFlags:t.featureFlags,owner:c,appSource:"ME"},ft.createElement(uo.ConfigProvider,{platform:uo.Platform.VKCOM,scheme:"inherit"},ft.createElement(uo.AdaptivityProvider,null,ft.createElement(ho,{isLoading:l,set:i}))))))},To=a(90831),Mo=a(16032),Lo=a(63843),Io=a(48898),ko=a(7412),Po=a(52111),Ao=a(89754),Bo=a(18233),xo=a(59003),Do=a(2508),Ro=a(7660),Oo=a(91747),No=a(70894),Fo=a(46767),Uo=a(34943),Ho=a(36223),jo=a(86204),qo=a(97138),Ko=a(76288),Go=a(30365),Wo=a(43927),Vo=a(41650),zo=a(71996),Yo=function(e){var t=e.onClose,a=e.store,n=e.browserEnv;return(0,vt.jsxs)(Go.default,(0,i.__assign)({onClose:t},{children:[(0,vt.jsx)(Wo.ModalHeader,{title:(0,Vo.getLang)("mail_im_settings_header"),onClose:t},void 0),(0,vt.jsx)(Ko.ModalBody,(0,i.__assign)({hasScroll:!1},{children:(0,vt.jsx)("div",(0,i.__assign)({style:{width:"560px",margin:"0 -25px",padding:"4px 20px"}},{children:(0,vt.jsx)(So,{store:a,env:n,set:new Set(["ctrSubmit","soundNotifications","showRecommendations","countOnlyNotMuted","autoUnarchive","transcriptAutoShow"])},void 0)}),void 0)}),void 0)]}),void 0)},$o=function(){function e(e,t){this.isMounted=!1,this.imStore=e,this.imPageMutations=t}return e.prototype.renderSettingsPopup=function(t,a){var i=this,n=e.getContainer();n&&bt.render((0,vt.jsx)(Yo,{onClose:function(){return i.hide()},store:t,browserEnv:a},void 0),n)},e.getContainer=function(){return document.querySelector("#MessengerSettings")},e.prototype.getContext=function(){var e;if(null===(e=window.reforgedME)||void 0===e?void 0:e.settingsContext)return window.reforgedME.settingsContext;if(this.ownContext)return this.ownContext;(0,Qr.initConfig)();var t=window.vk.id,a=(0,zo.createFeatureFlags)(),i=new Bo.Api(t),n=new Do.Logger,s=new Ro.ProxyStorage(To.STORAGE_DB_NAME),r=new Uo.SharedEngine(n,(0,zo.isMasterTab)()),o=new Ho.Stats,l=(0,zo.createLang)(n),c={system:new Mo.Modals,stack:new Mo.Stack},d=new Lo.Uploader(i),_=new Ao.FCPlayer,u=new Ao.FCVoicePlayer,g={vkDomain:(0,Mt.getHostName)(),api:i,lang:l,logger:n,navigate:new jo.Navigate,storage:s,player:_,voicePlayer:u,browserNotifications:new Oo.BrowserNotifications,externalEvents:new Io.ExternalEvents,idle:new xo.Idle(n),stats:o,geoLocation:new qo.GeoLocation,openApp:function(){},vkcom_textInput:(0,zo.vkcom_textInputStub)(),vkcom_mediaSelector:(0,zo.vkcom_mediaSelectorStub)(),botKeyboard:{update:function(){},subscribe:function(){return function(){}},openApp:function(){},openLink:function(){},openSnackbar:function(){},addEventId:function(){}},modals:c,router:zo.fastchatRouter,uploader:d},m={api:i,engine:r,queue:new Fo.SharedQueue,lang:l,logger:n,storage:s,player:_,stats:o,botKeyboard:{update:function(){},subscribe:function(){return function(){}},openApp:function(){},openLink:function(){},openSnackbar:function(){},addEventId:function(){}},modals:c,router:zo.fastchatRouter,notification:new No.Notification},p=(0,ko.createStore)(m,a,void 0,t);return p.start(),this.ownContext={store:p,browserEnv:g},this.ownContext},e.prototype.hide=function(){if(this.isMounted){var t=e.getContainer();t&&bt.unmountComponentAtNode(t),this.unsubscribe(),this.isMounted=!1}},e.prototype.show=function(){var e=this,t=this.getContext(),a=t.store,i=t.browserEnv,n=a.getState().viewer.settings;this.unsubscribe=a.subscribe((function(t){var a=t.viewer.settings;n.ctrSubmit!==a.ctrSubmit&&(window.cur.ctrl_submit=a.ctrSubmit,e.imStore.set((function(e){return(0,Tt.setLocalSettingsValue)("ctrl_submit",Number(a.ctrSubmit),e)}))),n.showRecommendations!==a.showRecommendations&&e.imStore.set((function(e){return(0,Tt.setLocalSettingsValue)("messages_recommendation_list_hidden",Number(!a.showRecommendations),e)})).finally((function(){a.showRecommendations?e.imPageMutations().setRecommendationListVisibility(!0)||(e.hide(),window.nav.reload()):e.imPageMutations().setRecommendationListVisibility(!1)})),n.countOnlyNotMuted!==a.countOnlyNotMuted&&e.imStore.set((function(e){return(0,Tt.setLocalSettingsValue)("show_only_not_muted_messages",Number(a.countOnlyNotMuted),e)})).then((function(e){(0,Po.updateUnreadCounter)(e)})),n.transcriptAutoShow!==a.transcriptAutoShow&&e.imStore.set((function(e){return(0,Tt.setLocalSettingsValue)("transcript_auto_show",Number(a.transcriptAutoShow),e)})).then((function(){return(0,Wt.pause)(.25)})).then((function(){var t;return null===(t=e.imStore.get().longpoll)||void 0===t?void 0:t.push([(0,f.changeVoiceTranscriptUI)()])})),n=t.viewer.settings})),this.renderSettingsPopup(a,i),this.isMounted=!0},e}(),Zo=a(60615),Qo=a(93498),Xo=a(80312),Jo=a(47337),el=a(46830),tl=a(33600),al=a(11728),il=a(57554),nl=function(e){var t=e.contacts,a=e.hasMore,i=e.onSelect,n=(0,mo.useDispatch)(),s=(0,mo.useBrowserEnv)().lang,r=(0,ft.useRef)(null),o=(0,ft.useRef)(null),l=(0,ft.useState)("loading"),c=(0,Xr.default)(l,2),d=c[0],_=c[1],u=(0,ft.useState)(""),g=(0,Xr.default)(u,2),m=g[0],p=g[1],h=(0,ft.useState)([]),v=(0,Xr.default)(h,2),f=v[0],b=v[1],y=(0,ft.useMemo)((function(){return tl.add(tl.create(),(0,Xo.default)(t.values()),(function(e){return{id:e.userId||e.id,strings:tl.peerWords(e)}}))}),[t]);(0,ft.useEffect)((function(){a?n({type:"LoadContactList",offset:0}):(b((0,Xo.default)(t.keys())),_(0===t.size?"empty":"results"))}),[a,n,t]),(0,ft.useEffect)((function(){var e;null===(e=o.current)||void 0===e||e.focus()}),[]),(0,ft.useEffect)((function(){if("loading"!==d){if(m){var e=(0,Xo.default)(tl.search(y,m).values());return b(e),void _(e.length?"results":"empty")}_(0===t.size?"empty":"results"),b((0,Xo.default)(t.keys()))}}),[m,t,y,d]);var C=(0,ft.useCallback)((function(e){var a=e.index,n=e.style,s=f[a];if(!s)return null;var r=t.get(s);return r?ft.createElement("li",{className:"ContactList__item",key:s,style:n,onClick:function(){return i(s)}},ft.createElement("div",{className:"ContactList__avatar"},ft.createElement(Jo.Avatar,{peer:r,size:32,withBirthday:!0})),ft.createElement("div",{className:"ContactList__name"},r.name)):null}),[t,f,i]);return ft.createElement("div",{className:"ContactList"},"loading"!==d&&t.size>0&&ft.createElement("div",{className:"ContactList__search"},ft.createElement("div",{className:"ContactList__searchIcon"},ft.createElement(el.default,null)),ft.createElement("input",{type:"text",className:"ContactList__searchInput",placeholder:s.use("me_convo_list_search_placeholder"),onChange:function(e){return p(e.target.value)},value:m,ref:o})),ft.createElement("div",{className:"ContactList__contacts"},function(){switch(d){case"loading":return ft.createElement(po.OptimizedSpinner,{className:"ContactList__loader"});case"empty":return ft.createElement("div",{className:"ContactList__noResults"},s.use(m?"me_search_empty_contacts":"me_contacts_empty"));default:return ft.createElement(al.default,null,(function(e){return ft.createElement(il.FixedSizeList,{ref:r,className:"ContactList__virtual",height:e.height,width:e.width,overscanCount:10,itemCount:f.length,itemSize:56,innerElementType:"ul"},C)}))}}()))},sl=function(e){var t=e.store,a=e.env,i=e.onSelect,n=(0,ft.useState)(t.getState()),s=(0,Xr.default)(n,2),r=s[0],o=s[1];(0,ft.useEffect)((function(){return t.subscribe(o)}),[t]);var l=wo.safeGet(r.peers,r.viewer.id),c=r.contacts,d=c.items,_=c.hasMore;return ft.createElement(Eo.ErrorBoundary,{fallbackRender:function(){return null},onError:function(e){return a.logger.error("[ContactListApp] Error",e)}},ft.createElement("div",{className:"ContactListApp MEConfig vkui__root"},ft.createElement(Co.Provider,{env:a,state:r,dispatch:t.dispatch,featureFlags:t.featureFlags,owner:l,appSource:"ME"},ft.createElement(uo.ConfigProvider,{platform:uo.Platform.VKCOM,scheme:"inherit"},ft.createElement(uo.AdaptivityProvider,null,ft.createElement(nl,{contacts:d,hasMore:_,onSelect:i}))))))},rl=a(61650),ol=function(e){var t=e.store,a=e.browserEnv,n=e.onClose,s=e.onSelect;return(0,vt.jsxs)(Go.default,(0,i.__assign)({onClose:n,disableBodyScroll:!0},{children:[(0,vt.jsx)(rl.default.Header,{title:(0,Vo.getLang)("mail_contacts_list"),onClose:n},void 0),(0,vt.jsx)("div",(0,i.__assign)({style:{width:550,height:560}},{children:(0,vt.jsx)(sl,{store:t,env:a,onSelect:s},void 0)}),void 0)]}),void 0)},ll=function(){function e(){this.isMounted=!1}return e.prototype.renderContactListPopup=function(t,a){var i=this,n=e.getContainer();n&&bt.render((0,vt.jsx)(ol,{store:t,browserEnv:a,onClose:function(){return i.hide()},onSelect:function(e){return i.onSelectPeer(e)}},void 0),n)},e.getContainer=function(){return document.getElementById("ContactList")},e.prototype.hide=function(){if(this.isMounted){var t=e.getContainer();t&&bt.unmountComponentAtNode(t),this.isMounted=!1}},e.prototype.show=function(){var e,t=null===(e=window.reforgedME)||void 0===e?void 0:e.contactListContext;if(t){var a=t.store,i=t.browserEnv;this.renderContactListPopup(a,i),this.isMounted=!0}},e.prototype.onSelectPeer=function(e){this.hide(),window.nav.go("/im?sel="+e,null,{params:{entrypoint:"contacts_list"}})},e}();function cl(){return cl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},cl.apply(this,arguments)}var dl=(0,ee.debounce)(V.statlogsProbValueEvent,1e3),_l="_im_search_more",ul="im-dialog-select_rotated",gl="im-dialog-select_hidden",ml="im-page--dialogs-header-controls_hidden",pl="_im_create_convo",hl="_im_create_call";function vl(e,t,a,i,r,o,l){var d=(0,c.trim)(o);if((0,u.isSearchingValue)(e,d)){var _=()=>l.clearSearch(e,t);d?(e.setState({recentSearch:!1}),r.stop()):r.replaceOrAdd(_),(0,s.cancelStackPush)("im_search",_),d&&e.set((e=>(0,n.setCurrentSearch)(d,!1,e))).then(t),i.classList.add("im-page--dialogs-search_fill","_im_d_search"),(0,_e.isCommunityInterface)(e)||l.showCancelControl()}else d||(r.stop(),e.set((e=>(0,n.setCurrentSearch)("",!1,e))).then(t),i.classList.remove("im-page--dialogs-search_fill","_im_d_search"),(0,_e.isCommunityInterface)(e)||l.hideCancelControl())}function fl(e,t,a){return function(){var i=(0,u.getSearchText)(t);i===e&&a(...arguments)}}function bl(e,t,a){var i=(0,u.getSearchText)(a);return dl(.01,"im_search_stat",1,"search_start"),(0,n.updateSearchQuery)(i),a.setState({recentSearch:!1}),e().toggleSettingsButton(a,!!i),i?(a.get().dialog_search_going=!0,function(e,t,a){var i=fl(e,a,(e=>t().appendFastDialogs(a,e)));return(0,n.searchTopConv)(e,a.get()).then((e=>{var t=e.filter((e=>"/images/deactivated_50.png"!==e.photo||"DELETED"!==e.tab));return i(t),t}))}(i,e,a).then((n=>{var s=n.map((e=>e.peerId));return t(i,e,s,a)})).then((()=>{a.get().dialog_search_going=!1})).catch((()=>{}))):(e().restoreDialogs(a,!1,!0),(0,Zo.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function yl(e,t,a,i){var s=i.get(),r=fl(e,i,(e=>t().appendDialogs(i,e))),o=fl(e,i,t().appendSearch);return(0,_.isPendingForward)(i)?(0,n.searchHints)(e,a,"all",{},s).then(r):Promise.all([(0,n.searchHints)(e,a,"all",{},s).then(r),(0,n.searchMessages)(e,s)]).then((e=>{var t=e[1],a=t[0],n=t[1];o(i,a,n,!0)}))}function Cl(e,t,a){var i=a.target;e.set((e=>(0,n.toggleCommunityMute)(t,e))).then((()=>{i.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&wl(e,{target:i})}))}function wl(e,t){var a=t.target;return(0,$.showTooltip)(a,{text:()=>e.get().mute?(0,o.getLang)("mail_im_sound_off"):(0,o.getLang)("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function El(e,t,a,i,n,s){switch(n){case"contacts":i.show();break;case"favorites":nav.go("/im?box=fav");break;case"spam":(0,_.showSpamLayer)(t,Zr,s);break;case"settings":a.show();break;case me.ConvoAction.CALL_AUDIO:case me.ConvoAction.CALL_VIDEO:case me.ConvoAction.CALL_APP:(0,_.startCallFromIm)(t,null,n===me.ConvoAction.CALL_VIDEO,[],_.CALL_ENTRY_POINT_LIST,n===me.ConvoAction.CALL_APP);break;case me.ConvoAction.CALL_BY_NAME:(0,_.startCallFromIm)(t,null,!1,null,_.CALL_ENTRY_POINT_LIST,!1,!0);break;case me.ConvoAction.BUSINESS_NOTIFY:case me.ConvoAction.ARCHIVE:if(t.get().active_tab===n)break;if(e().toggleFolder(t,n),(0,u.isClassicInterface)(t)){var r=document.getElementById(`ui_rmenu_${n}`);r?Qo.default.switchMenu(r):Qo.default.unselectAll(document.querySelector("._im_right_menu"))}var o=s.target.closest("._ui_menu_wrap");o&&uiActionsMenu.hide(o)}}function Sl(e,t,a,i,n,r,o,l,c,d,_,u){return{focusInput(){uiSearch.focus(i.parentNode)},hideCancelControl(){a.classList.remove(ml),t.classList.add(gl),t.classList.remove(ul)},showCancelControl(){a.classList.add(ml),t.classList.add(ul),t.classList.remove(gl)},setSearch(e,t,a){void 0===a&&(a=!1);var n=a?d:()=>{};i.value=t,vl(e,n,0,i,r,t,c())},clearSearch(e,t){(0,s.cancelStackFilter)("im_search"),(0,_e.isCommunityInterface)(e)||c().hideCancelControl(),uiSearch.reset(i),e.setState({recentSearch:!1}),vl(e,t||(()=>{}),0,i,r,i.value,c())},initPeerTagsFilter(e){(0,m.initPeerTagsFilter)(e)},applySearchAction(e,t,a){El(o,e,_,u,t,a)},openSettings(){_.show()},unmount(){r.stop(),_.hide(),(0,v.destroyModule)(l),uiSearch.destroy(n),(0,s.cancelStackFilter)("im_search")}}}function Tl(e,t,a){var i=(0,v.createMutations)(Sl),s=i.callMutations,r=i.bindMutations,l=new $o(t,a),c=new ll(t,a),d=(0,h.geByClass1)("_im_dialogs_header_controls",e),g=(0,h.geByClass1)(pl,e),p=(0,h.geByClass1)(hl,e),b=(0,h.geByClass1)("_im_search_cancel",e),y=(0,h.ge)("im_dialogs_search",e),C=(0,h.geByClass1)("_im_gim_mute",e),w=(0,h.geByClass1)("_im_av_time",e),E=(0,h.geByClass1)("_im_peer_tags_filter_control",e),S=(0,h.geByClass1)(_l,e),T=be("im_search",[_l,pl,hl,"_im_page_dcontent","_im_d_search","_im_dialog"]),M=(0,Wt.debouncedPromise)(yl,300),L=e=>bl(a,M,e),I=e=>vl(t,L,0,y,T,e,s()),k=()=>s().clearSearch(t,L),P=(0,h.geByClass1)("_im_dialogs_search_input",e);uiSearch.init(P,{onChange:I}),y.value&&setTimeout((()=>I(y.value)),0);var A=e=>{(0,$.showTooltip)(e.target,{text:(0,o.getLang)("mail_admin_av_time"),dir:(0,h.geByClass1)("_im_top_notice")||(0,h.geByClass1)("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},B=()=>{var e;e=0===t.get().peer||(0,_.isPendingForward)(t)?"search":"default",(0,u.isSearching)(t)||a().toggleSettingsButton(t,!1),t.get().longpoll.push([(0,f.transitionEvent)(e)])},x=()=>{(0,u.isSearching)(t)&&a().toggleSettingsButton(t,!0),function(e,t,a,i,s,r){if(!(0,u.isSearching)(e)){var o=cur.imDb.select(In.RECENT_SEARCH_OP);if(0!==o.length||(0,u.doPopularSuggExist)(e)){e.setState({recentSearch:!0}),vl(e,(()=>{(0,u.isSearching)(e)||(i.stop(),s().toggleSettingsButton(e,!1),s().restoreDialogs(e,!1,!0))}),0,a,i,"",r);var l=o.filter((t=>!(0,_.isTabLoadedWithMessage)(e.get(),t))),c=o.filter((t=>(0,_.isTabLoadedWithMessage)(e.get(),t))).reduce(((t,a)=>(t[a]=(0,u.getTab)(e,a),t)),{});e.get().topConvTree.then((t=>{var a=t.list.filter((e=>l.includes(e[0]))).reduce(((e,t)=>(e[t[0]]=(0,n.localIndexToDialog)(t),e)),{}),i=cl({},a,{},c);return s().appendFastDialogs(e,o.map((e=>i[e]))),a})).then((t=>(0,n.searchHints)("",Object.keys(t),!1,{},e.get()))).then((t=>{s().appendDialogs(e,t)}))}}}(t,0,y,T,a,s())},D=(e,i)=>{var n=i.dataset.action;El(a,t,l,c,n,e)},R=(0,v.createModule)({handlers:(i,n)=>{i(b,"click",k),i(b,"mouseover",(()=>function(e,t){return(0,$.showTooltip)(t,{appendEl:bodyNode,text:(0,o.getLang)("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,b))),i(g,"click",(()=>a().showCreation(t))),(0,h.domData)(p,"disable-click")||i(p,"click",(()=>{(0,_.startCallFromIm)(t,null,!1,null,_.CALL_ENTRY_POINT_LIST)})),n(e,"click","_im_search_more_action",D),w&&i(w,"mouseover",A),(0,_e.isCommunityInterface)(t)&&C&&(i(C,"click",(e=>Cl(t,!0,e))),i(C,"mouseover",(e=>wl(t,e)))),i(y,"click",x),i(y,"blur",B),i(y,"focus",(()=>{t.get().longpoll.push([(0,f.transitionEvent)("search")])})),i(S,"mouseenter",(e=>{var a,i,n=S.parentNode;null==(a=n.querySelector("._is_active"))||a.classList.remove("_is_active"),null==(i=n.querySelector(`[data-action='${t.get().active_tab}']`))||i.classList.add("_is_active")})),(0,_e.isCommunityInterface)(t)&&E&&(n(e,"change","_im_peer_tags_filter_checkbox",(e=>(0,m.onPeerTagsFilterCheckboxChange)(e,t))),n(e,"click","_im_peer_tags_filter_pane_item",(e=>(0,m.onPeerTagsFilterPaneItemClick)(e,t))))}});return(0,_e.isCommunityInterface)(t)&&(E?(0,m.initPeerTagsFilter)(t):C&&Cl(t,!1,{target:C})),r(e,b,d,y,P,T,a,R,s,L,l,c)}var Ml=a(99392);var Ll=a(78843),Il=a(54204),kl=a(57757),Pl=a(49846),Al=a(57833);function Bl(){return Bl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},Bl.apply(this,arguments)}var xl="_im_dialog",Dl="_im_peer_target",Rl="_im_dialog_star",Ol="_im_dialog_actions",Nl="_im_dialog_close",Fl="_im_dialog_actions_item",Ul="nim-dialog_inline-menu_visible",Hl=["_im_dialog_selected","nim-dialog_selected"],jl=["_im_dialog_hovered","nim-dialog_hovered"],ql="_im_dialog_peer_tags",Kl="_convoRecommendUser",Gl="_convoRecommendUserRemove",Wl="_convoRecommendAction",Vl="ConvoRecommendList--fadeIn",zl="ConvoRecommendList--fadeOut",Yl="_im_dialog_folder_button_hide",$l="im-page--dialogs-folder-button_hidden",Zl="_im_dialog_folder_actions",Ql="_im_dialog_folder_actions_item",Xl="_im_dialog_folder_back";function Jl(e,t,a){(0,h.removeClass)(t.parentNode,"im-page--dialogs_with-mess");var i=a.getCurrentElements().filter((e=>e.message));a.toTop(),a.reset(),(0,V.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),i.length>0?(i=[{type:"sep_messages"}].concat(i),e.setState({searchOnlyMessages:!0})):i=[Cc()],a.pipeReplace(Promise.resolve(i))}function ec(e){return(0,h.hasClass)(e,"_im_search")}function tc(e){if((0,u.isSearching)(e)&&e.get().searchAllLoaded||(0,u.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||(0,_.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if((0,u.isSearching)(e))return(0,n.searchMessages)((0,u.getSearchText)(e),e.get()).then((e=>{var t=e[0];return yc(e[1],t)}));var t=e.get().active_tab,a=e.get().dialog_tabs_all;return![E.FOLDER_MESSAGE_REQUEST,E.FOLDER_PEER_TAGS,me.FOLDER_BUSINESS_NOTIFY,me.FOLDER_ARCHIVE].includes(t)&&a[E.FOLDER_ALL]&&!(0,_.isReversedDialogs)(e)||a[t]?Promise.resolve(Oc(e)):e.set(n.loadDialogs).then(Oc)}function ac(e,t,a,i,s,r){var o,l;if(!(null==s||null==(o=s.target)||null==o.closest?void 0:o.closest("._im_dialog_actions"))){var c=parseInt((0,h.domData)(r,"peer"),10),g=(0,u.getTab)(a,c),m=(0,h.hasClass)(r,"_im_sugg_"+c),p=r.classList.contains("ConvoRecommendList__button");if(g||m||p){var v=(0,h.gpeByClass)(Dl,s.target)&&(0,d.checkEvent)(s),b=(0,_.isCommunityInterface)(a)&&(0,h.gpeByClass)(ql,s.target),y=!!(null==(l=s.target)?void 0:l.closest("._convoRecommendUserRemove"));if(!(v||b||y)){var C=a.get(),w=ec(r),E=parseInt((0,h.domData)(r,"msgid"),10);if(g&&(0,u.tabIsMessageRequestToChat)(g))return e().showChatInvitationBox(a,c),(0,d.cancelEvent)(s);var S=`list_${C.active_tab}`;if((0,u.isSearching)(a)&&(S="conversations_search"),(0,u.isRecentSearchesActive)(a)&&(S="recent_searches"),m&&(S="popular_suggestions"),p&&(S="list_all_suggestions"),w&&(S="message_search"),g&&(0,d.checkEvent)(s))return window.open(function(e,t,a,i){void 0===i&&(i=!1);var n=(0,_.getBaseLink)(e),s=()=>`${n}?sel=${(0,_.convertPeerToUrl)(t.peerId)}${i&&a?"&msgid="+a:""}`;if(i)return s();if((0,_.isUserPeer)(t.peerId)||(0,_.isCommunityPeer)(t.peerId))return(0,_.isClassicInterface)(e)?s():t.href;return s()}(a,g,E,w));if(i.saveScroll("list"),e().deselectAllMessages(a),w&&C.msgid!==E)C.longpoll.push([(0,f.changePeer)(c,E,!1,!1,S)]);else if(c!==C.peer){C.longpoll.push([(0,f.changePeer)(c,!1,!0,!0,S)]);var T=(0,u.isSearching)(a);T&&!(0,h.hasClass)(r,"_dont_add_recent")&&(0,n.saveRecentSearchPeer)(c,cur.imDb),T&&g&&!(0,_.isClassicInterface)(a)&&setTimeout((()=>{var e=g.message?g.message.messageId:g.peerId;i.scrollToElement(e.toString(),!0,0,"center")}),100)}else c===C.peer&&e().goToHistoryEnd();(0,Q.isMarusiaPeer)(c)&&(Al.marusiaStats.logChatOpen(Pl.navigationStat.getModule()),ajax.post("al_marusia.php",{act:"send_event",event:"chatopen"})),(0,d.cancelEvent)(s)}}}}function ic(e,t,a,i){var n,s="string"==typeof a.photo&&""!==a.photo,r=(0,_.isContactPeer)(t),o=a.tab||a.name,l=r?(0,_.prepareContactName)(o):o;if((0,_.isChatPeer)(t)&&!s)n=(0,_.renderPhotosFromTab)(e,a,i);else{if(r&&!s){var d=(0,_.getUserInitials)(o),g=(0,u.isSearching)(e)&&!a.message?34:i?50:46;n=(0,c.getTemplate)("sImContactAvatar",{name:d,size:g,classes:"nim-peer--contact-avatar"})}else n=(0,X.isDialogWithYourself)(e.get().id,t)?`<img src="${me.FAVORITES_ICON_URL}" alt="">`:`<img src="${a.photo}" alt="">`;i&&(n=(0,c.getTemplate)("im_dialogs_link_img",{href:a.href||a.link,photo:n}))}return{photo:n,userLink:`<span class="_im_dialog_link">${l}</span>`}}function nc(e,t,a,i){return a?"":i?(0,c.getTemplate)("im_img_prebody",{photo:t}):e+":"}function sc(e,t,a){if(!(a&W.FLAG_OUTBOUND))return!1;if((0,_.isSelfMessage)(t.peerId,e.get().gid))return!1;if((0,_.isChatPeer)(t.peerId)&&t.data&&t.data.closed)return!1;if(t.unread)return!1;if((0,Vt.partConfigEnabled)("me_web_read_by_cmid")){var i=gc(t);return!!i.local||i.chat_local_id>t.out_up_to_cmid}return!!t.lastmsg&&t.lastmsg>t.out_up_to}function rc(e){var t=gc(e);return!!(e.unread>0&&t)||!!(0,u.isTabMarkedUnread)(e)}function oc(e){return(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?!(!e.mention_cmids||!e.mention_cmids.length):!(!e.mentions||!e.mentions.length)}function lc(e){return function(e){return(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?!(!e.expiring_cmids||!e.expiring_cmids.length):!(!e.expiring_messages||!e.expiring_messages.length)}(e)&&!oc(e)}function cc(e,t,a,i){void 0===a&&(a=!1),void 0===i&&(i={});var n=a||gc(t),s=ic(e,t.peerId,t,(0,_.isClassicInterface)(e)),l=s.photo,d=s.userLink;if(!n)return function(e,t,a,i,n){void 0===n&&(n={});var s=[];(0,_.isClassicInterface)(i)&&s.push("nim-dialog_classic"),(0,u.isRecentSearchesActive)(i)&&s.push("nim-dialog_recent"),s.push("nim-dialog_empty"),n.search&&s.push("_im_search");var r=(0,c.getTemplate)("im_drow_close_button",{peer_id:e.peerId});return(0,c.getTemplate)("im_drow",{peer:e.peerId,msg_id:"",photo:t,user_link:a,date:"",body:"",unread:"",more:s.join(" "),is_star:"",unread_message_string:"",is_online:(0,p.onlinePlatformClass)(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==i.get().peer?"nim-dialog_selected _im_dialog_selected":"",actions:r})}(t,l,d,e,i);var m=n.flags,h=(0,_.isFvkcomgroup)(e,t.peerId),v=(0,Y.tabIsMessageRequest)(t),f=(0,u.tabIsMessageRequestToChat)(t),b=(0,u.isCasperChat)(e,t.peerId),y=uc(t,e,a),C=(0,u.isCommunityChat)(e,t.peerId),w=t.major_sort_id,E=[];i.search&&E.push("_im_search","nim-dialog_search"),(0,c.inArray)(t.peerId,e.get().mutedPeers)&&E.push("nim-dialog_muted"),t.verified&&E.push("nim-dialog_verified"),t.isDonutChat&&E.push("nim-dialog_donut"),b&&E.push("nim-dialog_casper"),(0,u.isRecentSearchesActive)(e)&&E.push("nim-dialog_recent"),(0,g.isMessageEmpty)(n)&&!b&&E.push("nim-dialog_empty"),(0,_.isClassicInterface)(e)&&E.push("nim-dialog_classic"),t.folders&W.FOLDER_IMPORTANT&&E.push("nim-dialog_starred"),!i.search&&(0,_.isUnrespond)(e,t.peerId,t)&&E.push("nim-dialog_unrespond"),(h||C)&&e.get().gid&&E.push("nim-dialog_deny-remove"),oc(t)&&E.push("nim-dialog_unread-mentions"),lc(t)&&E.push("nim-dialog_unread-expiring"),t.callInProgress&&E.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&E.push("nim-dialog_active-call-empty"),(0,Q.isPinnedSortId)(w)&&E.push("nim-dialog_pinned");var S=(0,u.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:n.date,T=e.get().timeshift,M=S?(0,o.getShortDateOrTime)(S,T,!0,(0,o.getLang)("months_sm_of","raw")):"",L=!sc(e,t,m)||f||(0,u.isSearching)(e)?"":"nim-dialog_unread-out",I=t.unread>0?(0,o.getLang)("mail_im_new_messages",t.unread):"",k=(0,_.isContactPeer)(t.peerId)?(0,_.prepareContactName)(t.tab):t.tab,P=(0,c.getTemplate)((0,_.isCommunityInterface)(e)||v||!(0,Vt.partConfigEnabled)("mail_dialog_list_menu")?"im_drow_close_button":"im_drow_actions_menu",{peer_id:t.peerId});return(0,c.getTemplate)("im_drow",{peer:t.peerId,msg_id:n.messageId||"",photo:l,user_link:d,date:M,body:y,unread_message_string:I,tab_name:(0,r.stripHTML)(k),unread:(0,_.simplifyCounter)(t.unread),more:E.join(" "),is_online:(0,p.onlinePlatformClass)(t.online),is_unread:rc(t)?"nim-dialog_unread":"",is_unread_out:L,is_selected:i.noselect||f||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected",actions:P,title:(0,Vt.partConfigEnabled)("mail_dialog_preview_title")?y.replace(/\<[^>]*\>/g,""):""})}function dc(e,t,a,i,n){if(!t.deletedDialog)if((0,h.hasClass)(e,"nim-conversation-search-row"))_c(e,t,a);else{var s=a.get(),r=gc(t),l=r.flags,d=uc(t,a),m=ic(a,t.peerId,t,(0,_.isClassicInterface)(a)),v=m.photo,f=m.userLink,b=a.get().timeshift,y=r.date?(0,o.getShortDateOrTime)(r.date,b,!0,(0,o.getLang)("months_sm_of","raw")):"";Sc(e,t),(0,Vt.partConfigEnabled)("mail_dialog_preview_title")&&(0,h.attr)((0,h.geByClass1)("_im_dialog_title",e),"title",(0,Rt.decodeHTMLEntities)(d.replace(/\<[^>]*\>/g,""))),(0,h.val)((0,h.geByClass1)("_dialog_body",e),d),(0,h.val)((0,h.geByClass1)("_im_dialog_date",e),y),(0,h.val)((0,h.geByClass1)("_im_dialog_unread_ct",e),(0,_.simplifyCounter)(t.unread));var C=(0,h.geByClass1)("_im_dialog_link",e);C&&(0,h.val)(C.parentNode,f);var w=(0,h.geByClass1)("_im_dialog_photo",e);w.innerHTML!==v&&(0,h.val)(w,v),s.is_peer_profile_enabled&&(s.peer||Pc(e,a));var E=(0,u.isCasperChat)(a,t.peerId);(0,h.toggleClass)(e,"nim-dialog_verified",!!t.verified),(0,h.toggleClass)(e,"nim-dialog_casper",E),(0,h.toggleClass)(e,"nim-dialog_muted",(0,c.inArray)(t.peerId,a.get().mutedPeers)),(0,h.toggleClass)(e,"nim-dialog_unrespond",(0,_.isUnrespond)(a,t.peerId,t)),(0,h.toggleClass)(e,"nim-dialog_classic",(0,_.isClassicInterface)(a)),(0,h.toggleClass)(e,"nim-dialog_unread",rc(t)),(0,h.toggleClass)(e,"nim-dialog_unread-mentions",oc(t)),(0,h.toggleClass)(e,"nim-dialog_unread-expiring",lc(t)),(0,h.toggleClass)(e,"nim-dialog_active-call",!!t.callInProgress),(0,h.toggleClass)(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),(0,h.toggleClass)(e,"nim-dialog_pinned",(0,Q.isPinnedSortId)(t.major_sort_id)),(0,h.toggleClass)(e,"nim-dialog_deny-remove",a.get().gid>0&&((0,_.isFvkcomgroup)(a,t.peerId)||(0,u.isCommunityChat)(a,t.peerId))),(0,h.removeClass)(e,"nim-dialog_failed"),(0,h.removeClass)(e,"nim-dialog_deleted"),(0,h.addClass)(e,"_im_dialog"),(0,p.toggleOnline)((0,h.geByClass1)("_im_peer_online",e),t.online),(0,h.toggleClass)(e,"nim-dialog_recent",(0,u.isRecentSearchesActive)(a)),(0,h.toggleClass)(e,"nim-dialog_empty",(0,g.isMessageEmpty)(r)&&!E),(0,h.toggleClass)(e,"nim-dialog_unread-out",sc(a,t,l)&&!(0,u.isSearching)(a)),(0,h.toggleClass)(e,"nim-dialog_starred",t.folders&W.FOLDER_IMPORTANT),n&&setTimeout((function(){(0,h.addClass)((0,h.geByClass1)("_im_dialog_"+t.peerId,i),"nim-dialog_injected")}),100)}}function _c(e,t,a){Sc(e,t),(0,h.toggleClass)(e,"nim-dialog_recent",(0,u.isRecentSearchesActive)(a)),(0,h.val)((0,h.geByClass1)("_im_dialog_unread_ct",e),(0,_.simplifyCounter)(t.unread)),(0,h.toggleClass)(e,"nim-dialog_unread",rc(t)),(0,h.toggleClass)(e,"nim-dialog_unread-expiring",lc(t)),(0,h.toggleClass)(e,"nim-dialog_unread-mentions",oc(t));var i=ic(a,t.peerId,t,(0,_.isClassicInterface)(a)).photo,n=(0,h.geByClass1)("_im_dialog_photo",e);n.innerHTML!==i&&(0,h.val)(n,i),(0,p.toggleOnline)((0,h.geByClass1)("_im_peer_online",e),t.online)}function uc(e,t,a){void 0===a&&(a=!1);var i=a||gc(e),n=(0,u.tabIsMessageRequestToChat)(e),s=(0,u.isCasperChat)(t,e.peerId);if(n){var r=(0,_.isClassicInterface)(t),l=e.mr&&e.mr.inviter_id,d=(0,z.oCacheGet)(t,l),m=r?d.name:d.short_name;return(r?(0,c.getTemplate)("im_img_prebody",{photo:d.photo}):"")+(0,o.getLang)("mail_mr_service_message").replace(/{user}/,m)}if((0,_.isPeerBlocked)(e.peerId,t)){var p=t.get().block_states[e.peerId].name,h=(0,o.getLang)("mail_community_answering").replace("{username}",p);return(0,c.getTemplate)("im_drow_prebody",{prebody:h,body:""})}return(0,g.isServiceMsg)(i)&&!n?(0,An.renderServiceMsg)(t,i,e.peerId,!1):s&&(0,g.isMessageEmpty)(i)?(0,o.getLang)("mail_empty_casper_message"):(0,g.isExpiredCasperMessage)(i)?(0,o.getLang)("mail_expired_message"):function(e,t,a,i,n,s,r,l,d,g){var m="",p=(0,u.isChannelPeer)((0,u.getTab)(e,a));return t&W.FLAG_OUTBOUND?m=nc((0,o.getLang)("mail_by_you"),g,p,d):!(0,Y.isBusinessNotifyTab)((0,u.getTab)(e,a))&&(0,_.isChatPeer)(a)&&0!==i&&(m=nc((0,z.oCacheGet)(e,i).first_name,(0,z.oCacheGet)(e,i).photo,p,d)),r=(0,_.renderShortText)(a,l,r,n,s),m?(0,c.getTemplate)("im_drow_prebody",{prebody:m,body:r}):r}(t,i.flags,e.peerId,i.userId,!0,i.attaches,i.text,i.subject,(0,_.isClassicInterface)(t),(0,z.oCacheGet)(t,t.get().id).photo)}function gc(e){var t=e.lastmsg_meta;return Array.isArray(t)&&(t=(0,Z.getMessageFromTuple)(t)),t||(0,Z.getMessageFromTuple)([-1,0,e.peerId,0,"",{},{},-1,-1,0])}function mc(e,t,a){var i=(0,u.getTab)(e,t),s=(0,u.tabIsMessageRequestToChat)(i),r=(0,_.showLeaveDialog)(e,t,(i=>{a().updateMenu(e);var o=Promise.resolve();(0,_.isChatPeer)(t)&&(o=s?e.set((e=>(0,n.rejectMessageRequest)(t,!1,e))):e.set((e=>(0,n.leaveChat)(t,e)))),i&&o.then((()=>(0,_.cleanHistory)(e,r,a,n.flushHistory,t))),r.hide()}))}function pc(e,t,a,i,s,r){var l=(0,h.gpeByClass)("_im_dialog",r,a);if((0,d.cancelEvent)(s),!l)return!1;var u=(0,c.intval)((0,h.domData)(l,"peer")),g=t.get(),m=(0,_.isCommunityPeer)(u)||(0,_.isUserPeer)(u);if(g.recentSearch){var p=(0,n.removeFromRecentSearch)(u,cur.imDb);(0,h.re)(l),0===p.length&&kc(t,i,e)}else(0,_.isClassicInterface)(t)&&m?(0,n.deleteDialog)(u,g).then((a=>{var i=a[0],n=a[1];i?(!function(e,t,a,i,n){var s=(0,h.geByClass1)("_dialog_body",t);(0,h.addClass)(t,"nim-dialog_deleted"),(0,h.removeClass)(t,"_im_dialog"),(0,h.val)(s,(0,c.getTemplate)("im_delete_actions",{text:(0,o.langNumeric)(a,(0,o.getLang)("mail_im_X_message_deleted","raw")),peer:e,spam_id:i}))}(u,l,i,n),e().updateMenu(t)):mc(t,u,e)})):mc(t,u,e);return!1}function hc(e,t,a){(0,_.toggleDialogsFolder)(e,(e=>{t().restoreDialogs(e,!0,!0),(0,S.unpackStore)(e).active_tab===E.FOLDER_ALL&&t().updateRecommendationList(e),t().updateDialogFilters(e,!0)}),n.changeDialogsTab,a)}function vc(e,t,a){var i;void 0===a&&(a="");var n=ic(e,t.peerId,t,(0,_.isClassicInterface)(e)),s=n.photo,o=n.userLink,l=(0,_.isContactPeer)(t.peerId)?(0,_.prepareContactName)(t.tab):t.tab,d=function(e){return!(0,_.isPendingForward)(e)}(e),g=""===a?[]:[a],m=e.get();return(0,u.isRecentSearchesActive)(e)&&g.push("nim-dialog_recent"),(0,_.isClassicInterface)(e)&&g.push("nim-csr_classic"),(0,c.inArray)(t.peerId,e.get().mutedPeers)&&g.push("nim-dialog_muted"),(0,u.isCasperChatTab)(t)&&g.push("nim-dialog_casper"),oc(t)&&g.push("nim-dialog_unread-mentions"),lc(t)&&g.push("nim-dialog_unread_expiring"),(null==(i=(0,u.getTab)(e,t.peerId))?void 0:i.isDonutChat)&&g.push("nim-dialog_donut"),(0,c.getTemplate)("im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:s,user_link:o,unread:(0,_.simplifyCounter)(t.unread),tab_name:(0,r.stripHTML)(l),is_unread:rc(t)?"nim-dialog_unread":"",is_online:(0,p.onlinePlatformClass)(t.online),is_selected:t.peerId==m.peer&&d?"nim-dialog_selected _im_dialog_selected":"",more:g.join(" ")})}function fc(e,t){switch(t.type){case"sep_btn_search_msg":return(0,_.renderBtnSearchOnlyMessages)(e);case"sep_messages":return(0,_.renderMessagesSep)();case"sep_conversations":return(0,_.renderConversationsSep)();case"sep_popular":return(0,_.renderPopularSuggSep)();case"popular_sugg":return(0,_.renderPopularSuggestions)(e);case"recommend_list":return(0,_.renderConvoRecommendList)(e);case"find_friends_stub":return(0,_.renderFindFriendsStub)(e);case"clear_recent":return(0,_.renderClearRecent)();case"empty_dialogs":return(0,c.getTemplate)("im_dialogs_none",{msg:(0,o.getLang)("mail_dialogs_list_empty"),icon:""});case"empty_business_notify":return(0,c.getTemplate)("im_dialogs_none",{msg:(0,o.getLang)("mail_dialogs_business_notify_empty"),icon:""});case"empty_archives":return(0,c.getTemplate)("im_dialogs_none",{msg:(0,o.getLang)("mail_dialogs_archives_empty"),icon:'<svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="archive_outline_56__Icons-56/archive_outline_56" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="archive_outline_56__archive_outline_56"><path d="M0 0h56v56H0z"/><path d="M44.5 18c.83 0 1.5.67 1.5 1.5v21a7.5 7.5 0 0 1-7.5 7.5h-21a7.5 7.5 0 0 1-7.5-7.5v-21c0-.83.67-1.5 1.5-1.5h33ZM43 21H13v19.5a4.5 4.5 0 0 0 4.5 4.5h21a4.5 4.5 0 0 0 4.5-4.5V21Zm-21.5 9h13a1.5 1.5 0 0 0 0-3h-13a1.5 1.5 0 0 0 0 3Zm-9-22h31a6.5 6.5 0 0 1 6.5 6.5v4a2.5 2.5 0 0 1-2.5 2.5h-39A2.5 2.5 0 0 1 6 18.5v-4A6.5 6.5 0 0 1 12.5 8ZM47 18v-3.5a3.5 3.5 0 0 0-3.5-3.5h-31A3.5 3.5 0 0 0 9 14.5V18h38Z" id="archive_outline_56__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>'});case"empty_message_requests":return(0,c.getTemplate)("im_dialogs_none",{msg:(0,o.getLang)("mail_dialogs_mr_empty"),icon:""});case"empty":return(0,c.getTemplate)("im_dialogs_none",{msg:(0,o.getLang)("mail_im_search_empty"),icon:""});case"message_request_notice":return(0,c.getTemplate)("im_dialogs_message_requests_notice",{msg:(0,o.getLang)("mail_message_request_tab_notice")});case"message_request_button_go":return(0,c.getTemplate)("im_dialogs_message_requests_button",{msg:(0,o.getLang)("mail_tab_mr"),counter:(0,Ll.getFolderUnreadCount)(e,me.ConvoListFolder.MR)});case"business_notify_button_go":return(0,c.getTemplate)("im_dialogs_business_notify_button",{msg:(0,o.getLang)("mail_tab_business_notify"),class_name:t.hidden?$l:"",counter:(0,Ll.getFolderUnreadCount)(e,me.ConvoListFolder.BUSINESS_NOTIFY)});case"archive_button_go":return(0,c.getTemplate)("im_dialogs_archives_button",{msg:(0,o.getLang)("mail_tab_archives"),class_name:t.hidden?$l:"",counter:(0,Ll.getFolderUnreadCount)(e,me.ConvoListFolder.ARCHIVE),mentions:(0,Ll.getFolderMentionsCount)(e,me.ConvoListFolder.ARCHIVE)});case"archive_notice":var a=(0,c.getTemplate)("im_dialogs_archive_notice_button",{text:(0,o.getLang)("mail_archive_tab_notice_button")}),i=(0,o.getLang)("mail_archive_tab_notice_content").replace("{button}",a);return(0,c.getTemplate)("im_dialogs_archive_notice",{title:(0,o.getLang)("mail_archive_tab_notice_title"),text:i});case"all":var n=(0,S.unpackStore)(e).active_tab,s={[me.ConvoListFolder.MR]:(0,o.getLang)("mail_tab_mr"),[me.ConvoListFolder.BUSINESS_NOTIFY]:(0,o.getLang)("mail_tab_business_notify"),[me.ConvoListFolder.ARCHIVE]:(0,o.getLang)("mail_tab_archives")}[n],r=(0,Ll.getFolderInlineMenuActions)(e,n).length>0?(0,c.getTemplate)("im_dialogs_active_folder_button_actions",{folder:n}):"";return(0,c.getTemplate)("im_dialogs_active_folder_button",{msg:s,class_name:`_im_folder_${n}_header`,actions:r});case"new_ui_notice":return(0,c.getTemplate)("im_dialogs_new_ui_notice",{title:(0,o.getLang)("mail_new_ui_notice_title"),text:(0,o.getLang)("mail_new_ui_notice_text")});default:return t.message?cc(e,t,t.message,{noselect:!0,search:!0}):t.local_index||(0,u.isSearching)(e)?vc(e,t):cc(e,t)}}function bc(e,t,a,i,s,r){var l=(0,c.intval)((0,h.domData)(r,"peer")),u=(0,h.domData)(r,"action"),g=(0,h.domData)(r,"sid"),m=(0,h.geByClass1)("_im_dialog_"+l,t),p=(0,c.intval)((0,h.domData)(r,"spam"));switch(u){case"restore":m&&e.set(n.restoreDialog.bind(null,l,g,p)).then((()=>{(0,h.addClass)(m,"_im_dialog"),(0,h.removeClass)(m,"nim-dialog_deleted"),dc(m,e.get().tabs[l],e,t,!1),i().updateMenu(e)}));break;case"spam":var v=`${(0,o.getLang)("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${g}" data-peer="${l}">\n            ${(0,o.getLang)("mail_restore")}\n        </button>`;if(m){var f=(0,h.geByClass1)("_dialog_body",m);(0,h.val)(f,v),(0,n.spamDialog)(l,g,e.get())}break;case"block":((0,_.isCommunityInterface)(e)?(0,_.showBlacklistBox)(l,e):(0,_.showBlacklistBoxUser)(l,e)).once("success",(function(){e.set(n.flushHistory.bind(null,l)).then((()=>{a().restoreDialogs(e)}))}))}(0,d.cancelEvent)(s)}function yc(e,t){return e.map((e=>(0,Z.getMessageFromTuple)(e))).map((e=>(0,c.extend)({},t[e.peerId],{message:e})))}function Cc(e){return{type:"empty",lang:e}}function wc(e,t,a,i){var s=(0,h.gpeByClass)("_im_dialog",i,t),r=(0,c.intval)((0,h.domData)(s,"peer"));return e.set(n.toggleDialogImportant.bind(null,r)),setTimeout((function(){Ec(e,t,a,i)}),100),(0,d.cancelEvent)(a),!1}function Ec(e,t,a,i){(0,$.showTooltip)(i,{text:function(){var a=(0,h.gpeByClass)("_im_dialog",i,t),n=(0,h.domData)(a,"peer");return e.get().tabs[n].folders&W.FOLDER_IMPORTANT?(0,o.getLang)("mail_im_toggle_important_off"):(0,o.getLang)("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:Nc(e,i.getBoundingClientRect().top)})}function Sc(e,t){var a=t.unread>0?(0,o.getLang)("mail_im_new_messages",t.unread):"",i=(0,h.geByClass1)("_im_unread_blind_label",e);(0,h.val)(i,a)}function Tc(e,t,a,i,s){var r=(0,h.gpeByClass)("_im_dialog",s,t),_=(0,c.intval)((0,h.domData)(r,"peer"));return e.set(n.markDialogAnswered.bind(null,_)).then((()=>{dc(r,e.get().tabs[_],e,t),(0,u.isRecentSearchesActive)(e)||a().restoreDialogs(e)})),(0,l.showDoneBox)((0,o.getLang)("mail_marked_as_answered"),{out:1e3}),(0,d.cancelEvent)(i),!1}function Mc(e){var t=(0,u.isSearching)(e),a=e.get().searchOnlyMessages;return(0,_.isClassicInterface)(e)?{top:t&&!a?96:60,bottom:(0,_.isCommunityInterface)(e)?42:87}:{top:t&&!a?36:0,bottom:0}}function Lc(e,t){e.hoverFirstElement(jl,Mc(t))}function Ic(e){e.unhoverElements(jl)}function kc(e,t,a){if((0,u.doPopularSuggExist)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else a().cancelSearch(e),(0,s.cancelStackFilter)("im_search")}function Pc(e,t){var a=t.get(),i=parseInt((0,h.domData)(e,"peer")),n=(0,u.getTab)(a,i);if(a.is_peer_profile_enabled&&(0,_.isCommunityInterface)(a)&&n&&!(0,u.isChannelPeer)(n)&&!(0,u.isCommunityChat)(a,i)&&!(0,u.isSearching)(t)){var s=(0,h.geByClass1)(ql,e);if(n.ad_id||a.peer_profile_tags&&n.peer_tags&&n.peer_tags.ids){var r=n.peerTagsMaxWidth||0;if(!r){var o=(0,h.geByClass1)("_im_dialog_name_w",e).offsetWidth;r=340-(o+6+(n.verified?16:0)),t.set((e=>(e.tabs[i].peerTagsMaxWidth=r,Promise.resolve(e))))}(0,m.renderPeerTags)(s,r,t,i)}else s.innerHTML&&(s.innerHTML="")}}function Ac(e,t){if((0,_.isCommunityInterface)(e)){["empty_dialogs","empty_business_notify","empty_archives","empty"].includes((0,h.domData)(t,"list-id"))?(0,m.updateEmptyDialogsMargin)():(0,h.hasClass)(t,"_im_dialog")&&Pc(t,e)}}function Bc(e){(0,d.checkEvent)(e)||(0,d.cancelEvent)(e)}function xc(){return window.FriendsSearch?Promise.resolve():window.stManager.add([window.jsc("web/friends_search.js")])}function Dc(e,t,a){var i={new_ui_notice:{selector:"._im_new_ui_notice",setting:"new_ui_notice_hidden"},archive:{selector:"._im_archive_notice",setting:"archives_folder_notice_hidden"}}[a],n=i.selector,s=i.setting;n&&s&&e.set((e=>(0,Tt.setLocalSettingsValue)(s,1,e))).then((()=>(t.querySelector(n).hidden=!0,(0,Aa.toggleHideFolderNoticeHandler)((0,S.unpackStore)(e),a,1))))}function Rc(e,t,a,i,n,s){return{selectPeer(t,a){for(var i=(0,h.geByClass)("_im_dialog",e),n=a.get().peer,s=0;s<i.length;s++){var r=i[s],o=(0,c.intval)((0,h.domData)(r,"peer")),l=(0,c.intval)((0,h.domData)(r,"msgid"));o===n&&(!ec(r)||t===l&&ec(r))?((0,h.addClass)(r,"nim-dialog_selected"),(0,h.addClass)(r,"_im_dialog_selected")):(0,h.hasClass)(r,"_im_dialog_selected")&&((0,h.removeClass)(r,"nim-dialog_selected"),(0,h.removeClass)(r,"_im_dialog_selected"))}},appendFastDialogs(t,i,n){(0,h.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),a.saveScroll("list"),n?(a.reset(),(0,_.isPendingForward)(t)||(0,u.isRecentSearchesActive)(t)||!C(i)?(0,u.isRecentSearchesActive)(t)&&(C(i)&&(i=[{type:"clear_recent"}].concat(i)),(0,u.doPopularSuggExist)(t)&&(i=[{type:"sep_popular"},{type:"popular_sugg"}].concat(i))):i=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(i),t.setState({searchOnlyMessages:!1}),a.pipeReplace(Promise.resolve(i)).then((()=>Lc(a,t)))):a.pipe(Promise.resolve(i)),(0,_.isClassicInterface)(t)&&!(0,_.isReservedPeer)(t.get().peer)||a.toTop()},deactivate(){a.deactivate()},activate(){a.activate()},hoverFirstDialog(e){Lc(a,e)},hoverNextDialog(e){a.hoverNextElement(jl,Hl,Mc(e))},hoverPrevDialog(e){a.hoverPrevElement(jl,Hl,Mc(e))},unhoverDialogs:Ic.bind(a),selectHoveredDialog(t){var n=(0,h.geByClass1)("_im_dialog_hovered",e);(0,Vt.partConfigEnabled)("mail_dialog_list_disable_enter_default")||n||(n=(0,h.geByClass1)("_im_dialog",e)),n&&ac(i,0,t,a,{},n)},appendSearch(t,i,n){var s=yc(n,i);n.length>0?((0,h.addClass)(e.parentNode,"im-page--dialogs_with-mess"),a.pipe(Promise.resolve([{type:"sep_messages"}].concat(s))).then((()=>Lc(a,t)))):(0===a.getCurrentElements().length&&a.pipeReplace(Promise.resolve([Cc()])),(0,h.removeClass)(e.parentNode,"im-page--dialogs_with-mess"))},update(e){a.pipeReplace(Promise.resolve(Oc(e))).then(s.track)},updateDialog(t,a){var i=(0,h.geByClass1)("_im_dialog_"+t,e);i&&!ec(i)&&dc(i,(0,u.getTab)(a,t),a,e)},focusOnSelected(t){var i=t.get().peer;if(i){var n=(0,h.geByClass1)(`_im_dialog_${i}`,e);n?a.scrollTop(n.offsetTop-n.offsetHeight):a.toTop()}},restoreScroll(e){a.restoreScroll("list")||a.toTop()},forceScrollReinit(){var e=a.getScroller();e&&(e.style.overflowY="hidden",setTimeout((()=>e.style.overflowY=""),0))},restoreDialogs:(t,n,r)=>((0,h.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),(0,Ll.isEmptyFolder)(t)&&!a.isLoading()&&(n=!0),n&&a.reset(),r&&a.wipe(),(0,$.hideAllTooltips)(e),a.pipeReplace(Promise.resolve(Oc(t))).then((()=>{if(n&&(!(0,_.isClassicInterface)(t)||!t.get().peer)){var e=function(e,t,a){return(0,_.isClassicInterface)(a)||t().toggleSettingsLoader(a,!0),e.checkMore(!(0,_.isClassicInterface)(a)).then((()=>{(0,_.isClassicInterface)(a)||t().toggleSettingsLoader(a,!1)}))}(a,i,t);return a.toTop(),e}})).then((()=>Ic(a))).then(s.track)),appendDialogs(t,i){(0,h.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),i.forEach((a=>{var i=(0,h.geByClass1)("_im_dialog_"+a.peerId,e);i&&_c(i,a,t)})),(0,_.isPendingForward)(t)||(0,u.isRecentSearchesActive)(t)||!C(i)||(i=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(i)),t.setState({searchOnlyMessages:!1}),a.isEmpty()&&0===i.length&&(0,_.isPendingForward)(t)&&(i=[Cc((0,o.getLang)("mail_im_search_empty_chats"))]),a.replacePreserveOrder(i)},updateCounter(t,a){var i=(0,h.geByClass1)("_im_dialog_"+a,e),n=(0,u.getTab)(t,a);if(i&&!ec(i)&&(Sc(i,n),(0,h.val)((0,h.geByClass1)("_im_dialog_unread_ct",i),(0,_.simplifyCounter)(n.unread)),(0,h.toggleClass)(i,"nim-dialog_unread",rc(n)),(0,h.toggleClass)(i,"nim-dialog_unread-out",sc(t,n,gc(n).flags)),(0,h.toggleClass)(i,"nim-dialog_unread-mentions",oc(n)),(0,h.toggleClass)(i,"nim-dialog_unread-expiring",lc(n))),(0,u.isRecentSearchesActive)(t)){var s=(0,h.geByClass1)("_im_sugg_"+a,e);s&&((0,h.val)((0,h.geByClass1)("_sugg_unread_ct",s),(0,_.simplifyCounter)(n.unread)),(0,h.toggleClass)(s,"sugg-is_unread",n.unread>0))}},removeDialog(e,t){a.remove(t)},updateOnline(t,a){var i=(0,h.geByClass1)("_im_dialog_"+t,e);if(i){var n=a.get().tabs[t],s=(0,h.geByClass1)("_im_peer_online",i);(0,p.toggleOnline)(s,n.online)}},updateRecommendedOnline(t,a){var i=(0,Y.getRecommendedConvoList)(a),n=e.querySelector(`.ConvoRecommendList__button[data-peer="${t}"]`);if(n&&i){var s=i.item_data[t].online_info,r=n.querySelector("._online");r.classList.toggle("online",s.is_online||s.is_mobile),r.classList.toggle("mobile",s.is_mobile)}},updateRecommendationList(t){var a=(0,h.se)((0,_.renderConvoRecommendList)(t)),i=a.querySelector("._im_carousel_layer");if(i){var n=e.querySelector(".ConvoRecommendList ._im_carousel_viewport");if(n){var r=n.querySelector("._im_carousel_layer:not(.ConvoRecommendList--fadeOut)");r&&(r.classList.add(zl),r.addEventListener("animationend",(()=>{i.classList.remove(Vl),r.parentNode&&(r.remove(),s.track())}))),i.classList.add(Vl),n.appendChild(i)}}else{var o=e.querySelector(".ConvoRecommendList");o&&o.replaceChildren(...a.children)}},setRecommendationListVisibility(t){var a=e.querySelector(".ConvoRecommendList");return!!a&&(a.classList.toggle("ConvoRecommendList--hidden",!t),!0)},setDialogFailed(t,a,i){var n=(0,h.geByClass1)("_im_dialog_"+t,e);n&&(i.get().tabs[t].lastmsg===a&&((0,h.addClass)(n,"nim-dialog_failed"),(0,h.val)((0,h.geByClass1)("_im_dialog_unread_ct",n),"!")))},scrollUp(e,t){void 0===t&&(t=!1),a.toTop(e,t),a.saveScroll("list",!0)},saveScroll(e){a.saveScroll("list",!0)},promoteDialog(i,n){var s=(0,h.geByClass1)("_im_dialog_"+n,e);s&&!ec(s)||!(0,u.isSearching)(i)?(a.pipeReplace(Promise.resolve(Oc(i)),void 0,!0).then((t=>{!(0,c.inArray)(n,t)&&s&&dc(s,(0,u.getTab)(i,n),i,e)})),t().updateTyping(n,i)):a.unsetScroll("list")},removeSelection(t){var i=t.get().peer.toString(),n=`._im_dialog_${i}.${Hl.join(".")}`,s=(0,h.domQuery)(n,e)[0];Hl.forEach((e=>(0,h.removeClass)(s,e))),(0,_.isClassicInterface)(t)||a.hoverElement(i,jl,Mc(t))},updateScroll(){a.updateScroll()},updateTyping(t,a){var i=(0,h.geByClass1)(`_im_dialog_${t}`,e);if(i&&!ec(i)&&!a.get().tabs[t].deletedDialog){var n=(0,h.geByClass1)("_im_dialog_typing",i),s=!(0,_.isClassicInterface)(a),r=(0,_.formatTyper)((0,u.getTab)(a,t).activity,t,!(0,_.isChatPeer)(t),a.get(),1,s);(0,h.val)(n,r),(0,h.toggleClass)(i,"nim-dialog_typing",r)}},renderPeerTags(t,a){(void 0===a&&(a=null),a)?Pc((0,h.geByClass1)("_im_dialog_"+a,e),t):function(e,t){var a=t.get();a.is_peer_profile_enabled&&(0,_.isCommunityInterface)(a)&&(0,h.geByClass)("_im_dialog",e).forEach((e=>{Pc(e,t)}))}(e,t)},updateFolderCounters(t){var a=(0,S.unpackStore)(t),i={[me.ConvoListFolder.ARCHIVE]:_.TOGGLE_ARCHIVES_TAB,[me.ConvoListFolder.BUSINESS_NOTIFY]:_.TOGGLE_BUSINESS_NOTIFY_TAB};[me.ConvoListFolder.MR,me.ConvoListFolder.BUSINESS_NOTIFY,me.ConvoListFolder.ARCHIVE].forEach((t=>{var n=(0,Ll.getFolderUnreadCount)(a,t),s=e.querySelector(`[data-list-id=${t}_button_go] .im-page--dialogs-folder-button--counter`);s&&(s.innerHTML=n);var r,o,l=i[t];l&&(null==e||null==(r=e.querySelector(`.${l}`))||null==(o=r.classList)||o.toggle($l,(0,Ll.isConvoListFolderHidden)(a,t)))}));var n=(0,Ll.getFolderMentionsCount)(a,me.ConvoListFolder.ARCHIVE),s=e.querySelector(`[data-list-id=${me.ConvoListFolder.ARCHIVE}_button_go] .im-page--dialogs-folder-button--mentions`);s&&(s.dataset.mentions=n)},toggleFolder:hc,unmount(){a.unmount(),s.destroy(),(0,v.destroyModule)(n)}}}function Oc(e){var t,a,i=(0,S.unpackStore)(e),n=i.active_tab,s=null!=(t=null==(a=i.dialog_tabs)?void 0:a[n])?t:[],r=i.tabs,o=s.map((e=>r[e.toString()])).sort(X.sortFn.bind(null,e)),l=(0,_.isViewWithRecommendations)(e)&&o.length<2&&!i.hasContacts;if(n===E.FOLDER_MESSAGE_REQUEST&&o.unshift({type:"message_request_notice"}),n!==me.FOLDER_ARCHIVE||i.settings.archives_folder_notice_hidden||o.unshift({type:"archive_notice"}),!(0,_.isClassicInterface)(e))switch(n){case E.FOLDER_ALL:(0,Ll.getConvoListFolderCounterDisplayed)(e,me.ConvoListFolder.MR)>0&&o.unshift({type:"message_request_button_go"}),(0,_e.isBusinessNotifyEnabled)(e)&&o.unshift({type:"business_notify_button_go",hidden:(0,Ll.isConvoListFolderHidden)(e,me.FOLDER_BUSINESS_NOTIFY)}),o.unshift({type:"archive_button_go",hidden:(0,Ll.isConvoListFolderHidden)(e,me.FOLDER_ARCHIVE)});break;case E.FOLDER_UNREAD:o.unshift({type:"archive_button_go",hidden:(0,Ll.isConvoListFolderHidden)(e,me.FOLDER_ARCHIVE)});break;case E.FOLDER_MESSAGE_REQUEST:case me.FOLDER_BUSINESS_NOTIFY:case me.FOLDER_ARCHIVE:o.unshift({type:"all"})}return(0,_.isViewWithRecommendations)(e)&&(i.hasContacts||s.length>1)&&o.unshift({type:"recommend_list"}),l?o.push({type:"find_friends_stub"}):(0,Ll.isEmptyFolder)(e)&&o.push(...(0,Ll.getEmptyFolderEls)(e)),(0,Vt.partConfigEnabled)("mail_new_ui_banner")&&n===E.FOLDER_ALL&&!(0,_.isCommunityInterface)(e)&&!(0,_.isClassicInterface)(e)&&!(0,_e.getLocalSettingsValue)(e,"new_ui_notice_hidden")&&o.unshift({type:"new_ui_notice"}),o}function Nc(e,t){var a=e.get().gid?220:150;return!((0,m.isPeerTagsFolder)(e)&&t<=a+46)&&(t>a||(0,u.isSearching)(e))}function Fc(e,t,a,i){var s=(0,v.createMutations)(Rc),r=s.callMutations,l=s.bindMutations,g=bodyNode.appendChild(document.createElement("div"));g.classList.add("im-page--dialogs-inline-menu-container");var f,b,y,C,w=function(e,a){(0,$.showTooltip)(a,{text:()=>{if((0,u.isRecentSearchesActive)(t))return(0,o.getLang)("mail_hide_from_recent");var e=Number(a.getAttribute("data-peer")),i=(0,u.getTab)(t,e),n=(0,u.tabIsMessageRequestToChat)(i);return(0,_.isChatPeer)(e)&&!n?(0,Y.doesChatTabHaveFlag)((0,u.getTab)(t,e),1024)?(0,o.getLang)("mail_unfollow_channel"):(0,u.isChatActive)(i)?(0,o.getLang)("mail_leave_chat"):(0,o.getLang)("mail_delete"):(0,o.getLang)("mail_delete")},black:1,[(0,_.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:(0,_.isClassicInterface)(t)?[-4,10]:[0,10],toup:Nc(t,a.getBoundingClientRect().top),zIndex:1})},E=function(a,i){var n=i.dataset.folder;if(n){var s=function(e,t,a,i,n){return a=>{var s,r=a.target.closest(`.${Ql}`);if(r&&r.dataset.action===me.FolderAction.SHOW){var o={[me.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[me.ConvoListFolder.ARCHIVE]:"archives_folder_hidden"}[i];o&&t.set((e=>(cur.imDb.updateByKey("archives_folder_hidden",null),(0,Tt.setLocalSettingsValue)(o,null,e)))).then((t=>{var a=e.querySelector(`.${Zl}`);return a&&(a.hidden=!0),(0,Aa.toggleHideFolderHandler)((0,S.unpackStore)(t),i,!1,!0)})),null==n||null==(s=n.tt)||s.hide()}}}(e,t,0,n,i),r=(0,Ll.getFolderInlineMenuActions)(t,n).map((e=>(0,c.getTemplate)("im_page_inline_menu_item",Bl({},e,{class_name:Ql})))).join(""),o=(0,c.getTemplate)("im_page_inline_menu",{actions:r});(0,$.showTooltip)(i,{text:o,onCreate:()=>{var e,t;return null==(e=i.tt)||null==(t=e.container)?void 0:t.addEventListener("click",s)},onHide:()=>{var e,t,a;null==(e=i.tt)||null==(t=e.container)||t.removeEventListener("click",s),null==(a=i.tt)||a.destroy()},black:0,dir:"top",shift:[-2,-6],zIndex:130,hasover:!0,appendEl:g,className:"im_page_inline_menu_tt im_page_folder_inline_menu_tt",slide:4,showdt:100,hidedt:100,forcetodown:1,needLeft:!0})}},T=function(i,n){var s=(0,u.getTab)(t,Number(n.dataset.peer));if(s){(0,$.hideAllTooltips)(e),(0,$.destroyAllTooltips)(e),f=null;var o=function(e,t,a,i,n){return s=>{var r,o=s.target.closest("._im_dialog_actions_item");if(o){var l=o.dataset.action;(0,kl.handleUiActionForPeer)(e,t,a,l,i),null==n||null==(r=n.tt)||r.hide()}}}(t,a,r,s.peerId,n),l=(0,Y.getConvoInlineMenuActions)(t,s).map((e=>(0,c.getTemplate)("im_page_inline_menu_item",Bl({},e,{class_name:Fl})))).join(""),d=(0,c.getTemplate)("im_page_inline_menu",{actions:l});f=n.closest("._im_dialog"),(0,$.showTooltip)(n,{text:d,onCreate:()=>{var e,t;return null==(e=n.tt)||null==(t=e.container)?void 0:t.addEventListener("click",o)},onShowStart:()=>{var e,t;null==(e=f)||null==(t=e.classList)||t.add(Ul)},onHide:()=>{var e,t;null==(e=f)||null==(t=e.classList)||t.remove(Ul),f=null},black:0,dir:"left",shift:[-30,-11],zIndex:130,hasover:!0,className:"im_page_inline_menu_tt im_page_dialog_inline_menu_tt",appendEl:g,slideX:4,showdt:200,hidedt:100})}},M=function(e,a){(0,$.showTooltip)(a,{text:(0,o.getLang)("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:Nc(t,a.getBoundingClientRect().top)})},L=Ec.bind(null,t,e),I=wc.bind(null,t,e),k=Tc.bind(null,t,e,r),P={idFn:e=>function(e,t){try{return t.message?t.message.messageId:(0,u.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}catch(s){if(t)throw s;var a=(0,S.unpackStore)(e),i=Object.keys(a.tabs).map(Number),n=a.dialog_tabs.all.filter((e=>!i.includes(e)));throw s.message=`Missing convo info for: ${n.join(", ")}`,s}}(t,e),hoverableFn:e=>(0,h.hasClass)(e,"_im_dialog"),renderFn:fc.bind(null,t),more:tc.bind(null,t,r),onScroll:()=>{(0,_.isClassicInterface)(t)&&((bodyNode.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&J.browser.safari?(0,h.addClass)(i,"im-page--header_static"):(0,h.removeClass)(i,"im-page--header_static"));(0,$.hideAllTooltips)(e)},onRenderFn:Ac.bind(null,t)},A=G(e,(0,S.default)({limit:40,offset:0,nativeScroll:!!(0,_.isClassicInterface)(t),height:64,elements:Oc(t)}),(()=>P)),B=(y=new Set,C=e=>{e.forEach((e=>{var t=e.target,a=e.isIntersecting,i=t.dataset,n=i.position,s=i.peer,r=i.trackcode;if(!y.has(s)&&a)y.add(s),(0,ue.collectConversationSuggestionItemStats)(r,Number(n),"show");else if(y.has(s)&&!a){if(y.delete(s),!r)return;(0,ue.collectConversationSuggestionItemStats)(r,Number(n),"hide")}}))},{track:()=>{b&&b.disconnect();var e=document.querySelector(".ConvoRecommendList");if(e){var t=e.querySelector("._im_carousel_viewport");b=new IntersectionObserver(C,{root:t}),e.querySelectorAll("._convoRecommendUser").forEach((e=>b.observe(e)))}},destroy:()=>{b&&b.disconnect()}});B.track(),J.browser.mozilla&&xc();var x=ac.bind(null,a,r,t,A),D=e=>{var t,a;null==(t=f)||null==(a=t.classList)||a.remove(Ul)},R=Jl.bind(null,t,e,A),O=bc.bind(null,t,e,r,a),N=pc.bind(null,a,t,e,A),F=[me.ConvoListFolder.MR,me.ConvoListFolder.BUSINESS_NOTIFY,me.ConvoListFolder.ARCHIVE,me.ConvoListFolder.ALL].map((e=>n=>{if(n.target.closest("._im_dialog_folder_button_hide")){var s=(0,S.unpackStore)(t).settings,r={[me.ConvoListFolder.BUSINESS_NOTIFY]:"number"!=typeof s.business_notify_folder_hidden,[me.ConvoListFolder.ARCHIVE]:"number"!=typeof s.archives_folder_hidden}[e],l={[me.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[me.ConvoListFolder.ARCHIVE]:"archive_folder_hidden"},c=Boolean(cur.imDb.selectByKey(l[e]));r&&!c&&(!function(e,t){var a,i=e.querySelector("._im_search_more");if(i){var n,s="feature_intro_tt feature_intro_blue_tt im-page--dialogs--folder_hide_hint";switch(t){case me.ConvoListFolder.BUSINESS_NOTIFY:n={width:206,content:(0,o.getLang)("mail_dialog_business_notify_more_hint"),cls:s+" im-page--dialogs--business-notify_hide_hint"};break;case me.ConvoListFolder.ARCHIVE:n={width:164,content:(0,o.getLang)("mail_dialog_archive_more_hint"),cls:s+" im-page--dialogs--archives_hide_hint"};break;default:return}null==(a=(0,h.data)(i,"ett"))||null==a.destroy||a.destroy();var r=new Ml.ElementTooltip(i,Bl({autoShow:!1,appendTo:bodyNode,forceSide:"bottom",offset:[15,8],align:"right",withCloseButton:!0,onHide:()=>{r.destroy()}},n));r.show()}}(i,e),cur.imDb.updateByKey(l[e],1)),a().hideFolderButton(t,e)}else hc(t,a,e)})),U=F[0],H=F[1],j=F[2],q=F[3],K=a=>{Dc(t,e,"archive")},W=a=>{Dc(t,e,"new_ui_notice")},V=(0,v.createModule)({handlers:(i,s)=>{s(e,"click",Nl,N),s(e,"click","_im_dialog_markre",k),s(e,"click",Rl,I),s(e,"click",xl,x),s(e,"mouseover",xl,D),s(e,"click",_.MESSAGE_SEARCH_CLASS,R),s(e,"mouseover",Nl,w),s(e,"mouseover",Ol,T),s(e,"mouseover",Zl,E),s(e,"mouseover","_im_dialog_markre",M),s(e,"click",_.CLEAR_RECENT_CLASS,(()=>{(0,n.resetRecentSearch)(cur.imDb),kc(t,A,a)})),s(e,"click",_.TOGGLE_MR_TAB,U),s(e,"click",_.TOGGLE_BUSINESS_NOTIFY_TAB,H),s(e,"click",_.TOGGLE_ARCHIVES_TAB,j),s(e,"click",_.TOGGLE_ALL_TAB,q),s(e,"mouseover",Rl,L),s(e,"click","_im_dialog_daction",O),s(e,"click",Dl,Bc),s(e,"click",Gl,(e=>function(e,t){(0,d.cancelEvent)(e);var a=e.target.closest("._convoRecommendUser"),i=a.parentNode,n=Number(a.dataset.position),s=Number(a.dataset.peer),r=a.dataset.trackcode;if(!r){var o=(0,S.unpackStore)(t),l={hasPeer:!!s,hasListData:!!o.recommendationList,hasPeerData:!!o.recommendationList.item_data[s]};throw i.remove(),t.set((e=>(0,ge.removeStoredRecommendedListItem)(e,s))),new Error((0,Il.getErrorText)(l,"Rec remove log"))}i.remove(),t.set((e=>(0,ge.removeStoredRecommendedListItem)(e,s))),(0,Pa.hideSuggestedContact)({position:n,track_code:r}).catch((e=>{throw new Error((0,Il.getErrorText)(e))}))}(e,t))),s(e,"click",Kl,(e=>function(e){if(!e.target.closest("._convoRecommendUserRemove")){var t=e.target.closest("._convoRecommendUser").dataset,a=t.position,i=t.trackcode;(0,ue.collectConversationSuggestionItemStats)(i,Number(a),"click")}}(e))),s(e,"click",Wl,(e=>function(e,t){"invite_by_phone_number"===e.target.closest("._convoRecommendAction").dataset.action&&xc().then((()=>{window.FriendsSearch.inviteBox()}))}(e))),(0,_.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&(s(e,"mouseover","_im_peer_tags_extra",(e=>(0,m.onPeerTagsExtraHover)(e,t))),s(e,"click","_im_dialog_peer_tag",(e=>(0,m.onDialogPeerTagClick)(e,t)))),i(e,"mouseover",(0,p.throttle)(A.unhoverElements.bind(A,jl),100)),s(e,"mouseover",Yl,((e,t)=>{(0,$.showTooltip)(t,{text:(0,o.getLang)("mail_dialog_folder_button_hide"),black:1,center:!0,shift:[1,6],appendEl:bodyNode})})),s(e,"click","_im_archive_notice_close",K),s(e,"click","_im_new_ui_notice_close",W),s(e,"click","_im_archive_notice_settings",(e=>{a().applySearchAction(t,"settings",e)})),s(e,"mouseover",Xl,((e,t)=>{(0,$.showTooltip)(t,{text:(0,o.getLang)("mail_dialog_folder_button_back"),black:1,center:!0,shift:[-3,0],appendEl:bodyNode})})),s(e,"click",Xl,q)}});return l(e,r,A,a,V,B)}var Uc=a(6735),Hc="_im_to_unread";function jc(e,t,a){var i=function(e,i){(0,_.showUnreadOnly)(t,a,n.changeDialogsTab).then((function(e){var n=t.get().active_tab;if(e){var s=n===me.ConvoListFolder.UNREAD;i.innerHTML=(0,c.getTemplate)("im_filter",{filter:s?(0,o.getLang)("mail_to_all_dialogs"):(0,o.getLang)("mail_to_unread")}),n===me.ConvoListFolder.ALL&&a().updateRecommendationList(t)}}))},s=(0,v.createModule)({handlers:function(t,a){a(e,"click",Hc,i)}});return function(e,t){return{updateFilter:function(t){var a,i=t.get().active_tab,n=i===me.ConvoListFolder.UNREAD,s=[];((0,u.isSearching)(t)||[me.ConvoListFolder.BUSINESS_NOTIFY,me.ConvoListFolder.ARCHIVE,me.ConvoListFolder.MR].includes(i))&&s.push("im-page--dialogs-filter_hidden"),(0,_e.getUnreadCountWithMuted)(t)>0?a=n?(0,o.getLang)("mail_to_all_dialogs"):(0,o.getLang)("mail_to_unread"):(a=(0,o.getLang)("mail_all_dialogs"),s.push("im-page--dialogs-filter_disabled"));var r=e.querySelector("._im_to_unread");r&&(r.innerHTML=(0,c.getTemplate)("im_filter",{filter:a,cls:s.join(" ")}))},toggleButton:function(t,a){var i=e.querySelector(".im-page--dialogs-filter");i&&i.classList.toggle("im-page--dialogs-filter_hidden",a)},toggleLoader:function(t,a){var i=e.querySelector("._im_dialogs_cog_settings");i&&i.classList.toggle("im-page--dialogs-settings_loading",a)},unmount:function(){(0,v.destroyModule)(t)}}}(e,s)}var qc=a(43714),Kc=a(68959),Gc="_ui_multiselect_cancel";function Wc(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function Vc(e){return e.selection=[],Promise.resolve(e)}function zc(e,t){return t.selection=t.selection.filter((t=>t.id!==e)),Promise.resolve(t)}function Yc(e,t,a,i,n,s,r){var o=(0,c.intval)((0,h.domData)(r,"peer"));tooltips.hide(r),t.set(zc.bind(null,o)).then((s=>{Zc(e,i,t,n),a().selectionDeleted(t,o)}))}function $c(e,t,a,i){e.set(n.setCurrentSearch.bind(null,a,!1)).then(t().onChange)}function Zc(e,t,a,i){var n=a.get().selection,s=uiSearch.getFieldEl(e);uiSearch.focus(e),n.length>0?(0,h.attr)(s,"placeholder",""):(0,h.attr)(s,"placeholder",(0,r.unclean)((0,o.getLang)("mail_search_creation"))),t.innerHTML=n.map((e=>['<div class="token">',`<div class="token_title">${e.name}</div>`,`<div data-peer="${e.id}" class="token_del ${Gc}"></div>`,"</div>"])).reduce(((e,t)=>e.concat(t)),[]).join(""),(0,h.toggleClass)(e,"ui_multiselect_has_selection",n.length>0),(0,h.domFC)(e).scrollTop+=50,i()}function Qc(e,t){return(0,$.showTooltip)(t,{text:(0,o.getLang)("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function Xc(e,t,a){uiSearch.init(e,{onChange:$c.bind(null,t,a)});var i=uiSearch.getFieldEl(e),n=(0,h.ce)("div",{className:"_ui_multiselection ui_multiselect_cnt"});i&&i.parentNode.insertBefore(n,i);var s,r,o=(s=i,r=0,function(){var e=s.offsetWidth;(0,h.setStyle)(s,{width:1});var t=s.offsetLeft;r!==t?(r=t,e=s.parentNode.offsetWidth,(0,h.setStyle)(s,{width:Math.max(30,e-t-20)})):(0,h.setStyle)(s,{width:e})});t.set(Vc);var l=Yc.bind(null,e,t,a,n,o),c=t=>{document.activeElement!==i&&uiSearch.focus(e)},d=(0,v.createModule)({handlers:(t,a)=>{a(e,"click",Gc,l),a(e,"mouseover",Gc,Qc),t(e,"click",c)}});return{addSelection:(a,i)=>t.set(Wc.bind(null,{id:a,name:i})).then(Zc.bind(null,e,n,t,o)),removeSelection:a=>t.set(zc.bind(null,a)).then(Zc.bind(null,e,n,t,o)),resetSelection(){!function(e,t,a,i){e.set(Vc).then(Zc.bind(null,t,a,e,i))}(t,e,n,o)},focus(){uiSearch.focus(e)},save(){t.stash(),Zc(e,n,t,o)},restore(){t.pop(),Zc(e,n,t,o)},unmount(){uiSearch.destroy(e),(0,v.destroyModule)(d)}}}var Jc,ed=a(79203),td="_im_dialogs_creation_name",ad="_im_create_select",id="_im_create_avatar",nd="_im_confirm_creation",sd="_im_avatar_img",rd=["im-creation--item_hovered"],od="olist_item_wrap_on",ld=33554432,cd=ld;function dd(e){!function(e){var t=e.querySelector("._im_creation_settings_modal_wrap"),a=_d.bind(null,t);bt.render((0,vt.jsxs)(Go.default,{onClose:a,className:"im-creation--modal-settings",children:[(0,vt.jsx)(Kc.default,{title:(0,Vo.getLang)("mail_chat_creation_settings"),onCloseClick:a}),(0,vt.jsx)(qc.ChatSettingsOptions,{flags:cd,back:a,isChatCreation:!0,onSave:ud,afterSave:gd.bind(null,t),onCancel:a})]}),t)}(e)}function _d(e){e&&bt.unmountComponentAtNode(e)}function ud(e){return cd=e,Promise.resolve()}function gd(e){_d(e)}function md(e){return(0,$.showTooltip)(e,{text:(0,Vo.getLang)("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function pd(e,t,a,i,r,o){(0,n.toggleConversation)(!1),(0,h.removeClass)(t,"im-create_shown"),(0,h.removeClass)(t,"im-create_photo-attached"),setTimeout(vd.bind(null,t,!1),100),wd(o).map((e=>(0,h.geByClass1)("_im_dialog"+e))).forEach((e=>{(0,h.removeClass)(e,od)})),a().createCanceled(e),r.resetSelection(),"add_member"===e.get().creationType&&e.set(n.setCreationType.bind(null,"chat",[])),e.set(n.presetAvatar.bind(null,!1));var l=(0,h.geByClass1)(sd,t);fd(e,o,t),uiSearch.reset((0,h.geByClass1)(td,t)),uiSearch.reset((0,h.geByClass1)(ad,t)),l&&l.parentNode.removeChild(l),fd(e,o,t),(0,s.cancelStackFilter)("im_search");var c=0===e.get().peer?"search":"default";e.get().longpoll.push([(0,f.transitionEvent)(c)]),(0,h.attr)(t,"aria-hidden","true")}function hd(e,t,a){return t&&(a.current_create_peer_ids={},a.current_create_peers=[]),a.current_create_peer_ids||(a.current_create_peer_ids={}),a.current_create_peers||(a.current_create_peers=[]),e.forEach((e=>{e.then((e=>{e=e.filter((e=>!a.current_create_peer_ids[e.peerId])),a.current_create_peer_ids=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),a.current_create_peer_ids),a.current_create_peers=a.current_create_peers.concat(e)}))})),Promise.resolve(a)}function vd(e,t){(0,h.toggleClass)(e,"im-create_material",t)}function fd(e,t,a){var i=(0,h.geByClass1)(nd,a),n=t.get().selection.length,s="add_member"===e.get().creationType,r=uiSearch.getFieldEl((0,h.geByClass1)(td,a)),o=n>0,l=(r?r.value.trim():"").length>0,c=!o&&(s||!l),d=s?1===n?(0,Vo.getLang)("mail_append_chat"):(0,Vo.getLang)("mail_im_create_chat_with"):l||n>1?(0,Vo.getLang)("mail_im_create_chat"):(0,Vo.getLang)("mail_im_go_to_dialog");Yn.FlatButton.setLabel(i,d),Yn.FlatButton.setDisabled(i,c)}function bd(e,t,a,i,n,s,r){if(r){var o,l=(0,c.intval)((0,h.domData)(r,"list-id")),d=wd(s),_=(0,c.trim)(r.textContent),u=(0,h.geByClass1)(ad,t),g=(0,h.getSize)(u)[1];(0,c.inArray)(l,d)?(o=i.removeSelection(l,_),(0,h.removeClass)(r,od)):(o=i.addSelection(l,_),(0,h.addClass)(r,od)),o.then((()=>{var e=g-(0,h.getSize)(u)[1],t=n.scrollTop();n.scrollTop(t-e)})),fd(e,s,t);var m=(0,h.geByClass1)(ad,t);uiSearch.reset(m)}}function yd(e,t){var a=wd(e),i=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],n=[];return t.online&&n.push("online"),mobPlatforms[t.online]&&n.push("mobile"),(0,c.inArray)(t.peerId,a)&&i.push(od),(0,c.getTemplate)("im_owner_item",{owner_id:t.peerId,cls:" "+i.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:n.join(" ")})}function Cd(e){return(0,u.getSearchText)(e)||!1}function wd(e){return e.get().selection.map((e=>e.id))}function Ed(e,t,a){return e.then((e=>e.filter((e=>e.is_friend&&!(0,c.inArray)(e.peerId,a.get().creationFilter)))))}function Sd(e,t,a,i,s){var r,o,l=(0,h.geByClass1)(ad,e),c=(0,n.searchLocalHints)(i,t.get()),d=a.hoverFirstElement.bind(a,rd,Pd(t));t.get().creation_shown_all=!1,a.reset(),a.pipe(Ed(c,0,t),i),a.toTop(),i?(o=(0,n.searchTopConv)(i,t.get()),r=(0,n.searchHintsIndex)(i,[],"friends",t.get()),a.pipe(Ed(r,0,t),i).then(d),a.pipe(Ed(o,0,t),i).then(d)):(r=Promise.resolve([]),o=Promise.resolve([])),t.set(hd.bind(null,[c,o,r],!0)),uiSearch.showProgress(l),Promise.all([c,r,o]).then((()=>uiSearch.hideProgress(l)))}function Td(e,t,a,i){var s=2e9+Math.round((0,r.rand)(1e6,2e6));cur.recieveCropResult=a=>{cur.recieveCropResult=!1,(0,l.curBox)()&&(0,l.curBox)().hide(),e.set(n.presetAvatar.bind(null,a)),(0,n.getOwnerPhoto)(a,s).then((e=>{(0,h.geByClass1)(id,t).appendChild((0,h.ce)("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))})),(0,h.addClass)(t,"im-create_photo-attached")},Page.ownerPhoto(s)}function Md(e,t){(0,h.geByClass1)(id,t).innerHTML="",e.set(n.presetAvatar.bind(null,!1)),(0,h.removeClass)(t,"im-create_photo-attached")}function Ld(e,t,a,i,n,s){wd(t).map((e=>(0,h.geByClass1)("_im_dialog"+e))).forEach((e=>(0,h.removeClass)(e,od))),t.reset(),Sd(a,e,i,!1,wd(t)),n.resetSelection(),pd(e,a,s,0,n,t)}function Id(e,t,a,i,s,r,o){var l=wd(t),c=e.get(),d=(0,h.geByClass1)(nd,a),_=uiSearch.getFieldEl((0,h.geByClass1)(td,a)).value,g="add_member"===e.get().creationType,m=!g&&(_.length||l.length>1),p=(0,h.geByClass1)("_im_creation_show_history_input",a).checked;if(g)return e.set(n.addNewMember.bind(null,c.peer,l,p)).catch((e=>(0,ye.showFastBox)((0,Vo.getLang)("global_error"),e))),pd(e,a,r,0,s,t);if(Yn.FlatButton.lock(d),!m)return v(l[0]);function v(n){cd=ld,Ld(e,t,a,i,s,r),function(e,t,a,i,n,s){pd(e,t,a,0,n,s),e.get().longpoll.push([(0,f.changePeer)(i,!1,!1,!1,"create_conversation")])}(e,a,r,n,s,t),Yn.FlatButton.unlock(d),(0,u.isSearching)(e)?r().cancelSearch(e):r().restoreDialogs(e),(0,ue.collectChatCreateStats)(n,"create_chat__create_new")}e.set((e=>(0,ed.createChatAction)(e,c.next_chat_avatar,l,_,cd))).then((()=>v(c.next_peer))).catch((e=>{Yn.FlatButton.unlock(d),(0,ra.topMsg)((0,Vo.getLang)("global_unknown_error"),2,"#FFB4A3")}))}function kd(e,t){return(0,$.showTooltip)(e,{text:(0,Vo.getLang)("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function Pd(e,t){var a=t&&t.get().selection.length;return{top:-1,bottom:(0,_.isClassicInterface)(e)?a>0?69:0:-1}}function Ad(e,t,a){fd(e,t,a)}function Bd(e,t,a,i,n,r,o,l){return{show(t,r){void 0===r&&(r=[]),t.setState({shown:!0}),vd(e,!0),(0,s.cancelStackPush)("im_create",o),(0,h.addClass)(e,"im-create_shown");var l=i.get().selection.reduce(((e,t)=>(e[t.id]=!0,e)),{});r&&r.forEach((t=>{if(!l[t[0]]){var a=e.querySelector(`._im_dialog${t[0]}`);n.addSelection(t[0],t[1]),a&&!a.classList.contains(od)&&a.classList.add(od)}})),function(e,t,a,i){(0,h.toggleClass)(e,"im-create_chat","chat"===i.get().creationType),(0,h.toggleClass)(e,"im-create_invite","add_member"===i.get().creationType);var n="chat"===i.get().creationType?(0,Vo.getLang)("mail_im_group_dialog"):(0,Vo.getLang)("mail_im_friends_tab"),s=(0,h.geByClass1)("_im_create_title",e);(0,h.val)(s,n),Yn.FlatButton.setLabel((0,h.geByClass1)(nd,e),"add_member"===i.get().creationType?(0,Vo.getLang)("mail_im_create_chat_with"):(0,Vo.getLang)("mail_im_create_chat")),Sd(e,i,t,!1,a.get().selection.map((e=>e.id)))}(e,a,i,t),setTimeout((()=>{t.get().longpoll.push([(0,f.transitionEvent)("create")]),(0,h.attr)(e,"aria-hidden","false"),n.focus()}),1)},focusSearch(e){n.focus()},confirmCreate(e){l()},hide(a){a.get().shown=!1,pd(a,e,t,0,n,i)},scroll(e){a.scrollPage(e,!0)},updateScroll(){a.updateScroll()},selectElement(t){bd(t,e,0,n,a,i,a.getHoveredElement())},hoverPrevElement(e){a.hoverPrevElement(rd,null,Pd(e,i))},hoverNextElement(e){a.hoverNextElement(rd,null,Pd(e,i))},unmount(){(0,v.destroyModule)(r),a.unmount(),n.unmount(),(0,s.cancelStackFilter)("im_create"),cur.recieveCropResult=void 0}}}function xd(e,t,a){var i=(0,S.default)({selection:[]}),s=(0,h.geByClass1)("_im_create_list",e),r=(0,h.geByClass1)(ad,e),o=(0,Wt.debouncedPromise)((function(a){return function(e,t,a,i){var n=i.get(),s=Cd(n);n.selection.map((e=>e.id)),a.unhoverElements(rd),e.get().creationQuery=s,Sd(t,e,a,s)}(t,e,_,a)}),300),l=Xc(r,i,(()=>({selectionDeleted(a,i){fd(t,a,e),(0,h.removeClass)((0,h.geByClass1)("_im_dialog"+i),od)},onChange:e=>o(e).catch((e=>{if("debounce"!==e)throw e}))}))),_=G(s,(0,S.default)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),(()=>({idFn:e=>(0,c.intval)(e.peerId),hoverableFn:e=>(0,h.hasClass)(e,"_im_dialog"),renderFn:yd.bind(null,i),more(e,a){var s;return t.get().shown?(t.get().creation_shown_all||!1!==Cd(i)?s=Promise.resolve([]):(t.get().creation_shown_all=!0,s=(0,n.searchTopConv)(Cd(i),t.get())),t.set(hd.bind(null,[s],!1)),Ed(s,Cd(i),t)):Promise.resolve(!1)},onClick(a,n){(0,d.checkEvent)(a)||(bd(t,e,0,l,_,i,n),(0,d.cancelEvent)(a))}})));t.get().creationQuery=!1,t.get().creationType="chat";var u=pd.bind(null,t,e,a,"cross",l,i),g=Td.bind(null,t,e),m=Md.bind(null,t,e),f=Ld.bind(null,t,i,e,_,l,a),b=Id.bind(null,t,i,e,_,l,a),y=Ad.bind(null,t,i,e),C=dd.bind(null,e),w=(0,h.geByClass1)("_im_create_cancel",e),E=(0,h.geByClass1)(td,e),T=(0,h.geByClass1)("_im_creation_settings",e),M=E.querySelector(".ui_search_reset"),L=(0,v.createModule)({handlers:(t,a)=>{t(w,"click",u),t(w,"mouseover",kd.bind(null,w)),t((0,h.geByClass1)(id,e),"click",g),t((0,h.geByClass1)("_im_create_remove_avatar",e),"click",m),t((0,h.geByClass1)("_im_cancel_creation",e),"click",f),t(E,"change",y),t(E,"input",y),t(E,"paste",y),t(M,"click",y),t((0,h.geByClass1)(nd,e),"click",b),t(T,"click",C),t(T,"mouseenter",md.bind(null,T)),t(e,"mouseover",(0,p.throttle)(_.unhoverElements.bind(_,rd),100))}});return Bd(e,a,_,i,l,L,u,b)}!function(e){e.Online="online"}(Jc||(Jc={}));function Dd(e,t){return t.state=e,Promise.resolve(t)}function Rd(e,t,a,i,n){switch(t){case E.ARROW_UP:(0,_.isEditableFocused)()||(i.scroll(n,"up"),(0,d.cancelEvent)(a));break;case E.ARROW_DOWN:(0,_.isEditableFocused)()||(i.scroll(n,"down"),(0,d.cancelEvent)(a));break;case E.PAGE_UP:a.ctrlKey||(0,_.isClassicInterface)(n)||(i.scroll(n,"up",!0),(0,d.cancelEvent)(a));break;case E.PAGE_DOWN:a.ctrlKey||(0,_.isClassicInterface)(n)||(i.scroll(n,"down",!0),(0,d.cancelEvent)(a));break;case E.HOME:(0,_.isEditableFocused)()||(i.scroll(n,"up",!1,!0),(0,d.cancelEvent)(a));break;case E.END_KEY:(0,_.isEditableFocused)()||(i.scroll(n,"down",!1,!0),(0,d.cancelEvent)(a));break;case E.PRINTABLE:i.focustTxt(e)}}function Od(e,t,a,i,n,s){var r=(0,S.default)({state:t||"default"});return{signal(t,o){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(r.get().state){case"default":return Rd(r,t,o,i,e);case"fwd":case"search":return function(e,t,a,i,n,s){switch(t){case E.ARROW_DOWN:i&&i.hoverNextDialog(s),(0,d.cancelEvent)(a);break;case E.ARROW_UP:i&&i.hoverPrevDialog(s),(0,d.cancelEvent)(a);break;case E.ENTER:(0,_.isEditableFocused)()&&!(0,h.gpeByClass)("_im_dialogs_search_input",document.activeElement)||i&&i.selectHoveredDialog(s);break;case E.PRINTABLE:n.focusInput()}}(0,t,o,a,n,e);case"create":return function(e,t,a,i,n){switch(t){case E.PAGE_UP:!a.ctrlKey&&(0,_.isClassicInterface)(n)&&(i.scroll("up"),(0,d.cancelEvent)(a));break;case E.PAGE_DOWN:!a.ctrlKey&&(0,_.isClassicInterface)(n)&&(i.scroll("down"),(0,d.cancelEvent)(a));break;case E.ARROW_DOWN:i.hoverNextElement(n);break;case E.ARROW_UP:i.hoverPrevElement(n);break;case E.ENTER:(0,h.gpeByClass)("_im_dialogs_creation_name",document.activeElement)?i.confirmCreate(n):(0,h.gpeByClass)("im-create--search",document.activeElement)&&i.selectElement(n);break;case E.PRINTABLE:i.focusSearch(n)}}(0,t,o,s,e);case"message":return function(e,t,a,i,n){switch(t){case E.HOME:case E.END_KEY:i.isEmpty(n)&&Rd(e,t,a,i,n);break;case E.PAGE_UP:case E.PAGE_DOWN:Rd(e,t,a,i,n)}}(r,t,o,i,e);default:throw new Error("Unknown state: "+r.get().state)}},transition:e=>r.set(Dd.bind(null,e))}}var Nd=a(87294),Fd=(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?15:14;function Ud(e,t){e.waitAbortFns.push(t)}function Hd(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=(0,Nd.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),a=t.request,n=t.cancel;return e.stopFn=n,a.then((function(t){var a=(0,i.__read)(t,2),n=a[0],s=a[1];return e.onData(e,s),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var a=(0,i.__read)(t,2)[1];return e.onData(e,a),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var a=t.failed?(0,Wt.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},n=a.abort,s=a.pause;switch(t.failed){case 1:return Ud(e,n),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(s).then((function(){return Hd(e)}));case 2:return Ud(e,n),e.onKeyExpired(e,t).then((function(t){var a=(0,i.__read)(t,4),n=a[0],s=a[1],r=a[2],o=a[3];return e.onResult({ts:+o,updates:[[-2,n,s+"/"+r],[-1]]})})).then(s).then((function(){return Hd(e)}));case 3:return e.onLpBroken(e,t);default:var r=t.updates.some((function(e){switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}));return r?e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(s).then((function(){return Hd(e)})):Promise.resolve(t)}}(e,t)}))}function jd(e){e.isStoppedFn()||Hd(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&qd(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),qd(e,-3);var a=(0,Wt.abortablePause)(e.waitTimeout,null),i=a.abort,n=a.pause;return Ud(e,i),n().then((function(){return qd(e,-4)}))}(e,t)})).then((function(){return jd(e)}))}function qd(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function Kd(e){return e||function(){}}function Gd(e){return e?function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return Promise.resolve(e.apply(void 0,(0,i.__spreadArray)([],(0,i.__read)(t),!1)))}:function(){return Promise.reject()}}function Wd(e,t){for(var a=[],n=2;n<arguments.length;n++)a[n-2]=arguments[n];if(window.vk.lpConfig.debug){var s="background: "+e+"; color: white",r=new Date,o=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,(0,i.__spreadArray)(["%c "+r.getHours()+":"+o(r.getMinutes())+":"+o(r.getSeconds())+":"+r.getMilliseconds()+" "+t+" ",s],(0,i.__read)(a),!1))}}function Vd(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function zd(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function Yd(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function $d(){var e;Yd()&&(zd().forEach((function(e){!Vd().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,Wd("red","im not fc",e.ev))})),Vd().forEach((function(e){var t=zd().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,Wd("red","now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=Vd().filter((function(t){return t.time>e})),window.lpBufferIm=zd().filter((function(t){return t.time>e}))}function Zd(e,t){return function(e,t){var a=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||Fd,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return a},onResult:function(e){e.ts&&s(i.ts,e.ts,e.updates.map(W.constructEvent))},onData:Kd(t.onData),onRequestError:Kd(t.onRequestError),onHistoryLost:Gd(t.onHistoryLost),onKeyExpired:Gd(t.onKeyExpired),onLpBroken:Gd(t.onHistoryLost)},n=t.onEvents;function s(e,t,a){i.ts=t;for(var s=0;s<a.length;++s)a[s].type===W.REFRESH_LP_KEY&&(i.key=a[s].key||"",i.url=a[s].url||"");n(e,t,a)}var r={options:i,isStopped:function(){return a},stopConnection:function(){a=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,document.removeEventListener("resume",o),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",o),qd(i,-4),a=!1,jd(i)},abortWaiting:function(){i.waitAbortFns.forEach((function(e){return e()})),i.waitAbortFns=[],i.waitTimeout=2},onLp:s};function o(){r.abortWaiting()}return document.addEventListener("resume",o),jd(i),r}(e,{onEvents:t,onData:Jd,onRequestError:e_,onHistoryLost:t_,onKeyExpired:a_,onLpBroken:i_})}window.longpollTestingOnImEvents=function(e){var t;Yd()&&((t=zd()).push.apply(t,(0,i.__spreadArray)([],(0,i.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),!1)),setTimeout($d,1100)),Wd.apply(void 0,(0,i.__spreadArray)(["blue","im"],(0,i.__read)(e),!1))};var Qd={},Xd=Date.now();function Jd(e,t){if(t&&t.status&&e.lpstat){var a=t.status.toString();t.status>=500&&t.status<600&&(0,Zo.statlogsValueEvent)("fc_longpoll",1,a,t.getResponseHeader("x-frontend")||""),Qd[a]=a in Qd?Qd[a]+1:1,Date.now()-Xd>=3e4&&(Object.keys(Qd).forEach((function(e){(0,Zo.statlogsValueEvent)("fc_longpoll",Qd[e],e,t.getResponseHeader("x-frontend")||"")})),Qd={},Xd=Date.now())}}function e_(e){Wd("red","LP error",e.message||"no message (probably browser reset)")}function t_(e,t){Wd("red","LP failed: old timestamp; resync, next ts",t.ts)}function a_(e){return Wd("red","LP failed: key is incorrect; refresh key"),(0,Nd.post)(n.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function i_(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}function n_(e,t,a){var n=0,s=e,r=[],o=!1;function l(){!r.length||n>0||o||(t(r),r=[])}return{pause:function(){n++},resume:function(){n>0&&(n--,l())},onLp:function(e,t,n){o||(s>=e?(s=t,r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(n),!1)),l()):a&&(o=!0,a(s).then((function(e){var t=(0,i.__read)(e,3),a=t[1],n=t[2];s=a,o=!1,r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(n),!1)),l()}))))}}}var s_={},r_=Date.now();function o_(e,t){var a=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&(0,Ee.statlogsValueEvent)("im_longpoll",1,a+"0x",t.getResponseHeader("x-frontend")),s_[a]=s_[a]?s_[a]+1:1,Date.now()-r_>=3e4&&(Object.keys(s_).forEach((e=>{(0,Ee.statlogsValueEvent)("im_longpoll",s_[e],e+"0x",t.getResponseHeader("x-frontend"))})),s_={},r_=Date.now()))}function l_(e,t){return Promise.resolve((0,c.extend)({},t,{timeout:e<64?2*e:e}))}function c_(e,t){return Promise.resolve((0,c.extend)({},t,{imTs:e}))}function d_(e){e.set((e=>Promise.resolve((0,c.extend)({},e,{stopped:!0})))).then((()=>{e.get().cancelToken()}))}function __(e,t){return t.cancelToken=e,Promise.resolve(t)}function u_(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function g_(e){return e.pauses||(e.pauses=[]),(0,p.lplog)("Aborting all pauses","error"),e.pauses.forEach((e=>e())),e.pauses=[],Promise.resolve(e)}function m_(e,t,a,i){var s=i.failed?(0,Wt.abortablePause)(4,e):{},r=s.abort,o=s.pause;switch(i.failed){case 1:return(0,p.lplog)("Old timestamp, init resync","error"),e.set(u_.bind(null,r)),a([W.resyncEvent()]),e.set(n.loadLongPollTs).then(o).then(p_.bind(null,e,t,a));case 2:return(0,p.lplog)("Key is incorrect","error"),e.set(u_.bind(null,r)),e.set(n.loadLongPollKey).then(o).then(p_.bind(null,e,t,a));case 3:throw nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(c_.bind(null,i.ts)).then((()=>i))}}function p_(e,t,a){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var i=e.get(),n=`${i.imUrl}/${i.imPart}`,s=(0,Nd.plaingetCancelable)(n,{act:"a_check",key:i.imKey,version:14,ts:i.imTs,wait:25,mode:i.mode}),r=s.request,o=s.cancel;return e.set(__.bind(null,o)).then((()=>r)).then((t=>{var a=t[0],n=t[1];return n&&o_(i,n),e.set(l_.bind(null,1)),JSON.parse(a)})).catch((e=>{e[0];var t=e[1];return t&&o_(i,t),Promise.reject(new Error(""))})).then(m_.bind(null,e,t,a))}function h_(e,t,a){e.get().stopped||((0,p.lplog)("New request"),p_(e,a,t).then((e=>e.map(W.constructEvent))).then((e=>((0,p.lplog)("Request success","success"),e))).then(t).catch((t=>{if(!e.get().stopped)return(0,p.lplog)("Error, waiting: "+(t.message||"no message (probably browser reset)"),"error"),e.set(l_.bind(null,a()?2:e.get().timeout)).then((()=>{var t=(0,Wt.abortablePause)(e.get().timeout,e),a=t.abort,i=t.pause;return e.set(u_.bind(null,a)).then(i)}));(0,p.lplog)("Stopped longpoll")})).then(h_.bind(null,e,t,a)))}function v_(e){var t=e.id,a=e.gid,i=e.key,n=e.ts,s=e.url,r=e.lhost,o=e.lpstat,l="main",c=new EventEmitter,d=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,_=na((function(e,t){return d&&window.longpollTesting_onImEvents(t),c.trigger("data",t),Promise.resolve({})})),u=_.pause,g=_.resume,m=_.pushMessage,p=_.isPaused,h=_.reset,v=(0,S.default)({id:t,gid:a,mode:202,timeout:1,imKey:i,imTs:n,imPart:s,imUrl:r,pause:!1,stat:o});return h_(v,m.bind(null,l),p.bind(null,l)),{onData:e=>c.on("data",e),offData:e=>c.off("data",e),abortWaiting:()=>v.set(g_),stop:d_.bind(null,v),pause:u.bind(null,l),resume:g.bind(null,l),reset:h.bind(null,l),push:e=>c.trigger("data",e),isEnabled:()=>!v.get().pause&&!v.get().stopped}}function f_(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return b_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return b_(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function y_(){return y_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},y_.apply(this,arguments)}var C_=new Map,w_=!1;function E_(e){return e.queue||e.key}function S_(){C_.forEach(((e,t)=>{var a=e.onData,i=e.onUpdateKey,n=e.ts;if(function(e){var t;return!!(null==(t=window.curNotifier)?void 0:t.addQueues)&&!curNotifier.addQueues[E_(e)]}(t)){var s=y_({},t,{ts:n});Notifier.addKey(s,L_.bind(null,a,i,s))}}))}function T_(){w_||(w_=setInterval(S_,3e3))}function M_(e){!function(e){var t;if(!(null==(t=window.curNotifier)?void 0:t.addQueues))return!1;delete curNotifier.addQueues[E_(e)]}(e),C_.delete(e),0===C_.size&&(clearInterval(w_),w_=!1)}function L_(e,t,a,i,n){if(n.failed)return M_(a),void function(e,t,a,i){var n;switch(e){case 1:case 2:case 3:case 5:n=i(t,e);break;case 4:n=(0,Wt.pause)(1).then((()=>t));break;default:throw new Error("Unkonwn error from queue: "+e)}(0,Wt.pause)(3).then((()=>n)).then((e=>{C_.set(e,{onUpdateKey:i,onData:a,ts:e.ts}),S_(),T_()}))}(n.err,a,e,t);var s=(0,c.intval)(n.ts);Object.assign(a,{ts:s}),function(e,t){var a,i=void 0,n=null==e?void 0:e.queue;if(n)for(var s,r=f_(C_);!(s=r()).done;){var o=s.value[0];if((null==o?void 0:o.queue)===n){i=o;break}}var l=null!=(a=i)?a:e;C_.set(l,t)}(a,{onData:e,onUpdateKey:t,ts:s}),n.events.map((e=>"string"==typeof e?e.split("<!>"):e)).forEach(e)}var I_=a(69413),k_=Object.values(me.ConvoListFolder);function P_(e){var t=e.get().tabbedPeers.map((t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer])).filter((e=>e)).filter((e=>!e.deletedDialog)).map((e=>({type:"peer",peer:e.peerId})));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function A_(e,t){if("sep"===t.type)return(0,c.getTemplate)("im_right_menu_sep",{});var a=`${(0,_.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,i=(0,_.getBareTab)(t.peer,e),n=(0,_.isContactPeer)(t.peer)?(0,_.prepareContactName)(i.tab):i.tab,s="";switch(!0){case i.unread>0:s=i.unread;break;case(0,_.isTabMarkedUnread)(i):s=1}var o=(0,I_.isRedesign)();return s=(0,c.getTemplate)(o?"im_right_menu_ct_redesign":"im_right_menu_ct",{name:n,count:s}),n=o?n:s,(0,c.getTemplate)(o?"im_right_menu_tpl_redesign":"im_right_menu_tpl",{href:a,label:n,peer:t.peer,attrs:`title="${(0,r.stripHTML)(i.tab)}"`,cls:i.unread>0?"im-right-menu--unread":"",extra:o?s:""})}function B_(e,t,a,i){var s=(0,h.gpeByClass)("_im_peer_tab",i),r=(0,c.intval)((0,h.domData)(s,"list-id")),o=e.get().tabbedPeers.filter((e=>e.peer!==r));return e.set(n.updateTabbedPeers.bind(null,o,!0)).then((()=>{if(x_(t,e),r===e.get().peer)e.get().longpoll.push([(0,f.resetPeer)()]);else if(0!==e.get().peer){var a=(0,h.gpeByClass)("_im_right_menu",i);uiRightMenu.hideSliding(a)}})),(0,d.cancelEvent)(a),!1}function x_(e,t){return e.pipeReplace(Promise.resolve(P_(t)))}function D_(e,t,a,i){return{updateMenu(t){!function(e,t){(0,h.geByClass)("_im_peer_tab",e).forEach((e=>{var a=(0,Wn.fromQueryString)((0,h.attr)(e,"href").split("?")[1]);a.tab!==t.get().active_tab&&(0,h.attr)(e,"href",`${(0,_.getBaseLink)(t)}?sel=${a.sel}&tab=${t.get().active_tab}`)}))}(e,t);var i=(0,h.gpeByClass)("_im_right_menu",e);x_(a,t).then((()=>{var e;(e=t.get().peer?(0,h.ge)("ui_rmenu_peer_"+t.get().peer):(0,h.ge)("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(i)}))},updateName(e,t){var a=(0,h.ge)("ui_rmenu_peer_"+e);if(a){var i=(0,h.geByClass1)((0,I_.isRedesign)()?"ui_rmenu_label-text":"_im_r_tx",a),n=t.get().tabs[e].tab;(0,h.val)(i,n)}},updateCounter(e,t){var a=(0,h.ge)("ui_rmenu_peer_"+t);if(a){var i=(0,h.geByClass1)("_im_r_ct",a),n=(0,_.getTab)(e,t),s="";switch(!0){case n.unread>0:s=n.unread;break;case(0,_.isTabMarkedUnread)(n):s=1}(0,h.val)(i,s),a.classList.toggle("im-right-menu--unread",n.unread>0||(0,_.isTabMarkedUnread)(n))}},unmount(){(0,v.destroyModule)(i),a.unmount()}}}function R_(e,t,a){1===a.which&&(e.get().peer&&e.get().longpoll.push([(0,f.resetPeer)()]),e.get().longpoll.push([(0,f.changeTab)(t)]),(0,d.cancelEvent)(a))}function O_(e){(0,$.showTooltip)(e.currentTarget,{text:(0,o.getLang)("mail_admin_av_time"),dir:"bottom",needLeft:!0,typeClass:"tt_default_right RightMenuBlockInfo__averageTimeTooltip",width:210,shift:[-14,8],slide:15})}function N_(e,t,a){e.set((e=>(0,n.toggleCommunityMute)(!t,e))).then((()=>a.classList.toggle("RightMenuBlockInfo__mute--muted",e.get().mute)))}function F_(e,t,a){var i=G(e,(0,S.default)({limit:50,offset:0,noScroll:!0,elements:P_(t)}),(()=>({idFn:e=>e.peer||"000",renderFn:A_.bind(null,t)}))),n=B_.bind(null,t,i),s=(0,h.geByClass1)("RightMenuBlockInfo"),r=(0,h.geByClass1)("RightMenuBlockInfo__averageTimeHint",s),o=(0,h.geByClass1)("RightMenuBlockInfo__mute",s),l=(0,v.createModule)({handlers:(a,i)=>{i(e,"click","_im_r_cl",n),i(e,"click","_im_peer_tab",((e,a)=>{if(!(0,d.checkEvent)(e)){var i=(0,c.intval)((0,h.domData)(a,"list-id"));(0,p.unpackStore)(t).longpoll.push([(0,f.changePeer)(i,!1,!0,!0,"right_menu")]),(0,d.cancelEvent)(e)}})),k_.forEach((i=>{a((0,h.geByClass1)(`_ui_item_${i}`,e.parentNode),"mousedown",R_.bind(null,t,i))})),r&&a(r,"mouseover",O_),(0,_.isCommunityInterface)(t)&&o&&a(o,"click",(e=>N_(t,!1,e.currentTarget)))}});return(0,_.isCommunityInterface)(t)&&o&&(N_(t,!0,o),o.classList.remove("RightMenuBlockInfo__mute--hidden")),D_(e,0,i,l)}function U_(e){var t=e.get().tabs,a=e.get().peer,i=Object.keys(t).filter((t=>(0,_.isFullyLoadedTab)(e,t)&&(0,c.intval)(t)!==a)).map((e=>t[e]));i.filter((e=>Date.now()-e.last_visited>54e6)).forEach((t=>e.set(n.cleanTab.bind(null,t.peerId)))),i.filter((t=>(0,_.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5)).forEach((t=>e.set(n.stringifyTab.bind(null,t.peerId))))}function H_(e){var t=setInterval(U_.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}function j_(e,t,a,i){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var s=(0,h.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,_.wrapLoading)(s)((0,n.loadImportant)(e.offset).then((t=>{t[0];var a=t[1],r=(t[2],t[3]);e.all=r.all,e.offset=r.offset,e.all?(0,h.addClass)(s,"im-important_all"):e.loading=!1,i.set((e=>(0,n.mergeTabs)(e,(0,_.tabFromIds)(r.msgs,r.hash),!0)));var o=(0,h.ce)("div");o.innerHTML=a,s.appendChild(o),(0,rs.ensureDomHasActions)(s)})),"bottom")}}function q_(e,t,a){for(var i=arguments.length,s=new Array(i>3?i-3:0),r=3;r<i;r++)s[r-3]=arguments[r];s.filter((e=>(0,c.inArray)(e.type,[W.SET_FLAGS,W.RESET_FLAGS,W.CHANGE_PEER]))).forEach((i=>{if(i.type!==W.CHANGE_PEER){if(i.flags===W.FLAG_IMPORTANT){var s=i.type===W.SET_FLAGS;e.set(n.updateFavMessage.bind(null,[i.messageId],0,s)).then((a=>{t.markImportant(i.messageId,s,e)}))}}else a.hide()}))}function K_(e,t,a,i){var n=(0,h.ge)("box_layer_wrap"),s=t.get().longpoll,r=(0,S.default)({peer:0,longpoll:s,oCache:{},tabs:(0,_.tabFromIds)(i.msgs,i.hash)}),o=_n(e.bodyNode,r,(()=>({}))),l=w(e.bodyNode,t,"fav_box");(0,rs.ensureDomHasActions)(e.bodyNode);var c=q_.bind(null,t,o,e);s.onData(c);var d=j_.bind(null,{all:!1,loading:i.all,offset:i.offset},e,n,r),u=(0,v.createModule)({handlers:(e,t)=>{e(n,"scroll",d)}});return{unmount(){(0,v.destroyModule)(u),l.unmount(),o.unmount(),s.offData(c)}}}function G_(e){return e.which||e.keyCode}function W_(e,t,a){!a||(0,c.inArray)(G_(a),E.UNPRINTABLE_KEYS)||(0,n.isSearchingInplace)(e.get().peer,e.get())||(0,_.isEditableFocused)()||a.ctrlKey||J.browser.mac&&a.metaKey||a.key&&1!==a.key.length||t.signal("printable",a)}function V_(e,t,a){G_(a)===E.ENTER&&e.signal(G_(a),a)}function z_(e,t,a,i){var n=G_(i);if(!layers.visible){if(n>=49&&n<=57&&(i.ctrlKey||i.metaKey&&J.browser.mac)&&(0,_.isClassicInterface)(t))return function(e,t){var a=e.get().tabbedPeers[t];a&&e.get().longpoll.push([(0,f.changePeer)(a.peer,!1,!0,!0,"right_menu")])}(t,n-49),(0,d.cancelEvent)(i);(0,c.inArray)(n,E.UP_DOWN_CONTROLS)&&e.signal(n,i)}}function Y_(e,t){var a=J.browser.mozilla?"keydown":"keypress",i=(0,S.default)({signalTimer:!1}),n=W_.bind(null,e,t),s=z_.bind(null,t,e,i),r=V_.bind(null,t,i),o=(0,v.createModule)({handlers:e=>{e(document,"keydown",s),e(document,"keyup",r),e(document,a,n)}});return{unmount(){(0,v.destroyModule)(o)}}}function $_(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function Z_(e,t){var a=e?e.indexOf(t):-1;return-1!==a&&(e.splice(a,1),!0)}function Q_(e,t,a,i,s,r){var o=(0,u.getTab)(e,t),l=i===vk.id;switch(a){case W.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case W.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return a===W.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?$_(o.adminIds,i):Z_(o.adminIds,i),e.set((e=>(0,n.setCallAvailability)(t,e))).then((()=>{X_(e,t,s),J_(e,t,s,r)})),!0;case W.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return o.data.flags=i,e.set((e=>(0,n.setCallAvailability)(t,e))).then((()=>{X_(e,t,s),J_(e,t,s,r)})),!0;case W.MAIL_CHAT_UPDATE_TYPE_PINNED:delete o.pinHideId,cur.imDb.update(In.PIN_HIDDEN_ID_OP,[o.peerId,void 0]);var c=o&&o.pinned&&(0,_.parserMessage)(o.pinned).messageId;return s.removeUnpinnedMessageEditable(e,c),!1;case W.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:return function(e,t,a){if((0,_.isTabLoaded)(a.get(),e)){var i=(0,u.getTab)(a,e);$_(i.memberIds,t)&&i.membersCount++,-1===i.data.active.indexOf(t)&&i.data.active.push(t),t===vk.id&&(i.data.kicked=0,i.data.closed=0)}return a.set((a=>(0,n.loadChatMember)({[e]:[t]},a)))}(t,i,e).then((()=>{if(l&&e.get().peer===t)return e.set((e=>(0,n.getPinnedMessage)(t,e)))})).then((()=>J_(e,t,s,r))).then((()=>{if(l&&e.get().peer===t)return Promise.all([e.set((e=>(0,n.getPeerActiveCallData)(t,e))),e.set((e=>(0,n.loadKeyboard)(t,e)))])})).then((()=>(e.get().peer===t&&o.callInProgress&&(s.updateBanner(e),s.updateHeader(e)),s.fixKeyboard()))).then((()=>{if((0,Vt.partConfigEnabled)("im_message_editable_sync")&&l)return e.set((e=>(0,n.syncMessagesEditableStatus)(e,t)))})),!0;case W.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case W.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,a,i,s){if((0,_.isTabLoaded)(i.get(),e)){var r=(0,u.getTab)(i,e);Z_(r.memberIds,t)&&r.membersCount--,r.data.active=r.data.active.filter((e=>e!==t)),t===vk.id&&(a?r.data.kicked=1:r.data.closed=1,i.set((t=>(0,n.removePeerActiveCallData)(e,t))))}return t===vk.id&&i.get().peer===e?(s.cancelEditing(),i.set((t=>(0,n.unpinMessageOptimistic)(e,t)))):Promise.resolve()}(t,i,a===W.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,s).then((()=>J_(e,t,s,r))).then((()=>{if((0,Vt.partConfigEnabled)("im_message_editable_sync")&&l)return e.set((e=>(0,n.syncMessagesEditableStatus)(e,t)))})),e.get().id!==i&&((0,u.getKeyboard)(e,t)||{}).author_id!==i||e.set((e=>(0,n.deleteKeyboard)(t,e))).then((()=>s.fixKeyboard())),!0;case W.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set((e=>(0,n.loadBanner)(t,e))).then((()=>s.updateBanner(e))),!0;case W.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case W.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;case W.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:var d=i?e=>(0,n.getPeerActiveCallData)(t,e):e=>(0,n.removePeerActiveCallData)(t,e);return e.set(d).then((()=>{e.get().peer===t&&(s.updateBanner(e),s.updateHeader(e)),r.updateDialog(t,e),X_(e,t,s)})),!0;case W.MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED:return e.set((e=>(0,ge.setConvoIsNew)(t,i,e))),!0;default:return!1}}function X_(e,t,a){e.get().peer===t&&((0,n.setActions)(e.get()),a.updateActions(e))}function J_(e,t,a,i){e.get().peer===t&&((0,n.setActions)(e.get()),a.updateChat(e,t),i.updateDialog(t,e))}var eu=a(61508),tu=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}());function au(){return au=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},au.apply(this,arguments)}var iu=J.browser.iphone||J.browser.ipad||J.browser.ipod;function nu(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=au({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function su(e,t,a){(0,Mt.isMvk)()?window.addEvent(e,t,a,{passive:!0}):window.addEvent(e,t,a)}function ru(e,t,a){(0,Mt.isMvk)()?window.removeEvent(e,t,a,{passive:!0}):window.removeEvent(e,t,a)}function ou(){return document.visibilityState||document.webkitVisibilityState}function lu(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}window.extend(nu.prototype,eu.default.prototype),window.extend(nu.prototype,{stop:function(){this.started=!1,ru(this.opts.element,this.opts.triggerEvents,this.cbActiveB),(0,Mt.isMvk)()&&this._isTopLevel()&&lu()&&ru(document,lu(),this.onVisiblityChange),(0,Mt.isMvk)()&&iu||(ru(this.opts.focusElement,"focus",this.cbActiveB),ru(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!(0,Mt.isMvk)()&&J.browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),(0,Mt.isMvk)()&&this._isTopLevel()&&lu()&&su(document,lu(),this.onVisiblityChange),(0,Mt.isMvk)()&&iu||(su(this.opts.focusElement,"focus",this.cbActiveB),su(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(su(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),ru(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(tu.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),ru(this.opts.element,this.opts.triggerEvents,this.cbActiveB),su(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===ou()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=ou();return"string"==typeof t&&"visible"===t}return document.activeElement===e}});var cu=a(82744);var du=[me.ConvoListFolder.MR,me.ConvoListFolder.BUSINESS_NOTIFY,me.ConvoListFolder.ARCHIVE];function _u(e){var t=(0,S.unpackStore)(e);du.forEach((function(e){var a,i,n=(0,Ll.getFolderUnreadCount)(t,e),s=document.querySelector('._im_right_menu_counter[data-tab="'+e+'"]');s&&(s.innerHTML=n,null===(i=null===(a=s.closest(".ui_rmenu_item"))||void 0===a?void 0:a.classList)||void 0===i||i.toggle("ui_rmenu_item_hidden",(0,Ll.isConvoListFolderHidden)(t,e)))}));var a=(0,Ll.getFolderMentionsCount)(t,me.ConvoListFolder.ARCHIVE),i=document.querySelector('._im_right_menu_mentions[data-tab="'+me.ConvoListFolder.ARCHIVE+'"]');i&&(i.dataset.mentions=a)}var uu=a(94378),gu=a(42347);function mu(){return mu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},mu.apply(this,arguments)}function pu(e,t,a,i,n,s,r){try{var o=e[s](r),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(i,n)}function hu(e){return function(){var t=this,a=arguments;return new Promise((function(i,n){var s=e.apply(t,a);function r(e){pu(s,i,n,r,o,"next",e)}function o(e){pu(s,i,n,r,o,"throw",e)}r(void 0)}))}}function vu(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return fu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fu(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function bu(){return Promise.all([a.e(68592),a.e(38838),a.e(89855)]).then(a.bind(a,77729)).then((e=>e.marusiaSdk))}function yu(e,t,a,i,s){for(var r,o=new Map,l=new Map,c=new Map,d=vu(s);!(r=d()).done;){var g=r.value;o.has(g.peerId)||o.set(g.peerId,new Set),o.get(g.peerId).add(g.messageId);var m=(0,u.getMessage)(e,g.peerId,g.messageId);m&&l.set(g.messageId,m.chat_local_id),c.set(g.messageId,g)}o.forEach(((s,r)=>{var o=[...s],d=(0,u.getTab)(e,r),g=d&&!d.offset,m=d&&d.inplaceSearch&&!!d.searchOffset;e.set(n.removeMessages.bind(null,o,r)).then((()=>e.set(n.removeMessagesMarkDeleted.bind(null,o,r)))).then((()=>{if(e.get().peer===+r&&(0,_.isFullyLoadedTab)(e.get(),r)){var a=(0,u.getTab)(e,r);t.removeMessages(o,+r,e);var i=a.inplaceSearch;if(!a.offset&&!g&&((0,n.setActions)(e.get()),t.updateActions(e),i||t.showEmptyScreen()),i&&m&&!a.searchOffset&&(t.showSearchResults(),J.browser.safari)){var s=(0,h.geByClass1)("_im_peer_history_w");s.style.display="none",setTimeout((()=>s.style.display=""),0)}}})).then((()=>{var s=(0,u.getTab)(e,r);if(s){var d=o.some((e=>e>=s.lastmsg)),_=(0,Vt.partConfigEnabled)("me_web_read_by_cmid")?o.filter((e=>{var t=l.get(e);return t&&t>s.in_up_to_cmid&&!(c.get(e).flags&W.FLAG_OUTBOUND)})):o.filter((e=>e>s.in_up_to&&!(c.get(e).flags&W.FLAG_OUTBOUND)));d?(0,n.loadActualLastMessage)(e,+r).then((()=>{a.promoteDialog(e,r),i&&i.updateCounter(e,r),r===(0,_e.getPeer)(e)&&(t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0))})):_&&(0,ge.removeDeletedUnreadMsgsFromTab)(r,_,e.get()).then((()=>a.updateDialog(r,e)))}}))}))}function Cu(e,t){"spam"===t?(0,_.showSpamLayer)(e,Zr,{}):"fav"===t&&(0,_.showFavvedBox)(e,{},K_,{})}function wu(e,t,a,i,s){e.forEach((e=>{switch(e.kludges.source_act){case _.CHAT_PHOTO_REMOVE:case _.CHAT_PHOTO_UPDATE:!function(e,t,a,i){t.set(n.updateChatPhoto.bind(null,e)).then((()=>{var n=e.kludges.source_act;a.updateDialog(e.peerId,t),i.updateChatPhoto(e,n,t)}))}(e,t,a,i)}}))}function Eu(e,t){var a=e.get().longpoll.push.bind(null,[(0,f.resetPeer)()]),i=()=>{var n=e.get().selectedMessages;n&&n.length?(e.setState({selectedMessages:[]}).then((()=>{t.changedMessageSelection(e),t.cleanSelection(n)})),setTimeout((()=>(0,s.cancelStackPush)("im_peer",i)),0)):a()};(0,s.cancelStackPush)("im_peer",i)}function Su(e,t){return Tu.apply(this,arguments)}function Tu(){return(Tu=hu(regeneratorRuntime.mark((function e(t,a){var i,n,s,r,o,l,c,d,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("event_add_message"===a.type||"event_edit_message"===a.type){e.next=2;break}return e.abrupt("return",!1);case 2:if(e.prev=2,s=t.get(),r=s.id,o=s.tabs,(0,Y.tabIsArchived)(o[a.peerId])){e.next=6;break}return e.abrupt("return",!1);case 6:if(l=null!=(i=null==(n=a.kludges)?void 0:n.marked_users)?i:[],l.some((e=>{e[0];var t=e[1];return Array.isArray(t)&&t.includes(r)}))){e.next=10;break}return e.abrupt("return",!1);case 10:if(!(0,Y.isMutedConvo)(t.get(),a.peerId)){e.next=12;break}return e.abrupt("return",!0);case 12:return e.next=14,(0,Pa.getInfo)();case 14:return c=e.sent,d=c.messages_auto_unarchive,_=void 0!==d&&d,e.abrupt("return",!_);case 20:return e.prev=20,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,null,[[2,20]])})))).apply(this,arguments)}function Mu(){return(Mu=hu(regeneratorRuntime.mark((function e(t){var a,i,n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.get(),i=a.archiveMentionsMap,!Array.isArray(i)){e.next=4;break}return e.abrupt("return",!1);case 4:if(void 0!==(n=cur.imDb.selectByKey("archive-mentions-map"))){e.next=8;break}return cur.imDb.updateByKey("archive-mentions-map",i),e.abrupt("return",!1);case 8:return s=Object.entries(i).some((e=>{var t=e[0],a=e[1];return!n.hasOwnProperty(t)||n[t]<a})),e.abrupt("return",s);case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function Lu(e,t){e.set((e=>(0,Tt.setLocalSettingsValue)("archives_folder_hidden",null,e))).then((a=>(cur.imDb.updateByKey("archives_folder_hidden",null),(0,_.isClassicInterface)(e)||t.updateFolderCounters(e),(0,Aa.toggleHideFolderHandler)((0,p.unpackStore)(a),"archive",!1,!0))))}function Iu(e,t,a){var i,n,s;void 0===a&&(a=null);var r=(0,p.unpackStore)(e),o=null!=(i=null==r||null==(n=r.tabs)||null==(s=n[t])?void 0:s.mention_cmids)?i:[];if(o.length){var l=a||Math.max(...o);cur.imDb.updateByKey("archive-mentions-map",mu({},cur.imDb.selectByKey("archive-mentions-map")||{},{[t]:l})),e.set((e=>(Array.isArray(e.archiveMentionsMap)&&(e.archiveMentionsMap={}),e.archiveMentionsMap[t]=l,Promise.resolve(e))))}}function ku(e){var t=e.attaches.filter((e=>"sticker"!==e.type&&"call"!==e.type));return(0,g.isServiceMsg)(e)||0===t.length}function Pu(e,t,a){(0,h.addClass)(a,"im-page_history-show"),t.loadingPeer(e)}function Au(e,t){var a=(0,_.getRightMenuMaxItems)(e,t.offsetHeight);if(e.get().tabbedPeers.length>a){var i=e.get().tabbedPeers.filter((t=>{var a=t.peer;return(0,c.intval)(a)!==e.get().peer})).map((t=>{var a=t.peer;return e.get().tabs[a]})).sort(((e,t)=>t.last_touched-e.last_touched)),s=[];0!==e.get().peer&&s.push(e.get().tabs[e.get().peer]);var r=s.concat(i).slice(a).map((e=>e.peerId)),o=e.get().tabbedPeers.filter((e=>!(0,c.inArray)(e.peer,r)));return e.set(n.updateTabbedPeers.bind(null,o,!0))}return Promise.resolve(e)}function Bu(){for(var e=(0,l.curBox)();e;)e.hide(),e=(0,l.curBox)()}function xu(e,t,a,i,r,o,l,c,d){e.get().audio_msg.isRecording&&e.set(n.cancelRecording).then((()=>{i.cancelRecording()})),AudioMessagePlayer.detachPlayer(),(0,u.isAnyMessageBeingEdited)(e)&&i.cancelEditing(),(0,u.isSearching)(e)&&t.cancelSearch&&(r.clearSearch(e),a.restoreDialogs(e),d().toggleSettingsButton(e,!1)),Du(e,c,d),Pu(e,i,o);var g=e.get().peer;(0,n.updateMentions)(e.get()),(0,_.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!(0,u.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!(0,u.getMessage)(e,t.peerId,(0,u.getTab)(e,t.peerId).lastmsg)||(0,u.getTab)(e,t.peerId).skipped)&&e.mutate((e=>(0,u.makeTabNotFullyLoaded)(e,t.peerId)));var m=e.set(n.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then((e=>{var a=e.get();return a.tabs[t.peerId]?Promise.resolve(a):e.set((()=>(0,Aa.loadPeer)(a,t.peerId,t.msgid,!0,!1,"applyPeer")))})).then((()=>{if(a.selectPeer(t.msgid,e),function(e,t){(0,_.isPendingForward)(e)&&((0,s.cancelStackFilter)("forward"),e.set(n.forwardMessages.bind(null,e.get().pendingForward,(0,u.getTabDraft)((0,u.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),Bu(),i.preparePeer(e),Eu(e,i),(0,_.isClassicInterface)(e)?(a.deactivate(),Au(e,o).then((()=>l.updateMenu(e))),_u(e)):a.updateFolderCounters(e),!(0,_.isClassicInterface)(e)&&(0,Y.isRecommendedConvo)(e,t.peerId)&&(0,Q.isUserPeer)(t.peerId)&&!(0,Q.isContactPeer)(t.peerId)){var r=((0,u.getTab)(e,t.peerId)||{}).online||0,c=(0,_.convertLegacyOnlineToAPIFlags)(r),d=c.is_online,g=c.is_mobile;e.set((e=>(0,ge.updateRecommendedListItemOnline)(e,t.peerId,d,g))).then((e=>{a.updateRecommendedOnline(t.peerId,e)}))}}));return(m=t.msgid?m.then((()=>e.set(n.selectPeerOnMessage.bind(null,t.peerId===g,g)))):m.then((()=>e.set((e=>(0,n.selectPeer)(!0,e)))))).then((()=>e.set(n.prepareCasperMessagesFromMessages.bind(null,t.peerId)))).then((()=>{if(e.get().peer===t.peerId){if(t.forward){var a=e.get().tabs[e.get().peer];if(!a.scrollBottom&&a.unread)((0,Vt.partConfigEnabled)("mail_history_unread_counter_observer")?Promise.resolve():e.set(n.readLastMessages.bind(null,e.get().peer))).then((()=>e.set(n.setActions))).then((()=>i.updateActions(e)));else!a.unread&&(0,u.isTabMarkedUnread)(a)&&e.set((e=>(0,n.markDialogRead)(t.peerId,e)))}(0,_.isClassicInterface)(e)&&l.updateMenu(e),i.changePeer(e,!1),i.updateTyping(t.peerId,e),i.removeExpiredFailedMessages(t.peerId),(0,Vt.partConfigEnabled)("mail_history_unread_counter_observer")&&i.updateObserver(),(0,n.updateMentions)(e.get())}})).catch(uu.dummyCatch)}function Du(e,t,a){t&&e.get().shown&&(t.hide(e),a().createCanceled(e))}function Ru(e,t,a){(0,u.isSearching)(e)&&(t.clearSearch(e),a.restoreDialogs(e))}function Ou(e,t,a,i,s,r,o){e.setState({isCreating:!0}),(0,_.isClassicInterface)(e)&&(s.saveScroll(e),r.saveScroll(e)),i.showCancelControl(),(0,h.addClass)(o,"im-page_creating"),a&&a.show(e,t),(0,_.isClassicInterface)(e)&&((0,h.setStyle)(o,{height:Gu(o,e).page}),setTimeout((function(){(0,h.addClass)(o,"im-page_cropped")}),200)),(0,n.toggleConversation)(!0)}function Nu(e,t,a,i){(0,_.isTabLoaded)(e.get(),i)&&(t.updateTyping(i,e),a.updateTyping(i,e))}function Fu(e,t,a,i,s){i.activityType||(i.activityType=s);var r=e=>Nu(e,t,a,i.peerId);(0,_.isSelfMessage)(i.peerId,e.get().gid)||(e.set(n.setActivity.bind(null,i,s)).then(r),e.set(n.waitActivity.bind(null,i,s)).then(r))}function Uu(e,t,a){var i=(0,u.getTab)(a,(0,Y.getCurrentTab)(a));if(i&&!(0,Y.isBusinessNotifyTab)(i)){var n="im-page_reconnecting";t?e.classList.add(n):e.classList.remove(n)}}function Hu(e,t,a,i,s){(0,u.isMessageRequestChangedEvent)(t)?function(e,t,a,i){var s=(0,Y.getCurrentTab)(e);switch(t.updateType){case W.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED:s&&s.peerId===t.updateArg&&e.get().longpoll.push([(0,f.changePeer)(t.peerId,!1,!1,!1,e.get().currentEntryPoint)]),e.set((e=>(0,n.deletedDialog)(t.updateArg,Promise.resolve([]),e))).then((()=>{a().removePeer(e,t.updateArg),a().updateDialogFilters(e)}));break;case W.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:var r=(0,u.getTab)(e,t.peerId);(!(0,Vt.partConfigEnabled)("simplified_start_conversation")||r&&(0,Y.tabIsNotImportantMessageRequest)(r)?e.set((e=>(0,n.updateMessageRequestsCounter)(t,e))):e.set((e=>Promise.resolve(e)))).then((()=>{r&&t.updateArg===W.MESSAGE_REQUEST_STATUS_REJECTED&&(0,ge.updateListedConvos)(e.get(),r,!0,(e=>e.filter((e=>e!==Number(t.peerId)))))})).then((()=>{(0,_.isClassicInterface)(e)?_u(e):i.updateFolderCounters(e),(0,_.checkMessageRequestsTab)(e,i.update),W.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&(0,_.isClassicInterface)(e)&&a().updateMenu(e),W.MESSAGE_REQUEST_STATUS_REJECTED===t.updateArg&&0===e.get().dialog_tabs[E.FOLDER_MESSAGE_REQUEST].length&&(0,u.isMessageRequestFolder)(e)&&e.get().longpoll.push([(0,f.changeTab)(E.FOLDER_ALL)])}))}}(e,t,a,s):(0,u.isBusinessNotifyChangedEvent)(t)?function(e,t,a,i){var s=e.set((e=>(0,ge.resetFolderList)(e,me.ConvoListFolder.BUSINESS_NOTIFY)));e.get().active_tab===me.ConvoListFolder.BUSINESS_NOTIFY&&s.then((()=>e.set(n.loadDialogs))).then((()=>a().restoreDialogs(e,!0,!0)))}(e,0,a):(0,_.isTabLoaded)(e.get(),t.peerId)&&(Q_(e,t.peerId,t.updateType,t.updateArg,i,s)||!(0,_.isChatPeer)(t.peerId)||e.set((e=>(0,n.loadChatInfo)(t.peerId,e).then((e=>e.peer===t.peerId?(0,n.setActions)(e):Promise.resolve(e))))).then((()=>{a().updateChatInfo(t.peerId)})))}function ju(e,t,a){var i=null;if(a.kludges.keyboard&&!a.kludges.keyboard.inline){var s=Object.assign(a.kludges.keyboard,{author_id:a.userId});i=e.set(n.setKeyboard.bind(null,a.peerId,s))}else{var r=(0,u.getKeyboard)(e,a.peerId);r&&r.one_time&&r.author_id!==(0,g.getAuthorId)(e,a)&&(i=e.set(n.deleteKeyboard.bind(null,a.peerId)))}a.peerId===(0,_e.getPeer)(e)&&i&&i.then(t.fixKeyboard)}function qu(e,t,a,i,d,b,y,C,w,S,T,M,L,I,k,P,A,B,x,D,R,O,N){var F=!1;return{changePeer(e,a){t.selectPeer(e,a)},cancelSearch(e){Ru(e,i,t)},loadingPeer(e){Pu(e,a,d)},restoreDialogs(e,a,i){t.restoreDialogs(e,a,i)},showChatInvitationBox(e,a){(0,_.showChatInvitationBox)(e,a,w,t)},toggleSettingsButton(e,t){null==T||T.toggleButton(e,t)},focusSearch(e){i.focusInput()},appendSearch(e,a,i,n){t.appendSearch(e,a,i,n)},appendDialogs(e,a){t.appendDialogs(e,a)},showCreation(e,n){Ou(e,n,S,i,t,a,d)},updateState(e,i){t.updateDialog(e,i),i.get().peer===e&&a.updateChat(i,e)},updateConvoInList(e,a){t.promoteDialog(a,e)},appendFastDialogs(e,a){t.appendFastDialogs(e,a,!0)},createCanceled(e){i.hideCancelControl(),(0,_.isClassicInterface)(e)?((0,h.setStyle)(d,{height:"auto"}),(0,h.removeClass)(d,"im-page_cropped"),setTimeout((()=>i.focusInput()),0),0===e.get().peer?t.restoreScroll(e):a.restoreScroll(e,e.get().peer)):setTimeout((()=>{0===e.get().peer?i.focusInput():a.focustTxt(e)}),0),(0,h.removeClass)(d,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){P&&P.updateMenu(e)},goToHistoryEnd(){a.goToEnd()},updateDialog(e,a){t.updateDialog(e,a)},updateRecommendationList(e){e.set($n.updateConvoRecommendationList).then((e=>{(0,_e.isRecommendationListRerenderNeeded)(e)&&t.updateRecommendationList(e)}))},setRecommendationListVisibility:e=>t.setRecommendationListVisibility(e),focusTxt(e){a.focustTxt(e)},resync(e){(0,u.isSearching)(e)&&i.clearSearch(e),t.restoreDialogs(e,!0,!0).then((()=>{(0,_.isClassicInterface)(e)||t.focusOnSelected(e)})),S&&S.hide(e),(0,_.isCommunityInterface)(e)&&e.get().tabbedPeers.forEach((t=>{var a=t.peer;P.updateCounter(e,a)})),(0,_.isClassicInterface)(e)?(e.get().tabbedPeers.forEach((t=>{var a=t.peer;P.updateCounter(e,a),P.updateName(a,e)})),_u(e)):t.updateFolderCounters(e),a.cleanSelection(e.get().selectedMessages||[]),a.cancelSearch(e,!0),(0,_.isReservedPeer)(e.get().peer)||a.changePeer(e,!1),(0,Po.updateUnreadCounter)(e)},toggleSettingsLoader(e,t){T.toggleLoader(e,t)},onUserActions(e,t){if(!(0,n.isSearchingInplace)(e.get().peer,e.get())){var i,s=e.get(),r=s.peer;if((0,_.isFullyLoadedTab)(s,r))if(!b.is_idle)if((0,u.countUnread)(e.get().peer,e.get())>0)if(!s.tabs[r].skipped&&a.isNewMessagesVisible(e))a.hideGoToEnd(!0),a.hideGoToMention(!0),(0,Vt.partConfigEnabled)("mail_history_unread_counter_observer")?(a.updateObserver(),i=Promise.resolve()):i=e.set(n.readLastMessages.bind(null,r)),i.then((()=>e.set(n.setActions))).then((()=>a.updateActions(e)))}},removeSelection(e){t.removeSelection(e),i.focusInput()},openSettings(){i.openSettings()},route(e,s,r,o){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var c=!1;return!!(e.mr||e.invite_chat_id&&r.invite_hash)||(o&&o.params&&"left_nav"===o.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach((e=>{switch(e){case"sel":r.q||(c=!0);var u=r.sel?(0,_.unUrlPeer)(r.sel):0,g=o.back;if(0===u)M.get().longpoll.push([(0,f.resetPeer)(!1,g)]);else if(u!==M.get().peer){var m="";o&&o.params&&o.params.entrypoint&&(m=o.params.entrypoint),M.get().longpoll.push([(0,f.changePeer)(u,r.msgid||!1,!1,!1,m)])}break;case"invite_chat_id":case"invite_hash":!function(e){e.set(n.leaveInvitation).then((()=>{e.get().longpoll.push([(0,f.resetPeer)(!1,!1)])}))}(M);break;case"tab":Du(M,S,w),c=!0;var p=r.tab||E.FOLDER_ALL;M.get().longpoll.push([(0,f.changeTab)(p)]);break;case"act":r.act&&"create"===r.act?Ou(M,[],S,i,t,a,d):function(e,t,a,i){a&&a.hide(e,t)}(M,[],S);break;case"st":r.st&&r.sel?((0,l.curBox)()&&(0,l.curBox)().hide(),M.mutate(n.setInplaceSearch.bind(null,unescape(r.st),r.sel)),a.startSearch(M)):(M.mutate(n.cancelSearch.bind(null,s.sel)),a.cancelSearch(M,!0));break;case"q":r.q?((0,l.curBox)()&&(0,l.curBox)().hide(),i.setSearch(M,r.q,!0)):i.clearSearch(M);break;case"box":Cu(M,r.box)}})),r.msgid&&(M.get().msgid=r.msgid,a.focusOnMessage()),(0,_.isClassicInterface)(M)&&void 0===e.sel&&P.updateMenu(M),c&&Ru(M,i,t),!1)},updateDialogFilters(e,a){void 0===a&&(a=!1),(0,u.isSearching)(e)||a||t.restoreDialogs(e),null==T||T.updateFilter(e)},removePeer(e,a){t.removeDialog(e,a),t.saveScroll(e),e.get().peer===a&&e.get().longpoll.push([(0,f.resetPeer)()]),(0,_.isClassicInterface)(e)&&P.updateMenu(e)},newMessage(e){(0,_.isClassicInterface)(e)||t.scrollUp(!0)},onQueueEvent(e,i){if(i.entity_type===Jc.Online)e.set((e=>(0,n.updateOnline)(i.data.user_id,!!i.data.online&&i.data.platform,i.data.last_seen,e))).then((e=>{(0,_.isTabLoaded)(e.get(),i.data.user_id)&&(t.updateOnline(i.data.user_id,e),a.updateOnline(i.data.user_id,e)),(0,Y.isRecommendedConvo)(e,i.data.user_id)&&t.updateRecommendedOnline(i.data.user_id,e)}))},onEvents(e,s){var l=(0,f.compactCounterEvents)(s),v=s.filter(g.isServiceMsg),M=s.filter((e=>e.type===W.ADD_MESSAGE)),I=(0,n.checkNewPeople)(v,M,e),k=Promise.resolve();I.shouldLoad&&(k=e.set(n.loadNewPeople.bind(null,I,y))),k.then((()=>{wu(v,e,t,a),l.forEach((s=>{switch(s.type){case W.ADD_MESSAGE:var l=s.peerId,v=(0,u.getTab)(e,l),y=!v||!v.msgs||0===v.msgs.length,M=(0,_.getMessageStoreStatus)(s,e.get()),I=(0,u.isCommunityBlocked)(e,s.peerId),k=v&&!v.lastmsg,A=v&&(0,Y.isChatConvo)(v)&&v.data.closed;switch(ju(e,a,s),(0,g.isCasperMessage)(s)&&cu.casperMessagesStore.add(s),M){case _.MSG_NEW:e.set(n.addMessage.bind(null,s)).then((e=>{Su(e,s).then((a=>{a&&(Lu(e,t),Iu(e,s.peerId,s.chat_local_id))}))})),Au(e,d),function(e,t){var a=(0,p.unpackStore)(e),i=a.tabs[t.peerId],s=a.active_tab;return!(!i||!s)&&(!(s!==E.FOLDER_ALL||(0,Y.tabIsArchived)(i)||(0,Y.isBusinessNotifyTab)(i)||(0,u.tabIsMessageRequestToChat)(i))||(s===E.FOLDER_PEER_TAGS?(0,m.applyPeerTagsFilterToTab)(a,i):(0,n.filterFromTab)(s)(i)))}(e,s)&&((0,u.tabIsMessageRequest)(v)||(s.flags&W.FLAG_OUTBOUND||e.set(n.updateFavAndTitle.bind(null,s.peerId,!0)),function(e,t){var a=t.flags&W.FLAG_OUTBOUND,i=(0,c.inArray)(t.peerId,e.get().mutedPeers),n=t.flags&W.FLAG_DELETED,s=e.get().gid;if(!a&&!i&&!n){var l,d,u=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",g=(u?u+" ":"")+t.text||"",m=t.userId,p=t.peerId,h=e.get().tabs[p];if(t.kludges&&t.kludges.source_act&&(g=(0,r.stripHTML)((0,An.renderServiceMsg)(e,t,h.peerId,!1))),(!e.get().notify_msg&&!(0,_.isChatPeer)(p)||s&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:p}),!(0,_.isChatPeer)(p))return;g=(0,c.trim)((0,r.replaceEntities)((0,r.stripHTML)(g.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),g=(0,kn.replaceMentions)(g,((e,t,a,i,n)=>n)),(0,_.isChatPeer)(p)?(l=(0,z.oCacheGet)(e,m).name,h.tab&&(l+=" » "+h.tab),d=(0,z.oCacheGet)(e,m).photo):(l=h.tab,d=h.photo);var v=t.attaches[0];if(v&&"mail"===v.type)g+="\n["+(0,o.getLang)("mail_added_msgs")+"]";else if(v){var f="doc"===v.type&&"graffiti"===v.kind?"graffiti":v.type;g+="\n["+(0,o.getLang)("mail_added_"+f)+"]"}l=(0,c.trim)((0,r.replaceEntities)((0,r.stripHTML)((l||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:g,author_id:p,title:l,author_photo:d})}}(e,s)),t.updateTyping(s.peerId,e),(0,u.isSearching)(e)?t.updateDialog(s.peerId,e):t.promoteDialog(e,s.peerId));var B=(0,u.isCommunityBlocked)(e,s.peerId),x=v&&!v.offset,R=v&&(0,Y.isChatConvo)(v)&&!v.data.closed&&A;(I&&!B||k&&!x||R)&&(R&&(0,n.setActions)((0,p.unpackStore)(e)),a.updateActions(e)),(0,_.isClassicInterface)(e)?(P.updateCounter(e,s.peerId),P.updateMenu(e)):null==T||T.updateFilter(e),e.set(n.updateActivity.bind(null,s)).then(Nu.bind(null,e,a,t,s.peerId)),a.addMessage(e,s),ku(s)||!(0,_.isFullyLoadedTab)(e,s.peerId)||s.local||e.set(n.loadMedia.bind(null,s)).then((e=>{a.replaceAttachmentPlaceholders(e,s),ke()})),s.kludges.has_template&&e.set((e=>(0,n.addCarouselTemplateToStore)(s,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,s)})),(0,Te.statlogsSendingTimeStart)(e,s,"send","opt_to_lp");break;case _.MSG_LOCAL_DUPLICATE:ku(s)||e.set(n.loadMedia.bind(null,s)).then((e=>{a.replaceAttachmentPlaceholders(e,s)})),e.set(n.replaceMessage.bind(null,s)),a.replaceMessageAttrs(s,e),t.updateDialog(s.peerId,e),e.get().active_tab===E.FOLDER_ALL&&(0,Y.isRecommendedConvo)(e,s.peerId)&&this.updateRecommendationList(e),s.randomId&&(0,Te.statlogsSendingTimeEnd)(e,s,"send","opt_to_lp");break;case _.MSG_DUPLICATE:(0,u.isSearching)(e)||t.promoteDialog(e,s.peerId)}(0,u.tabIsMessageRequest)(v)&&(0,_.checkMessageRequestsTab)(e,t.update);var O=M===_.MSG_LOCAL_DUPLICATE&&1===v.offset||M===_.MSG_NEW&&k&&!s.local;(0,Vt.partConfigEnabled)("messenger_empty_pinned_support")&&O&&e.set((t=>(0,Aa.loadPeer)(t,l,0,!1,!1,"emptyPinnedCrutch").then((t=>((0,ge.updateListedConvos)(t,(0,u.getTab)(t,l),!1,(e=>(0,n.addDialog)(l,e,t)),((e,a,i)=>(0,n.shouldIncludeDialog)(t,e,a,i))),l===e.get().peer?(0,n.setActions)(t):t))))).then((e=>t.promoteDialog(e,l))),v&&y&&v.peerId===(0,_e.getPeer)(e)&&D();break;case W.EDIT_MESSAGE:case W.REPLACE_MESSAGE:e.set(n.editMessage.bind(null,s)).then((e=>{if(Su(e,s).then((a=>{a&&(Lu(e,t),Iu(e,s.peerId,s.chat_local_id))})),ju(e,a,s),s.kludges.is_expired)return(0,_.removeExpiredMessageIfNeed)(s,a.handleMessageExpiration),void t.updateDialog(s.peerId,e);t.updateDialog(s.peerId,e),a.updateTyping(s.peerId,e),a.editMessage(e,s),ku(s)||!(0,_.isFullyLoadedTab)(e,s.peerId)||s.local||e.set(n.loadMedia.bind(null,s)).then((e=>a.replaceAttachmentPlaceholders(e,s))),s.kludges.has_template&&e.set((e=>(0,n.addCarouselTemplateToStore)(s,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,s)}))}));break;case W.INVALIDATE_MESSAGE:(0,n.reloadMessage)(s.messageId,e.get()).then((t=>{var a=(0,Z.getMessageFromTuple)(t);return e.set((e=>(0,n.editMessage)(a,e))).then((()=>a))})).then((i=>{a.editMessage(e,i),t.updateDialog(i.peerId,e),!ku(i)&&(0,_.isFullyLoadedTab)(e,i.peerId)&&e.set((e=>(0,n.loadMedia)(i,e))).then((e=>a.replaceAttachmentPlaceholders(e,i)))}));break;case W.READ_INBOUND:case W.READ_INBOUND_BY_CMID:e.set((e=>(0,n.markInboundMessagesAsRead)(s,e))).then((e=>{t.updateCounter(e,s.peerId),s.peerId===(0,_e.getPeer)(e)&&(a.updateGoToEnd(e,!0),a.updateGoToMention(e,!0),a.updateObserver()),(0,_.isClassicInterface)(e)&&P.updateCounter(e,s.peerId),(0,u.isSearching)(e)||t.restoreDialogs(e),null==T||T.updateFilter(e)}));break;case W.READ_OUTBOUND:case W.READ_OUTBOUND_BY_CMID:e.set(n.markOutboundMessagesAsRead.bind(null,s)).then((e=>{t.updateCounter(e,s.peerId),a.markMessagesAsRead(e,s)}));break;case W.UNREAD_COUNT:e.set((e=>(0,Tt.setUnreadCounters)(s,e))).then((()=>{null==T||T.updateFilter(e);var a=s.showOnlyNotMuted;a!==(0,_e.getLocalSettingsValue)(e,"show_only_not_muted_messages")&&e.set((e=>(0,Tt.setLocalSettingsValue)("show_only_not_muted_messages",a,e))),(0,Vt.partConfigEnabled)("mail_longpoll_unread_counter")||(0,Po.updateUnreadCounter)(e);var i=Promise.resolve();s.businessNotifyUnread>0&&1===e.get().settings.business_notify_folder_hidden&&(i=e.set((e=>(0,Tt.setLocalSettingsValue)("business_notify_folder_hidden",0,e))),(0,Aa.toggleHideFolderHandler)((0,p.unpackStore)(e),me.ConvoListFolder.BUSINESS_NOTIFY,!1)),i.then((a=>{(0,_.isClassicInterface)(e)?(_u(e),e.get().tabbedPeers.forEach((t=>{var a=t.peer;P.updateCounter(e,a)}))):t.updateFolderCounters(e)}))}));break;case W.SET_FLAGS:case W.REPLACE_FLAGS:case W.RESET_FLAGS:switch(!0){case Boolean(s.flags&W.FLAG_DELETED):case Boolean(s.flags&W.FLAG_SPAM):s.type!==W.SET_FLAGS||(0,_.isAlreadyDeleted)(e,s.peerId,s.messageId)||e.get().blockedFlagUpdates[s.peerId]||C(s);break;case s.flags===W.FLAG_IMPORTANT:var N=s.type===W.SET_FLAGS;e.set((e=>(0,n.updateImportant)(N?1:-1,s.messageId,e))),e.set((e=>(0,n.updateFavMessage)([s.messageId],s.peerId,N,e))).then((()=>{a.markImportant(s.messageId,N,e)}));break;case Boolean(s.flags&W.FLAG_AUDIO_MESSAGE_LISTENED):e.set((e=>function(e,t,a,i,n){var s=(0,Y.getTab)(e,t),r=(0,Gt.getMessage)(e,t,a);return s&&s.msgs&&r?(r.flags=n?r.flags|i:r.flags&~i,s.msgs[a]=r,Promise.resolve(e)):Promise.resolve(e)}(e,s.peerId,s.messageId,W.FLAG_AUDIO_MESSAGE_LISTENED,!0))).then((e=>{var t=s.peerId,i=s.messageId,n=(0,u.getTab)(e,t);if((0,_e.getPeer)(e)===t&&a.markMessageAsListened(e,t,i),n&&(0,_.isFullyLoadedTab)(e,t)){var r=(0,rs.unpackHistory)(n.history);n.history=(0,_.updateListenedMark)(r,i)}}))}break;case W.RECORDING_AUDIO:Fu(e,a,t,s,n.ACTIVITY_TYPE_RECORDING_AUDIO);break;case W.TYPING:Fu(e,a,t,s,n.ACTIVITY_TYPE_TYPING);break;case W.NOTIFY_SETTINGS_CHANGED:!function(e,t,a,i){e.set(n.setMutedPeer.bind(null,a,i)).then(t().updateState.bind(null,a))}(e,w,s.peerId,!s.sound);break;case W.CONVO_MAJOR_ID_CHANGED:e.set((e=>{var t=s.peerId,a=s.majorId,i=(0,u.getTab)(e,t);return(a&&i?Promise.resolve(e):(0,Aa.loadPeer)(e,t,0,!1,!1,"sortingChange")).then((e=>{var i=(0,u.getTab)(e,t);return i.major_sort_id=a,(0,ge.updateListedConvos)(e,i,!1,(a=>(0,n.addDialog)(t,a,e)),((t,a,i)=>(0,n.shouldIncludeDialog)(e,t,a,i))),(0,n.setActions)(e),Promise.resolve(e)}))})).then((e=>{var i=s.peerId;(0,u.getTab)(e,i)&&!(0,u.isSearching)(e)&&t.promoteDialog(e,i),i===e.get().peer&&a.updateActions(e)}));break;case W.CONVO_MINOR_ID_CHANGED:e.set((e=>{var t=s.peerId,a=s.minorId,i=(0,u.getTab)(e,t);return i?(i.minor_sort_id=a,Promise.resolve(e)):Promise.resolve(e)})).then((e=>{var a=s.peerId;(0,u.getTab)(e,a)&&!(0,u.isSearching)(e)&&t.promoteDialog(e,a)}));break;case W.RESYNC:e.get().longpoll.pause(),e.set(n.resync).then(w().resync).then((()=>e.get().longpoll.resume()));break;case W.TRANSITION:L.transition(s.state);break;case W.RESET_PEER:if(s.removeActivePeer){var U=e.get().tabbedPeers.filter((t=>{var a=t.peer,i=t.type;return a!==e.get().peer&&"perm"===i}));e.setState({tabbedPeers:U})}!function(e,t,a,i){e.set(n.cancelRecording).then((()=>{a.cancelRecording()})),AudioMessagePlayer.detachPlayer(),t.removeSelection(e),(0,h.removeClass)(i,"im-page_history-show"),a.flushDraft(e),a.stopLoading(),a.destroyPeerProfile(),(0,u.isAnyMessageBeingEdited)(e)&&a.cancelEditing();var s=e.get().peer;e.set(n.changePeer.bind(null,0,!1,"")).then((()=>{window.tooltips&&window.tooltips.hideAll(),Bu(),(0,_.isClassicInterface)(e)&&t.activate(),a.changePeer(e),(0,_.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout((()=>{e.get().longpoll.push([(0,f.transitionEvent)("search")])}),13),(0,_.isLocksAvailable)(e)&&(0,_.isPeerBlockedByMe)(s,e)&&e.set(n.releaseBlock.bind(null,s))}))}(e,t,a,d),s.cancelSearch&&Ru(e,i,t),(0,_.isClassicInterface)(e)&&P.updateMenu(e),(0,_.isClassicInterface)(e)&&e.get().active_tab===E.FOLDER_ALL&&this.updateRecommendationList(e),i.focusInput(),(0,_.isCommunityInterface)(e)&&(i.initPeerTagsFilter(e),t.renderPeerTags(e));break;case W.CHANGE_TAB:(0,u.isSearching)(e)&&i.clearSearch(e);var H=e.get().active_tab;(0,_.changeTab)(s.tab,e,w,n.changeDialogsTab).then((e=>{null==T||T.updateFilter(e),s.tab===E.FOLDER_PEER_TAGS&&H!==s.tab&&i.initPeerTagsFilter(e),s.tab===E.FOLDER_ALL&&this.updateRecommendationList(e)}));break;case W.RESET_DIRECTORIES:case W.SET_DIRECTORIES:case W.REPLACE_DIRECTORIES:var j=s.type,q=s.peerId,K=s.mask;if(K===W.FOLDER_HAS_BANNER)break;var G=K===W.FOLDER_AD_TAG;e.set((e=>(0,n.updateFolderState)(q,K,j,s.local,G,e))).then((e=>{(0,u.isSearching)(e)||j===W.RESET_DIRECTORIES&&K===E.FOLDER_MASKS[E.FOLDER_IMPORTANT]||j===W.RESET_DIRECTORIES&&K===E.FOLDER_MASKS[E.FOLDER_MESSAGE_REQUEST]||j===W.SET_DIRECTORIES&&K===E.FOLDER_MASKS[E.FOLDER_MESSAGE_REQUEST_REJECTED]||j===W.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(q,e),(0,_.isClassicInterface)(e)&&P.updateCounter(e,q),e.get().peer===q&&a.changedMessageSelection(e)}));break;case W.DELETE_DIALOG:e.set(n.deletedDialog.bind(null,s.peerId,Promise.resolve([]))).then((()=>{w().removePeer(e,s.peerId),w().updateDialogFilters(e)}));break;case W.CHANGE_PEER:xu(e,s,t,a,i,d,P,S,w);break;case W.MUTEX:var V={[s.peerId]:s},$=(0,_.isPeerBlocked)(s.peerId,e);e.set(n.updateBlockStates.bind(null,V)).then((()=>{t.updateDialog(s.peerId,e);var i=(0,_.isPeerBlocked)(s.peerId,e);(0,_.isFullyLoadedTab)(e.get(),s.peerId)&&$!==i&&a.updateChat(e,s.peerId)}));break;case W.FAILED_MESSAGE:e.set(n.setMessageErrored.bind(null,s.peerId,s.message)).then((()=>{a.setMessageErrored(s.peerId,s.message,s.error,e),t.setDialogFailed(s.peerId,s.message.messageId,e)}));break;case W.RESEND:var Q=s.message.messageId;e.set(n.resendMessage.bind(null,s.peerId,Q,s.message)).then((()=>{a.resendMessage(s.peerId,Q),t.promoteDialog(e,s.peerId)}));break;case W.PEER_TAGS_CHANGED_EVENT:(0,m.onPeerTagsChangeEvent)(e,t,s);break;case W.PEER_PROFILE_TAGS_CHANGED_EVENT:(0,m.onPeerProfileTagsChangedEvent)(e,t);break;case W.CONVERSATION_UPDATED:Hu(e,s,w,a,t);break;case W.WAITING_FOR_RECONNECT:setTimeout((()=>{Uu(d,!0,e),a.setNetworkWaitingStatus(s.timeout-1,e)}),1e3);break;case W.RECONNECTING:Uu(d,!0,e),a.setNetworkReconnectingStatus(e);break;case W.RECONNECTED:Uu(d,!1,e),setTimeout(a.clearNetworkStatus,0),J.browser.chrome&&!(0,_.isClassicInterface)(e)&&e.get().peer&&(b.is_idle?F||(b.once("unidle",(()=>{F=!1,t.forceScrollReinit()})),F=!0):t.forceScrollReinit());break;case W.KEYBOARD_CALLBACK_RECEIVED:var X=(0,_e.getPressedButtonState)(s.event_id,e);X&&(e.set((e=>(0,Tt.unsetPressedCallbackButton)({peerId:s.peer_id,eventId:s.event_id},e))),X.onCallback(),(0,Le.handleCallbackAction)(s,e));break;case f.CHANGE_VOICE_UI:var ee=(0,_e.getPeer)(e);if(!ee)return;var te=(0,u.getTab)(e,ee),ae=null==te?void 0:te.msgs;if(!te||!ae)return;for(var ie=Object.values(ae),ne=function(t){var i=(0,un.parseMessage)(ie[t]);if((0,_.isAlreadyDeleted)(e,te.peerId,i.messageId)||!(0,g.isAudioMsg)(i)&&!(0,Gt.hasForwards)(i))return"continue";a.editMessage(e,i),e.set((e=>(0,n.loadMedia)(i,e))).then((e=>a.replaceAttachmentPlaceholders(e,i)))},se=ie.length-1;se>=0;se--)ne(se)}}))})),(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&bu().then((e=>{e.onLongpollData(s.filter(gu.isEventForMarusia))}))},updateHistory:e=>a.updateHistory(e),updateChatInfo(e){a.updateChatTopic(e,M),(0,_.isClassicInterface)(M)&&P.updateName(e,M),M.get().peer===e&&a.updateActions(M)},cancelRecording:()=>M.set(n.cancelRecording).then((()=>a.cancelRecording())),fixHeight(){D()},toggleFolder(e,a){t.toggleFolder(e,(()=>this),a)},updateFolderCounters(e){t.updateFolderCounters(e)},hideFolderButton(e,a){var i=(0,p.unpackStore)(e);e.set(function(){var t=hu(regeneratorRuntime.mark((function t(i){var n,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=a,t.next=t.t0===me.ConvoListFolder.BUSINESS_NOTIFY?3:t.t0===me.ConvoListFolder.ARCHIVE?4:8;break;case 3:return t.abrupt("return",(0,Tt.setLocalSettingsValue)("business_notify_folder_hidden",1,i));case 4:return n=e.get(),s=n.archiveMentionsMap,cur.imDb.updateByKey("archive-mentions-map",Array.isArray(s)?{}:s),cur.imDb.updateByKey("archives_folder_hidden",1),t.abrupt("return",(0,Tt.setLocalSettingsValue)("archives_folder_hidden",1,i));case 8:return t.abrupt("return",Promise.resolve(i));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((e=>((0,_.isClassicInterface)(e)||t.updateFolderCounters(e),(0,Aa.toggleHideFolderHandler)(i,a,!0))))},makeArchiveVisible(e){Lu(e,t)},actualizeArchiveVisibilityOnUnidle(e){!function(e,t){var a=e.get().settings.archives_folder_hidden,i=cur.imDb.selectByKey("archives_folder_hidden");i&&!a?e.set((e=>(0,Tt.setLocalSettingsValue)("archives_folder_hidden",1,e))).then((()=>{(0,_.isClassicInterface)(e)||t.updateFolderCounters(e)})):null===i&&a&&e.set((e=>(0,Tt.setLocalSettingsValue)("archives_folder_hidden",null,e))).then((()=>{(0,_.isClassicInterface)(e)||t.updateFolderCounters(e)}))}(e,t)},addEntityToArchiveMentionsMap(e,t){Iu(e,t)},applySearchAction(e,t,a){i.applySearchAction(e,t,a)},deselectAllMessages(e){a.deselectAll(e)},unmount(){(0,v.destroyModule)(e),clearInterval(M.get().update_title_to),b.stop(),R(),O(),cu.casperMessagesStore.destroy(),t.unmount();var r=window.devicePixelRatio>=2?"_2x":"";(0,Uc.setFavIcon)("/images/icons/favicons/fav_logo"+r+".ico"),a.unmount(),i.unmount(),(0,s.cancelStackFilter)("im_peer"),null==T||T.unmount(),S&&S.unmount(),P&&P.unmount(),A&&A(),I&&I(),(0,_.isLocksAvailable)(M)&&M.get().peer&&M.set(n.releaseBlock.bind(null,M.get().peer)),B.unmount(),N.unmount(),P&&P.unmount(),x.unmount(),clearInterval(k),cur.imDb.unmount(),cur.imDb=!1,(0,Vt.partConfigEnabled)("marusya_web_support_proccess_commands")&&bu().then((e=>{e.dispose()}))}}}function Ku(e,t,a,i){var s=t.get();(0,_.isReservedPeer)(s.peer)||e().onUserActions(t,i),s.update_old_title&&t.set(n.updateFavAndTitle.bind(null,!1,!1))}function Gu(e,t){var a=(0,h.ge)("page_header"),i=(0,h.geByClass1)("_im_page_history",e),n=(0,h.clientHeight)()-a.offsetHeight-30-2,s=(0,_.isClassicInterface)(t)?250:400,r={page:Math.max(n,s)};if((0,_.isClassicInterface)(t)){var o=(0,_.getClassicChatHeight)();o=o>0?Math.min(o-a.offsetHeight-30-2,n):n;var l=(0,h.hasClass)(i,"im-page--history_empty-hist")?o:n;r.history=Math.max(o,s),r.chat=Math.max(l,s)}return r}function Wu(e,t,a,i,s,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=!1),!(0,p.isFullScreen)()){var l=Gu(e,t);if((0,h.setStyle)(e,{minHeight:l.page}),(0,_.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(n.initializeChatResize),(0,h.setStyle)(e,{height:t.get().isCreating?l.page:"auto"}),(0,h.setStyle)((0,h.geByClass1)("_im_page_dialogs",e),{minHeight:l.page}),(0,h.setStyle)((0,h.geByClass1)("_im_page_history",e),{minHeight:l.history,position:"relative",top:0}),(0,h.setStyle)((0,h.geByClass1)("_im_chat_body_abs",e),{minHeight:l.chat,height:l.chat,position:"relative",top:0})),J.browser.safari&&o&&"function"==typeof o&&o(),i&&i.updateScroll(),s&&s.updateScroll&&s.updateScroll(),a){var c=a.updateScroll();a.scrollFix(t,t.get().peer,c)}r&&setTimeout((()=>Wu(e,t,a,i,s,!1)),100)}}function Vu(e,t){e.get().resendAllOnOnline&&t()}function zu(){var e=document.querySelector(".im_page");!function(e){var t="safari-repaint";e.forEach((function(e){(0,h.hasClass)(e,t)&&(0,h.removeClass)(e,t),(0,h.addClass)(e,t)})),setTimeout((function(){e.forEach((function(e){(0,h.removeClass)(e,t)}))}),100)}([(0,h.geByClass1)("_im_dialog_actions",e),(0,h.geByClass1)("_im_chat_input_w",e),(0,h.ge)("side_bar"),(0,h.geByClass1)("_im_right_menu",e),(0,h.geByClass1)("_im_dialogs_footer",e),(0,h.geByClass1)("_im_dialogs_search",e)])}function Yu(e){var t,a,i,s=e.get();return(0,_.isLocksAvailable)(e)?(t=s.mutex_key,a=function(e){s.longpoll.push([W.mutexEvent(e)])},i=function(e,t){return(0,n.getMutexQueue)(s.gid).then((e=>e[0]))},Notifier.addKey(t,L_.bind(null,a,i,t)),C_.set(t,{onData:a,onUpdateKey:i,ts:t.ts}),T_(),{stop:M_.bind(null,t)}).stop:null}function $u(e,t){var a;(0,Vt.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog={});var i,s=t.get(),r=window.devicePixelRatio>=2?"_2x":"";(0,Uc.setFavIcon)("/images/icons/favicons/fav_im"+r+".ico"),Wu(e,t,!1,!1,!1,!0);var o=(0,v.createMutations)(qu),l=o.callMutations,c=o.bindMutations,g=s.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),m=g?Notifier.getLpInstance():t.get().gid?function(e){var t=new window.EventEmitter,a=n_(e.ts,(e=>{t.trigger("data",e)})),i=Zd(e,a.onLp);return{onData:e=>t.on("data",e),offData:e=>t.off("data",e),push:e=>t.trigger("data",e),pause:a.pause.bind(a),resume:a.resume.bind(a),abortWaiting:i.abortWaiting.bind(i),onLp:a.onLp.bind(a),stop:i.stopConnection.bind(i),isEnabled:()=>!(!i||i.isStopped())}}(s.lpConfig):v_(s);m.onData(y);var f=Notifier.getEventQueueInstance&&Notifier.getEventQueueInstance(),b=f?f.subscribe((e=>l().onQueueEvent(t,e))):()=>{};function y(){for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];l().onEvents(t,a)}var C=(0,h.geByClass1)("_im_dialogs_search",e),w=(0,h.geByClass1)("_im_dialogs_footer",e),E=Fc((0,h.geByClass1)("_im_page_dcontent",e),t,l,C);E.renderPeerTags(t);var S,M,L=Tl(C,t,l),I=w?jc(w,t,l):null,k=H_(t),P=function(e,t){return(0,(0,v.createMutations)(de).bindMutations)((0,v.createModule)({handlers:function(e,a){a(t,"click",ae,re),a(t,"mouseover",te,le),a(t,"mouseout",te,ce)}}),e)}(t,document.body);(cur.imDb=(0,In.mount)(t.get().gid?-t.get().gid:vk.id),cur.imDb.updateByKey("archives_folder_hidden",t.get().settings.archives_folder_hidden),t.set(n.preloadSearchIndex.bind(null,cur.imDb)),function(e){return Mu.apply(this,arguments)}(t).then((e=>{e&&l().makeArchiveVisible(t)})),(0,_.isClassicInterface)(t))&&(S=F_((0,h.geByClass1)("_im_ui_peers_list",e.parentNode),t),M=function(e,t,a,i){if(J.browser.mobile)return!1;var n=[t,a,(0,h.geByClass1)("_im_chat_input_w",i),(0,h.geByClass1)("_im_dialog_actions",i)],s=null,r=(0,h.hasClass)(e,"im-page--header_static"),o=(0,h.ge)("im-group-online-disabled-notice");function l(){var t=(0,T.getNativeOption)("scrollLeft"),a=(0,h.hasClass)(e,"im-page--header_static"),i=[];s!==t?i=n.slice().concat([e]):a!==r&&(i=[e]),s=t,r=a,i.length>0&&i.forEach((i=>{var n=e===i&&a?0:-t;(0,h.setStyle)(i,{[cssTransformProp]:0===n?"unset":"translateX("+n+"px)"})}))}return o&&n.push(o),n=n.concat((0,h.geByClass)("_im_aside_notice"),(0,h.geByClass)("_im_aside_promo_block")),(0,d.addEvent)(window,"scroll",l),l(),()=>{(0,d.removeEvent)(window,"scroll",l)}}(C,w,(0,h.geByClass1)("_im_right_menu",e.parentNode),e));(0,_.isClassicInterface)(t)&&s.peer&&E.deactivate(),s.gid||(i=xd((0,h.geByClass1)("_im_dialogs_creation",e),t,l));var A=Rr((0,h.geByClass1)("_im_page_history",e),t,E,S,l),B=s.isCreating,x=B?"create":0===s.peer?"search":"default";B&&i.show(t,[]);var D=Od(t,x,E,A,L,i),R=Y_(t,D);A.renderPeerProfile(t),A.updateScroll();var O=Ku.bind(null,l,t,D);s.peer&&t.set(n.prepareCasperMessagesFromMessages.bind(null,s.peer)),(0,_.isReservedPeer)(s.peer)||setTimeout((()=>Eu(t,A)),10);var N=new nu({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"}),F=(0,ee.debounce)(zu,300),U=Wu.bind(null,e,t,A,E,i,!1,F),H=Vu.bind(null,t,A.resendAll);t.setState({longpoll:m}),t.set(n.setExecStack.bind(null,[])),N.on("unidle",(function(){var e;null==(e=l())||e.actualizeArchiveVisibilityOnUnidle(t),m.abortWaiting(),O()})),N.start(),nav.objLoc.box&&(Cu(t,nav.objLoc.box),(0,Ln.updateLocation)({box:null})),nav.objLoc.mr&&(0,_.isChatPeer)(Number(nav.objLoc.mr))&&(0,_.showChatInvitationBox)(t,nav.objLoc.mr,l,E),(null==(a=window.nav.objLoc)?void 0:a.openSettings)&&(L.openSettings(),(0,Ln.updateLocation)({openSettings:null}));var j,q=Yu(t);if((0,_.isLocksAvailable)(t)&&(j=setInterval(_.blockLatencyCompensation.bind(null,t,s.longpoll),2e3)),t.get().invitation&&(0,_.showInvitationBox)(t,t.get().invitation,n.leaveInvitation),(0,_.isClassicInterface)(t)&&(0,u.existsIncomingMessageRequest)(t)){var K=document.getElementById("ui_rmenu_mr");K&&K.classList.remove("unshown")}var G=(0,p.throttleAccumulate)(yu.bind(null,t,A,E,S),200),W=_.hideTopNotice.bind(null,t),V=_.hideAsideNotice.bind(null,t);cu.casperMessagesStore.subscribe((e=>function(e,t,a,i,n){var s=n.type,r=n.message;switch(s){case cu.EXPIRING:return t.updateCasperMessageStatus(r);case cu.EXPIRING_SOON:return t.updateCasperMessageStatus(r,!0);case cu.EXPIRED:(0,u.isCasperChat)(e,r.peerId)?i(r):(t.handleMessageExpiration(r),a.updateDialog(r.peerId,e))}}(t,A,E,G,e))),cu.casperMessagesStore.setTimeshift(s.timeshift);var z=e=>{var a=e.target.closest("._im_new_ui_banner");a&&(a.hidden=!0,(0,Aa.toggleHideFolderNoticeHandler)(t.get(),"new_ui_banner",1))};return t.set($n.updateConvoRecommendationList).then((e=>{(0,_e.isRecommendationListRerenderNeeded)(e)&&E.updateRecommendationList(e)})),(0,Ce.initWidgets)(e),c((0,v.createModule)({handlers:(a,i)=>{a(document,"mousemove mousedown keypress",O),a(window,"resize",U),a(window,"online",H),i(e,"click",_.HIDE_TOP_NOTICE_CLASS,W),i((0,h.gpeByClass)("_im-page-wrap",e),"click",_.HIDE_ASIDE_NOTICE_CLASS,V),i((0,h.gpeByClass)("_im-page-wrap",e),"click",_.HIDE_ASIDE_PROMO_BLOCK_CLASS,_.hideAsidePromoBlock),i((0,h.gpeByClass)("_im-page-wrap",e),"click",_.INSTALL_VKADMIN_LINK,_.installVKAdminApp),(0,_.isClassicInterface)(t)&&(0,Vt.partConfigEnabled)("mail_new_ui_banner")&&!(0,_.isCommunityInterface)(t)&&i((0,h.gpeByClass)("_im-page-wrap",e),"click","_im_new_ui_banner_close",z),J.browser.safari&&a(document,"visibilitychange",zu)}}),E,A,L,e,N,m,G,l,i,I,t,D,q,j,S,M,k,R,U,(function(){g?m.offData(y):m.stop()}),b,P)}var Zu,Qu;function Xu(e){var t=(0,h.ge)("page_header"),a=(0,h.clientHeight)()-t.offsetHeight-30-2;(0,h.setStyle)(e,{height:Math.max(a,400)})}function Ju(e){var t=(0,_.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?(0,o.getLang)("mail_sick_timer").replace(/{timer}/gi,t):""}function eg(){nav.reload({force:!0})}function tg(e){return{unmount(){clearInterval(Qu),clearTimeout(Zu),(0,v.destroyModule)(e)}}}function ag(e,t,a){Xu(e);var i,n,s=(0,(0,v.createMutations)(tg).bindMutations)((0,v.createModule)({handlers:(t,a)=>{t(e.querySelector("._im_sick_reload"),"click",eg),t(window,"resize",Xu.bind(null,e))}})),r=(i=localStorage.getItem("im_sick_timer"),n=i?Math.min(2*parseInt(i),6e5):5e3,localStorage.setItem("im_sick_timer",n),n),o=e.querySelector("._im_sick_timer"),l=+new Date;return o.innerHTML=Ju(r),Qu=setInterval((()=>{o.innerHTML=Ju(l+r-new Date)}),500),Zu=setTimeout(eg,r),s}var ig=a(20797),ng=a.n(ig),sg=a(97109);window.IM={init:function(e){var t;if((0,c.addTemplates)(ng()),window.cur.lang.dont_attach=(0,o.getLang)("mail_dont_add_media"),e.failed)return ag((0,h.geByClass1)("im-sick",(0,h.ge)("page_body")));localStorage.removeItem("im_sick_timer"),window.cur.ctrl_submit=Boolean(e.settings.ctrl_submit),window.cur.module="im",window.cur.mutedPeers=e.mutedPeers,window.cur.gid=e.gid,window.cur.peer=e.peer,window.cur.options={blacklist_hash:e.thash};var a=-10800-60*(new Date).getTimezoneOffset(),s=e.timeshift,r=(0,i.__assign)((0,i.__assign)({},e),{owners:void 0,tabbedPeers:(e.tabbedPeersArray||[]).map((function(e){return{peer:e,type:"perm"}})),blockedFlagUpdates:{},msgid:(0,c.intval)(window.nav.objLoc.msgid),timeshift:s-a,oCache:{},ref_id:window.nav.objLoc.ref,ref_source:window.nav.objLoc.ref_source,topConvTree:new Promise((function(){})),hintsTree:new Promise((function(){})),imTopConvList:new Promise((function(){})),callbackEventButtons:new Map}),d=(0,S.default)(r);null===(t=e.owners)||void 0===t||t.forEach((function(e){return(0,z.oCacheAdd)(d,e)})),(0,_.normalizeTabsGotFromServer)(d,d.get().tabs),window.cur.imClassicInterface=(0,_.isClassicInterface)(d);var u=$u((0,h.geByClass1)("js-im-page",(0,h.ge)("page_body")),d);(0,n.updateMentions)(d.get()),e.group_calls_feature_tt_hash&&(0,_.showGroupCallsOnboardingBox)(d.get(),e.group_calls_feature_tt_hash),e.group_calls_new_year_feature_tt_hash&&(0,_.showGroupCallsNewYearTooltip)(d.get(),e.group_calls_new_year_feature_tt_hash),window.IMBRIDGE={chatPhotoSaved:function(e){(0,l.curBox)()&&(0,l.curBox)().hide();var t=(e||{})[1];return t?(window.cur.pvShown&&window.layers.fullhide(!0,!0),"im"!=window.cur.module||d.get().peer!=t?window.nav.go("/im?sel=c"+(t-2e9)):void 0):window.nav.reload()},syncHistory:function(){d.set((function(e){return(0,n.syncHistory)(e)})).then((function(){}),(function(){}))},activateTab:function(e,t){void 0===t&&(t="notifications"),d.get().gid||d.get().longpoll.push([(0,f.changePeer)((0,c.intval)(e),!1,!1,!0,t)])},selectedPeer:function(){return d.get().peer},openSettings:function(){u.openSettings()}},(0,Vt.partConfigEnabled)("debug_messenger")&&(window.IMBRIDGE.store=d);var g=!1;window.cur.nav.push((function(){var e;return!!g||((null===(e=d.get().audio_msg)||void 0===e?void 0:e.isRecording)&&u.cancelRecording(),window.AudioMessagePlayer.detachPlayer(),u.route.apply(null,arguments))})),(0,sg.pushNavDestroy)((function(){if(g)return!0;u.unmount(),window.IMBRIDGE=void 0,d.unmount(),window.store=void 0,g=!0,e=!1,d=!1,u=!1}))}};try{window.stManager.done("imn.js")}catch(e){}},69413:(e,t,a)=>{"use strict";function i(){return document.body.classList.contains("redesign_web")}a.d(t,{isRedesign:()=>i})}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(a.exports,a,a.exports,__webpack_require__),a.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,a,i)=>{if(!t){var n=1/0;for(l=0;l<deferred.length;l++){for(var[t,a,i]=deferred[l],s=!0,r=0;r<t.length;r++)(!1&i||n>=i)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[r])))?t.splice(r--,1):(s=!1,i<n&&(n=i));if(s){deferred.splice(l--,1);var o=a();void 0!==o&&(e=o)}}return e}i=i||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>i;l--)deferred[l]=deferred[l-1];deferred[l]=[t,a,i]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var a=Object.create(null);__webpack_require__.r(a);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var n=2&t&&e;"object"==typeof n&&!~leafPrototypes.indexOf(n);n=getProto(n))Object.getOwnPropertyNames(n).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,__webpack_require__.d(a,i),a},__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,a)=>(__webpack_require__.f[a](e,t),t)),[])),__webpack_require__.u=e=>64178===e?"SilentModeEnabledForm.f3520eb8d8b20c850715.js":29019===e?"ReportForm.2324db14455e00955ab6.js":89855===e?"marusia-sdk.58617a3881e0327d7ad1.js":55489===e?"lottie-light.e5656d3d22706dbf6fb1.js":26156===e?e+".7dcd5779771087783d6a.js":93417===e?"758783f2384baa77b901b7efcc9e55b5.3ca812b474740638d292.js":38838===e?"85b9c7e85448bb5ce051c14fabb418ee.9283a26d5c4849742701.js":void 0,__webpack_require__.miniCssF=e=>e+"."+{29019:"1b35412d5731f898e75f",64178:"3803626961e0b8881faa",89855:"68776436162c5ed40276"}[e]+".css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,a,i)=>{if(inProgress[e])inProgress[e].push(t);else{var n,s;if(void 0!==a)for(var r=document.getElementsByTagName("script"),o=0;o<r.length;o++){var l=r[o];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+a){n=l;break}}n||(s=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,__webpack_require__.nc&&n.setAttribute("nonce",__webpack_require__.nc),n.setAttribute("data-webpack","vk:"+a),n.src=e),inProgress[e]=[t];var c=(t,a)=>{n.onerror=n.onload=null,clearTimeout(d);var i=inProgress[e];if(delete inProgress[e],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach((e=>e(a))),t)return t(a)},d=setTimeout(c.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=c.bind(null,n.onerror),n.onload=c.bind(null,n.onload),s&&document.head.appendChild(n)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,a)=>{var i=__webpack_require__.miniCssF(e),n=__webpack_require__.p+i;if(((e,t)=>{for(var a=document.getElementsByTagName("link"),i=0;i<a.length;i++){var n=(r=a[i]).getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(n===e||n===t))return r}var s=document.getElementsByTagName("style");for(i=0;i<s.length;i++){var r;if((n=(r=s[i]).getAttribute("data-href"))===e||n===t)return r}})(i,n))return t();((e,t,a,i)=>{var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onerror=n.onload=s=>{if(n.onerror=n.onload=null,"load"===s.type)a();else{var r=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=r,l.request=o,n.parentNode.removeChild(n),i(l)}},n.href=t,document.head.appendChild(n)})(e,n,t,a)})),installedCssChunks={655:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{29019:1,64178:1,89855:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={655:0};__webpack_require__.f.j=(t,a)=>{var i=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==i)if(i)a.push(i[2]);else{var n=new Promise(((a,n)=>i=e[t]=[a,n]));a.push(i[2]=n);var s=__webpack_require__.p+__webpack_require__.u(t),r=new Error;__webpack_require__.l(s,(a=>{if(__webpack_require__.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var n=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.src;r.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",r.name="ChunkLoadError",r.type=n,r.request=s,i[1](r)}}),"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,a)=>{var i,n,[s,r,o]=a,l=0;for(i in r)__webpack_require__.o(r,i)&&(__webpack_require__.m[i]=r[i]);if(o)var c=o(__webpack_require__);for(t&&t(a);l<s.length;l++)n=s[l],__webpack_require__.o(e,n)&&e[n]&&e[n][0](),e[s[l]]=0;return __webpack_require__.O(c)},a=self.webpackChunkvk=self.webpackChunkvk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var __webpack_exports__=__webpack_require__.O(void 0,[76429,75514,24509,40885,56990,38288,68592,66868,30892,90729,79542,25077,87595,23299,43639,43087,56058,5360],(()=>__webpack_require__(11279)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();