(self.webpackChunkvk=self.webpackChunkvk||[]).push([[68069],{95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},57450:(e,n,t)=>{"use strict";t.d(n,{IconSettingsContext:()=>i});var a=t(67294);var i=a.createContext({})},91750:(e,n,t)=>{"use strict";t.d(n,{makeIcon:()=>f});var a=t(67294),i=t(87854),o=t.n(i),r=t(57450),s=t(3389);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(){return c=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},c.apply(this,arguments)}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){l(e,n,t[n])}))}return e}function u(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function _(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var v={display:"block"};var p=function(e){var n=e.width,t=e.height,i=e.viewBox,o=e.id,s=e.className,l=void 0===s?"":s,p=e.style,f=void 0===p?{}:p,h=e.fill,A=e.getRootRef,g=e.Component,m=void 0===g?"div":g,C=e.role,E=e["aria-label"],S=e["aria-hidden"],I=_(e,["width","height","viewBox","id","className","style","fill","getRootRef","Component","role","aria-label","aria-hidden"]),T=Math.max(n,t),N=a.useContext(r.IconSettingsContext),x=function(e,n){for(var t=n.classPrefix,a=n.globalClasses,i="",o=0;o<e.length;o++)t&&(i+=" "+(t+e[o])),t&&!a||(i+=" "+e[o]);return i}(["Icon","Icon--".concat(T),"Icon--w-".concat(n),"Icon--h-".concat(t),"Icon--".concat(o)],N);return a.createElement(m,c({role:"presentation"},I,{ref:A,className:"".concat(x," ").concat(l),style:u(d({},f),{width:n,height:t})}),a.createElement("svg",{viewBox:i,width:n,height:t,style:v,role:C,"aria-label":E,"aria-hidden":S},a.createElement("use",{xlinkHref:"#".concat(o),style:{fill:"currentColor",color:h}})))};function f(e,n,t,i,r,l){var d=!1;function u(){d||((0,s.addSpriteSymbol)(new(o())({id:n,viewBox:t,content:i})),d=!0)}var _=function(e){return(0,s.useIsomorphicLayoutEffect)(u,[]),a.createElement(p,c({},e,{viewBox:t,id:n,width:isNaN(e.width)?r:+e.width,height:isNaN(e.height)?l:+e.height}))};return _.mountIcon=u,_.displayName=e,_}},3389:(e,n,t)=>{"use strict";t.d(n,{addSpriteSymbol:()=>d,useIsomorphicLayoutEffect:()=>u});var a,i=t(62548),o=t.n(i),r=t(67294),s=!("undefined"==typeof window||!window.document||!window.document.createElement);if(s){var l="__SVG_SPRITE_NODE__";a=new(o())({attrs:{id:l}});var c=function(){var e=document.getElementById(l);e?a.attach(e):a.mount(),document.removeEventListener("DOMContentLoaded",c)};document.querySelector("body")?c():document.addEventListener("DOMContentLoaded",c)}else a=null;function d(e){a&&a.add(e)}var u=s?r.useLayoutEffect:r.useEffect},47934:(e,n,t)=>{"use strict";t.d(n,{default:()=>a});const a=(0,t(63192).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="add_20"><path clip-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v6.499h6.499a.75.75 0 0 1 0 1.5H10.75v6.499a.75.75 0 0 1-1.5 0v-6.5H2.751a.75.75 0 0 1 0-1.5H9.25V2.75A.75.75 0 0 1 10 2z" fill="currentColor" fill-rule="evenodd" /></symbol>',20,20,!1,void 0)},11099:(e,n,t)=>{"use strict";var a=t(95318);n.classNames=function(){for(var e=[],n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return t.forEach((function(n){if(n)switch((0,i.default)(n)){case"string":e.push(n);break;case"object":Object.keys(n).forEach((function(t){n[t]&&e.push(t)}));break;default:e.push("".concat(n))}})),e.join(" ")};var i=a(t(50008))},37441:(e,n,t)=>{"use strict";t.d(n,{ENavigateToConvoDirection:()=>a,isFastChatMounted:()=>s,useBoxLayerObserver:()=>c,useNavGoListener:()=>l});var a,i=t(70655),o=t(67294),r=function(){var e;return!(!(null===(e=window.reforgedME)||void 0===e?void 0:e.selectPeer)||!document.querySelector(".FCApp"))},s=function(){return e=window.location,n=e.host,t=e.pathname,!/calls\.vk\.(com|ru)/.test(n)&&!t.startsWith("/calls-standalone")&&r();var e,n,t};!function(e){e[e.Messenger=0]="Messenger",e[e.FastChat=1]="FastChat"}(a||(a={}));var l=function(e,n){(0,o.useEffect)((function(){if(!n&&r()){var t=function(e){function n(n,t,a,i){return e(n,t,a,i),!0}function t(){var e,n;return null===(n=null===(e=window.nav)||void 0===e?void 0:e.subscribeOnModuleEvaluated)||void 0===n||n.call(e,a),!0}function a(){var e,a,i,o,r,s;null===(i=null===(a=null===(e=window.cur)||void 0===e?void 0:e.nav)||void 0===a?void 0:a.push)||void 0===i||i.call(a,n),null===(s=null===(r=null===(o=window.cur)||void 0===o?void 0:o.destroy)||void 0===r?void 0:r.push)||void 0===s||s.call(r,t)}return{init:a,destroy:function(){var e,i,o,r,s,l;null===(i=null===(e=window.nav)||void 0===e?void 0:e.unsubscribeOnModuleEvaluated)||void 0===i||i.call(e,a),(null===(o=window.cur)||void 0===o?void 0:o.nav)&&Array.isArray(null===(r=window.cur)||void 0===r?void 0:r.nav)&&(window.cur.nav=window.cur.nav.filter((function(e){return e!==n}))),(null===(s=window.cur)||void 0===s?void 0:s.destroy)&&Array.isArray(null===(l=window.cur)||void 0===l?void 0:l.destroy)&&(window.cur.destroy=window.cur.destroy.filter((function(e){return e!==t})))}}}(e);return t.init(),function(){t.destroy()}}}),[e,n])},c=function(e,n){(0,o.useEffect)((function(){if(!n&&r()&&window.hasOwnProperty("MutationObserver")&&window.hasOwnProperty("boxLayer")){var t=new MutationObserver((function(n){var t,a,o=!1;try{for(var r=(0,i.__values)(n),s=r.next();!s.done;s=r.next()){var l=s.value;if("childList"===l.type)l.addedNodes.length&&(e(),o=!0);if(o)break}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}}));return t.observe(window.boxLayer,{childList:!0}),function(){t.disconnect()}}}),[e,n])}},7384:(e,n,t)=>{"use strict";t.d(n,{init:()=>Zu});var a,i=t(70655),o=t(85893),r=t(73935),s=t(59397),l=t(67294),c=t(35886),d=t(73674),u=function(){return(0,c.useDispatch)()};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(a||(a={}));var _=(0,l.forwardRef)((function(e,n){var t=e.icon,r=e.text,l=e.type,c=e.className,d=(0,i.__rest)(e,["icon","text","type","className"]),u=(0,s.classNames)("CallButton","CallButton--"+l,c,{"CallButton--withText":!!r},"CallButton--withAnimation"),_=(0,s.classNames)("CallButton__icon","CallButton__icon--withAnimation"),v=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsxs)("button",(0,i.__assign)({className:u},v,{disabled:l===a.DISABLED,ref:n},{children:[(0,o.jsx)("figure",(0,i.__assign)({className:_},{children:t}),void 0),r]}),void 0)})),v=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"},void 0)}),void 0)},p=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"},void 0)}),void 0)},f=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"},void 0)}),void 0)},h=function(e){var n=e.id,t=e.className,a=e.children,r=(0,l.useMemo)((function(){return"radial-gradient(circle, rgb("+(48+Math.abs(n)%3*4)+","+(48+Math.abs(n)%4*5)+","+(52+Math.abs(n)%5*6)+") 40%, #0a0a0a 100%)"}),[]),c=(0,s.classNames)("BlurredBackground",t);return(0,o.jsx)("div",(0,i.__assign)({className:c,style:{background:r}},{children:a}),void 0)},A=t(3065);function g(e){var n=e.title,t=e.description,a=e.className;return(0,o.jsxs)("header",(0,i.__assign)({className:(0,s.classNames)("IncomingCallHeader",a)},{children:[(0,o.jsx)("h1",(0,i.__assign)({className:"IncomingCallHeader__title"},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"IncomingCallHeader__description"},{children:t}),void 0)]}),void 0)}var m=(0,l.forwardRef)((function(e,n){var t,a=e.type,r=e.isActive,l=e.icon,c=e.className,d=(0,i.__rest)(e,["type","isActive","icon","className"]),u=(0,s.classNames)("CallIconButton",c,"CallIconButton--withAnimation",((t={"CallIconButton--active":r})["CallIconButton--"+a]=!!a,t)),_=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsx)("button",(0,i.__assign)({},_,{className:u,ref:n},{children:l}),void 0)})),C=t(97404),E=t(71192);function S(e){var n=e.id,t=e.photo,a=e.title,r=e.description,s=e.onCollapseCall,c=e.children,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("section",(0,i.__assign)({className:"IncomingCall"},{children:[(0,o.jsx)(h,{id:n},void 0),(0,o.jsx)(C.default,(0,i.__assign)({position:"b",text:d("calls_collapse"),marginTop:-6},{children:(0,o.jsx)(m,{type:"collapse",className:"IncomingCall__collapse",onClick:s},void 0)}),void 0),(0,o.jsx)(g,{title:a,description:r},void 0),(0,o.jsx)(A.CallPhoto,{id:n,waves:!0,photo:t,alt:a||"",className:"IncomingCall__photo"},void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"IncomingCall__footer"},{children:c}),void 0)]}),void 0)}var I=t(30365),T=function(){function e(e,n,t){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=t||function(){},this.prepareFunc=n||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),n=this.iterCur;n<e;n++){var t=this.list[n];try{t._order=n}catch(e){}this.add(t)}this.iterCur=n,n>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var n,t={},a=(n=e,n.replace(/&#(\d\d+);/g,(function(e,n){return(n=!0===(t=n)?1:parseInt(t)||0)>=32?String.fromCharCode(n):e;var t})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),i=a.length;i--;){var o=a[i],r="";if(o){for(var s=0;s<6;s++){var l=o.charCodeAt(s);if(l){var c=this.toTranslit[l],d=o.substr(s,1);r+=null!=c?c:d}}t[r]=1}}return t},e.prototype.strToSearchPrefixes=function(e){for(var n=[],t=e.toLowerCase().split(this.delimiter),a=t.length;a--;){var i={},o=t[a],r="",s="",l="",c=o.length>1;if(o){for(var d=0;d<6;d++){var u=o.charCodeAt(d);if(u){var _=this.toTranslit[u],v=o.substr(d,1);if(r+=null!=_?_:v,c){var p=this.toLocalCase[v],f=this.toLocalTranslit[u];s+=null!=p?p:v,l+=null!=f?f:v}}}i[r]=1,c&&(i[s]=2,i[l]=3),n.push(i)}}return n},e.prototype.toIndexTree=function(e,n){for(var t=this.index,a=0;a<6;a++){var i=e.substr(a,1)||-1;t=t[i]?t[i]:t[i]=5==a?[]:{}}t.push(n)},e.prototype.remove=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)if(t.hasOwnProperty(a)){for(var i=this.index,o=0;o<6;o++){var r=a.substr(o,1)||-1;if(!i[r])break;i=i[r]}if(i.length)for(var o in i)if(this.equals(i[o],e)){i.splice(o,1);break}}},e.prototype.equals=function(e,n){for(var t in e)if(e.hasOwnProperty(t))switch(typeof e[t]){case"object":if(!this.equals(e[t],n[t]))return!1;break;case"function":if(void 0===e[t]||e[t].toString()!=n[t].toString())return!1;break;default:if(e[t]!=n[t])return!1}for(var t in n)if(void 0===n[t])return!1;return!0},e.prototype.intersect=function(e,n){var t=[];if(N(e[0])||N(n[0]))return e.filter((function(e){return-1!==n.indexOf(e)}));for(;e.length>0&&n.length>0;)if(e[0]._order<n[0]._order)e.shift();else if(e[0]._order>n[0]._order)n.shift();else{if(this.equals(e[0],n[0])){var a=e.shift();a&&t.push(a)}n.shift()}return t},e.prototype.add=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)t.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var n=this.index,t=this.strToSearchPrefixes(e),a=[],i=!1;for(var o in t)if(t.hasOwnProperty(o)){if(i&&!a)break;var r=this.localSearch(t[o],0,n);r.sort((function(e,n){return e._order-n._order})),a=i?this.intersect(a,r):r,i=!0}for(var s=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=s&&(c.push(s),s=u)}return c},e.prototype.localSearch=function(e,n,t){if(!t)return[];var a={};for(var i in e)e.hasOwnProperty(i)&&(a[r=i.substr(n,1)||-1]||(a[r]={}),a[r][i]=1);if(6==n++)return t;var o=[];for(var r in a)if("-1"===r)for(var s in t)t.hasOwnProperty(s)&&o.push.apply(o,this.localSearch(a[r],n,t[s]));else{var l=this.localSearch(a[r],n,t[r]);o.push.apply(o,l)}return o},e}();function N(e){return!isNaN(e)}var x=function(e,n,t){var a=(0,l.useRef)(null);a.current=a.current?a.current:new T(e,n);var o=a.current,r=(0,l.useCallback)((function(e){return e.reduce((function(e,n){return e[t(n)]=!0,e}),{})}),[]),s=(0,i.__read)((0,l.useState)(e),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(r(e)),2),_=u[0],v=u[1];return(0,l.useEffect)((function(){var n=r(e),a=e.filter((function(e){return!_[t(e)]})),i=c.filter((function(e){return!n[t(e)]}));(a.length||i.length)&&(a.forEach((function(e){o.add(e)})),i.forEach((function(e){o.remove(e)})),d(e),v(n))}),[e]),o};var y=t(10930),b=function(e){var n=e.onClose,t=e.onBackdropClick,a=e.isIncoming,r=void 0!==a&&a,c=e.isCautionBoxShown,_=void 0!==c&&c,v=e.children,p=u(),f=(0,l.useContext)(y.ConfigContext).withAnimation,h=(0,s.classNames)("CallModal",{"CallModal--withAnimation":f,"CallModal--isIncoming":r});(0,l.useEffect)((function(){return document.body.classList.add("layers_shown"),function(){document.body.classList.remove("layers_shown")}}),[]);var A=(0,l.useCallback)((function(){return _?void p({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:r||!1}):n()}),[_]);return(0,o.jsx)(I.default,(0,i.__assign)({className:h,disableBodyScroll:!0,onClose:A,onBackdropClick:t},{children:v}),void 0)},O=t(67921),w=t(73294);function M(e){var n=e.SDK,t=e.bridge,r=(0,c.useSelector)((function(e){return e})),s=r.peer,h=r.callData,A=r.participants,g=r.caller,m=u(),C=(0,l.useContext)(E.LangContext).getLang,I=g;I||(I=(0,O.isGroupCallByPeer)(s)?h.conversation:A[s]);var T=h.type===d.CallType.VIDEO,N=C(T?"calls_incoming_videocall":"calls_incoming_audiocall"),x=C(T?"calls_reply_with_audio":"calls_reply"),y=C(T?"calls_reject_call":"calls_reject"),M=function(){n.declineCall(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:h.callId,peer_id:s,is_group_call:(0,O.isGroupCallByPeer)(s),reason:"none"})};return(0,o.jsx)(b,(0,i.__assign)({onClose:M,isIncoming:!0,isCautionBoxShown:!0},{children:(0,o.jsx)(S,(0,i.__assign)({id:s,title:(null==I?void 0:I.tab)||"",description:N,photo:(null==I?void 0:I.photo)||"",onCollapseCall:function(){m({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED})}},{children:(0,o.jsxs)(o.Fragment,{children:[T&&(0,o.jsx)(_,{text:C("calls_reply_with_video"),type:a.POSITIVE,icon:(0,o.jsx)(v,{},void 0),onClick:function(){return t.acceptCall(!0,!0)}},void 0),(0,o.jsx)(_,{text:x,type:T?a.REGULAR:a.POSITIVE,icon:(0,o.jsx)(p,{},void 0),onClick:function(){return t.acceptCall(!1,!0)}},void 0),(0,o.jsx)(_,{text:y,type:a.NEGATIVE,icon:(0,o.jsx)(f,{},void 0),onClick:M},void 0)]},void 0)}),void 0)}),void 0)}var P=c.useSelector,k=t(15464);function L(){var e=P((0,l.useCallback)((function(e){return e.devices}),[])),n=P((0,l.useCallback)((function(e){return e.participantsChunk}),[]));return(0,l.useMemo)(k.getActiveDevicesCount,[e,n])}function D(e,n){return"/video"+e+"_"+n}function j(e){var n=document.createElement("video"),t=function(){n.classList.add("Video--visible"),n.removeEventListener("loadeddata",t)};return n.addEventListener("loadeddata",t),n.autoplay=!0,n.controls=!1,n.crossOrigin="anonymous",n.playsInline=!0,n.preload="metadata",n.srcObject=e,n.volume=0,n}var R=new WeakMap,B=(0,l.memo)((function(e){var n=e.stream,t=e.participantId,a=e.isMirrored,i=void 0!==a&&a,r=e.isContained,c=void 0!==r&&r,d=e.isStartWithVisible,u=void 0!==d&&d,_=e.isLocalSchreenShare,v=void 0!==_&&_,p=e.className,f=(0,l.useRef)(null),h=(0,l.useRef)(null),A=(0,l.useRef)(n);return(0,l.useEffect)((function(){var e,a,o,r;if(!(null===(e=f.current)||void 0===e?void 0:e.lastElementChild)||A.current!==n){var l=u;if(n&&(R.has(n)?null===(null===(a=R.get(n))||void 0===a?void 0:a.closest("body"))?(h.current=null!==(o=R.get(n))&&void 0!==o?o:null,l=!0):(h.current=j(n),h.current.dataset.participantId=t):(h.current=j(n),h.current.dataset.participantId=t,R.set(n,h.current))),h.current&&h.current.dataset.participantId!==t){var d=h.current;d.dataset.participantId=t,d.srcObject=null,d.srcObject=n;var _=function(){d.classList.add("Video--visible"),d.removeEventListener("loadeddata",_)};d.addEventListener("loadeddata",_),l=!1,d.classList.remove("Video--visible")}if(h.current&&f.current&&f.current.lastElementChild!==h.current){var p=(0,s.classNames)("Video",{"Video--contain":c,"Video--mirrored":i,"Video--visible":l||(null===(r=h.current)||void 0===r?void 0:r.classList.contains("Video--visible"))});f.current.lastElementChild&&(f.current.innerHTML=""),h.current.className=p,f.current.appendChild(h.current),h.current.play()}var g=function(){if(!v)return function(){return null};var e=n.getVideoTracks()[0],t=function(){h.current&&(h.current.srcObject=h.current.srcObject)};return null==e||e.addEventListener("mute",t),function(){return null==e?void 0:e.removeEventListener("mute",t)}}();return function(){g(),h.current&&h.current!==R.get(n)&&(h.current.srcObject=null,h.current.src="",h.current.pause(),h.current.removeAttribute("src"),h.current.load()),f.current&&(f.current.innerHTML="")}}}),[n,f.current,t]),(0,l.useEffect)((function(){h.current&&h.current.classList.toggle("Video--mirrored",i)}),[i]),(0,o.jsx)("div",{ref:f,className:p},void 0)})),U=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},n,{children:(0,o.jsx)("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"},void 0)}),void 0)},H=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"},void 0)}),void 0)},G=t(4495),V=t(13984),F=t(70226),W=function(e){var n=e.item,t=e.setOpen,a=n.disabled,r=void 0!==a&&a,l=(0,s.classNames)("CallsDropdown__button",{"CallsDropdown__button--disabled":r});return"href"in n?(0,o.jsx)("a",(0,i.__assign)({href:n.href,rel:"noopener noreferrer",target:"_blank",onClick:r?void 0:function(e){e.stopPropagation(),"onClick"in n&&void 0!==n.onClick&&n.onClick(e),t(!1)},className:l},{children:n.text}),void 0):"onClick"in n?(0,o.jsxs)("button",(0,i.__assign)({onClick:r?void 0:function(e){e.stopPropagation(),n.onClick(e),t(!1)},className:l},{children:[(0,o.jsx)(V.default,(0,i.__assign)({className:"CallsDropdown__row-title"},{children:String(n.text)}),void 0),void 0!==n.isEnabled&&(0,o.jsx)(F.default,{className:"CallsDropdown__switch",checked:n.isEnabled},void 0)]}),void 0):null},Z=function(e){var n=e.isListEdge;return(0,o.jsx)("div",{className:(0,s.classNames)({CallsDropdown__separator:!n})},void 0)},z=function(e){var n=e.children,t=e.items,a=e.open,r=void 0!==a&&a,c=e.setOpen,d=e.placement,u=e.className;return(0,o.jsx)(G.Dropdown,(0,i.__assign)({placement:d,onShownChange:c,content:(0,o.jsx)("ul",(0,i.__assign)({className:(0,s.classNames)("CallsDropdown",u)},{children:t.map((function(e,n,t){return(0,o.jsx)("li",(0,i.__assign)({className:"CallsDropdown__item"},{children:"separator"in e?(0,o.jsx)(Z,{isListEdge:!n||t.length-1===n},void 0):(0,o.jsx)(W,{item:e,setOpen:c},void 0)}),e.key||n)}))}),void 0),shown:r},{children:(0,l.cloneElement)(n,(0,i.__assign)((0,i.__assign)({},n.props),{"data-active":r}))}),void 0)},K=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"25",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M10 8a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"},void 0),(0,o.jsx)("path",{d:"M6.558 10a.024.024 0 00-.017.04l3.254 3.255-2.947 2.948a1 1 0 001.414 1.414l2.948-2.948 3.25 3.25c.015.015.04.005.04-.017v-2.114c0-1.81.72-3.547 2-4.828l1.658-.414a.2.2 0 00.093-.336l-4-4a.2.2 0 00-.336.093L13.5 8a6.828 6.828 0 01-4.829 2H6.558z"},void 0)]}),void 0)},Q=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"56",height:"56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("path",{d:"M28.5 37.5A1.5 1.5 0 0030 36V22.622l4.94 4.939a1.5 1.5 0 002.007.103l.114-.103a1.5 1.5 0 000-2.122l-7.5-7.5a1.5 1.5 0 00-2.122 0l-7.5 7.5a1.5 1.5 0 002.122 2.122l4.938-4.939L27 36a1.5 1.5 0 001.355 1.493l.145.007z"},void 0),(0,o.jsx)("path",{d:"M19.883 8c-5.019 0-7.117.465-9.244 1.603a10.924 10.924 0 00-4.536 4.536C4.965 16.266 4.5 18.364 4.5 23.383v9.234c0 5.019.465 7.117 1.603 9.244a10.924 10.924 0 004.536 4.536C12.766 47.535 14.864 48 19.883 48h17.234c5.019 0 7.117-.465 9.244-1.603a10.924 10.924 0 004.536-4.536c1.138-2.127 1.603-4.225 1.603-9.244v-9.234c0-5.019-.465-7.117-1.603-9.244a10.924 10.924 0 00-4.536-4.536C44.234 8.465 42.136 8 37.117 8H19.883zm-7.83 4.248c1.486-.794 3-1.248 7.83-1.248h17.234c4.83 0 6.344.454 7.83 1.248a7.925 7.925 0 013.305 3.306c.794 1.485 1.248 3 1.248 7.83v9.233c0 4.83-.454 6.344-1.248 7.83a7.925 7.925 0 01-3.306 3.305c-1.485.794-3 1.248-7.83 1.248H19.884c-4.83 0-6.344-.454-7.83-1.248a7.925 7.925 0 01-3.305-3.306c-.794-1.485-1.248-3-1.248-7.83v-9.233c0-4.83.454-6.344 1.248-7.83a7.925 7.925 0 013.306-3.305z"},void 0)]}),void 0)};function Y(e){var n=e.isInverted,t=(0,s.classNames)("CallingStatus",{"CallingStatus--inverted":!!n}),a=(0,s.classNames)("CallingStatus__part","CallingStatus__part--withAnimation");return(0,o.jsxs)("div",(0,i.__assign)({className:t},{children:[(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0)]}),void 0)}var J=t(53996),X=t(63192);const q=(0,X.makeIcon)("Icon16Connection","connection_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="connection_16"><path d="M12 2a1 1 0 0 0-1 1v10a1 1 0 1 0 2 0V3a1 1 0 0 0-1-1ZM7 5.5a1 1 0 0 1 2 0V13a1 1 0 1 1-2 0V5.5ZM3 8a1 1 0 0 1 2 0v5a1 1 0 1 1-2 0V8Z" /></symbol>',16,16,!1,void 0);var $,ee;!function(e){e.VkCalls="vkcalls",e.Sferum="sferum"}(ee||(ee={}));var ne=function(){function e(){}return e.setAppType=function(n){e._appType=n},e.getAppType=function(){return e._appType},e.getLsKeys=function(){return e._lsKeysMap[e._appType]},e._appType=ee.VkCalls,e._lsKeysMap=(($={})[ee.VkCalls]=d.LS_KEYS,$[ee.Sferum]=d.LS_SFERUM_KEYS,$),e}(),te={queryOption:function(e){return te.getOptions()[e]},getOptions:function(){try{var e=ne.getLsKeys(),n=localStorage.getItem(e.VIDEO_OPTIONS);if("string"!=typeof n)throw new Error("no value stored");return JSON.parse(n)}catch(e){return te.getDefaultOptions()}},saveOption:function(e,n){var t,a=(0,i.__assign)((0,i.__assign)({},te.getOptions()),((t={})[e]=n,t)),o=ne.getLsKeys();return localStorage.setItem(o.VIDEO_OPTIONS,JSON.stringify(a)),a},saveOptions:function(e){var n=ne.getLsKeys();return localStorage.setItem(n.VIDEO_OPTIONS,JSON.stringify(e)),e},getDefaultOptions:function(){return{calls_is_video_mirrored:!0}}},ae=function(){var e=ne.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT);return"string"!=typeof n?d.EVideoEffectType.NONE:/^\d+$/.test(n)?+n:n},ie=function(e){var n=ne.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT,""+e)},oe=function(){var e=ne.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS);return"string"!=typeof n?0:+n},re=function(e){var n=ne.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS,""+e)},se=function(){var e=ne.getLsKeys();localStorage.removeItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS)},le=function(){var e=(0,c.useSelector)((function(e){return e.virtualBackgroundSettings.videoOptions})),n=u(),t=(0,i.__read)((0,l.useState)(te.getOptions),2),a=t[0],o=t[1],r=(0,l.useCallback)((function(){o(te.getOptions())}),[]),_=(0,l.useCallback)((function(){te.saveOptions(a),n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[a]),v=(0,l.useCallback)((function(e,n){o((function(t){var a;return(0,i.__assign)((0,i.__assign)({},t),((a={})[e]=n,a))}))}),[]);return(0,l.useEffect)((function(){(0,s.isEqual)(e,a)||n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[]),{videoOptions:a,storedVideoOptions:e,setVideoOptions:o,onRestoreSettings:r,onSaveSettings:_,onChangeVideoOption:v}},ce=(0,l.memo)((function(e){var n=e.externalId,t=e.isVisible,a=void 0===t||t,r=e.isOrator,c=void 0!==r&&r,u=e.isInfoShown,_=e.isPinned,v=e.isPinnedByAdmin,p=e.isHandRaised,f=e.photo,g=e.hasVideo,m=e.hasAudio,C=e.isSharingScreen,S=e.isSpeaking,I=void 0!==S&&S,T=e.stream,N=void 0===T?null:T,x=e.isMe,b=void 0!==x&&x,O=e.name,w=e.letter,M=e.status,P=void 0===M?J.ParticipantStatus.CONNECTED:M,L=e.wasConnected,D=void 0===L||L,j=e.networkStatus,R=void 0===j?1:j,G=e.onClickParticipant,V=e.onDblClickParticipant,F=e.onStopScreenShare,W=e.allowContain,Z=e.actions,X=(0,l.useContext)(E.LangContext).getLang,$=(0,l.useContext)(y.ConfigContext),ee=$.withAnimation,ne=$.anonymPhoto,te=(0,l.useRef)(null),ae=(0,k.isParticipantAnonym)(n),ie=le().storedVideoOptions,oe=(0,k.externalIdToString)(n),re=!!G||!!V,se=c&&C&&b,ce=(0,s.classNames)("Participant",{"Participant--isInteractive":re,"Participant--isPinned":_,"Participant--isSpeaking":I,"Participant--isOrator":c,"Participant--withAnimation":ee}),de=(0,s.classNames)("Participant__more",{"Participant__more--withAnimation":ee}),ue=(0,i.__read)((0,l.useState)(!1),2),_e=ue[0],ve=ue[1],pe=(0,l.useCallback)((function(e){G&&G(e,n)}),[G]),fe=(0,l.useCallback)((function(e){V&&V(e,n)}),[V]),he=(0,s.classNames)({Participant__offsetCard:u,Participant__oratorPhoto:c});return(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__wrapper"},{children:[a&&Z&&Z.length>0&&(0,o.jsx)(z,(0,i.__assign)({className:"Participant__Dropdown",items:Z,open:_e,setOpen:ve},{children:(0,o.jsx)("button",(0,i.__assign)({className:de,"aria-label":X("calls_actions")},{children:(0,o.jsx)(H,{},void 0)}),void 0)}),void 0),(0,o.jsxs)("article",(0,i.__assign)({ref:te,className:ce,onClick:pe,onDoubleClick:fe,"participant-id":oe},{children:[!a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(A.CallPhoto,{id:+n.id,photo:!ne&&ae?"":f,alt:O||"",letter:w,className:he},void 0)}),void 0),u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:O}),void 0),(D||b)&&!m&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),a&&(0,o.jsxs)(o.Fragment,{children:[!(g&&c)&&(0,o.jsx)(h,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(A.CallPhoto,{id:+n.id,photo:!ne&&ae?"":f,alt:O||"",className:he},void 0)}),void 0),p&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(U,{className:"Participant__handIcon"},void 0)}),void 0),se&&(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__screenSharer"},{children:[(0,o.jsx)(Q,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"Participant__screenSharerText"},{children:X("calls_you_are_screen_sharer")}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"Participant__screenSharerButton",onClick:F},{children:X("calls_screen_share_stop")}),void 0)]}),void 0),N&&g&&!se&&(0,o.jsx)(B,{className:"Participant__main",participantId:oe,stream:N,isMirrored:b&&!C&&ie[d.EVideoOptionType.IS_VIDEO_MIRRORED],isContained:W||C,isStartWithVisible:b,isLocalSchreenShare:b&&C},void 0),P!==J.ParticipantStatus.CONNECTED&&!b&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__status"},{children:(0,o.jsx)(Y,{isInverted:!0},void 0)}),void 0),!c&&u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(m||N||C)&&R<.6&&(0,o.jsx)(q,{fill:R<=.3?"#ff5c5c":"#FECE00"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:O}),void 0),(D||b)&&!m&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),!v&&_&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)("div",{className:"Participant__pin"},void 0)}),void 0),v&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)(K,{className:"Participant__icon"},void 0)}),void 0)]}),void 0)]}),void 0)})),de=(0,l.memo)((function(e){var n=(0,k.externalIdToString)(e.externalId),t=P((0,l.useCallback)((function(e){var t;return null===(t=e.speakers)||void 0===t?void 0:t[n]}),[n])),a=e.hasAudio&&t&&e.isVisible;return(0,o.jsx)(ce,(0,i.__assign)({},e,{isSpeaking:a}),void 0)})),ue=t(25685),_e=function(){var e,n,t,a,r=(0,ue.useLang)().getLang,l=P((function(e){var n=e.localDevice,t=e.externalId,a=e.me,i=e.peer,o=e.devices,r=e.participants;return{localDevice:n,peerDevice:(0,k.getPeerIdDeviceInfo)(i,o),meParticipant:t&&r[a],peerParticipant:r[i],externalId:t}})),c=l.externalId,d=l.localDevice,u=l.meParticipant,_=l.peerDevice,v=l.peerParticipant,p=(0,k.isParticipantWithVideo)(d),f=!(!_||!(0,k.isParticipantWithVideo)(_)),h=(0,s.classNames)("OneToOne",{"OneToOne--hasVideo":p,"OneToOne--opponentHasVideo":f});return(0,o.jsxs)("div",(0,i.__assign)({className:h},{children:[(0,o.jsx)("aside",(0,i.__assign)({className:"OneToOne__local"},{children:c&&u&&(0,o.jsx)(ce,{externalId:c,hasVideo:p,hasAudio:!!(null===(e=d.mediaSettings)||void 0===e?void 0:e.isAudioEnabled),isSharingScreen:!!(null===(n=d.mediaSettings)||void 0===n?void 0:n.isScreenSharingEnabled),stream:(0,k.getStream)(d),isMe:!0,name:r("calls_own_label"),letter:null==u?void 0:u.name.slice(0,1),wasConnected:d.wasConnected,allowContain:!0,networkStatus:d.networkStatus},void 0)}),void 0),(0,o.jsx)("main",(0,i.__assign)({className:"OneToOne__remote"},{children:v&&_&&(0,o.jsx)(ce,{externalId:_.externalId,hasVideo:f,hasAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isSharingScreen:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:(0,k.getStream)(_),photo:v.photo,name:v.name,allowContain:!0,wasConnected:_.wasConnected,networkStatus:_.networkStatus},void 0)}),void 0)]}),void 0)},ve=(0,l.forwardRef)((function(e,n){var t=e.children,a=e.className,r=e.alignX,l=e.alignY,c=e.size,d=void 0===c?"m":c,u=(0,i.__rest)(e,["children","className","alignX","alignY","size"]),_=(0,s.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+l,"CallIconButtonGroup--size-"+d,a);return(0,o.jsx)("div",(0,i.__assign)({className:_,ref:n},u,{children:t}),void 0)})),pe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"},void 0)}),void 0)},fe=(0,l.forwardRef)((function(e,n){var t=e.unreadCount,a=void 0===t?0:t,r=(0,i.__rest)(e,["unreadCount"]),c=(0,l.useContext)(y.ConfigContext).withAnimation,d="",u="";switch(!0){case!a:d="none";break;case a<=9:d="single",u=a.toString();break;case a<=99:d="double",u=a.toString();break;case a>99:d="max",u="99+"}var _=(0,s.classNames)("ChatIconButton","ChatIconButton--"+d,{"ChatIconButton--withAnimation":c});return(0,o.jsx)("button",(0,i.__assign)({className:_},r,{ref:n},{children:u&&(0,o.jsx)("div",(0,i.__assign)({className:"ChatIconButton__count "},{children:u}),void 0)}),void 0)})),he=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M20.465 4.4c-.489-.26-.974-.4-2.31-.4H5.844c-1.336 0-1.821.14-2.31.4A2.726 2.726 0 002.4 5.536C2.139 6.024 2 6.509 2 7.845v8.31c0 1.336.14 1.821.4 2.31.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h12.31c1.336 0 1.821-.14 2.31-.4a2.726 2.726 0 001.134-1.135c.262-.489.401-.974.401-2.31v-8.31c0-1.336-.14-1.821-.4-2.31A2.726 2.726 0 0020.464 4.4zm-11.81 5.728l2.97-2.978c.207-.2.543-.2.75 0l2.97 2.978c.33.318.077.872-.376.872H13v4.979c0 .564-.442 1.021-1 1.021s-1-.457-1-1.021V11H9.031c-.44 0-.715-.545-.375-.872z"},void 0)}),void 0)},Ae=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"},void 0)}),void 0)},ge=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"},void 0)}),void 0)},me=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"},void 0)}),void 0)},Ce=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"},void 0)}),void 0)},Ee=t(51013),Se=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.49 4.293a4.402 4.402 0 116.225 6.225l-1.072 1.072a.9.9 0 01-1.273-1.273l1.071-1.072a2.601 2.601 0 10-3.678-3.678l-3.537 3.537a2.601 2.601 0 000 3.678.9.9 0 01-1.274 1.273 4.402 4.402 0 010-6.225l3.537-3.537zm-.708 5.66a.9.9 0 011.273 0 4.402 4.402 0 010 6.225l-3.537 3.537a4.402 4.402 0 11-6.225-6.226l1.122-1.121a.9.9 0 111.273 1.273l-1.121 1.122a2.601 2.601 0 103.678 3.678l3.537-3.537a2.601 2.601 0 000-3.678.9.9 0 010-1.274z",fill:"#fff"},void 0)}),void 0)};const Ie=(0,X.makeIcon)("Icon24Live","live_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="live_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M12 22.5C6.201 22.5 1.5 17.799 1.5 12S6.201 1.5 12 1.5 22.5 6.201 22.5 12 17.799 22.5 12 22.5Zm0-2a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0-2a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13Zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Zm0-2a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var Te=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"},void 0)}),void 0)},Ne=(0,l.forwardRef)((function(e,n){var t=e.participantCount,r=e.onClick,l=e.isParticipantControlActive,c=(0,o.jsx)(Te,{},void 0);if(t&&t>0){var d="";(d=t>99?"99+":null==t?void 0:t.toString())&&(c=(0,o.jsxs)("div",{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)({ParticipantIconButton__count:!0,"ParticipantIconButton__count--lt99":t<=99})},{children:d}),void 0),c]},void 0))}return(0,o.jsx)(_,{type:l?a.OFF:a.ON,icon:c,onClick:r,className:"Call__footerButton",ref:n},void 0)})),xe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"},void 0)]}),void 0)},ye=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"},void 0)}),void 0)},be=t(11099),Oe=function(){var e=(0,be.classNames)({MicIconWithSpeakingIndicator__scale:!0});return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},{children:[(0,o.jsx)("mask",(0,i.__assign)({id:"MicIconWithSpeakingIndicatorMask"},{children:(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0)}),void 0),(0,o.jsx)("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"},void 0),(0,o.jsx)("g",(0,i.__assign)({mask:"url(#MicIconWithSpeakingIndicatorMask)"},{children:(0,o.jsxs)("g",(0,i.__assign)({className:e},{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"},void 0)]}),void 0)}),void 0)]}),void 0)},we=(0,l.forwardRef)((function(e,n){var t=e.isAudioAllowed,i=e.isAudioEnabled,r=e.onToggleAudio,s=P((function(e){return!(!e.externalId||!e.speakers[(0,k.externalIdToString)(e.externalId)])})),l=i?s?(0,o.jsx)(Oe,{},void 0):(0,o.jsx)(xe,{},void 0):(0,o.jsx)(ye,{},void 0),c=t?i?a.ON:a.OFF:a.DISABLED;return(0,o.jsx)(_,{type:c,icon:l,onClick:r,className:"Call__footerButton",ref:n},void 0)}));const Me=(0,X.makeIcon)("Icon24Settings","settings_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418ZM12 16.75a4.75 4.75 0 1 0 0-9.5 4.75 4.75 0 0 0 0 9.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var Pe=function(e){var n=e.tooltips,t=e.onTooltipChange,a=e.getRootRef,r=e.isDropdownOpen,s=e.tooltipTitle,l=(0,i.__rest)(e,["tooltips","onTooltipChange","getRootRef","isDropdownOpen","tooltipTitle"]);return(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:s,open:n.settings,delay:300,onOpen:function(){return t("settings",!0)},onClose:function(){return t("settings",!1)},forceClose:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallSettingsButton__outer"},{children:(0,o.jsx)("div",(0,i.__assign)({},l,{ref:a,className:"CallSettingsButton__inner"},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(Me,{},void 0)},void 0)}),void 0)}),void 0)}),void 0)};function ke(e){var n,t,r=e.info,c=e.chatUnreadCount,u=void 0===c?0:c,p=e.callMenuActions,f=e.isAudioAllowed,h=void 0!==f&&f,A=e.isVideoAllowed,g=void 0!==A&&A,C=e.isVideoEnabled,S=void 0!==C&&C,I=e.isAudioEnabled,T=void 0!==I&&I,N=e.isScreenSharingEnabled,x=void 0!==N&&N,b=e.isOratorMode,O=void 0===b||b,w=e.isFullScreen,M=void 0!==w&&w,P=e.onToggleVideo,k=e.onToggleAudio,L=e.onLeaveCall,D=e.onCollapseCall,j=e.onToggleOratorMode,R=e.onChat,B=e.onHandClick,U=e.onToggleScreenShare,H=e.onFullScreenToggle,G=e.onDeferredStreamStart,V=e.isParticipantControlActive,F=void 0!==V&&V,W=e.isLayoutSwitchShown,Z=void 0!==W&&W,K=e.isScreenShareControlShown,Q=void 0!==K&&K,Y=e.isHandRaised,J=void 0!==Y&&Y,X=e.isHandControlShown,q=void 0!==X&&X,$=e.isChatControlShown,ee=void 0!==$&&$,ne=e.isStreamingControlShown,te=void 0!==ne&&ne,ae=e.isChainControlShown,ie=void 0!==ae&&ae,oe=e.onParticipantsClick,re=e.onTooltipChange,se=e.onHidePanel,le=e.notification,ce=e.tooltips,de=e.onChainClick,ue=e.notificationWithButton,_e=e.withoutPadding,Te=void 0!==_e&&_e,xe=e.participantCount,ye=void 0===xe?0:xe,be=e.children,Oe=e.isPopupOrModalOpen,Me=(0,l.useContext)(y.ConfigContext),ke=Me.withAnimation,Le=Me.isModalView,De=(0,l.useContext)(E.LangContext).getLang,je=(0,s.classNames)("Call",{"Call--fullscreen":M||!Le}),Re=(0,s.classNames)("Call__content",{"Call__content--withoutPadding":Te}),Be=300,Ue=null===(t=null===(n=window.location)||void 0===n?void 0:n.host)||void 0===t?void 0:t.includes(d.VK_HOST),He=(0,l.useRef)(null),Ge=(0,l.useRef)(null),Ve=(0,l.useRef)(null),Fe=(0,l.useRef)(null),We=(0,i.__read)((0,l.useState)(!1),2),Ze=We[0],ze=We[1],Ke=(0,i.__read)(function(e,n,t,a,o,r){var c=(0,i.__read)((0,l.useState)(!0),2),d=c[0],u=c[1],_=(0,l.useRef)(null),v=(0,l.useRef)(!1),p=(0,l.useRef)(!1),f=(0,l.useRef)(!1);f.current!==r&&(f.current=r);var h=(0,l.useRef)(!1),A=function(){v.current||h.current?h.current=!1:(_.current&&window.clearTimeout(_.current),u(!0),p.current||f.current||(_.current=window.setTimeout((function(){u(!1),_.current=null,o&&o()}),5e3)))};return(0,l.useEffect)((function(){A();var i=(0,s.throttle)((function(){A()}),1e3),o=function(){p.current=!0},r=function(){p.current=!1};return n.current.addEventListener("mouseenter",o),n.current.addEventListener("mouseleave",r),t.current.addEventListener("mouseenter",o),t.current.addEventListener("mouseleave",r),a.current.addEventListener("mouseenter",o),a.current.addEventListener("mouseleave",r),e.current.addEventListener("mousemove",i),function(){v.current=!0,_.current&&window.clearTimeout(_.current),n.current&&(n.current.removeEventListener("mouseenter",o),n.current.removeEventListener("mouseleave",r)),t.current&&(t.current.removeEventListener("mouseenter",o),t.current.removeEventListener("mouseleave",r)),a.current&&(a.current.removeEventListener("mouseenter",o),a.current.removeEventListener("mouseleave",r)),e.current&&e.current.removeEventListener("mousemove",i)}}),[p,f.current]),[d,function(e){e?u(!0):(u(!1),h.current=!0)}]}(He,Ge,Ve,Fe,se,Ze),2),Qe=Ke[0],Ye=Ke[1],Je=(0,s.classNames)({"Call__controlPanel--withAnimation":ke,"Call__controlPanel--hideBottomWithAnimation":ke,"Call__controlPanel--hideBottom":!Qe},"CallsWithZIndex--1"),Xe=(0,s.classNames)({"Call__controlPanel--withAnimation":ke,"Call__controlPanel--hideBottomWithAnimation":ke,"Call__controlPanel--hideBottom":!Qe},"Call__curtain"),qe=(0,s.classNames)("Call__buttons",{"Call__controlPanel--withAnimation":ke,"Call__controlPanel--hideBottomWithAnimation":ke,"Call__controlPanel--hideBottom":!Qe},"CallsWithZIndex--1"),$e=(0,l.useCallback)((function(){return Ye(!0)}),[]),en=(0,l.useCallback)((function(){Oe||(Ye(!1),ce.streaming&&re("streaming",!1))}),[Oe,ce.streaming]);return(0,o.jsxs)("section",(0,i.__assign)({className:je,onMouseEnter:$e,onMouseLeave:en,ref:He},{children:[r,le,(0,o.jsx)("div",(0,i.__assign)({className:Re,"data-calls-id":"content"},{children:be}),void 0),(0,o.jsx)("div",{className:Xe},void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"l",alignY:"b",className:Je,ref:Ve},{children:(0,o.jsxs)(o.Fragment,{children:[ee&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_chat"),open:ce.chat,delay:Be,onOpen:function(){return re("chat",!0)},onClose:function(){return re("chat",!1)}},{children:(0,o.jsx)(fe,{unreadCount:u,onClick:R},void 0)}),void 0),q&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(J?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:ce.hand,delay:Be,onOpen:function(){return re("hand",!0)},onClose:function(){return re("hand",!1)}},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(Ae,{},void 0),type:"hand",isActive:J,onClick:B},void 0)}),void 0),Q&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(x?"calls_stop_screen_share":"calls_start_screen_share"),open:ce.screenShare,delay:Be,onOpen:function(){return re("screenShare",!0)},onClose:function(){return re("screenShare",!1)}},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(he,{},void 0),isActive:x,onClick:U},void 0)}),void 0),te&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_call_menu_translation"),open:ce.streaming,delay:Be,onOpen:function(){return re("streaming",!0)},onClose:function(){return re("streaming",!1)}},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(Ie,{},void 0),isActive:te,onClick:G},void 0)}),void 0)]},void 0)}),void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"r",alignY:"b",style:M&&Ue?{right:"78px"}:void 0,className:Je,ref:Fe},{children:(0,o.jsxs)(o.Fragment,{children:[Z&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(O?"calls_show_grid":"calls_show_orator"),open:ce.layout,delay:Be,onOpen:function(){return re("layout",!0)},onClose:function(){return re("layout",!1)}},{children:(0,o.jsx)(m,{type:O?"changeToGrid":"changeToOrator",onClick:j},void 0)}),void 0),p&&(0,o.jsx)(z,(0,i.__assign)({items:p,open:Ze,setOpen:ze,placement:"top-end",className:"Call__dropdown"},{children:(0,o.jsx)(Pe,{onTooltipChange:re,tooltips:ce,isDropdownOpen:Ze,tooltipTitle:De("calls_settings")},void 0)}),void 0),D&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_collapse"),open:ce.collapse,delay:Be,onOpen:function(){return re("collapse",!0)},onClose:function(){return re("collapse",!1)}},{children:(0,o.jsx)(m,{type:"collapse",onClick:D},void 0)}),void 0),H&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(M?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:ce.fullscreen,delay:Be,onOpen:function(){return re("fullscreen",!0)},onClose:function(){return re("fullscreen",!1)}},{children:(0,o.jsx)(m,{onClick:H,icon:M?(0,o.jsx)(ge,{},void 0):(0,o.jsx)(me,{},void 0)},void 0)}),void 0)]},void 0)}),void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"Call__footer",ref:Ge},{children:(0,o.jsxs)("div",(0,i.__assign)({className:qe},{children:[ie&&de&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_menu_link"),open:ce.chainlink,delay:Be,onOpen:function(){return re("chainlink",!0)},onClose:function(){return re("chainlink",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.ON,icon:(0,o.jsx)(Se,{},void 0),onClick:de,className:"Call__footerButton"},void 0)}),void 0),oe&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_participants"),open:ce.participants,delay:Be,onOpen:function(){return re("participants",!0)},onClose:function(){return re("participants",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(Ne,{isParticipantControlActive:F,onClick:oe,participantCount:ye},void 0)}),void 0),(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(S?"calls_camera_turn_off":"calls_camera_turn_on"),open:ce.video,delay:Be,onOpen:function(){return re("video",!0)},onClose:function(){return re("video",!1)},tooltipClassName:"Call__footerButton__tooltip",preferPointerEvents:!0},{children:(0,o.jsx)(_,{type:g?S?a.ON:a.OFF:a.DISABLED,icon:S?(0,o.jsx)(v,{},void 0):(0,o.jsx)(Ce,{},void 0),onClick:P,className:"Call__footerButton"},void 0)}),void 0),k&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(T?"calls_mic_turn_off":"calls_mic_turn_on"),open:ce.audio,delay:Be,onOpen:function(){return re("audio",!0)},onClose:function(){return re("audio",!1)},tooltipClassName:"Call__footerButton__tooltip",preferPointerEvents:!0},{children:(0,o.jsx)(we,{isAudioAllowed:h,isAudioEnabled:T,onToggleAudio:k},void 0)}),void 0),(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_exit"),open:ce.leaveCall,delay:Be,onOpen:function(){return re("leaveCall",!0)},onClose:function(){return re("leaveCall",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.NEGATIVE,icon:(0,o.jsx)(pe,{},void 0),onClick:L,className:"Call__footerButton"},void 0)}),void 0)]}),void 0)}),void 0),ue&&ue]}),void 0)}var Le=t(39664),De=function(e){var n=e.onScroll,t=e.scrollPosition,a=e.participantsCount,r=e.participantsShiftCount,c=e.children,d=l.Children.toArray(c),u=(0,s.classNames)("CallGridNew","CallGridNew--c"+a),_=(0,l.useRef)(null);(0,l.useEffect)((function(){var e=function(){null!==_.current&&n(_.current.scrollTop)};return null!==_.current&&_.current.addEventListener("scroll",e),function(){_.current&&_.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;n(t),null===(e=_.current)||void 0===e||e.scrollTo(0,t)}),[_.current]);var v=(0,l.useMemo)((function(){return new Array(r).fill(0).map((function(e,n){return(0,o.jsx)("article",{className:"CallGridNew__item CallGridNew__item--empty"},-n)}))}),[r]),p=a-r-d.length>0;return(0,o.jsxs)("section",(0,i.__assign)({className:u,ref:_},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallGridNew__in"},{children:[v,d.map((function(e,n){return(0,o.jsx)("article",(0,i.__assign)({className:"CallGridNew__item","data-calls-id":"grid-item"},{children:e}),e.key||n)}))]}),void 0),p&&(0,o.jsx)(Le.default,{color:"white",size:64,duration:1,className:"CallGridNew__spinner"},void 0)]}),void 0)},je=function(e){var n=e.children,t=e.orator,a=e.oratorTitle,r=e.onToggleParticipantsAside,c=e.isShownParticipantsAside,d=e.onScroll,u=e.scrollPosition,_=e.participantsAsideCount,v=e.participantsAsideShift,p=l.Children.toArray(n),f=(0,s.classNames)({CallOrator__toggleIcon:!0,"CallOrator__toggleIcon--withAnimation":!0}),h=(0,s.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!c}),A=(0,s.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!c}),g=(0,s.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":c,"CallOrator__toggleArrow--toRight":!c}),m=(0,l.useRef)(null);return(0,l.useEffect)((function(){var e=function(){null!==m.current&&d(m.current.scrollTop)};return null!==m.current&&m.current.addEventListener("scroll",e),function(){m.current&&m.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;d(u),null===(e=m.current)||void 0===e||e.scrollTo(0,u)}),[m.current]),(0,o.jsxs)("article",(0,i.__assign)({className:h,ref:m},{children:[(0,o.jsx)("main",(0,i.__assign)({className:"CallOrator__orator"},{children:t}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"CallOrator__toggleOthers",onClick:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:f},{children:(0,o.jsx)("div",{className:g},void 0)}),void 0)}),void 0),(0,o.jsx)("aside",(0,i.__assign)({className:A},{children:(0,o.jsxs)("ul",(0,i.__assign)({className:"CallOrator__list",style:{height:148*_-8+"px"}},{children:[v>0&&(0,o.jsx)("li",{className:"CallOrator__participant","data-calls-id":"participant",style:{height:v+"px"}},-1),p.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallOrator__participant","data-calls-id":"participant"},{children:e}),"key"in e?e.key:void 0)}))]}),void 0)}),void 0),a]}),void 0)},Re=t(41118);function Be(e,n){var t=e.browser.hasMicrophonePermission(),a=e.browser.hasCameraPermission(),o=n.includes(J.MediaOption.AUDIO)&&!t,r=n.includes(J.MediaOption.VIDEO)&&!a;return o||r?function(e,n,t){return(0,i.__awaiter)(this,void 0,void 0,(function(){return(0,i.__generator)(this,(function(a){return[2,e.browser.getUserMedia(n,t).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))]}))}))}(e,r,o):Promise.resolve()}var Ue=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"14",height:"12",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"},void 0)}),void 0)},He=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("CallNotification",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},Ge=function(e){var n=e.duration;return(0,o.jsx)("div",{className:"CallTimer","aria-label":n,"data-duration":n},void 0)},Ve=t(78658),Fe=t(90355),We=function(e){var n=e.status,t=(0,l.useContext)(E.LangContext).getLang;switch(n){case J.ParticipantStatus.WAITING:return(0,o.jsx)(Fe.default,{children:t("calls_status_waiting")},void 0);case J.ParticipantStatus.CONNECTING:case J.ParticipantStatus.RECONNECT:return(0,o.jsx)(Fe.default,{children:t("calls_status_connecting")},void 0);case J.ParticipantStatus.ERROR:return t("calls_error");case J.ParticipantStatus.HANGUP:return(0,o.jsx)(Fe.default,{children:t("calls_status_hangup")},void 0);case J.ParticipantStatus.PERMISSIONS:return t("calls_status_no_permissions");case J.ParticipantStatus.CONNECTED:default:return null}};function Ze(e){return e?(0,o.jsx)(Ge,{duration:(0,Ve.calculateCallDuration)(e)},void 0):null}function ze(e,n){if(e.hangupType)switch(e.hangupType){case d.HANGUP_TYPE_BUSY:return n("calls_busy");case d.HANGUP_TYPE_CALLEE_IS_OFFLINE:return n("calls_callee_is_offline");case d.HANGUP_TYPE_REJECTED:return n("calls_rejected_status");case d.HANGUP_TYPE_CANCELED:case d.HANGUP_TYPE_MISSED:case d.HANGUP_TYPE_HUNGUP:case d.HANGUP_TYPE_REMOVED:return null;case d.HANGUP_TYPE_CALLER_IS_BLOCKED:case d.HANGUP_TYPE_EXTERNAL_API_ERROR:case d.HANGUP_TYPE_FAILED:case d.HANGUP_TYPE_NOT_FRIENDS:case d.HANGUP_TYPE_OLD_VERSION:case d.HANGUP_TYPE_SERVICE_DISABLED:case d.HANGUP_TYPE_UNKNOWN_ERROR:case d.HANGUP_TYPE_UNSUPPORTED:return n("calls_error")}return null}var Ke=function(e,n){return e?ze(e,n)||function(e,n){var t,a=null;return(a=n===e.me?e.localDevice:(0,k.getPeerIdDeviceInfo)(n,e.devices))&&a.status===J.ParticipantStatus.CONNECTED||a&&a.status===J.ParticipantStatus.WAITING_HALL||(0,k.getActiveParticipantsCount)(e)<2?null:(0,o.jsx)(We,{status:null!==(t=null==a?void 0:a.status)&&void 0!==t?t:J.ParticipantStatus.WAITING},void 0)}(e,(0,O.isGroupCallByPeer)(e.peer)?e.me:e.peer)||function(e,n){return void 0===((0,O.isGroupCallByPeer)(e.peer)?e.callData.ts:e.callData.localTimeStamp)?(0,o.jsx)(Fe.default,{children:n("calls_status_waiting")},void 0):null}(e,n):""},Qe=function(e){var n=e.dispatch,t=e.notification,a=e.participant,r=(0,l.useContext)(E.LangContext),s=r.getLang,u=r.langSex,_=(0,c.useSelector)((function(e){return e})),v=(0,l.useMemo)((function(){return function(e,n,t,a){void 0===a&&(a={name:"",sex:"0",shortName:""});if(!e)return null;switch(e.type){case d.NotificationType.SPEAKING_ON_MUTE:return n("calls_notification_mic_is_mute");case d.NotificationType.SCREEN_SHARING_STARTED:if(!a||!a.name)return(0,o.jsx)("span",{children:n("calls_notification_screen_sharing_started")},void 0);var r=t(a.sex,"calls_notification_user_started_screen_sharing",n("calls_notification_user_started_screen_sharing",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.RAISED_HAND:if(!a||!a.name)return null;r=t(a.sex,"calls_notification_raised_hand",n("calls_notification_raised_hand",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION:return(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection")},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[(0,o.jsx)(Ue,{},"icon"),(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection_disable_camera")},"text")];case d.NotificationType.ADMIN_ROLE_GRANTED:return(0,o.jsx)("span",{children:n("calls_notification_admin_role_granted")},"text");case d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE:if(!a||!a.name&&!a.shortName)return null;var s=n("calls_notification_user_granted_with_admin_role").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PINNED_BY_ADMIN:return(0,o.jsx)("span",{children:n("calls_notification_admin_pinned_self")},"text");case d.NotificationType.USER_PINNED_BY_ADMIN:if(!a||!a.name&&!a.shortName)return null;s=n("calls_notification_admin_pinned_user").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PUSH_TO_TALK:s=n("calls_notification_push_to_talk_enabled");return[e.data?(0,o.jsx)(Oe,{},"icon"):(0,o.jsx)(xe,{},"icon"),(0,o.jsx)("div",(0,i.__assign)({className:"CallNotification__pushToTalkText"},{children:s}),"text")];case d.NotificationType.LINK_COPIED_TO_CLIPBOARD:s=n("calls_create_call_by_link_copied");return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.ADMIN_MUTE:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute")},"text");case d.NotificationType.ADMIN_MUTE_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_video")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_video")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_audio")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_video")},"text");default:return null}}(t,s,u,a)}),[t,a]),p=(0,l.useRef)(0);(0,l.useEffect)((function(){return p.current&&window.clearTimeout(p.current),t&&0!==t.timer&&(p.current=window.setTimeout((function(){n({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),p.current=0}),t.timer||d.defaultNotificationLifeSpan)),function(){p.current&&window.clearTimeout(p.current)}}),[t]);var f=(0,l.useMemo)((function(){return(0,k.getActiveDevices)(_).activeDevices}),[_.devices,_.participantsChunk,_.me,_.groupId,_.meGroup]),h=(0,l.useMemo)((function(){return(0,O.isGroupCallByPeer)(_.peer)}),[_.peer]),A=f.length>1,g=h||f.length>2,m=A||(0,k.isParticipantWithVideo)(_.localDevice),C=g&&m&&_.isOratorMode,S=(0,be.classNames)("",{CallNotification__pushToTalk:(null==t?void 0:t.type)===d.NotificationType.PUSH_TO_TALK,CallNotification__orator:C&&_.isShownParticipantsAside}),I=_.peer,T=(0,O.isGroupCallByPeer)(I)?_.callData.conversation:(0,k.getPeerIdDeviceInfo)(I,_.devices),N=(0,i.__read)((0,l.useState)(),2),x=N[0],y=N[1],b=(0,i.__read)((0,l.useState)(""),2),w=b[0],M=b[1];return(null==T?void 0:T.status)!==x&&(M(Ke(_,s)),y(null==T?void 0:T.status)),(0,l.useEffect)((function(){M(Ke(_,s))}),[_]),t||w?(0,o.jsx)(He,(0,i.__assign)({className:S},{children:w||v}),void 0):null};var Ye=t(17179);function Je(e,n){return(e&n)===n}function Xe(e){for(var n={},t=0;t<e.length;++t)n[e[t]]=1<<t;return n}var qe={acc:{},timer:0,tasks:0};function $e(e,n,t,a){!function(e,n,t,a,o){void 0===a&&(a=100);var r=(0,k.externalIdToString)(e),s=(0,i.__assign)((0,i.__assign)({},n),{externalId:e});o.acc[r]=o.acc[r]&&"object"==typeof o.acc[r]?(0,i.__assign)((0,i.__assign)({},o.acc[r]),s):s,o.tasks++,o.timer&&clearTimeout(o.timer);o.timer=window.setTimeout((function(){o.tasks>0&&(t(o.acc),o.acc={},o.tasks=0),o.timer=0}),a)}(n,t,(function(n){e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:n})}),a,qe)}function en(e,n,t){var a,o,r,s,l;if(t)try{for(var c=(0,i.__values)(t),d=c.next();!d.done;d=c.next()){var u=d.value;$e(n,u.uid,{mediaSettings:u.mediaSettings,markers:u.markers,status:u.status||J.ParticipantStatus.CONNECTING,statusData:u.participantState?(0,k.convertParticipantStateFromSDK)(u.participantState):void 0,wasConnected:!1,permissions:xt.mapParticipantPermissions(u.muteStates)});var _=e.devices[(0,k.externalIdToString)(u.uid)],v=(null===(r=null==_?void 0:_.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||!1;(null===(s=null==u?void 0:u.mediaSettings)||void 0===s?void 0:s.isScreenSharingEnabled)!==v&&(0,k.toggleScreenSharing)(e,n,null===(l=null==u?void 0:u.mediaSettings)||void 0===l?void 0:l.isScreenSharingEnabled,u.uid,!0)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}}var nn=t(71618),tn=t(93385);function an(e){return new Promise((function(n,t){var a=new Image;a.src=e,a.onload=n,a.onerror=t}))}function on(e){return Promise.resolve(e)}function rn(e,n,t){if(e.authorizedGroupId)return Promise.resolve();if((0,Ve.unpackState)(n).friends.length>0)return Promise.resolve();if(e.getFriends){var a=e.getFriends();if(null!==a)return t({type:d.E_ACTION.SET_FRIENDS,data:a}),Promise.resolve()}return(0,nn.loadFriends)().then((function(e){var n=e.items,t=e.count;return{friends:n.map(tn.normalizeUser),count:t}})).then((function(e){var n=e.count,a=e.friends;t({type:d.E_ACTION.SET_FRIENDS,data:a,friendsCount:n})}))}function sn(e,n,t,a){return(0,nn.loadChatMembers)(t).then((function(t){t.profiles&&n({type:d.E_ACTION.SET_CHAT_INFO,data:ln(t).sort((function(n,t){var a=(0,Ve.unpackState)(e).me;return n.peerId===a?-1:t.peerId===a?1:0})),conversation:a})}))}function ln(e){var n,t,a=function(e){var n,t,a={};if(!e)return a;try{for(var o=(0,i.__values)(e),r=o.next();!r.done;r=o.next()){var s=r.value;a[s.id]=s}}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(n)throw n.error}}return a}(e.profiles),o=[];try{for(var r=(0,i.__values)(e.items),s=r.next();!s.done;s=r.next()){var l=a[s.value.member_id];l&&o.push((0,tn.normalizeUser)(l))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}return o}function cn(e,n,t){return e.authorizedGroupId?n.groupMembers.length>0?Promise.resolve():(0,nn.getGroupMembers)(-e.authorizedGroupId,0,d.COUNT_OF_GROUP_MEMBERS_TO_LOAD).then((function(e){var n=e.items,t=e.count,a=[],i=[];return n.forEach((function(e){e.deactivated||(a.push((0,tn.normalizeUser)(e)),e.can_call_from_group||i.push(e.id))})),{groupMembers:a,unableToCallGroupMembersIds:i,count:t}})).then((function(e){var n=e.groupMembers,a=e.unableToCallGroupMembersIds,i=e.count;return t({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:i,groupMembers:n,unableToCallGroupMembersIds:a}),Promise.resolve()})):Promise.resolve()}function dn(e,n,t){return(0,nn.retryLoadCallPeers)(t).then((function(e){var t=(0,i.__read)((0,Ve.convertServerData)(e),3),a=t[0],o=t[1],r=t[2];return hn(n,r),on({conversation:a,members:o})})).then((function(e){var a=e.conversation,i=e.members;n({type:d.E_ACTION.LOAD_PEERS,conversation:a,members:i,peerId:t})}))}function un(e,n,t){return t?(0,nn.loadCallPeers)(t).then((function(e){var t=e.items,a=(0,i.__read)(t,1)[0];hn(n,a)})):Promise.resolve()}var _n,vn={acc:[],timer:0,promise:null,promiseResolve:null,tasks:0,timeout:300};function pn(e,n,t,a,o,r){var s,l;return(s=vn.acc).push.apply(s,(0,i.__spreadArray)([],(0,i.__read)(o),!1)),vn.timer&&clearTimeout(vn.timer),vn.timer=window.setTimeout((function(){var o=vn.acc,s=vn.promiseResolve;vn.promise=null,vn.promiseResolve=null,vn.acc=[],function(e,n,t,a,o,r){var s=(0,Ve.unpackState)(e).me,l=(0,Ve.unpackState)(e).anonymSecret,c=s<0?s:void 0;return(0,nn.getCallParticipants)(a,o,c,s<0,l).then((function(e){var s=e.profiles,l=void 0===s?[]:s,c=e.anonyms,u=void 0===c?[]:c,_=e.secret,v=e.groups,p=void 0===v?[]:v;_&&n({type:d.E_ACTION.UPDATE_ANON_SECRET,secret:_});var f=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(u),!1),(0,i.__read)(p),!1),h=o.filter((function(e){var n=f.find((function(n){return n&&n.id===e}));return!n}));h.length>0&&t.eventHandlers.onError&&t.eventHandlers.onError(new Error("callId: "+a+", timestamp: "+Date.now()+", cant find in participants: "+h.join(", ")));var A=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(u),!1),(0,i.__read)(l),!1).map(tn.normalizeUser);(null==p?void 0:p.length)>0&&(A=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(A),!1),(0,i.__read)(p.map(tn.normalizeGroup)),!1));var g=on([{},A]);return r.awaitImages?g.then((function(){return[null,A]})):[null,A]})).then((function(e){var t=(0,i.__read)(e,2)[1];t.length>0&&n({type:d.E_ACTION.LOAD_PEERS,members:t})})).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))}(e,n,t,a,o,r).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)})).finally(s)}),vn.timeout),vn.promise=null!==(l=vn.promise)&&void 0!==l?l:new Promise((function(e){vn.promiseResolve=e}))}function fn(e,n,t,a){return void 0===a&&(a=0),(0,nn.getCallUrlLink)(n,t,a).then((function(n){var t=n.join_link;return e({type:d.E_ACTION.CALL_STATE,callData:{callUrlLink:t}}),t}))}function hn(e,n){if(n&&n.call_in_progress){var t=n.unread_count,a=n.last_message_id,i=n.call_in_progress.has_link,o=n.call_in_progress.can_finish_call;e({type:d.E_ACTION.CALL_STATE,callData:{canFinishCall:o,hasUrlLink:i}}),(t||a)&&e({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t,chatUpToMsgId:a})}}function An(e,n){return void 0===n&&(n=!1),(0,J.startStream)(n,null,e).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))}function gn(e,n,t){void 0===t&&(t=0),fn(e,n,!1,t).then((function(n){(0,s.copyTextToClipboard)(n).then((function(n){n&&e({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.LINK_COPIED_TO_CLIPBOARD}})}))})).catch(console.log)}function mn(e,n,t,a){n(t),Mn(e)&&kn(a,n,t)}!function(e){e.CONTAIN="cn",e.COVER="cv"}(_n||(_n={}));function Cn(e,n,t){return(0,O.isGroupCallByPeer)(e.peer)?e.uiMode===d.UIMode.COLLAPSED?function(e){var n=(0,Ve.isAnyoneWithVideo)(e),t=(0,k.getCallVisibleParticipant)(e,n),a=(0,k.getActiveDevices)(e).activeDevices,i=e.config,o=i.enableScreenTrack,r=i.enableProducerScreenTrack;return a.reduce((function(n,a){var i=a.externalId,s=a.mediaSettings;if((0,k.isSameExternalId)(a.externalId,e.externalId))return n;var l=(0,k.externalIdToString)(i);if(o||r){var c=!!(null==s?void 0:s.isScreenSharingEnabled),d=!!(null==s?void 0:s.isVideoEnabled),u=(0,k.isSameExternalId)(i,null==t?void 0:t.externalId);u&&c&&(n.set(bn(l,J.MediaType.SCREEN),In(t,J.MediaType.SCREEN)),n.set(bn(l,J.MediaType.CAMERA),Sn(a,J.MediaType.CAMERA))),u&&!c&&d&&(n.set(bn(l,J.MediaType.CAMERA),In(t,J.MediaType.CAMERA)),n.set(bn(l,J.MediaType.SCREEN),Sn(a,J.MediaType.SCREEN))),u&&(c||d)||(n.set(bn(l,J.MediaType.SCREEN),Sn(a,J.MediaType.SCREEN)),n.set(bn(l,J.MediaType.CAMERA),Sn(a,J.MediaType.CAMERA)))}else(0,k.isSameExternalId)(null==t?void 0:t.externalId,i)&&yn(s)?n.set(l,In(t)):n.set(l,Sn(a));return n}),new Map)}(e):e.isOratorMode?function(e,n,t){var a,i,o=(0,k.getSelectedDevice)(e),r=o.externalId,s=(0,k.externalIdToString)(r),l=(0,k.getActiveDevices)(e).activeDevices,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;if((_||v)&&s){var p=new Map,f=!!(null===(a=null==o?void 0:o.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),h=!!(null===(i=null==o?void 0:o.mediaSettings)||void 0===i?void 0:i.isVideoEnabled),A=e.uiMode===d.UIMode.FULLSCREEN,g=!(0,k.isSameExternalId)(r,e.externalId);return f&&g&&(c++,p.set(bn(s,J.MediaType.SCREEN),Nn(o,A,!1,n,t,J.MediaType.SCREEN))),f&&h&&g&&(c++,p.set(bn(s,J.MediaType.CAMERA),xn(o,J.MediaType.CAMERA))),f&&!h&&g&&p.set(bn(s,J.MediaType.CAMERA),Sn(o,J.MediaType.CAMERA)),!f&&h&&g&&(c++,p.set(bn(s,J.MediaType.CAMERA),Nn(o,A,!1,n,t,J.MediaType.CAMERA)),p.set(bn(s,J.MediaType.SCREEN),Sn(o,J.MediaType.SCREEN))),f||h||!g||(p.set(bn(s,J.MediaType.CAMERA),Sn(o,J.MediaType.CAMERA)),p.set(bn(s,J.MediaType.SCREEN),Sn(o,J.MediaType.SCREEN))),l.reduce((function(n,t){var a=t.externalId,i=t.mediaSettings;if((0,k.isSameExternalId)(a,e.externalId)||(0,k.isSameExternalId)(a,r))return n;var o=(0,k.externalIdToString)(a),s=!!(null==i?void 0:i.isScreenSharingEnabled),l=!!(null==i?void 0:i.isVideoEnabled),d=t.visible&&c<e.config.videoSlotsCount;return d&&l&&(c++,n.set(bn(o,J.MediaType.CAMERA),xn(t,J.MediaType.CAMERA)),n.set(bn(o,J.MediaType.SCREEN),Sn(t,J.MediaType.SCREEN))),d&&!l&&s&&(c++,n.set(bn(o,J.MediaType.SCREEN),xn(t,J.MediaType.SCREEN)),n.set(bn(o,J.MediaType.CAMERA),Sn(t,J.MediaType.CAMERA))),d&&(l||s)||(n.set(bn(o,J.MediaType.SCREEN),Sn(t,J.MediaType.SCREEN)),n.set(bn(o,J.MediaType.CAMERA),Sn(t,J.MediaType.CAMERA))),n}),p),p}return l.reduce((function(a,i){var o=i.externalId,s=i.mediaSettings;if((0,k.isSameExternalId)(o,e.externalId))return a;var l=(0,k.externalIdToString)(o);if((0,k.isSameExternalId)(r,o)&&yn(s)){var u=Nn(i,e.uiMode===d.UIMode.FULLSCREEN,!1,n,t);a.set(l,u)}else yn(s)&&i.visible&&c<e.config.videoSlotsCount?(c++,a.set(l,xn(i))):a.set(l,Sn(i));return a}),new Map)}(e,n,t):function(e,n,t){var a=e.uiMode===d.UIMode.FULLSCREEN,i=a?n:900,o=a?t:504,r=(0,k.getActiveDevices)(e).activeDevices,s=function(e,n,t){switch(t){case 1:return n;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(n/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(n/3);default:return Math.round(e/6)}}(i,o,r.length),l=s<200?1:2,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;return r.reduce((function(n,t){if((0,k.isSameExternalId)(t.externalId,e.externalId))return n;var a=t.externalId,i=t.mediaSettings,o=(0,k.externalIdToString)(a);if(_||v){var r=!!(null==i?void 0:i.isScreenSharingEnabled),d=!!(null==i?void 0:i.isVideoEnabled),u=t.visible&&c<e.config.videoSlotsCount;return u&&r&&(c++,n.set(bn(o,J.MediaType.SCREEN),Tn(t,s,l,J.MediaType.SCREEN)),n.set(bn(o,J.MediaType.CAMERA),Sn(t,J.MediaType.CAMERA))),u&&!r&&d&&(c++,n.set(bn(o,J.MediaType.CAMERA),Tn(t,s,l,J.MediaType.CAMERA)),n.set(bn(o,J.MediaType.SCREEN),Sn(t,J.MediaType.SCREEN))),u&&(r||d)||(n.set(bn(o,J.MediaType.CAMERA),Sn(t,J.MediaType.CAMERA)),n.set(bn(o,J.MediaType.SCREEN),Sn(t,J.MediaType.SCREEN))),n}return yn(i)&&t.visible&&c<e.config.videoSlotsCount?(n.set(o,Tn(t,s,l)),c++):n.set(o,Sn(t)),n}),new Map)}(e,n,t):function(e,n,t){var a=new Map,i=(0,k.getPeerIdDeviceInfo)(e.peer,e.devices);if(!i)return a;var o=e.config,r=o.enableScreenTrack,s=o.enableProducerScreenTrack,l=e.uiMode===d.UIMode.FULLSCREEN,c=e.uiMode===d.UIMode.COLLAPSED,u=i.externalId,_=i.mediaSettings;if((0,k.isSameExternalId)(u,e.externalId))return a;var v=(0,k.externalIdToString)(u);if(r||s){var p=!!(null==_?void 0:_.isScreenSharingEnabled),f=!!(null==_?void 0:_.isVideoEnabled);if(p&&f&&(a.set(bn(v,J.MediaType.SCREEN),Nn(i,l,c,n,t,J.MediaType.SCREEN)),a.set(bn(v,J.MediaType.CAMERA),xn(i,J.MediaType.CAMERA))),p!==f){var h=p?J.MediaType.SCREEN:J.MediaType.CAMERA,A=p?J.MediaType.CAMERA:J.MediaType.SCREEN;a.set(bn(v,h),Nn(i,l,c,n,t,h)),a.set(bn(v,A),Sn(i,A))}return p||f||(a.set(bn(v,J.MediaType.SCREEN),Sn(i,J.MediaType.SCREEN)),a.set(bn(v,J.MediaType.CAMERA),Sn(i,J.MediaType.CAMERA))),a}return a.set(v,yn(_)?Nn(i,l,c,n,t):Sn(i)),a}(e,n,t)}function En(e){return e&&!e.stopStream}function Sn(e,n){return void 0===n&&(n=null),{stopStream:!0,uid:e.externalId,mediaType:n}}function In(e,n){return void 0===n&&(n=null),{fit:_n.CONTAIN,width:265,height:200,priority:2,uid:e.externalId,mediaType:n}}function Tn(e,n,t,a){return void 0===a&&(a=null),{fit:_n.COVER,width:n,height:n,priority:t,uid:e.externalId,mediaType:a}}function Nn(e,n,t,a,i,o){return void 0===o&&(o=null),{fit:_n.CONTAIN,width:n?a:t?265:900,height:n?i:t?200:504,priority:3,uid:e.externalId,mediaType:o}}function xn(e,n){void 0===n&&(n=null);var t=e.mediaSettings;return{fit:(null==t?void 0:t.isScreenSharingEnabled)?_n.CONTAIN:_n.COVER,width:140,height:140,priority:1,uid:e.externalId,mediaType:n}}function yn(e){var n;return null!==(n=!!(null==e?void 0:e.isVideoEnabled)||!!(null==e?void 0:e.isScreenSharingEnabled))&&void 0!==n&&n}function bn(e,n){return void 0===n&&(n=null),n?e+":"+n:e}var On="GRID";function wn(e){var n=1*e;return Math.min(n+e+n,128)}function Mn(e){var n;return Boolean(null===(n=e.config)||void 0===n?void 0:n.enableParticipantListChunk)}function Pn(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(Mn(e)&&r){var s=(0,k.externalIdToString)(i),l=Jn(e,s),c=Vn(Wn(o),e),d=c>-1,u=-1===c;if(Qn(n,i,!1),d){var _=it(c,r),v={countBefore:r.countBefore,ids:_,countAfter:r.countAfter};ot(n,v),function(e,n,t,a){if(0===a.countAfter&&0===a.countBefore||ft(a,e))return Promise.resolve();At(e,n,t)}(e,n,t,v)}else u?(ot(n,{countBefore:r.countBefore-1}),gt(e,n,t)):ot(n,{countAfter:r.countAfter-1});l&&Yn(e,n,s)}}function kn(e,n,t){var a=t.numberOfVisible,o=t.firstVisible;return(0,i.__awaiter)(this,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(i){return t=Ye.GlobalStore.getCallsState(),o=ct(Math.max(0,o)),a=Math.ceil(a),function(e,n,t){var a=e.participantsChunk;if(!a)return!0;var i=a.countBefore,o=a.countAfter,r=i,s=r+a.ids.length,l=n+t,c=Math.ceil(1*t*.2);if((0===i||n-r>=c)&&(0===o||s-l>=c))return!1;return!0}(t,o,a)?[2,At(t,n,e,{firstVisible:o,numberOfVisible:a})]:[2]}))}))}function Ln(e,n,t,a,o){var r=o.externalId,s=o.markers,l=o.mediaSettings,c=o.permissionsOnce,d=l.isScreenSharingEnabled,u=e.participantsChunk,_=tt(u,nt(e,s));d||_?(!function(e,n,t){t&&$n(e,n,{markers:t})}(n,r,s),Bn(e,n,a,r,{mediaSettings:l,permissionsOnce:c})):Yn(e,n,(0,k.externalIdToString)(r));var v=0===(null==u?void 0:u.countBefore);(0,k.getOrator)(e).device!==e.localDevice||v||function(e,n,t){(0,i.__awaiter)(this,void 0,void 0,(function(){var a,o;return(0,i.__generator)(this,(function(r){switch(r.label){case 0:return[4,jn(e,{count:1,fromIdx:0})];case 1:return a=i.__read.apply(void 0,[r.sent().participants,1]),(o=a[0])?((0,k.toggleScreenSharing)(n,t,o.mediaSettings.isScreenSharingEnabled,o.uid),[2]):[2]}}))}))}(t,e,n),zn(e,n,t,a,{externalId:r,markers:s})}var Dn=[];function jn(e,n,t){var a=n.count,o=n.fromIdx,r=void 0===o?0:o,s=n.fromMarker,l=(void 0===t?{}:t).signal,c=void 0===l?null:l;return(0,i.__awaiter)(this,void 0,void 0,(function(){var n,t;return(0,i.__generator)(this,(function(i){return n=!1,t=function(){return n=!0},c&&c.addEventListener("abort",t,{once:!0}),[2,e.getParticipantListChunk({count:a,fromIdx:s?void 0:r,fromMarker:s,listType:On}).then((function(e){return n?Promise.reject(new Error("aborted")):e})).finally((function(){c&&c.removeEventListener("abort",t)}))]}))}))}function Rn(e,n,t,a){var i=qn(e,n,t,a.map((function(e){return e.externalId})));return Gn(n,a),i}function Bn(e,n,t,a,o){Rn(e,n,t,[(0,i.__assign)({externalId:a},o)])}function Un(e){var n;if(e){var t=null!==(n=e.countBefore)&&void 0!==n?n:0;return t?dt(t,1):t}return 0}function Hn(e,n){var t=lt(e),a=_t(e),i=t+a,o=n.countBefore;return n.ids.reduce((function(e,n,a){var r=o+a,s=r>=t&&r<i;return e.push({externalId:n,visible:s}),e}),[])}function Gn(e,n){var t=n.reduce((function(e,n){return e[(0,k.externalIdToString)(n.externalId)]=n,e}),{});e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:t})}function Vn(e,n){var t=n.participantsChunk,a=(null==t?void 0:t.ids)||[];return(0,Ve.binarySearch)(a,(function(t){var a=(0,k.externalIdToString)(t),i=Xn(n,a);if(!i)return 1;var o=Wn(i.markers);return J.Utils.participantMarkerCompare(e,o)}))}function Fn(e,n,t){var a;!function(e,n,t){var a,i,o=null!==(i=null===(a=e.participantsChunk)||void 0===a?void 0:a.ids)&&void 0!==i?i:[];if(!o.length)return;var r=t.participants.reduce((function(e,n){return e[(0,k.externalIdToString)(n.uid)]=!0,e}),{});vt(e,n,o.filter((function(e){var n=(0,k.externalIdToString)(e);return!r[n]})))}(e,n,t);var i=null!==(a=null==t?void 0:t.participants)&&void 0!==a?a:[],o={countBefore:t.countBefore,ids:i.map((function(e){return e.uid})),countAfter:t.countAfter};ot(n,o);var r=i.map((function(e){return{externalId:e.uid,markers:e.markers}}));Gn(n,r),en(e,n,i),Hn(e,o).forEach((function(e){$e(n,e.externalId,e)}))}function Wn(e){return null==e?void 0:e.GRID}function Zn(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(r){var s=et(e,i),l=nt(e,o),c=s>-1,d=tt(r,l);if(d&&!c){var u=0===r.countBefore&&r.countAfter?r.countAfter-1:r.countAfter;pt(e,n,t,{externalId:i,markers:o,countBefore:0===r.countAfter&&r.countBefore?r.countBefore-1:r.countBefore,countAfter:u})}else{if(c&&!d)!function(e,n,t,a){if(!a)return;var i=it(n,a),o=0===t;function r(e,n){return e?n+1:n}ot(e,{countBefore:r(o,a.countBefore),ids:i,countAfter:r(!o,a.countAfter)})}(n,s,l,r);else c&&d&&s!==l&&function(e,n,t,a,i){var o=Array.from(i);o.splice(t,0,a);var r=n+(t<=n?1:0);o.splice(r,1),ot(e,{ids:o})}(n,s,l,i,r.ids)}}}function zn(e,n,t,a,i){Zn(e,n,a,{externalId:i.externalId,markers:i.markers}),gt(e,n,t)}function Kn(e,n,t){(null==t?void 0:t.hand)&&Qn(e,n,t.hand.state)}function Qn(e,n,t){e({type:d.E_ACTION.SET_PARTICIPANT_HAND_STATE,key:(0,k.externalIdToString)(n),value:t})}function Yn(e,n,t){Jn(e,t)&&n({type:d.E_ACTION.REMOVE_DEVICE_FROM_CACHE,id:t})}function Jn(e,n){return Boolean(Xn(e,n))}function Xn(e,n){return e.devices[n]}function qn(e,n,t,a){return(0,i.__awaiter)(this,void 0,Promise,(function(){var o,r,s;return(0,i.__generator)(this,(function(i){return(o=a.reduce((function(n,t){var a=Number(t.id);return e.participants[a]||n.push(a),n}),[])).length?(r=e.callData.callId||"",s={withConversation:!e.callData.conversation,awaitImages:!1},[2,pn(e,n,t,r,o,s)]):[2,Promise.resolve()]}))}))}function $n(e,n,t){Gn(e,[(0,i.__assign)({externalId:n},t)])}function et(e,n){var t=Xn(e,(0,k.externalIdToString)(n));return t?Vn(Wn(t.markers),e):-1}function nt(e,n){var t=Vn(Wn(n),e);return t>-1?t:-(t+1)}function tt(e,n){if(!e)return!1;var t=e.ids;return 0===n&&0===e.countBefore||n===t.length&&0===e.countAfter||n>0&&n<t.length}function at(e,n,t,a,o){var r=o.externalId,s=o.marker;return(0,i.__awaiter)(this,void 0,void 0,(function(){var o;return(0,i.__generator)(this,(function(i){return o=(0,k.externalIdToString)(r),[2,jn(t,{count:1,fromMarker:s}).then((function(t){var i=t.participants[0];(0,k.externalIdToString)(i.uid)===o&&Bn(e,n,a,i.uid,{markers:i.markers,mediaSettings:i.mediaSettings})}))]}))}))}function it(e,n){if(!n)return[];var t=n.ids,a=Array.from(t);return a.splice(e,1),a}function ot(e,n){e({type:d.E_ACTION.SET_PARTICIPANTS_CHUNK,data:n})}function rt(e,n,t,a){var i=(0,k.externalIdToString)(t);(a.stream||a.screenSharingStream||Jn(e,i))&&$e(n,t,a)}function st(e,n){var t=1*n;return Math.max(0,e-t)}function lt(e){return ct(ut(e))}function ct(e){return dt(e,-1)}function dt(e,n){return Math.max(e+n,0)}function ut(e){var n;return null!==(n=e.isOratorMode?e.oratorScrollFirstVisible:e.gridScrollFirstVisible)&&void 0!==n?n:0}function _t(e){return e.isOratorMode?Math.ceil(e.oratorScrollNumberOfVisible):d.GRID_SCROLL_NUMBER_OF_VISIBLE}function vt(e,n,t){var a=[e.adminPinnedParticipant,e.screenSharingPinnedParticipant,e.pinnedParticipant].filter(Boolean).map((function(e){return(0,k.externalIdToString)(e)})).reduce((function(e,n){return e[n]=!0,e}),{});t.filter((function(e){var n=(0,k.externalIdToString)(e);return!a[n]})).forEach((function(t){var a=(0,k.externalIdToString)(t);Yn(e,n,a)}))}function pt(e,n,t,a){var o=a.externalId,r=a.markers,s=a.countBefore,l=a.countAfter,c=e.participantsChunk;if(c){s=null!=s?s:c.countBefore,l=null!=l?l:c.countAfter;var d=mt(Wn(r),e),u=ht(e),_=st(lt(e),_t(e)),v=Math.max(_-s,0),p=c.ids,f=Array.from(p);f.splice(d,0,o);var h=f.splice(0,v),A=f.splice(u),g={countBefore:s+h.length,ids:f,countAfter:l+A.length};Bn(e,n,t,o,{markers:r,status:J.ParticipantStatus.CONNECTED}),ot(n,g),function(e,n,t){t&&Gn(n,Hn(e,t))}(e,n,g),vt(e,n,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(h),!1),(0,i.__read)(A),!1))}}function ft(e,n){var t=ht(n);return e.ids.length>=t}function ht(e){return wn(_t(e))}function At(e,n,t,a){var i=void 0===a?{}:a,o=i.firstVisible,r=void 0===o?lt(e):o,s=i.numberOfVisible,l=void 0===s?_t(e):s,c=wn(l),d=function(e,n,t){return e.participantsChunk?st(n,t):0}(e,r,l);return jn(t,{count:c,fromIdx:d}).then((function(t){Fn(Ye.GlobalStore.isSet()?Ye.GlobalStore.getCallsState():e,n,t)}))}function gt(e,n,t){return kn(t,n,{firstVisible:ut(e),numberOfVisible:_t(e)})}function mt(e,n){return-(Vn(e,n)+1)}function Ct(e,n,t){var a=e.participantsChunk;return At(e,n,t,{firstVisible:null==a?void 0:a.countBefore,numberOfVisible:null==a?void 0:a.ids.length})}var Et,St,It,Tt=function(){function e(){}return e.getParticipantsMuteStates=function(n){e.abortGetParticipants();var t=new AbortController;e._lastController=t;var a=Ye.GlobalStore.getCallsStore(),o=a.getState(),r=a.dispatch,s=(0,Ve.objectMap)(o.devices,(function(e){return e.externalId}));s.length&&n.getParticipants({externalIds:s}).then((function(e){var n,a;if(!t.signal.aborted)try{for(var o=(0,i.__values)(e),s=o.next();!s.done;s=o.next()){var l=s.value;l.muteStates&&$e(r,l.uid,{permissions:xt.mapParticipantPermissions(l.muteStates)})}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}}))},e.abortGetParticipants=function(){e._lastController&&(e._lastController.abort(),e._lastController=null)},e._lastController=null,e}();!function(e){e[e.None=0]="None",e[e.Muted=1]="Muted",e[e.MutedPermanent=2]="MutedPermanent",e[e.UnmutedWithoutAttraction=3]="UnmutedWithoutAttraction",e[e.CanTurnOnOnce=4]="CanTurnOnOnce",e[e.CanTurnOnOnceWithoutAttraction=5]="CanTurnOnOnceWithoutAttraction",e[e.UnmutedWithAttraction=6]="UnmutedWithAttraction"}(St||(St={})),function(e){e[e.Increase=0]="Increase",e[e.Clear=1]="Clear",e[e.Reset=2]="Reset"}(It||(It={}));var Nt=((Et={})[J.MediaOption.AUDIO]="audio",Et[J.MediaOption.VIDEO]="video",Et[J.MediaOption.SCREEN_SHARING]="screenSharing",Et),xt=function(){function e(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this._params=e.mapArgs.apply(null,n),this._store=Ye.GlobalStore.getCallsStore(),this._dispatch=this._store.dispatch}return e.prototype.updateCallMuteState=function(e){var n=this._params,t=this._dispatch,a=this._store.getState();(0,Ve.isBoolean)(n.stateUpdated)&&!n.stateUpdated||n.muteAll&&(t({type:d.E_ACTION.SET_CALL_PERMISSIONS,data:n.muteStates}),((0,k.isAdmin)(a.localDevice)||(0,k.isCreator)(a.localDevice))&&n.mediaOptions.some((function(e){var t=a.permissions[e],i=n.muteStates[e];return t===J.MuteState.MUTE_PERMANENT&&i===J.MuteState.MUTE||t===J.MuteState.MUTE&&i===J.MuteState.MUTE_PERMANENT}))&&(a.config.enableParticipantListChunk?Ct(a,t,e):Tt.getParticipantsMuteStates(e)))},e.prototype.updatePersonalMuteState=function(){var e=this._params,n=this._store.getState(),t=this._dispatch;if((!e.userId||(0,k.isSameExternalId)(e.userId,n.externalId))&&(!e.adminId||!(0,k.isSameExternalId)(e.adminId,n.externalId))&&e.stateUpdated&&(e.muteAll||!e.requestedMedia)){var a=St.None,o=St.None,r=(0,i.__assign)({},n.localDevice.permissions);if(e.mediaOptions.includes(J.MediaOption.AUDIO)){var l=r.audio,c=e.muteStates[J.MediaOption.AUDIO]||J.MuteState.UNMUTE;l!==J.MuteState.MUTE_PERMANENT&&c===J.MuteState.MUTE_PERMANENT?a=St.MutedPermanent:l===J.MuteState.MUTE_PERMANENT&&c!==J.MuteState.MUTE_PERMANENT?a=St.UnmutedWithoutAttraction:c===J.MuteState.MUTE&&(a=St.Muted),r.audio=c}if(e.mediaOptions.includes(J.MediaOption.VIDEO)){l=r.video,c=e.muteStates[J.MediaOption.VIDEO]||J.MuteState.UNMUTE;l!==J.MuteState.MUTE_PERMANENT&&c===J.MuteState.MUTE_PERMANENT?o=St.MutedPermanent:l===J.MuteState.MUTE_PERMANENT&&c!==J.MuteState.MUTE_PERMANENT?o=St.UnmutedWithoutAttraction:c===J.MuteState.MUTE&&(o=St.Muted),r.video=c,r.screenSharing=c}var u=[],_=St.None;if(e.mediaOptions.length)if(a!==St.None&&o!==St.None){if(u.push(J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING),_=a,a!==o)return void(0,J.debugMessage)(J.DebugMessageType.ERROR,{error:"unexpected mute feedbacks pair audio="+a+" video="+o})}else o!==St.None?(u.push(J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING),_=o):a!==St.None&&(u.push(J.MediaOption.AUDIO),_=a);_!==St.None&&u.length&&this._handleFeedbackEvent({didReceiveEvent:_,forMedia:u}),(0,s.isEqual)(r,n.localDevice.permissions)||t({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:r}})}},e.prototype.updateExternalMuteState=function(){var e,n,t=this._params,a=this._store.getState(),o=this._dispatch;if(t.userId&&!(0,k.isSameExternalId)(t.userId,a.externalId)&&t.stateUpdated){var r,s,l=(0,k.externalIdToString)(t.userId),c={externalId:t.userId},u=null===(n=a.devices[l])||void 0===n?void 0:n.permissions,_=(r=t.muteStates,s=t.mediaOptions,(0,Ve.objectReduce)(r,(function(e,n,t){return s.includes(t)&&(e[Nt[t]]=n),e}),{}));c.permissions=(0,i.__assign)((0,i.__assign)({},u),_),t.unmuteOptions.length?c.permissionsOnce=new Set(t.unmuteOptions):(0,Ve.objectSome)(t.muteStates,(function(e){return e===J.MuteState.MUTE_PERMANENT}))&&(c.permissionsOnce=void 0),o({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:(e={},e[l]=c,e)})}},e.prototype.updatePersonalPermissionsOnce=function(){var e,n=this._params,t=this._store.getState(),a=!(0,Ve.isBoolean)(n.stateUpdated)||n.stateUpdated;n.userId&&!(0,k.isSameExternalId)(n.userId,t.externalId)||n.adminId&&(0,k.isSameExternalId)(n.adminId,t.externalId)||(null===(e=n.requestedMedia)||void 0===e?void 0:e.length)||a&&n.unmuteOptions.length&&this._handleFeedbackEvent({didReceiveEvent:St.CanTurnOnOnceWithoutAttraction,forMedia:(0,i.__spreadArray)([],(0,i.__read)(n.unmuteOptions),!1)})},e.prototype.attractAttentionIfNeeded=function(){var e=this._params,n=this._store.getState();if((!e.userId||(0,k.isSameExternalId)(e.userId,n.externalId))&&(!e.adminId||!(0,k.isSameExternalId)(e.adminId,n.externalId))&&e.requestedMedia&&e.requestedMedia.length){var t=St.None,a=St.None;if(e.requestedMedia.includes(J.MediaOption.AUDIO)&&(e.muteAll&&n.localDevice.permissions.audio===J.MuteState.MUTE_PERMANENT||n.localDevice.mediaSettings.isAudioEnabled||(t=n.permissions[J.MediaOption.AUDIO]===J.MuteState.MUTE_PERMANENT||n.localDevice.permissions.audio===J.MuteState.MUTE_PERMANENT?St.CanTurnOnOnce:St.UnmutedWithAttraction)),e.requestedMedia.includes(J.MediaOption.VIDEO)&&(e.muteAll&&n.localDevice.permissions.video===J.MuteState.MUTE_PERMANENT||n.localDevice.mediaSettings.isVideoEnabled||(a=n.permissions[J.MediaOption.VIDEO]===J.MuteState.MUTE_PERMANENT||n.localDevice.permissions.video===J.MuteState.MUTE_PERMANENT?St.CanTurnOnOnce:St.UnmutedWithAttraction)),t!==St.None&&a!==St.None){var i=St.None;i=t!=a?St.CanTurnOnOnce:t,this._handleFeedbackEvent({didReceiveEvent:i,forMedia:[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]})}else t!==St.None?this._handleFeedbackEvent({didReceiveEvent:t,forMedia:[J.MediaOption.AUDIO]}):a!==St.None&&this._handleFeedbackEvent({didReceiveEvent:a,forMedia:[J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]})}},e.prototype._handleFeedbackEvent=function(e){var n=e.didReceiveEvent,t=e.forMedia;switch(n){case St.CanTurnOnOnce:this._lowerHandIfRaised(),this._updatePermissionsOnce(t,It.Increase),this._openUnmuteRequestPopup(t);break;case St.CanTurnOnOnceWithoutAttraction:this._updatePermissionsOnce(t,It.Reset);break;case St.UnmutedWithAttraction:this._lowerHandIfRaised(),this._openUnmuteRequestPopup(t);break;case St.Muted:this._notificationMuted(t);break;case St.MutedPermanent:this._closeUnmuteRequestPopupIfOpened(),this._updatePermissionsOnce(t,It.Clear),this._notificationMutedPermanent(t);break;case St.UnmutedWithoutAttraction:this._lowerHandIfRaised(),this._notificationUnmuted(t)}},e.prototype._notificationUnmuted=function(e){var n=null;3===e.length?n=d.NotificationType.ADMIN_UNMUTE_PERMANENT:e.includes(J.MediaOption.AUDIO)?n=d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:e.includes(J.MediaOption.VIDEO)&&(n=d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO),this._showNotification(n)},e.prototype._notificationMuted=function(e){var n=null;3===e.length?n=d.NotificationType.ADMIN_MUTE:e.includes(J.MediaOption.AUDIO)?n=d.NotificationType.ADMIN_MUTE_AUDIO:e.includes(J.MediaOption.VIDEO)&&(n=d.NotificationType.ADMIN_MUTE_VIDEO),this._showNotification(n)},e.prototype._notificationMutedPermanent=function(e){var n=null;3===e.length?n=d.NotificationType.ADMIN_MUTE_PERMANENT:e.includes(J.MediaOption.AUDIO)?n=d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:e.includes(J.MediaOption.VIDEO)&&(n=d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO),this._showNotification(n)},e.prototype._showNotification=function(e){var n;if(e){var t=null===(n=this._store.getState().notification)||void 0===n?void 0:n.ts;if((0,s.isUndefined)(t)||!(Date.now()-t<1e3))(0,this._dispatch)({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:e}})}},e.prototype._lowerHandIfRaised=function(){var e,n,t=this._store.getState(),a=this._dispatch;(null===(n=null===(e=t.localDevice.statusData)||void 0===e?void 0:e.hand)||void 0===n?void 0:n.state)&&(0,J.changeParticipantState)({hand:d.SdkHandType.LOWERED}).then((function(){a({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i.__assign)((0,i.__assign)({},t.localDevice.statusData),{hand:{ts:Date.now(),state:!1}})}})})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e)}))},e.prototype._openUnmuteRequestPopup=function(e){var n=this._dispatch,t=Xe(Object.values(J.MediaOption)),a=function(e,n){return n.reduce((function(n,t){return n|e[t]}),0)}(t,e),i="";Je(a,t.AUDIO|t.VIDEO|t.SCREEN_SHARING)?i=d.POPUP_UNMUTE_REQUEST:Je(a,t.VIDEO|t.SCREEN_SHARING)?i=d.POPUP_UNMUTE_VIDEO_REQUEST:Je(a,t.AUDIO)&&(i=d.POPUP_UNMUTE_AUDIO_REQUEST),i&&n({type:d.E_ACTION.TOGGLE_POPUP,data:i})},e.prototype._closeUnmuteRequestPopupIfOpened=function(){var e=this._store.getState(),n=this._dispatch;(0,Ve.hasIn)(e.popup,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_AUDIO_REQUEST)&&n({type:d.E_ACTION.TOGGLE_POPUP})},e.prototype._updatePermissionsOnce=function(e,n){var t=this._dispatch,a=this._store.getState(),i=new Set(a.localDevice.permissionsOnce);switch(n){case It.Increase:e.forEach((function(e){return i.add(e)}));break;case It.Clear:e.forEach((function(e){return i.delete(e)}));break;case It.Reset:i.clear(),e.forEach((function(e){return i.add(e)}))}t({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissionsOnce:i}})},e.getDecreasedPermissionsOnce=function(e,n,t){if(null==t?void 0:t.size){var a=new Set(t);return e.isAudioEnabled&&!n.isAudioEnabled&&a.delete(J.MediaOption.AUDIO),e.isVideoEnabled&&!n.isVideoEnabled&&a.delete(J.MediaOption.VIDEO),e.isScreenSharingEnabled&&!n.isScreenSharingEnabled&&a.delete(J.MediaOption.SCREEN_SHARING),a}},e.getUnmutedPermissions=function(){return{audio:J.MuteState.UNMUTE,video:J.MuteState.UNMUTE,screenSharing:J.MuteState.UNMUTE}},e.isMediaAllowed=function(e,n,t){if(!n)return!1;var a=Ye.GlobalStore.getCallsState(),i=a.permissions,o=!("externalId"in n)?n:a.participants[n.externalId.id];if((0,k.isAdmin)(o)||(0,k.isCreator)(o))return!0;var r,s=n.permissions,l=n.permissionsOnce;switch(e){case"audio":r=J.MediaOption.AUDIO;break;case"video":r=J.MediaOption.VIDEO;break;case"screenSharing":r=J.MediaOption.SCREEN_SHARING}return(null==s?void 0:s[e])===J.MuteState.MUTE||(i[r]!==J.MuteState.MUTE_PERMANENT&&(null==s?void 0:s[e])!==J.MuteState.MUTE_PERMANENT||!t&&!!(null==l?void 0:l.has(r)))},e.mapParticipantPermissions=function(n){var t,a;if(n){var o=e.getUnmutedPermissions();try{for(var r=(0,i.__values)(Object.entries(n)),s=r.next();!s.done;s=r.next()){var l=(0,i.__read)(s.value,2),c=l[0],d=l[1];switch(c){case J.MediaOption.AUDIO:o.audio=d;break;case J.MediaOption.SCREEN_SHARING:o.screenSharing=d;break;case J.MediaOption.VIDEO:o.video=d}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}return o}},e.decreasePermissionsOnce=function(n,t,a){var i=n.localDevice.mediaSettings,o=e.getDecreasedPermissionsOnce(i,a,n.localDevice.permissionsOnce);t({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{mediaSettings:a,permissionsOnce:o}})},e.mapArgs=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return{muteStates:e[0],unmuteOptions:e[1],mediaOptions:e[2],muteAll:e[3],unmute:e[4],userId:e[5],adminId:e[6],stateUpdated:e[7],requestedMedia:e[8]}},e}();var yt=t(37441),bt={},Ot=function(e){var n=e.state,t=e.SDK,a=e.dispatch,i=e.participant,o=e.addProfileLink,r=e.getLang,s=e.navigateToConvo,l=e.navigateToProfile,c=e.separatedList,u=void 0!==c&&c,_=e.device,v=_?(0,k.externalIdToString)(_.externalId):i.peerId,p=n.groupId?i.peerId===n.groupId:i.peerId===n.me,f=_?(0,k.isSameExternalId)(_.externalId,n.externalId):p,h=(0,k.isParticipantAnonym)(i.peerId),A=(0,O.isGroupCallByPeer)(n.peer),g=!!n.groupId,m=[],C=[],E=n.config.isModalView,S=(0,k.isParticipantGroup)(i.peerId);if(f||!o||h||void 0===l||m.push({text:r(S?"calls_go_to_community":"calls_go_to_profile"),onClick:function(e){l(e,i.link)}}),f||h||(0,k.isParticipantAnonym)(n.me)||void 0===s||g||m.push({text:r(S?"calls_go_to_chat_with_community":"calls_go_to_chat_with_participant"),onClick:function(){var e=function(e,n){if(e.peerId)return e.peerId;if(!(null==n?void 0:n.externalId.id))return null;return+(null==n?void 0:n.externalId.id)}(i,_);e?s(e)!==yt.ENavigateToConvoDirection.FastChat&&(E&&a({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED}),a({type:d.E_ACTION.MANAGEMENT,isOpen:!1})):(0,J.debugMessage)(J.DebugMessageType.ERROR,{text:"[getPeerId] returned id: 0",peerId:e})}}),!p&&A&&!(0,k.isParticipantAnonym)(n.me)&&((0,k.isAdmin)(n.localDevice)||(0,k.isCreator)(n.localDevice))&&!(0,k.isCreator)(i)){var I={negative:!0,text:r("calls_participant_menu_kick"),onClick:function(){a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.CALL,participant:i}})}};u?C.push(I):m.push(I)}if(!f&&A&&!(0,k.isParticipantAnonym)(n.me)&&(0,k.canMuteParticipants)(n.localDevice)&&_&&(m.push({text:r("calls_participant_menu_mute_audio"),onClick:function(){a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.SINGLE_AUDIO,device:_}})},isEnabled:xt.isMediaAllowed("audio",_,!0)}),m.push({text:r("calls_participant_menu_mute_video"),onClick:function(){a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.SINGLE_VIDEO,device:_}})},isEnabled:xt.isMediaAllowed("video",_,!0)})),f||A||(0,k.isParticipantAnonym)(n.me)||!(0,k.canMuteParticipants)(n.localDevice)||m.push({text:r("calls_participant_menu_mute"),onClick:function(){var e=function(e){var n;t.muteParticipant(e.externalId,(n={},n[J.MediaOption.AUDIO]=J.MuteState.MUTE,n)).catch(console.log)};_?e(_):Pt(i,e)}}),f||!A||(0,k.isParticipantAnonym)(n.me)||!(0,k.canMuteParticipants)(n.localDevice)||function(e){return(0,k.someDeviceByParticipant)(e,(function(e){if((0,Ve.isEmpty)(e.mediaSettings))return!1;var n=e.mediaSettings,t=n.isAudioEnabled,a=n.isVideoEnabled,i=n.isScreenSharingEnabled;return!(!t||!a&&!i)}))}(i)||m.push({text:r("calls_participant_menu_enable_media_request"),onClick:function(){var e=function(e){t.muteParticipant(e.externalId,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_USER_TO_UNMUTE,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,O.isGroupCallByPeer)(n.peer)})};_?e(_):Pt(i,e)}}),f||!A||(0,k.isParticipantAnonym)(n.me)||(0,k.isParticipantAnonym)(i.peerId)||!Mt(n.localDevice)||(0,k.isAdmin)(i)||(0,k.isCreator)(i)||!(0,k.someDeviceByParticipant)(i,(function(e){return e.status===J.ParticipantStatus.CONNECTED}))||m.push({text:r("calls_participant_menu_assign_admin_role"),onClick:function(){a({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT,data:{participant:i}})}}),!p&&A&&!(0,k.isParticipantAnonym)(n.me)&&Mt(n.localDevice)&&(0,k.isAdmin)(i)&&m.push({text:r("calls_participant_menu_revoke_admin_role"),onClick:function(){var e=(0,k.getParticipantExternalId)(i);e&&(t.grantRoles(e,[J.UserRole.ADMIN],!0).then((function(){a({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:i.peerId,data:(i.roles||[]).filter((function(e){return e!==J.UserRole.ADMIN}))})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.RETRIEVE_ADMIN,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,O.isGroupCallByPeer)(n.peer)}))}}),A&&!(0,k.isParticipantAnonym)(n.me)&&(0,k.canPinParticipants)(n.localDevice)&&!wt(n.adminPinnedParticipant,_||i)&&m.push({text:r("calls_participant_menu_pin"),onClick:function(){var e=function(e){t.pinParticipant(e.externalId,!1).then((function(){a({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:e.externalId}),a({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_PIN,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,O.isGroupCallByPeer)(n.peer)})};_?e(_):Pt(i,e)}}),A&&!(0,k.isParticipantAnonym)(n.me)&&(0,k.canPinParticipants)(n.localDevice)&&wt(n.adminPinnedParticipant,_||i)&&m.push({text:r("calls_participant_menu_pin_cancel"),onClick:function(){var e=function(e){t.pinParticipant(e.externalId,!0).then((function(){a({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,O.isGroupCallByPeer)(n.peer)})};_?e(_):Pt(i,e)}}),u&&C.length>0&&(m.push({separator:!0}),m=m.concat(C)),bt[v]){var T=m.length===bt[v].length;if(T)for(var N=0;N<m.length;N++)m[N].text===bt[v][N].text&&m[N].isEnabled===bt[v][N].isEnabled||(T=!1);T?m=bt[v]:bt[v]=m}else bt[v]=m;return m};function wt(e,n){return"externalId"in n?(0,k.isSameExternalId)(e,n.externalId):!(null===e||!n.peerId)&&e.id===n.peerId.toString()}function Mt(e){return!!e.roles&&((0,k.isCreator)(e)||(0,k.isAdmin)(e))}function Pt(e,n){var t,a,o=Ye.GlobalStore.getCallsState(),r=o.maps.vkIdToDevices,s=o.devices,l=r.get(e.peerId);if(l)try{for(var c=(0,i.__values)(l),d=c.next();!d.done;d=c.next()){var u=s[d.value];u&&n(u)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(t)throw t.error}}}var kt=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"28px",height:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 28 10"},n,{children:(0,o.jsx)("path",{fill:"#F2F3F5",fillRule:"evenodd",d:"M1 0a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2H2V1a1 1 0 00-1-1zm7 1a1 1 0 112 0v8a1 1 0 11-2 0V1zm15-1a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2h-3V6h3a1 1 0 100-2h-3V2h3a1 1 0 100-2h-4zm-8.325 9.31l-2.55-7.824a.993.993 0 01-.117-.363L12 1.1h.005A1 1 0 1113.995.9L14 .9l2 6.4 2-6.4h.005a1 1 0 011.99.2H20l-.008.023a.993.993 0 01-.118.363l-2.55 7.824a1 1 0 01-.95.69h-.748a1 1 0 01-.95-.69z",clipRule:"evenodd"},void 0)}),void 0)},Lt=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C4.546 0 1.596 2.073.4 5c1.196 2.927 4.146 5 7.6 5 3.455 0 6.405-2.073 7.6-5-1.195-2.927-4.145-5-7.6-5zm3.5 5a3.5 3.5 0 11-7 0 3.5 3.5 0 017 0zM8 7a2 2 0 100-4 2 2 0 000 4z",fill:"#F5F5F5"},void 0)}),void 0)},Dt=t(53449),jt=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({xmlns:"http://www.w3.org/2000/svg",width:"8",height:"4",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},n,{children:(0,o.jsx)("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"},void 0)}),void 0)};const Rt=(0,X.makeIcon)("Icon12Hand","hand_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="hand_12"><path d="M2.5 2.5A.5.5 0 0 1 3 3v2.5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0V5a.5.5 0 0 0 1 0V1a.5.5 0 0 1 1 0v4.063a.5.5 0 0 0 1 0V1.938a.5.5 0 0 1 1 0V7.5l-.28-.032 1.774-1.898a.67.67 0 0 1 .995.9c-.677.774-2.013 2.306-2.615 3.029C7.935 10.624 6.56 11 5.526 11 2.15 11 2 8.727 2 7.958V3a.5.5 0 0 1 .5-.5Z" /></symbol>',12,12,!1,void 0),Bt=(0,X.makeIcon)("Icon20RecordingCircleFill","recording_circle_fill_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="recording_circle_fill_20"><path d="M10 14a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" /><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-1.657 0a6.343 6.343 0 1 1-12.686 0 6.343 6.343 0 0 1 12.686 0Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var Ut=function(e){var n=e.translationTimer,t=e.viewersCount,a=void 0===t?0:t,r=e.isLiveIndicatorOff,l=void 0!==r&&r,c=e.actions,d=void 0===c?[]:c,u=e.tooltipText,_=void 0===u?"":u,v=(0,s.classNames)({TranslationStatus__translationIndicator:!0,"TranslationStatus__translationIndicator--disabled":l}),p=(null==d?void 0:d.length)>0,f=(0,s.classNames)({TranslationStatus__translationTimer:!0,"TranslationStatus__translationTimer--hasIndicator":!l}),h=(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translation"},{children:[(0,o.jsx)(kt,{className:v},void 0),(0,o.jsxs)(o.Fragment,{children:[!!n&&(0,o.jsx)("div",(0,i.__assign)({className:f},{children:n}),void 0),!l&&(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCount"},{children:[(0,o.jsx)(Lt,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCountNumber"},{children:a}),void 0)]}),void 0),p&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationDropdown"},{children:(0,o.jsx)(jt,{},void 0)}),void 0)]},void 0)]}),"translation");return p?h=(0,o.jsx)(Dt.default,(0,i.__assign)({position:"b",align:"center",horizontalPosition:"right",trigger:"hover",marginLeft:-10,data:d,className:"TranslationStatus_dropdown"},{children:h}),void 0):_&&(h=(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:(0,o.jsx)(o.Fragment,{children:_},void 0)},{children:h}),void 0)),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus"},{children:h}),void 0)},Ht=function(e){var n=e.translationTimer,t=e.hands,a=e.isMeAuthor,r=e.recordStartTimeMs,l=e.recordAuthorDisplayName,c=e.onStopRecord,d=e.isCanStopRecord,u=(0,ue.useLang)().getLang,_=Date.now()-(r||0)>5e3,v=!!n&&_,p=!!n&&!_,f=!n&&!a&&!!l,h=(t||0)>0,A=!(!a&&!d);return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TranslationStatus","TranslationStatus--is-record")},{children:[h&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__hands"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__hands CallHeader__hands--visible"},{children:[(0,o.jsx)(Rt,{},void 0)," ",t]}),void 0)}),void 0),(0,o.jsx)("div",{className:"TranslationStatus__divider"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({TranslationStatus__translation:!0,"TranslationStatus__translation--is-not-author":!A})},{children:[(0,o.jsx)(Bt,{fill:"#FF3347",width:16,height:16},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationTimer"},{children:[v&&n,p&&u("calls_recording_in_progress"),f&&u("calls_name_is_recording").replace("{name}",l)]}),void 0),A&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationStatus__endRecord",onClick:c},{children:u("calls_end_recording")}),void 0)]}),"translation")]}),void 0)},Gt=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.978 3.423a1.792 1.792 0 00-1.645 1.785v1.765l-.1.021a8.254 8.254 0 00-6.44 8.917.75.75 0 001.343.379l.175-.22a7.577 7.577 0 015.022-2.721v2.08a1.792 1.792 0 002.897 1.41l6.52-5.11a1.792 1.792 0 000-2.82l-6.52-5.11a1.791 1.791 0 00-1.105-.382l-.147.006zm.147 1.494c.065 0 .129.021.18.062l6.52 5.11a.292.292 0 010 .459l-6.52 5.11a.292.292 0 01-.472-.23v-2.873a.75.75 0 00-.767-.75l-.215.005-.305.016a9.065 9.065 0 00-5.162 2.056l-.037.032.004-.027a6.752 6.752 0 015.823-5.533.75.75 0 00.659-.744V5.208c0-.16.13-.291.292-.291z",fill:"#99A2AD"},void 0)}),void 0)},Vt=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.72 4.72a.75.75 0 011.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z",fill:"#99A2AD"},void 0)}),void 0)},Ft=t(82280);function Wt(e){var n,t,a,i;return!(!(0,k.isAdmin)(e.localDevice)&&!(0,k.isCreator)(e.localDevice))||!!(null===(t=null===(n=e.translation)||void 0===n?void 0:n.host)||void 0===t?void 0:t.id)&&+(null===(i=null===(a=e.translation)||void 0===a?void 0:a.host)||void 0===i?void 0:i.id)===(0,k.getMeId)(e)}function Zt(e){return!(!(0,k.isAdmin)(e.localDevice)&&!(0,k.isCreator)(e.localDevice))||zt(e)}function zt(e){return(0,k.isParticipantGroup)(e.groupId)?e.groupId===e.translation.ownerId:e.me===e.translation.ownerId}var Kt=function(e){var n=e.hands,t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langNumeric,c=P((function(e){return e})),_=u(),v=(0,i.__read)((0,l.useState)(null),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(!1),2),A=h[0],g=h[1],m=(0,i.__read)((0,l.useState)(""),2),C=m[0],S=m[1],I=(0,i.__read)((0,l.useState)(0),2),T=I[0],N=I[1],x=(0,i.__read)((0,l.useState)([]),2),y=x[0],b=x[1],O=(0,i.__read)((0,l.useState)((function(){return qt(c.translation.startTime)})),2),w=O[0],M=O[1],L=(0,i.__read)((0,l.useState)(Xt(w)),2),D=L[0],j=L[1],R=(0,i.__read)((0,l.useState)(""),2),B=R[0],U=R[1],H=(0,i.__read)((0,l.useState)(!1),2),G=H[0],V=H[1],F=(0,l.useMemo)((function(){return(0,k.isAdmin)(c.localDevice)||(0,k.isCreator)(c.localDevice)}),[c.localDevice]),W=function(e){var n=(0,i.__read)((0,l.useState)(),2),t=n[0],a=n[1],o=P((function(n){return e.ownerId?n.participants[e.ownerId]:void 0}));(0,l.useEffect)((function(){if(e.isRecord&&e.ownerId&&e.videoId&&!o){var n=new AbortController,t=e.ownerId+"_"+e.videoId;return(0,nn.videoGet)({videos:t},{signal:n.signal}).then(a),function(){n.abort()}}}),[e.ownerId,e.videoId,e.isRecord,o]);var r=(0,l.useMemo)((function(){var e="";if(o)e=o.shortName||o.name||e;else{var n=null==t?void 0:t.items[0].owner_id;if(!(0,s.isUndefined)(n)&&(0,k.isParticipantGroup)(n)&&(null==t?void 0:t.groups)){var a=t.groups.find((function(e){return e.id===-n}));e=(null==a?void 0:a.name)||e}}return e}),[t,o]);return{data:t,recordAuthorDisplayName:r}}({isRecord:c.translation.isRecord,ownerId:c.translation.ownerId,videoId:c.translation.videoId}),Z=(0,k.isParticipantGroup)(c.groupId)?c.groupId===c.translation.ownerId:c.me===c.translation.ownerId,z=(0,l.useCallback)((function(){_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]);return(0,l.useEffect)((function(){var e=Wt(c);g(e)}),[c.translation,c.localDevice]),(0,l.useEffect)((function(){var e,n;if(null===(e=c.translation.host)||void 0===e?void 0:e.id){var t=c.participants[null===(n=c.translation.host)||void 0===n?void 0:n.id],a=(null==t?void 0:t.shortName)||(null==t?void 0:t.name);a!==p&&f(a)}else p&&f(null)}),[c.translation,c.participants]),(0,l.useEffect)((function(){var e=[];if(A){if(D){var n={text:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemWillStartSoon"},{children:a("calls_info_translation_will_start_soon")}),void 0)};e.push(n)}e.push(Qt((0,o.jsx)(Gt,{},void 0),a("calls_info_translation_share_menu_item"),(function(){return _({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}))),e.push(Qt((0,o.jsx)(Vt,{},void 0),a("calls_translation_stop_menu_item"),z))}b(e)}),[A,D]),(0,l.useEffect)((function(){var e=Xt(w);e&&w>-4&&A&&!G&&(V(!0),_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})),j(e)}),[w]),(0,l.useEffect)((function(){var e=qt(c.translation.startTime);M(e);var n=setInterval((function(){return M(qt(c.translation.startTime))}),Ft.SECOND_JS);return function(){return clearInterval(n)}}),[c.translation.startTime]),(0,l.useEffect)((function(){var e="";if(D){var n=Math.abs(w);if(n>Ft.DAY){var t=Math.floor(n/Ft.DAY);e=r(t,"calls_translation_upcoming_time_more_day_short",a("calls_translation_upcoming_time_more_day_short",t)).replace("%s",t)}else e=Yt("-"+Jt(n))}else e=Yt(Jt(w));S(e)}),[w,D]),(0,l.useEffect)((function(){var e,n=c.translation,t=n.ownerId,a=n.videoId;if(t&&a&&!D){var i=function(){var e={owner_id:t,video_id:a};(0,nn.videoLiveGetSpectators)(e).then((function(e){var n;N(null===(n=e.spectators)||void 0===n?void 0:n.count)}))};i(),e=setInterval(i,15*Ft.SECOND_JS)}return function(){return clearInterval(e)}}),[D,c.translation.ownerId,c.translation.videoId]),(0,l.useEffect)((function(){if(!A){var e="";e=D?a("calls_info_translation_will_start_soon"):p?a("calls_translation_host_info").replace("{name}",p):a("calls_translation_host_info_unknown"),U(e)}}),[D,p,A]),c.translation.isRecord?Z?(0,o.jsx)(Ht,{hands:n,onStopRecord:z,recordStartTimeMs:c.translation.startTime,isMeAuthor:Z,translationTimer:C},void 0):(0,o.jsx)(Ht,{hands:n,onStopRecord:z,recordStartTimeMs:c.translation.startTime,isCanStopRecord:F,recordAuthorDisplayName:W.recordAuthorDisplayName},void 0):(0,o.jsx)(Ut,{translationTimer:C,viewersCount:T,isLiveIndicatorOff:D,actions:y,tooltipText:B},void 0)};function Qt(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}}function Yt(e){return(0,o.jsx)(Ge,{duration:e},void 0)}function Jt(e){return 0===e?"00:00":e<=599?"0"+(0,s.formatDuration)(e):(0,s.formatDuration)(e)}function Xt(e){return e<0}function qt(e){var n=Date.now();return Math.floor((n-e)/1e3)}var $t=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 10 11"},n,{children:(0,o.jsx)("path",{fill:"#F5F5F5",d:"M.5 2.5A.5.5 0 011 3v2.5a.5.5 0 001 0v-4a.5.5 0 011 0V5a.5.5 0 001 0V1a.5.5 0 011 0v4.063a.5.5 0 001 0V1.938a.5.5 0 011 0V7.5l-.28-.032L8.494 5.57a.67.67 0 01.995.9 232.32 232.32 0 00-2.615 3.029C5.935 10.624 4.56 11 3.526 11 .15 11 0 8.727 0 7.958V3a.5.5 0 01.5-.5z"},void 0)}),void 0)},ea=(0,l.memo)((function(e){var n=e.translation,t=e.speakers,a=e.hands,r=e.time,l=e.network,c=e.networkTooltipText,d=e.isTranslationRecord,u=(0,s.classNames)("CallHeader__hands",{"CallHeader__hands--visible":a>0});return(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__main"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({CallHeader__timeAndNetwork:!0,"CallHeader__timeAndNetwork--is-record":d})},{children:[l<.6&&(0,o.jsx)(C.default,(0,i.__assign)({text:c,align:"left",className:"Call__oldTooltip"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__network"},{children:(0,o.jsx)(q,{fill:l<=.3?"#ff5c5c":"#FECE00"},void 0)}),void 0)}),void 0),r]}),void 0),n&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__translation"},{children:n}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__aside"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__participants"},{children:t}),void 0),!d&&(0,o.jsxs)("div",(0,i.__assign)({className:u},{children:[(0,o.jsx)($t,{},void 0)," ",a]}),void 0)]}),void 0)]}),void 0)}));function na(e){var n,t=e.onHandCountChanged,a=(0,c.useSelector)((function(e){return e})),r=(0,O.isGroupCallByPeer)(a.peer),s=(0,l.useContext)(E.LangContext),d=s.getLang,u=s.langNumeric,_=(0,i.__read)((0,l.useState)(null),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(0),2),h=f[0],A=f[1],g=(0,i.__read)((0,l.useState)(null),2),m=g[0],C=g[1];(0,l.useEffect)((function(){var e=(0,O.isGroupCallByPeer)(a.peer)?a.callData.ts:a.callData.localTimeStamp;C(Ze(e));var n=setInterval((function(){return C(Ze(e))}),1e3);return function(){return clearInterval(n)}}),[a.peer,a.callData.localTimeStamp,a.callData.ts]),(0,l.useEffect)((function(){var e=(0,k.getRaisedHands)(a.devices,a.localDevice,a.handState);e!==h&&(A(e),t&&t(e))}),[a.devices,a.localDevice,a.handState]),(0,l.useEffect)((function(){if(r){var e=a.speakersInHeader.reduce((function(e,n){var t=a.devices[n],i=t&&a.participants[t.externalId.id];return i&&(i.shortName||i.name)&&e.push(i),e}),[]);if(e.length>0){var n=d("calls_participants_speak",e.length).split(" ");p((0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",(0,i.__assign)({className:"CallHeader__speak"},{children:[n[0]," "]}),void 0),(0,Ve.getParticipantsListLabel)(e,e.slice(0,2),(function(e){return e.shortName||e.name}),d,u,0,2)]},void 0))}else p(null)}}),[a.participants,a.speakersInHeader,a.devices]);var S=(0,l.useMemo)((function(){return a.translation.isOn&&a.translation.isRecord?(0,o.jsx)(Kt,{hands:h},void 0):a.translation.isOn?(0,o.jsx)(Kt,{},void 0):""}),[a.translation.isOn,h,a.translation.isRecord]);return(0,o.jsx)(ea,{translation:S,isTranslationRecord:!(!a.translation.isOn||!a.translation.isRecord),speakers:r?v:null,hands:h,time:m,network:null!==(n=a.localDevice.networkStatus)&&void 0!==n?n:1,networkTooltipText:d("calls_status_bad_internet_connection")},void 0)}var ta=t(74351),aa=t(27814),ia=function(e){var n=e.title,t=e.onCloseModal,a=e.hint,r=e.actionButtons,s=e.isWithBackButton,c=e.onBackClick,d=e.children,u=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"CallManagementModal",onClose:t,actionButtons:r||[],footerHint:a,backText:s?u("calls_back"):void 0,onBack:c,title:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__content"},{children:l.Children.toArray(d).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)},oa=t(2291),ra=t(87255),sa=t(80044),la=t(48206),ca=t(78981),da=function(e){var n=e.isLinkBlockShown,t=e.linkBlockTitle,a=e.onLinkBlockClick,r=e.callUrlLink,s=(0,l.useContext)(y.ConfigContext).allowWaitingHall,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(oa.default,{children:n&&(0,o.jsxs)(ra.default,(0,i.__assign)({onClick:a,chevron:!0,icon:(0,o.jsx)(sa.ListIcon,{icon:(0,o.jsx)(la.LinkIcon,{},void 0),color:sa.ListIconColors.GREEN},void 0),aside:s?(0,o.jsx)("span",(0,i.__assign)({className:"CallManagementMenu__asideHint"},{children:c("calls_menu_link_setup")}),void 0):""},{children:[t,r&&(0,o.jsx)(ca.ListCopyControl,{value:r,copyText:c("calls_menu_link_copy"),doneText:c("calls_menu_link_copied")},void 0)]}),void 0)},void 0)},ua=t(89366),_a=t(69666),va=t(25633),pa=t(47560),fa=function(e){var n=e.link,t=void 0===n?"":n,a=e.isLinkLoading,r=e.isCopied,s=e.hideCopiedText,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"CallLink__info"},{children:c("calls_management_link_info_desc")}),void 0),a?(0,o.jsx)(va.default,(0,i.__assign)({className:"CallLink__input"},{children:(0,o.jsx)(pa.default,{},void 0)}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__input"},{children:[(0,o.jsx)(ua.default,{readOnly:"readonly",value:t},void 0),(0,o.jsx)("div",{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__hint"},{children:[c("calls_management_add_warning"),(0,o.jsx)(_a.default,(0,i.__assign)({className:"CallLink__copied",shown:r,callback:s},{children:c("calls_link_copied")}),void 0)]}),void 0)},void 0)]}),void 0)]}),void 0)},ha=t(78517),Aa=t(63205),ga=function(e){var n=e.searchQuery,t=e.onSearchChange,a=e.length,r=e.children,s=e.waitingHallList,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList"},{children:[(0,o.jsx)(ha.BlockSearchInput,{value:n,placeholder:c("calls_search_participants_placeholder"),onChange:t,onInput:t,onPaste:t,className:"CallParticipantList__input"},void 0),!!s&&s,(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({extra:a||""},{children:c("calls_participant_list_header")}),void 0),(0,o.jsx)(oa.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list"},{children:r}),void 0)]}),void 0)},ma=t(39132),Ca=t(19316),Ea=t(88420),Sa=function(e){var n=e.members,t=void 0===n?[]:n,a=e.totalCount,r=void 0===a?0:a,s=e.navigateToProfile,c=e.onPromote,d=e.onForbid,u=(0,l.useContext)(E.LangContext).getLang;return 0===t.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({extra:r||""},{children:u("calls_waiting_hall_list_header")}),void 0),(0,o.jsx)(oa.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list CallParticipantList__list--waitingList"},{children:t.map((function(e){return(0,o.jsx)(ra.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return d(e.peerId)},appearance:"secondary"},{children:u("calls_waiting_hall_forbid")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return c(e.peerId)}},{children:u("calls_waiting_hall_join")}),void 0)]},void 0)},{children:(0,o.jsx)(Ca.default,{onLinkClick:s,photo:(0,o.jsx)(A.CallPhoto,{id:e.peerId,photo:e.photo,alt:e.name||""},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.peerId)}))}),void 0)]},void 0)},Ia=t(42194);function Ta(e,n,t){var a=(0,tn.getExternalIdByUserId)(e);return(0,J.promoteParticipant)(a).then((function(){Na(e,n,t)}))}function Na(e,n,t){n&&(n.totalCount-=1,n.members.delete(e),t({type:d.E_ACTION.SET_WAITING_HALL,data:n}))}function xa(e,n,t,a){return function(e,n){if(0===n.length)return Promise.resolve([]);if(e>n.length)return(0,J.getWaitingHall)(null,e).then((function(e){return e.participants}));return Promise.resolve(n)}(e,n).then((function(n){var a=t.waitingHall||{members:new Map,hasNew:!1},o=a.members,r=a.hasNew,s=(0,i.__read)(function(e,n){return e.reduce((function(e,t){var a=(0,i.__read)(e,2),o=a[0],r=a[1],s=+t.id;return n.has(s)?r.push(s):o.push(s),[o,r]}),[[],[]])}(n,o),2),l=s[0],c=s[1],d=l.length>0,u=c.reduce((function(e,n){var t=o.get(n);return t&&e.set(n,t),e}),new Map),_={totalCount:e,members:u,hasNew:!!d||r};return d?function(e,n){var t=e.me,a=e.callData,o=e.anonymSecret,r=a.callId||"",s=t<0,l=s?t:0;return(0,nn.getCallParticipantsApiCall)(r,n,s,o,l).then((function(e){var n=e.profiles,t=void 0===n?[]:n,a=e.anonyms,o=void 0===a?[]:a,r=e.groups,s=void 0===r?[]:r;return(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o.map(tn.normalizeUser)),!1),(0,i.__read)(t.map(tn.normalizeUser)),!1),(0,i.__read)(s.map(tn.normalizeGroup)),!1)}))}(t,l).then((function(e){return e.forEach((function(e){e&&e.peerId&&_.members.set(e.peerId,e)})),_})).catch((function(){return _})):_})).then((function(e){e.members&&a({type:d.E_ACTION.SET_WAITING_HALL,data:e})}))}function ya(e,n){if(!e.waitingHall)return Promise.resolve();var t=e.waitingHall.totalCount;return t>e.waitingHall.members.size?new Promise((function(a){(0,J.getWaitingHall)(null,t).then((function(t){xa(t.totalCount,t.participants,e,n).then((function(){a()}))}))})):Promise.resolve()}var ba=function(e){var n,t,a,r,s,_=e.isModal,v=e.onMore,p=e.navigateToProfile,f=e.isWithBackButton,h=e.onBackClick,A=f?h:function(){},g=(0,c.useSelector)((function(e){return e})),m=u(),C=(0,l.useContext)(E.LangContext).getLang,S=(0,i.__read)((0,l.useState)(Oa(g,_)),2),I=S[0],T=S[1],N=(0,i.__read)((0,l.useState)(""),2),y=N[0],b=N[1],O=g.waitingHall?Array.from(null===(n=g.waitingHall)||void 0===n?void 0:n.members.values()):[],w=(0,l.useCallback)((function(e){return e.name}),[]),M=(0,l.useCallback)((function(e){return e.peerId}),[]),P=x(_?O:[],w,M),k=(0,l.useCallback)((function(e){b(e.target.value)}),[]),L=_?O:O.slice(0,5);y&&(L=P.search(y)),(0,l.useEffect)((function(){T(Oa(g,_))}),[null===(t=g.waitingHall)||void 0===t?void 0:t.totalCount]);var D=(0,l.useCallback)((function(e){var n,t=null===(n=g.waitingHall)||void 0===n?void 0:n.members.get(e);t&&m({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(a=g.waitingHall)||void 0===a?void 0:a.members,g.participants]),j=(0,l.useCallback)((function(e){g.waitingHall&&Ta(e,g.waitingHall,m)}),[null===(r=g.waitingHall)||void 0===r?void 0:r.members]),R=(0,l.useCallback)((function(){v&&v()}),[g.waitingHall]),B=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Sa,{members:L,totalCount:null===(s=g.waitingHall)||void 0===s?void 0:s.totalCount,navigateToProfile:p,onPromote:j,onForbid:D},void 0),I&&(0,o.jsx)(Ia.ListMore,(0,i.__assign)({onClick:R},{children:C("calls_waiting_hall_more_text")}),void 0)]},void 0);return _?(0,o.jsx)(ia,(0,i.__assign)({title:C("calls_waiting_hall_title"),onCloseModal:function(){m({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),m({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},isWithBackButton:f,onBackClick:A},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList CallParticipantList--waiting-hall"},{children:[O.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ha.BlockSearchInput,{value:y,placeholder:C("calls_search_participants_placeholder"),onChange:k,onInput:k,onPaste:k,className:"CallParticipantList__input"},void 0),B,y&&0===L.length&&(0,o.jsx)(Re.default,{children:C("calls_participants_not_found")},void 0)]},void 0),0===O.length&&(0,o.jsx)(Re.default,{children:C("calls_waiting_hall_not_users")},void 0)]}),void 0)}),void 0):B};function Oa(e,n){if(n)return!1;var t=e.waitingHall;return!!t&&t.totalCount>5}var wa=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"},void 0)}),void 0)},Ma=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"},void 0)}),void 0)},Pa=function(){var e=(0,be.classNames)("VolumeMeterAnimation","VolumeMeterAnimation--withAnimation");return(0,o.jsx)("div",{className:e},void 0)},ka=function(e){var n=e.showSpeaking,t=e.showAudioDisabled,a=e.showRaisedHand,r=e.showConnecting,c=e.showRaisedHandTooltip,d=e.onRaisedHandClick,u=(0,l.useContext)(E.LangContext).getLang,_=(0,o.jsx)("span",(0,i.__assign)({className:(0,s.classNames)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==d}),onClick:null!=d?d:void 0},{children:(0,o.jsx)(Ma,{className:"ParticipantIndicators__hand"},void 0)}),void 0);return(0,o.jsxs)("span",(0,i.__assign)({className:"ParticipantIndicators"},{children:[n&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Pa,{},void 0)}),void 0),t&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(wa,{className:"ParticipantIndicators__muted"},void 0)}),void 0),a?c?(0,o.jsx)(C.default,(0,i.__assign)({className:"ParticipantIndicators__tooltip",text:u("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light"},{children:_}),void 0):_:null,r&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Y,{},void 0)}),void 0)]}),void 0)},La=t(67406),Da=function(e){var n=e.position,t=e.align,a=e.trigger,r=e.marginTop,s=e.marginLeft,l=e.actions;return l.length>0?(0,o.jsx)(Dt.default,(0,i.__assign)({position:n,align:t,trigger:a,marginTop:r,marginLeft:s,className:"ParticipantMenu__dropdown",data:l},{children:(0,o.jsx)(La.ListActionsControl,{},void 0)}),void 0):null},ja=function(e){var n=e.SDK,t=e.participant,a=e.navigateToConvo,i=e.navigateToProfile,r=e.device,s=(0,c.useSelector)((function(e){return e})),d=u(),_=(0,l.useContext)(E.LangContext).getLang,v=t&&Ot({state:s,SDK:n,dispatch:d,participant:t,addProfileLink:!1,getLang:_,navigateToConvo:a,navigateToProfile:i,separatedList:!0,device:r});return(null==v?void 0:v.length)?(0,o.jsx)(Da,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:v},void 0):null},Ra=(0,l.memo)((function(e){var n,t,a,r,s=e.device,l=e.canMute,c=e.onUnmuteDevice,d=e.SDK,u=e.navigateToConvo,_=e.navigateToProfile,v=e.deviceId,p=P((function(e){return e.me})),f=P((function(e){return e.participants[s.externalId.id]})),h=P((function(e){return e.externalId})),g=P((function(e){return e.speakers[v]})),m=(0,k.isSameExternalId)(s.externalId,h),C=m?Ye.GlobalStore.getCallsState().localDevice:f,E=(null==f?void 0:f.peerId)!==p&&s.status===J.ParticipantStatus.WAITING,S=!E&&!(null===(n=s.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),I=!E&&!(null===(t=s.mediaSettings)||void 0===t?void 0:t.isVideoEnabled),T=!E&&!!(null===(r=null===(a=s.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state),N=E||S||T||g,x=!E&&(S||I)&&l&&!m;return(0,o.jsx)(ra.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[N&&(0,o.jsx)(ka,{showSpeaking:g,showRaisedHand:T,showAudioDisabled:S,showConnecting:E,showRaisedHandTooltip:x,onRaisedHandClick:x?function(){return c(s)}:void 0},"indicators"),(0,o.jsx)(ja,{SDK:d,participant:f,device:s,navigateToConvo:u,navigateToProfile:_},"menu")]},void 0)},{children:(0,o.jsx)(Ca.default,{onLinkClick:_,photo:(0,o.jsx)(A.CallPhoto,{id:null==f?void 0:f.peerId,photo:null==f?void 0:f.photo,alt:(null==f?void 0:f.name)||"",showCreatorBadge:(0,k.isCreator)(C),showAdminBadge:(0,k.isAdmin)(C)},void 0),title:null==f?void 0:f.name,href:null==f?void 0:f.link,target:"_blank"},void 0)}),v)})),Ba=100,Ua=function(e){var n=e.SDK,t=e.bridge,a=e.onAddClick,r=e.navigateToProfile,s=e.navigateToConvo,d=e.onShowMoreWaitingHall,u=(0,c.useSelector)((function(e){return e})),_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(""),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(Ba),2),A=h[0],g=h[1],m=(0,k.canMuteParticipants)(u.localDevice),C=function(e,n,t,a){var o=P((function(e){return e})),r=Mn(o),s=(0,l.useMemo)((function(){return o.externalId?(0,i.__assign)((0,i.__assign)({},o.localDevice),{externalId:o.externalId}):null}),[o.localDevice,o.externalId]);return(r?Ha:Ga)(e,n,t,s,{offset:a})}(p,n,t,A-Ba),S=C.participants,I=C.isLoading,T=(0,l.useCallback)((function(e){f(e.target.value)}),[]),N=!(0,k.isParticipantAnonym)(u.me),x=L(),y=(0,l.useCallback)((function(e){n.muteParticipant(e.externalId,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log)}),[]);return(0,o.jsxs)(ga,(0,i.__assign)({searchQuery:p,onSearchChange:T,length:x,waitingHallList:u.waitingHall&&(0,o.jsx)(ba,{isModal:!1,navigateToProfile:r,onMore:d},void 0)},{children:[!p&&N&&(0,o.jsx)(ra.default,(0,i.__assign)({selectable:!1,border:!1},{children:(0,o.jsx)(ma.ListAddControl,(0,i.__assign)({onClick:a},{children:_("calls_add_participants")}),void 0)}),"add"),!!S.length&&S.slice(0,A).map((function(e){var t=(0,k.externalIdToString)(e.externalId);return(0,o.jsx)(Ra,{deviceId:t,SDK:n,canMute:m,device:e,navigateToConvo:s,navigateToProfile:r,onUnmuteDevice:y},t)})),I&&(0,o.jsx)(Le.default,{},void 0),!I&&x>A&&(0,o.jsx)(ra.default,{children:(0,o.jsx)(Ia.ListMore,(0,i.__assign)({className:"CallParticipantList__more",onClick:function(){g((function(e){return e+Ba}))}},{children:_("calls_participants_show_more").replace("{n}",String(Ba))}),void 0)},"limit"),p&&0===S.length&&(0,o.jsx)(Re.default,{children:_("calls_participants_not_found")},void 0)]}),void 0)};function Ha(e,n,t,a,o){var r,s=(void 0===o?{}:o).offset,c=void 0===s?0:s,_=P((function(e){return e.devices})),v=P((function(e){return e.participants})),p=P((function(e){return e.participantsChunk})),f=P((function(e){var n;return null!==(n=e.callData.callId)&&void 0!==n?n:""})),h=u(),A=(0,i.__read)((0,l.useState)([]),2),g=A[0],m=A[1],C=(0,i.__read)((0,l.useState)(!1),2),E=C[0],S=C[1],I=(r=p)?r.countBefore+r.ids.length+r.countAfter:0,T=0===c&&I<=Ba?I:null;return(0,l.useEffect)((function(){var a=new AbortController,o=!1;return a.signal.addEventListener("abort",(function(){o=!0}),{once:!0}),S(!0),(e?new Promise((function(t,i){var r=setTimeout((function(){t(function(){function t(e,n){return{id:String(e.id),type:n}}(0,nn.searchCallParticipants)(f,{search:e},{signal:a.signal}).then((function(e){var n=e.profiles,a=void 0===n?[]:n,i=e.anonyms,o=void 0===i?[]:i,r=e.groups,s=void 0===r?[]:r,l=[],c=[];return o.forEach((function(e){l.push((0,tn.normalizeUser)(e)),c.push(t(e,J.ExternalIdType.ANONYM))})),a.forEach((function(e){l.push((0,tn.normalizeUser)(e)),c.push(t(e,J.ExternalIdType.USER))})),s.forEach((function(e){l.push((0,tn.normalizeGroup)(e)),c.push(t(e,J.ExternalIdType.GROUP))})),on([{},l]),h({type:d.E_ACTION.LOAD_PEERS,members:l}),c})).then((function(e){return n.getParticipants({externalIds:e})})).then((function(e){if(!o){var n=Ye.GlobalStore.getCallsState(),t=e.map((function(e){var n=e.uid;return(0,k.externalIdToString)(n)}));en(n,h,e),m(t)}}))}())}),1e3);a.signal.addEventListener("abort",(function(){clearTimeout(r),i()}),{once:!0})})):jn(n,{fromIdx:c,count:100},{signal:a.signal}).then((function(e){var n=Ye.GlobalStore.getCallsState(),a=e.participants.map((function(e){var n=e.uid,t=(0,i.__rest)(e,["uid"]);return(0,i.__assign)({externalId:n},t)})),o=a.map((function(e){var n=e.externalId;return(0,k.externalIdToString)(n)})),r=Rn(n,h,t,a);return m((function(e){return c>=e.length?e.concat(o):o})),r}))).finally((function(){S(!1)})),function(){return a.abort()}}),[f,e,c,T]),{participants:g.reduce((function(e,n){var t=_[n];if(t){var a=t.externalId.id,i=v[a];i&&i.name&&e.push(t)}return e}),e||!a?[]:[a]),isLoading:E}}function Ga(e){var n,t,a=(0,i.__read)((n=P((function(e){return e})),t=(0,l.useMemo)((function(){if(n.externalId)return(0,i.__assign)((0,i.__assign)({},n.localDevice),{externalId:n.externalId})}),[n.localDevice,n.externalId]),(0,l.useMemo)((function(){var e=[[],[]],a=function(e,t){var a=n.participants[t.externalId.id];return a&&t.status?(e[0].push(t),a.name&&e[1].push(t),e):e};return t&&a(e,t),(0,Ve.objectReduce)(n.devices,a,e)}),[n.devices,n.participants,n.localDevice,n.externalId])),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){var n;return null===(n=Ye.GlobalStore.getCallsState().participants[e.externalId.id])||void 0===n?void 0:n.name}),[]),c=(0,l.useCallback)((function(e){return(0,k.externalIdToString)(e.externalId)}),[]),d=x(r,s,c);return{participants:e?d.search(e):o,isLoading:!1}}var Va,Fa=t(93839);!function(e){e.Participants="participants",e.Friends="friends",e.Community="community"}(Va||(Va={}));var Wa,Za=t(88822),za=t(71831);function Ka(e,n,t){return t&&t[e]||(0,k.isParticipantInCall)(n,e)}function Qa(e){var n=e.member,t=e.state,a=e.selectedMap,i=(null==n?void 0:n.peerId)||0;if((0,k.isParticipantInCall)(t,i))return!0;if(Ka(i,t,a))return!1;if((0,O.isAuthedByGroupId)(t)){if((0,k.isParticipantUnavailableToCallFromGroup)(t,i))return!0}else if(!(null==n?void 0:n.canCall))return!0;return!(0,za.isUserPeer)(i)}!function(e){e.Friends="friends",e.CommunityMembers="groupMembers",e.Members="members"}(Wa||(Wa={}));var Ya=function(e){return e?(0,Za.escape)(e.replace(/\t/g,"\n")):""},Ja=function(e){return e.name},Xa=t(70720),qa=function(e){var n=e.tokens,t=e.onRemoveToken,a=e.value,i=e.onChange,r=e.onSelect,s=e.renderSuggest,c=e.data,d=e.hideInputWithName,u=(0,l.useRef)((function(){})),_=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Xa.default,{className:"CallsMultiSelect",tokens:n,removeTokenPlaceholder:_("calls_remove_token"),onRemoveToken:t,placeholder:_("calls_search_participants_placeholder"),value:a,onChange:i,onSelect:r,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:u.current,notFoundText:_("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:s,data:c,hideInputWithName:d},void 0)};const $a=(0,X.makeIcon)("Icon20CheckCircleOn","check_circle_on_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="check_circle_on_20"><path fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm5.35-12.72a.75.75 0 1 0-1.062-1.06l-5.955 5.968L5.81 9.66a.75.75 0 1 0-1.062 1.06l3.054 3.06a.75.75 0 0 0 1.062 0l6.486-6.5Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),ei=(0,X.makeIcon)("Icon20CheckCircleOff","check_circle_off_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" viewBox="0 0 20 20" id="check_circle_off_20"><defs><path id="check_circle_off_20_a" fill="currentColor" fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm0-1a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" clip-rule="evenodd" /></defs><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);function ni(e){var n=e.member,t=e.selected,a=void 0!==t&&t,r=e.disabled,l=void 0!==r&&r,c=(0,s.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":a,"ParticipantSuggest--disabled":l}),d=a?$a:ei;return(0,o.jsxs)("div",(0,i.__assign)({className:c,"data-id":n.id},{children:[(0,o.jsx)(Ca.default,{className:"ParticipantSuggest__entity",size:"34",title:n.name,photo:n.photo},void 0),(0,o.jsx)(d,{className:"ParticipantSuggest__checkIcon"},void 0)]}),void 0)}var ti=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"},void 0)}),void 0)},ai=(0,l.memo)((function(e){var n=e.data,t=e.onClick,a=e.selected,r=e.disabled;if("type"in n)switch(n.type){case d.SearchResultType.HEADER:return(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--header",extra:n.count},{children:n.text}),void 0);case d.SearchResultType.CALL_ALL_IN_CHAT:return(0,o.jsx)("div",(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--select"},{children:(0,o.jsxs)(Ea.default,(0,i.__assign)({appearance:"secondary",wide:!0,onClick:t},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"CallsSearchResult__icon"},{children:(0,o.jsx)(ti,{},void 0)}),void 0),n.text]}),void 0)}),void 0);case d.SearchResultType.MEMBERS_MORE:case d.SearchResultType.FRIENDS_MORE:case d.SearchResultType.GROUP_MEMBERS_MORE:return(0,o.jsx)(Ia.ListMore,(0,i.__assign)({onClick:t},{children:n.text}),void 0)}return(0,o.jsx)(ra.default,(0,i.__assign)({"data-id":n.peerId,onClick:t,selectable:!r},{children:(0,o.jsx)(ni,{member:n,selected:a,disabled:r},void 0)}),void 0)})),ii=function(e){var n=e.onChange,t=e.initMembers,a=e.selected,r=e.personCache,s=e.memberType,_=(0,l.useRef)(!1),v=(0,l.useRef)(),p=(0,c.useSelector)((function(e){return e})),f=u(),h=(0,ue.useLang)().getLang,A=(0,i.__read)((0,l.useState)(t),2),g=A[0],m=A[1],C=(0,i.__read)((0,l.useState)(""),2),E=C[0],S=C[1],I=(0,i.__read)((0,l.useState)(!1),2),N=I[0],x=I[1],y=(0,i.__read)((0,l.useState)(!1),2),b=y[0],O=y[1],w=(0,l.useMemo)((function(){return a.reduce((function(e,n){return e[n]=!0,e}),{})}),[a]),M=p.groupMembersCount>d.COUNT_OF_GROUP_MEMBERS_TO_LOAD,P=(0,l.useMemo)((function(){return new T(g,Ja)}),[]),k=(0,l.useCallback)((function(e){if(e){var n=P.search(e);if(_.current){var t={};return n.forEach((function(e){t[e.id]=e})),Object.values(t)}return n}return function(e){var n=e.getLang,t=e.members,a=e.showMore,o=e.memberType,r={type:d.SearchResultType.MEMBERS_MORE,text:n("calls_show_all_members")},s={type:d.SearchResultType.FRIENDS_MORE,text:n("calls_show_all_friends")},l={type:d.SearchResultType.GROUP_MEMBERS_MORE,text:n("calls_show_all_group_members")},c=[];switch(o){case Wa.Members:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(var u=0;u<10;u++)c.push(t[u]);c.push(r)}break;case Wa.Friends:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(s)}break;case Wa.CommunityMembers:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(l)}}return c}({getLang:h,members:g,showMore:N,memberType:s})}),[g,P,h,N,s]),L=(0,i.__read)((0,l.useState)((function(){return k(E)})),2),D=L[0],j=L[1],R=(0,l.useCallback)((function(e){var t=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a),!1),[+e],!1);n(t)}),[a,n]),B=(0,l.useCallback)((function(e){var t=a.filter((function(n){return n!==+e}));n(t)}),[a,n]);(0,l.useEffect)((function(){j(k(E))}),[N]),(0,l.useEffect)((function(){var e=E;return M&&(e.length>=3&&!b?v.current=setTimeout((function(){(function(e,n,t,a){return void 0===n&&(n=""),(0,nn.searchGroupMembers)(e,n).then((function(e){var n=e.items,o=[],r=[];return n&&n.forEach((function(e){e.deactivated||e.id in t.groupMembersCache||(o.push((0,tn.normalizeUser)(e)),e.can_call_from_group||r.push(e.id))})),o.length>0&&a({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:t.groupMembersCount,groupMembers:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.groupMembers),!1),(0,i.__read)(o),!1),unableToCallGroupMembersIds:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.unableToCallGroupMembersIds),!1),(0,i.__read)(r),!1)}),o}))})(-p.groupId,e,p,f).then((function(n){var t,a;if(O(!1),n.length){_.current=!0;var o=(0,i.__spreadArray)([],(0,i.__read)(g),!1);try{for(var r=(0,i.__values)(n),s=r.next();!s.done;s=r.next()){var l=s.value;o.push(l),P.add(l)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}m(o),j(k(e))}}))}),1e3):v.current&&(O(!1),clearTimeout(v.current))),function(){v.current&&clearTimeout(v.current)}}),[E]);var U=(0,l.useCallback)((function(e){S(e.target.value),j(k(e.target.value))}),[k]),H=(0,l.useCallback)((function(e){return B(e),Promise.resolve()}),[B]),G=(0,l.useCallback)((function(e){return Ka(e,p,w)?B(e):Qa({member:r.current.get(+e),state:p,selectedMap:w})||(R(e),S(""),j(k(""))),Promise.resolve()}),[p,w,k,R,B]),V=(0,l.useCallback)((function(e,n){return"type"in e?function(){return x(!0)}:n}),[]),F=(0,l.useCallback)((function(e,n){var t="peerId"in e?e.peerId:0;return(0,o.jsx)(ai,{data:e,onClick:V(e,n),selected:Ka(t,p,w),disabled:Qa({member:r.current.get(+t),state:p,selectedMap:w})},t||"text"in e&&e.text||void 0)}),[w,p.groupId,p.participants,p.me,p.unableToCallGroupMembersIds]);return{query:E,found:D,onRemoveToken:H,onChangeHandler:U,onSelect:G,renderSuggest:F}},oi=function(e){var n=e.tokens,t=e.onChange,a=e.selected,i=e.personCache,r=e.initMembers,s=e.memberType,l=ii({selected:a,onChange:t,personCache:i,initMembers:r,memberType:s});return(0,o.jsx)(qa,{tokens:n,onRemoveToken:l.onRemoveToken,value:l.query,onChange:l.onChangeHandler,onSelect:l.onSelect,renderSuggest:l.renderSuggest,data:l.found,hideInputWithName:!0},void 0)},ri=function(e){var n=e.onChange,t=e.onChangeTab,a=e.tab,r=e.tabs,d=e.selected,u=(0,c.useSelector)((function(e){return e.friends})),_=(0,c.useSelector)((function(e){return e.chatMembers})),v=(0,c.useSelector)((function(e){return e.groupMembers})),p=function(){var e=(0,c.useSelector)((function(e){return e.groupMembers})),n=(0,c.useSelector)((function(e){return e.chatMembers})),t=(0,c.useSelector)((function(e){return e.friends})),a=(0,l.useRef)({}),i=(0,l.useRef)();i.current||(i.current=new Map);var o=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){e.forEach((function(e){i.current.set(e.id,e)}))}))};return a.current.chatMembers!==n&&(o(n),a.current.chatMembers=n),a.current.groupMembers!==e&&(o(e),a.current.groupMembers=e),a.current.friends!==t&&(o(t),a.current.friends=t),(0,l.useEffect)((function(){return function(){i.current.clear(),a.current={}}}),[]),{personCache:i}}().personCache,f=function(e){var n=e.selected,t=e.personCache,a=(0,c.useSelector)((function(e){return e})),o=(0,l.useMemo)((function(){var e,o,r,s,l=(0,k.getActiveDevices)(a).activeDevices,c=new Map;try{for(var d=(0,i.__values)(l),u=d.next();!u.done;u=d.next()){var _=u.value,v=a.participants[_.externalId.id];v&&c.set(v.peerId,{id:v.peerId.toString(),text:Ya(v.name),locked:!0})}}catch(n){e={error:n}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(e)throw e.error}}try{for(var p=(0,i.__values)(n),f=p.next();!f.done;f=p.next()){var h=f.value,A=a.participants[h]||t.current.get(h);c.set(h,{text:Ya(null==A?void 0:A.name),id:h.toString(),locked:!1})}}catch(e){r={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(r)throw r.error}}return(0,i.__spreadArray)([],(0,i.__read)(c.values()),!1)}),[n,a.participants,a.me,a.groupId,a.meGroup,a.adminPinnedParticipant,a.isOratorMode,a.oratorScrollFirstVisible,a.gridScrollFirstVisible,a.oratorScrollNumberOfVisible]);return o}({selected:d,personCache:p});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Fa.ConfigProvider,(0,i.__assign)({platform:Fa.Platform.VKCOM,scheme:"inherit"},{children:(0,o.jsx)(Fa.Tabs,(0,i.__assign)({className:"AddParticipants__tabs"},{children:r.map((function(e){var n,r=e.id,l=e.label,c=e.counter;return(0,o.jsx)(Fa.TabsItem,(0,i.__assign)({className:"AddParticipants__tabsItem",onClick:function(){return t(r)},selected:r===a,after:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("AddParticipants__count",(n={},n["AddParticipants__count--inactive"]=r!==a,n))},{children:c}),void 0)},{children:l}),r)}))}),void 0)}),void 0),a===Va.Participants&&(0,o.jsx)(oi,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:_,memberType:Wa.Members},Va.Participants),a===Va.Friends&&(0,o.jsx)(oi,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:u,memberType:Wa.Friends},Va.Friends),a===Va.Community&&(0,o.jsx)(oi,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:v,memberType:Wa.CommunityMembers},Va.Community)]},void 0)};const si=(0,X.makeIcon)("Icon16Phone","phone_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="phone_16"><path d="m5.443 2.64.575.684c.796.943.713 2.365-.19 3.268l-.49.49a.475.475 0 0 0-.11.499c.179.487.634 1.096 1.364 1.827.732.731 1.34 1.185 1.827 1.364.174.064.369.02.5-.11l.489-.49c.903-.902 2.324-.985 3.269-.19l.683.574c.779.656.858 1.839.175 2.64-.372.431-.896.702-1.463.756-2.182.294-4.471-.758-6.868-3.155-2.398-2.398-3.45-4.688-3.156-6.87a2.213 2.213 0 0 1 .756-1.464c.802-.68 1.984-.602 2.64.178z" fill="currentColor" /></symbol>',16,16,!1,void 0);var li=function(e){var n=e.isAddSubmitDisabled,t=e.onAdd,a=e.onAddAll,r=e.tab,s=e.showCallAll,l=(0,ue.useLang)().getLang;return(0,o.jsxs)(o.Fragment,{children:[r===Va.Participants&&s&&(0,o.jsxs)(Ea.default,(0,i.__assign)({className:"CallManagementModal__callAllButton",appearance:"secondary",onClick:a},{children:[(0,o.jsx)(si,{height:15,className:"CallManagementModal__callAllButton__icon"},void 0),(0,o.jsx)("div",{children:l("calls_call_all")},void 0)]}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({disabled:n,onClick:t},{children:l("calls_add")}),void 0)]},void 0)},ci=function(e){var n=e.SDK,t=e.isWithBackButton,a=e.onBackClick,r=(0,c.useSelector)((function(e){return e})),s=(0,c.useSelector)((function(e){return e.me})),_=(0,c.useSelector)((function(e){return e.participants})),v=u(),p=(0,l.useContext)(E.LangContext).getLang,f=(0,i.__read)((0,l.useState)(r.preselectedIds||[]),2),h=f[0],A=f[1],g=(0,c.useSelector)((function(e){return e.chatMembers.length})),m=(0,c.useSelector)((function(e){return e.friendsCount||0})),C=(0,c.useSelector)((function(e){return e.groupMembersCount})),S=(0,c.useSelector)((function(e){return 0!==e.groupId})),I=(0,l.useMemo)((function(){return(0,k.getParticipantsInfo)({me:s,participants:_,excludeAnonymFromCount:!0})}),[_,s]),T=I.creatorPeerId,N=I.membersCount,x=(0,k.isParticipantGroup)(T),y=N+h.length,b=function(e){var n=e.friendsCount,t=e.membersCount,a=e.defaultTab,o=e.groupMembersCount,r=e.displayTabs,s=(0,ue.useLang)().getLang,c=(0,i.__read)((0,l.useState)(a||Va.Participants),2),d=c[0],u=c[1],_=function(e){switch(e){case Va.Participants:return{id:Va.Participants,label:s("calls_call_patricipants"),counter:t};case Va.Friends:return{id:Va.Friends,label:s("calls_call_friends"),counter:n};case Va.Community:return{id:Va.Community,label:s("calls_call_community_members"),counter:o}}},v=(0,l.useMemo)((function(){var e,n,t=[];try{for(var a=(0,i.__values)(r),o=a.next();!o.done;o=a.next()){var s=o.value;s&&t.push(_(s))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return t}),[s,t,n,d,o,r]);return{tab:d,tabs:v,onChangeTab:(0,l.useCallback)((function(e){u(e)}),[])}}({membersCount:N,friendsCount:m,groupMembersCount:C,displayTabs:(0,l.useMemo)((function(){return[!S&&!x&&Va.Participants,S?Va.Community:Va.Friends]}),[S]),defaultTab:S?Va.Community:x?Va.Friends:g>1?Va.Participants:Va.Friends}),M=b.onChangeTab,P=b.tab,L=b.tabs,D=function(){v({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),v({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},j=0===h.length,R=function(e){D(),v({type:d.E_ACTION.MANUAL_ADD_PARTICIPANTS,participants:e});var t=e.map((function(e){return new Promise((function(t){n.addParticipant(String(e)).then(t).catch((function(n){"auth.banned"===n.message?t(e):"vk-participant-is-rejected-error"===n.message?v({type:d.E_ACTION.ERROR,text:p("calls_error_cant_add_because_of_privacy")}):t(null)}))}))}));Promise.all(t).then((function(e){if((e=e.filter((function(e){return void 0!==e}))).length){var n=function(e,n){var t=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.friends),!1),(0,i.__read)(e.chatMembers),!1),(0,i.__read)(e.groupMembers),!1),a=[];return t.filter((function(e){var t=e.id;return!(!n.includes(t)||a.includes(t))&&(a.push(t),!0)}))}(r,e);v({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:{members:n}})}}));var a=(0,i.__read)((0,Ve.convertClientData)(function(e,n){var t=e.chatData||e.callData.conversation,a=n.reduce((function(n,t){return e.participants[t]||n.set(t,!0),n}),new Map);if(0===a.size)return[t,[]];var o=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,r=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,s=o.reduce((function(e,n){return a.get(n.id)&&(e.smallerListData.push(n),e.smallerListMap.set(n.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),l=s.smallerListData,c=s.smallerListMap;if(l.length===a.size)return[t,l];var d=r.filter((function(e){return!c.get(e.id)&&a.get(e.id)}));return[t,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(d),!1)]}(r,e)),2),o=a[0],s=a[1];v({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:s}),w.callStats.logEvent({call_event_type:d.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:r.callData.callId,peer_id:r.peer.toString(),is_group_call:(0,O.isGroupCallByPeer)(r.peer),group_call_users_count:h.length})};return(0,o.jsx)(ia,(0,i.__assign)({title:p("calls_add_participants_to_call"),onCloseModal:D,actionButtons:(0,o.jsx)(li,{isAddSubmitDisabled:j,onAdd:function(){R(h)},onAddAll:function(){var e=function(e){var n=e.state,t=e.selectedMap,a=(0,k.getActiveDevices)(n).activeDevices.reduce((function(e,n){return e[n.externalId.id]=!0,e}),{});return n.chatMembers.reduce((function(e,i){var o=i.peerId;return a[o]||Qa({member:i,state:n,selectedMap:t})||e.push(o),e}),[])}({state:r});R(e)},tab:P,showCallAll:g>N},void 0),hint:P!==Va.Participants?di(y,p):void 0,isWithBackButton:t,onBackClick:t?a:function(){}},{children:(0,o.jsx)(ri,{onChange:A,tab:P,tabs:L,onChangeTab:M,selected:h},void 0)}),void 0)};function di(e,n){if(e<2)return n("calls_management_add_warning")}var ui=t(63035),_i=function(e,n,t){var a=null,i=e;return e===d.EVideoEffectType.BLUR?(a=ui.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED,i=d.VIRTUAL_BACKGROUND_BLUR_ID):"number"==typeof e&&(a=e>4e3?ui.CallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DISABLED:ui.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED),{prevSendValue:i,disabledActionType:a,effectDuration:Math.round((n-t)/1e3)}},vi=function(e){var n=oe();if(n){se();var t=ae(),a=Date.now(),i=e.callData.callId,o=e.peer,r=(0,O.isGroupCallByPeer)(o),s=_i(t,a,n),l=s.disabledActionType,c=s.effectDuration,d=s.prevSendValue;null!==l&&w.callStats.logEvent({call_event_type:l,is_group_call:r,peer_id:o,session_id:i,background_duration:c,background_id:d})}};function pi(e,n,t,a){var i=n.callData.callId||"";t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),t({type:d.E_ACTION.SET_LAST_CALL_DATA,data:{isMeEndedCallForAll:!0}}),(0,nn.forceCallFinish)(i).catch((function(e){console.error(e),t({type:d.E_ACTION.ERROR,text:a("calls_error_force_call_finish"),handleType:d.ErrorHandleType.FATAL}),t({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})})).finally((function(){t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})),vi(n)}var fi=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#paint0_linear)"},void 0),(0,o.jsx)("path",{d:"M6.746 14.391c-.165-1.078-.204-1.206-.493-1.614-.363-.513-.415-1.1.38-1.255 2.042-.397 4.252-.1 6.265.268a5.546 5.546 0 002.204 0c2.013-.368 4.223-.665 6.264-.268.796.154.744.742.38 1.255-.288.408-.327.536-.492 1.614-.248 1.617-1.607 2.275-3.29 2.276-1.85 0-2.465-1.055-3.04-2.494-.557-1.398-1.29-1.398-1.849 0-.574 1.439-1.19 2.494-3.038 2.494-1.684 0-3.043-.66-3.29-2.276z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"paint0_linear",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},hi=function(e){var n=e.hint,t=e.className,a=e.children,r=(0,i.__rest)(e,["hint","className","children"]),s=!!n,l={"ListItem--withHint":s};return(0,o.jsxs)(ra.default,(0,i.__assign)({},r,{className:(0,be.classNames)(l,t)},{children:[a,s&&(0,o.jsx)("div",(0,i.__assign)({className:"ListItem--hint"},{children:n}),void 0)]}),void 0)};const Ai=(0,X.makeIcon)("Icon24DoorArrowLeftOutline","door_arrow_left_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="door_arrow_left_outline_24"><path d="M18.754 20.366c-.763.407-1.512.534-3.082.534H13a.9.9 0 1 1 0-1.8h2.672c1.487 0 1.87-.128 2.233-.322.336-.18.594-.438.773-.773.194-.362.322-.746.322-2.233V8.228c0-1.487-.128-1.871-.322-2.233a1.847 1.847 0 0 0-.773-.774c-.362-.193-.746-.321-2.233-.321H13a.9.9 0 1 1 0-1.8h2.672c1.57 0 2.32.127 3.082.534.65.347 1.164.863 1.512 1.512.407.762.534 1.512.534 3.082v7.544c0 1.57-.127 2.32-.534 3.082a3.647 3.647 0 0 1-1.512 1.512Z" /><path d="m9.364 15.364 2.463-2.464H3.9a.9.9 0 0 1 0-1.8h7.927L9.364 8.636a.9.9 0 1 1 1.272-1.272l4 4a.9.9 0 0 1 0 1.272l-4 4a.9.9 0 0 1-1.272-1.272Z" /></symbol>',24,24,!1,void 0);var gi,mi=function(e){var n=e.requireAuthToJoin,t=void 0!==n&&n,a=e.onRequireAuthToJoinChanged,r=e.isWaitingHallBlockShown,s=void 0!==r&&r,c=e.isWaitingHallEnabled,d=void 0!==c&&c,u=e.onWaitingHallEnabledChanged,_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(!t),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(d),2),A=h[0],g=h[1],m=!1,C=(0,l.useCallback)((function(){if(!m){m=!0;var e=!p;f(e),a&&a(!e)}}),[t]),S=!1,I=(0,l.useCallback)((function(){if(!S){S=!0;var e=!A;g(e),u&&u(e)}}),[d]);return(0,o.jsxs)(oa.default,{children:[s&&(0,o.jsx)(hi,(0,i.__assign)({onClick:I,canBeHovered:!1,icon:(0,o.jsx)(sa.ListIcon,{icon:(0,o.jsx)(Ai,{width:20,height:20},void 0),color:sa.ListIconColors.BLUE},void 0),hint:_("calls_menu_waiting_hall_description"),selectable:!0,aside:(0,o.jsx)(F.default,{onChange:I,checked:A},void 0)},{children:_("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(ra.default,(0,i.__assign)({border:!0,canBeHovered:!1,onClick:C,selectable:!0,icon:(0,o.jsx)(fi,{},void 0),aside:(0,o.jsx)(F.default,{onChange:C,checked:p},void 0)},{children:_("calls_management_link_allow_anonymous")}),void 0)]},void 0)},Ci=t(9670);!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS",e[e.WAITING_HALL=3]="WAITING_HALL"}(gi||(gi={}));var Ei=function(e){var n,t,a=e.bridge,r=e.SDK,s=e.navigateToConvo,_=e.navigateToProfile,v=e.allowAddMembers,p=void 0!==v&&v,f=(0,c.useSelector)((function(e){return e})),h=u(),A=P((function(e){return e.callData.callUrlLink||""})),g=(0,l.useContext)(y.ConfigContext).allowWaitingHall,m=f.managementView||gi.MAIN,C=(0,i.__read)((0,l.useState)(m),2),S=C[0],I=C[1],T=(0,i.__read)((0,l.useState)(!1),2),N=T[0],x=T[1],b=(0,i.__read)((0,l.useState)(!1),2),w=b[0],M=b[1],L=(0,i.__read)((0,l.useState)(!1),2),D=L[0],j=L[1],R=(0,i.__read)((0,l.useState)(!1),2),B=R[0],U=R[1],H=(0,i.__read)((0,l.useState)(!1),2),G=H[0],V=H[1],F=p||!!(null===(n=f.callData.conversation)||void 0===n?void 0:n.canAddMembers),W=(null===(t=f.callData)||void 0===t?void 0:t.canFinishCall)||0!==f.groupId&&A,Z=(0,l.useContext)(E.LangContext).getLang,z=(0,O.isRequireAuthToJoin)(f),K=(0,O.isWaitingHallEnabled)(f),Q=(0,l.useCallback)((function(){h({type:d.E_ACTION.MANAGEMENT,isOpen:!1})}),[]),Y=(0,l.useCallback)((function(){I(gi.MAIN)}),[]),X=function(e){var n=f.callData.callId||"";return x(!0),fn(h,n,e,(0,O.isAuthedByGroupId)(f)?f.groupId:0).catch((function(e){console.error(e),h({type:d.E_ACTION.ERROR,text:Z("calls_get_url_link_error_text")})})).finally((function(){x(!1)}))},q=(0,l.useCallback)((function(){I(gi.CALL_LINK),A||X(!1).catch((function(){I(gi.MAIN)}))}),[f.callData.callId,A]),$=(0,l.useCallback)((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[rn(a,f,h)].concat((0,za.isChatPeer)(f.peer)?[sn(f,h,f.peer,f.callData.conversation)]:[]).concat(a.authorizedGroupId?[cn(a,f,h)]:[]);return Promise.all(e).then((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),I(gi.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[f.peer,f.callData,f.friends,f.groupMembers]),ee=(0,l.useCallback)((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[ya(f,h)];return Promise.all(e).then((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),I(gi.WAITING_HALL)})).catch((function(e){console.error(e),h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[f.waitingHall]),ne=(0,l.useCallback)((function(){h({type:d.E_ACTION.TOGGLE_POPUP}),pi(0,f,h,Z)}),[f.callData.callId,f.imHash]);(0,l.useEffect)((function(){m===gi.CALL_LINK&&q()}),[]),(0,l.useEffect)((function(){var e=(0,k.participantIsAdmin)(f.localDevice),n=e;j(e),U(n),V(g&&e)}),[f.localDevice,g]);var te=(0,l.useCallback)((function(e){!function(e){var n;(0,J.changeConversationOptions)(((n={})[J.ConversationOption.REQUIRE_AUTH_TO_JOIN]=e,n))}(e)}),[]),ae=(0,l.useCallback)((function(e){!function(e){var n;(0,J.changeConversationOptions)(((n={})[J.ConversationOption.WAITING_HALL]=e,n))}(e)}),[]),ie=(0,l.useCallback)((function(){return M(!0)}),[]),oe=(0,l.useCallback)((function(){return M(!1)}),[]),re=(0,l.useCallback)((function(){X(!0).catch((function(){I(gi.MAIN)}))}),[f.callData.callId,A]);return(0,o.jsxs)(o.Fragment,{children:[S===gi.MAIN&&(0,o.jsxs)(ia,(0,i.__assign)({title:Z("calls_management_participants"),actionButtons:(0,o.jsxs)(o.Fragment,{children:[W&&(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:ne,appearance:"secondary"},{children:Z("calls_force_call_finish")}),"forceCallFinish"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:r.hangup},{children:Z("calls_leave_call")}),"leave")]},void 0),onCloseModal:Q},{children:[(0,o.jsx)(da,{isLinkBlockShown:F,linkBlockTitle:Z("calls_menu_link"),onLinkBlockClick:q,callUrlLink:A},void 0),(0,o.jsx)(Ua,{SDK:r,bridge:a,onAddClick:$,onShowMoreWaitingHall:ee,navigateToProfile:_,navigateToConvo:s},void 0)]}),void 0),S===gi.CALL_LINK&&(0,o.jsxs)(ia,(0,i.__assign)({title:Z("calls_management_link"),hint:z?Z("calls_management_link_anonymous_disallowed_hint"):"",onCloseModal:Q,isWithBackButton:m!==gi.CALL_LINK,onBackClick:Y,actionButtons:(B?[(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"tertiary",onClick:re},{children:Z("calls_link_invalidate")}),"invalidate-link")]:[]).concat([(0,o.jsx)(Ci.CopyText,(0,i.__assign)({text:A},{children:(0,o.jsx)(Ea.default,(0,i.__assign)({className:"CallManagementModal__copyTextButton",disabled:N,onClick:ie},{children:Z("calls_link_copy")}),void 0)}),"copy-link")])},{children:[(0,o.jsx)(fa,{link:A,isLinkLoading:N,isCopied:w,hideCopiedText:oe},void 0),D&&(0,o.jsx)(mi,{onRequireAuthToJoinChanged:te,requireAuthToJoin:z,isWaitingHallBlockShown:G,onWaitingHallEnabledChanged:ae,isWaitingHallEnabled:K},void 0)]}),void 0),S===gi.ADD_PARTICIPANTS&&(0,o.jsx)(ci,{SDK:r,isWithBackButton:!0,onBackClick:Y},void 0),S===gi.WAITING_HALL&&(0,o.jsx)(ba,{isModal:!0,isWithBackButton:!0,onBackClick:Y,navigateToProfile:_},void 0)]},void 0)};const Si=(0,X.makeIcon)("Icon12CancelOutline","cancel_outline_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="cancel_outline_12"><path clip-rule="evenodd" d="M9.03 2.97a.75.75 0 0 1 0 1.06L7.06 6l1.97 1.97a.75.75 0 0 1-1.06 1.06L6 7.06 4.03 9.03a.75.75 0 0 1-1.06-1.06L4.94 6 2.97 4.03a.75.75 0 0 1 1.06-1.06L6 4.94l1.97-1.97a.75.75 0 0 1 1.06 0z" fill="currentColor" fill-rule="evenodd" /></symbol>',12,12,!1,void 0);var Ii=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("NotificationWithButton",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},Ti=t(91750);const Ni=(0,Ti.makeIcon)("Icon56LogoSferumColor","logo_sferum_color_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="logo_sferum_color_56"><path fill="#07F" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_a)" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_b)" d="M41.468 19.586c-.898-.897-2.067-1.436-3.412-1.643-.206-1.344-.745-2.513-1.642-3.411-6.042-6.043-15.84-6.043-21.882 0-6.043 6.042-6.043 15.84 0 21.882.898.898 2.067 1.436 3.411 1.643.207 1.345.745 2.514 1.643 3.411 6.042 6.043 15.84 6.043 21.882 0 6.043-6.042 6.043-15.84 0-21.882Z" /><path fill="url(#logo_sferum_color_56_c)" d="M24.12 24.12c4.51-4.511 9.98-6.785 13.937-6.177-.206-1.344-.745-2.514-1.642-3.411-3.539-3.539-11.306-1.51-17.348 4.534-6.043 6.042-8.073 13.81-4.534 17.348.898.898 2.067 1.436 3.411 1.643-.609-3.956 1.665-9.427 6.176-13.938Z" /><defs><radialGradient id="logo_sferum_color_56_a" cx="0" cy="0" r="1" gradientTransform="matrix(29.98957 -32.53844 17.18804 15.84163 27.683 27.922)" gradientUnits="userSpaceOnUse"><stop offset=".281" stop-color="#4BF9E8" /><stop offset=".319" stop-color="#41D8D3" /><stop offset=".384" stop-color="#32A4B2" /><stop offset=".451" stop-color="#247696" /><stop offset=".518" stop-color="#19517E" /><stop offset=".584" stop-color="#11356C" /><stop offset=".65" stop-color="#0B205F" /><stop offset=".716" stop-color="#071458" /><stop offset=".779" stop-color="#061055" /></radialGradient><radialGradient id="logo_sferum_color_56_c" cx="0" cy="0" r="1" gradientTransform="rotate(-128.972 23.696 8.511) scale(13.7017 20.209)" gradientUnits="userSpaceOnUse"><stop stop-color="#0B25CE" /><stop offset=".486" stop-color="#2C93DB" /><stop offset=".838" stop-color="#42DCE4" /><stop offset="1" stop-color="#4BF9E8" /></radialGradient><linearGradient id="logo_sferum_color_56_b" x1="16.716" x2="39.042" y1="37.874" y2="18.339" gradientUnits="userSpaceOnUse"><stop stop-color="#0000C9" /><stop offset=".128" stop-color="#2006C9" /><stop offset=".322" stop-color="#4A0EC8" /><stop offset=".511" stop-color="#6B14C8" /><stop offset=".691" stop-color="#8318C7" /><stop offset=".858" stop-color="#911BC7" /><stop offset="1" stop-color="#961CC7" /></linearGradient></defs></symbol>',56,56),xi=(0,Ti.makeIcon)("Icon96LogoVkCallsColor","logo_vk_calls_color_96","0 0 96 96",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 96 96" id="logo_vk_calls_color_96"><path fill="#07F" d="M62.72 0C89.6 0 96 6.4 96 33.28v29.44C96 89.6 89.6 96 62.72 96H33.28C6.4 96 0 89.6 0 62.72V33.28C0 6.4 6.4 0 33.28 0h29.44Z" /><path fill="#77BEFF" d="M95.999 63.146c-.01 3.725-.146 7.051-.446 10.018a55.994 55.994 0 0 1-20.404 3.823c-10.73 0-20.756-3.01-29.281-8.232a2.563 2.563 0 0 0-2.38-.15c-5.3 2.357-11.26 3.594-17.93 4.13-1.841.148-3.08-1.8-2.29-3.471 2.633-5.574 4.358-10.617 5.41-15.635a2.41 2.41 0 0 0-.365-1.821c-5.877-8.875-9.3-19.516-9.3-30.957 0-7.198 1.355-14.08 3.823-20.404C25.916.135 29.382 0 33.28 0h29.44c26.77 0 33.227 6.348 33.279 32.952V63.146Z" /><path fill="#fff" d="M22.834.447a55.996 55.996 0 0 0-3.821 20.398c0 11.44 3.423 22.082 9.3 30.957a2.41 2.41 0 0 1 .365 1.821c-.758 3.618-1.866 7.25-3.413 11.083l-.004.01a77.91 77.91 0 0 1-.289.706 87.244 87.244 0 0 1-1.705 3.836c-.79 1.67.45 3.619 2.292 3.47a79.068 79.068 0 0 0 5.177-.584l.038-.006c4.605-.69 8.836-1.815 12.715-3.539.77-.342 1.66-.29 2.379.15 8.525 5.222 18.551 8.232 29.28 8.232 7.2 0 14.081-1.355 20.405-3.824-.356 3.523-.945 6.539-1.83 9.111A64.15 64.15 0 0 1 75.149 85c-11.245 0-21.833-2.9-31.036-7.995-5.64 2.12-11.655 3.215-17.913 3.718-8.562.687-13.358-8.176-10.183-14.892 2-4.232 3.376-8.019 4.303-11.659-5.918-9.717-9.326-21.135-9.326-33.327 0-6.448.953-12.683 2.729-18.565 2.572-.886 5.588-1.476 9.11-1.833Z" /><path fill="#fff" fill-rule="evenodd" d="M43.164 15.03c2.618-.308 4.793 1.844 6.05 4.356l1.408 2.817a6.894 6.894 0 0 1-2.664 9.022c-.501.296-.659.952-.333 1.44a56.82 56.82 0 0 0 7.084 8.626 56.826 56.826 0 0 0 8.626 7.084 1.017 1.017 0 0 0 1.44-.333 6.894 6.894 0 0 1 9.022-2.664l2.817 1.409c2.512 1.256 4.664 3.431 4.357 6.05-.165 1.403-.744 2.65-1.81 3.717-2.702 2.701-7.448 3.134-12.984 1.453-5.518-1.675-11.729-5.428-17.242-10.942-5.514-5.513-9.267-11.724-10.942-17.242-1.68-5.536-1.248-10.282 1.453-12.984 1.066-1.066 2.313-1.645 3.718-1.81Z" clip-rule="evenodd" /></symbol>',96,96);var yi=t(61108),bi=function(e,n,t){void 0===t&&(t=!1);var a=document.createElement("a");t&&(a.target="_blank"),a.download=n,a.href=e,document.body.appendChild(a),a.click(),a.remove()};function Oi(e){if(e)return function(){switch(yi.Platform.OS){case yi.OS.MAC:case yi.OS.WINDOWS:return{url:d.SFERUM_APP_URL[yi.Platform.OS],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[yi.Platform.OS]};case yi.OS.LINUX:return{url:d.SFERUM_APP_URL[yi.Platform.OS].deb[yi.ARCH.X64],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[yi.Platform.OS].deb[yi.ARCH.X64]};default:return null}}();var n=null;return yi.Platform.OS===yi.OS.MAC?n={url:d.DESKTOP_CALLS_DOWNLOAD[yi.OS.MAC],filename:d.DESKTOP_CALLS_FILENAME[yi.OS.MAC]}:yi.Platform.OS===yi.OS.WINDOWS?n={url:d.DESKTOP_CALLS_DOWNLOAD[yi.OS.WINDOWS],filename:d.DESKTOP_CALLS_FILENAME[yi.OS.WINDOWS]}:yi.Platform.OS===yi.OS.LINUX&&(n={url:d.DESKTOP_CALLS_DOWNLOAD[yi.OS.LINUX].deb[yi.ARCH.X64],filename:d.DESKTOP_CALLS_FILENAME[yi.OS.LINUX].deb[yi.ARCH.X64]}),n}function wi(){s.localStorage.setItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED,"true")}var Mi=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"13",viewBox:"0 0 12 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.21967 2.96967C4.51256 2.67678 4.98744 2.67678 5.28033 2.96967L8.28033 5.96967C8.57322 6.26256 8.57322 6.73744 8.28033 7.03033L5.28033 10.0303C4.98744 10.3232 4.51256 10.3232 4.21967 10.0303C3.92678 9.73744 3.92678 9.26256 4.21967 8.96967L6.68934 6.5L4.21967 4.03033C3.92678 3.73744 3.92678 3.26256 4.21967 2.96967Z",fill:"white",fillOpacity:"0.64"},void 0)}),void 0)},Pi=function(e){var n=e.onClose,t=e.isSferum,a=(0,ue.useLang)().getLang,r=Oi(t),s=yi.Platform.OS===yi.OS.MAC?"macOS":yi.Platform.OS===yi.OS.WINDOWS?"Windows":null,l=s?a("calls_notification_native_app_button_for").replace("{name}",s):a("calls_notification_native_app_button");return(0,o.jsxs)("div",(0,i.__assign)({className:"NotificationDesktopApp"},{children:[(0,o.jsx)(Si,{className:"NotificationDesktopApp--close",onClick:n,width:16,height:16},void 0),!!t&&(0,o.jsx)(Ni,{className:"NotificationDesktopApp--icon"},void 0),!t&&(0,o.jsx)(xi,{className:"NotificationDesktopApp--icon",width:56,height:56},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"NotificationDesktopApp--text"},{children:a("calls_notification_native_app_text")}),void 0),null!==s&&(0,o.jsxs)(Ea.default,(0,i.__assign)({onClick:function(){r&&bi(r.url,r.filename),n()},appearance:"overlay_primary",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Mi,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),null===s&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Mi,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0)]}),void 0)};const ki=(0,X.makeIcon)("Icon20ClockOutline","clock_outline_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="clock_outline_20"><g fill="currentColor"><path d="M10.25 6.5a.75.75 0 0 0-1.5 0v4a.75.75 0 0 0 .516.713l3.5 1.15a.75.75 0 1 0 .468-1.425l-2.984-.981z" /><path clip-rule="evenodd" d="M18.5 10a8.5 8.5 0 1 0-17 0 8.5 8.5 0 0 0 17 0zM3 10a7 7 0 1 1 14 0 7 7 0 0 1-14 0z" fill-rule="evenodd" /></g></symbol>',20,20,!1,void 0),Li=(0,X.makeIcon)("Icon20ChevronRight","chevron_right_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="chevron_right_20"><path fill-rule="evenodd" d="M7.293 4.293a1 1 0 0 1 1.414 0l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414-1.414L11.586 10 7.293 5.707a1 1 0 0 1 0-1.414Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var Di=function(e){var n=e.open,t=e.onClose,a=e.onExit,r=(0,ue.useLang)().getLang,s=(0,l.useRef)(null),c=(0,l.useRef)(null),d=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t){var e=function(){d.current&&clearTimeout(d.current)};return e(),d.current=setTimeout((function(){t(!0)}),1e4),e}}),[n,t]),(0,l.useEffect)((function(){var e;if(!n)return null===(e=s.current)||void 0===e||e.addEventListener("transitionend",t),c.current=setTimeout(t,600),i;function t(){i(),null==a||a()}function i(){var e;null===(e=s.current)||void 0===e||e.removeEventListener("transitionend",t),c.current&&clearTimeout(c.current)}}),[n,a]),(0,o.jsxs)("div",(0,i.__assign)({ref:s,onClick:function(){return null==t?void 0:t()},className:(0,Fa.classNames)({CallsNotificationRecordEnded:!0,"CallsNotificationRecordEnded--closing":!n})},{children:[(0,o.jsx)(ki,{className:"CallsNotificationRecordEnded--clock",fill:"#529EF4"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc__title"},{children:r("calls_record_is_processed")}),void 0),(0,o.jsx)("div",{children:r("calls_open_record_list")},void 0)]}),void 0),(0,o.jsx)(Li,{className:"CallsNotificationRecordEnded--chevron",fill:"var(--steel_gray_200)"},void 0)]}),void 0)};const ji=(0,X.makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Ri=function(e){var n=e.onClose,t=e.onClickJoin,a=(0,l.useContext)(E.LangContext).getLang,r=Oi(),c=yi.Platform.OS===yi.OS.LINUX?"Linux":yi.Platform.OS===yi.OS.MAC?"macOS":yi.Platform.OS===yi.OS.WINDOWS?"Windows":null,u=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),_=u[0],v=u[1],p=c?a("calls_warning_native_app_button_for").replace("{name}",c):a("calls_warning_native_app_button"),f=null===c||yi.Platform.BROWSER===yi.BROWSER.FIREFOX;return(0,o.jsxs)("div",(0,i.__assign)({className:"WarningDesktopApp"},{children:[(0,o.jsx)(ji,{fill:"#FF5C5C"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--title"},{children:a("calls_warning_native_app_title")}),void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--text"},{children:a("calls_warning_native_app_text")}),void 0),!_&&!f&&(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){r&&(bi(r.url,r.filename),wi(),v(!0))},appearance:"overlay_primary"},{children:p}),void 0),!_&&f&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"WarningDesktopApp--link",onClick:function(){wi(),v(!0)}},{children:[p," ",(0,o.jsx)(Mi,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),_&&(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:t,appearance:"overlay_primary"},{children:a("calls_warning_native_app_join_button")}),void 0),(0,o.jsx)(Si,{className:"WarningDesktopApp--close",onClick:n,width:16,height:16},void 0)]}),void 0)};function Bi(e){return new Promise((function(n,t){if(yi.Platform.isMobile)t("is_mobile");else if(document.body.focus(),"hidden"===document.visibilityState||document.hidden)t("hidden_page");else{var a,i=function(){a&&clearTimeout(a),window.removeEventListener("blur",i),n(!0)};if(window.addEventListener("blur",i),a=setTimeout((function(){window.removeEventListener("blur",i),t("timed_out")}),3e3),yi.Platform.BROWSER===yi.BROWSER.SAFARI||yi.Platform.BROWSER===yi.BROWSER.FIREFOX){var o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o);var r=o.contentWindow;r?(r.location.href=e,setTimeout((function(){o.parentNode&&o.parentNode.removeChild(o)}),100)):window.location.href=e}else window.location.href=e}}))}var Ui=function(e){var n=e.joinLink,t=e.vkJoinLink,a=e.userId,i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?joinLink="+n+"&userId="+a;return 0!==a&&a||(i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?callId="+t+"&joinLink="+n),console.log("deeplink: ",i),i},Hi=navigator.userAgent.toLowerCase(),Gi={version:(Hi.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(Hi)&&/webkit|safari|khtml/i.test(Hi),edge:/(edge)\/(\d+)\.(\d+)/.test(Hi),chrome:/(chrome)\/(\d+)\.(\d+)/.test(Hi),firefox:/(firefox)\/(\d+)\.(\d+)/.test(Hi)};function Vi(e){var n,t=null==e?void 0:e.find((function(e){return Gi[e.browser]&&void 0===e.version})),a=null==e?void 0:e.find((function(e){return Gi[e.browser]&&String(Gi.version).startsWith(String(e.version))}));return null!==(n=null!=a?a:t)&&void 0!==n?n:null}function Fi(){var e,n=((null===(e=/\.?(?<host>[^.]+\.[^.]+)$/.exec(window.location.host))||void 0===e?void 0:e.groups)||{}).host;return n&&/^vk\.(com|ru)$/.test(n)?n:"vk.com"}var Wi=function(){var e,n,t,a,r=(0,c.useSelector)((function(e){return e})),s=u(),_=(0,ue.useLang)(),v=_.getLang,p=_.langNumeric,f=r.config.desktopAppNotification,h=(0,i.__read)((0,l.useState)(!1),2),A=h[0],g=h[1];(0,l.useEffect)((function(){r.shouldShowRecordEndedDesktopAppNotification&&g(!0)}),[r.shouldShowRecordEndedDesktopAppNotification]);var m=(0,l.useMemo)((function(){return Vi(r.config.browserWarnings)}),[r.config.browserWarnings]),C=(0,l.useCallback)((function(e){var n,t=null===(n=r.waitingHall)||void 0===n?void 0:n.members.get(e);t&&s({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(e=r.waitingHall)||void 0===e?void 0:e.members,r.participants]),E=(0,l.useCallback)((function(){var e=[ya(r,s)];return Promise.all(e).then((function(){s({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:gi.WAITING_HALL})}))}),[r.waitingHall]),S=(0,l.useCallback)((function(e){r.waitingHall&&Ta(e,r.waitingHall,s)}),[null===(n=r.waitingHall)||void 0===n?void 0:n.members]),I=(0,l.useCallback)((function(){!function(e,n){e&&(e.hasNew=!1,n({type:d.E_ACTION.SET_WAITING_HALL,data:e}))}(r.waitingHall,s)}),[null===(t=r.waitingHall)||void 0===t?void 0:t.hasNew]);if(r.waitingHall&&0!==r.waitingHall.members.size&&r.waitingHall.hasNew){var T=Array.from(r.waitingHall.members.values()),N=v("calls_notification_users_in_waiting_hall_notification",r.waitingHall.totalCount).replace("{names}",(0,Ve.getParticipantsListLabel)(T,T.slice(0,3),(function(e){return e.shortName||e.name}),v,p,r.waitingHall.totalCount)),x=null;if(1===T.length){var y=T[0];x=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return S(y.peerId)},appearance:"overlay_primary"},{children:v("calls_waiting_hall_join")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return C(y.peerId)},appearance:"overlay_secondary"},{children:v("calls_waiting_hall_forbid")}),void 0)]},void 0)}else x=(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return E()},appearance:"overlay_primary"},{children:v("calls_waiting_show_participants")}),void 0);return(0,o.jsx)(Ii,{children:(0,o.jsxs)("div",{children:[(0,o.jsx)(Si,{className:"NotificationWithButton--close",onClick:I},void 0),(0,o.jsx)("span",{children:N},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"NotificationWithButton--buttons"},{children:x}),void 0)]},void 0)},void 0)}if(r.shouldShowRecordEndedDesktopAppNotification&&zt(r))return(0,o.jsx)(Di,{open:A,onClose:function(e){var n,t;!e&&r.translation.ownerId&&window.open&&window.open((n=r.translation.ownerId,t="https://"+Fi(),(0,k.isParticipantGroup)(n)?t+"/video/playlist/"+n+"_-8":t+function(e){return"/video/@"+e+"/recorded_calls"}(n)),"_blank"),g(!1)},onExit:function(){s({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION})}},void 0);if(m&&r.shouldShowWarningDesktopAppNotification&&(0,O.isGroupCallByPeer)(r.peer)&&(null===(a=r.join)||void 0===a?void 0:a.joinLink)){return(0,o.jsx)(Ri,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION,data:!1}),s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},onClickJoin:function(){var e,n,t,a;if(null===(e=r.join)||void 0===e?void 0:e.joinLink)return Bi(Ui({joinLink:null===(n=r.join)||void 0===n?void 0:n.joinLink,vkJoinLink:null===(t=r.join)||void 0===t?void 0:t.vkJoinLink,userId:null===(a=window.vk)||void 0===a?void 0:a.id}))}},void 0)}if(f&&r.shouldShowDesktopAppNotification){return(0,o.jsx)(Pi,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},isSferum:!!r.config.sferum},void 0)}return null},Zi=!1,zi=!0;function Ki(e){zi=e}function Qi(e,n,t){if(void 0===t&&(t=!0),zi)if(e){var a=!(!n||!n.isAudioEnabled);t&&(Zi=a),a&&(0,J.toggleLocalAudio)(!1)}else Zi&&(0,J.toggleLocalAudio)(!0);else Ki(!0)}var Yi,Ji=!1;function Xi(e,n,t,a){var i=e.keyCode,o=e.type,r=e.repeat,s="keydown"===o;if(32===i){if(e&&e.target){if(["FCComposer__input","FCSearch__input","fc_editable","fc_clist_filter_text"].some((function(n){return e.target.classList.contains(n)})))return}if(e.preventDefault(),r)return;if(Ji)return clearTimeout(Yi),void(Ji=!1);Ji=!0,Yi=setTimeout((function(){(function(e,n,t,a){var i=function(){var n,i,o=(null===(n=a.notification)||void 0===n?void 0:n.type)===d.NotificationType.PUSH_TO_TALK,r=!1;if(e&&!o?r=!0:e&&o?r=(null===(i=a.notification)||void 0===i?void 0:i.data)!==(0,O.isIAmSpeaking)(a):!e&&o&&(r=!0),r){var s=null;e&&(s={type:d.NotificationType.PUSH_TO_TALK,timer:0,data:(0,O.isIAmSpeaking)(a)}),t({type:d.E_ACTION.CALL_NOTIFICATION,notification:s})}};return e&&n||!e&&!n?Promise.resolve().then(i):(0,J.toggleLocalAudio)(e).then(i)})(s,n,t,a).then((function(){Ji=!1}))}),s?200:100)}}const qi=(0,X.makeIcon)("Icon16MicrophoneSlash","microphone_slash_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="microphone_slash_16"><path d="M5.498 7.06v.44a2.501 2.501 0 0 0 2.909 2.467l1.2 1.198a4.005 4.005 0 0 1-5.521-2.822.75.75 0 0 0-1.47.314A5.508 5.508 0 0 0 7.25 12.95v1.301a.75.75 0 0 0 1.502 0v-1.3a5.473 5.473 0 0 0 1.972-.669l1.25 1.25a.751.751 0 0 0 1.062-1.061L3.88 3.32a.75.75 0 1 0-1.06 1.06l2.678 2.68Zm6.356 1.529c-.089.314-.03.66.2.89.37.37.993.284 1.16-.211a5.44 5.44 0 0 0 .17-.61.75.75 0 1 0-1.469-.315 3.945 3.945 0 0 1-.061.246ZM6.303 2.662c-.332.307-.254.818.066 1.138l3.428 3.424a.4.4 0 0 0 .683-.279l.022-2.445a2.501 2.501 0 0 0-4.199-1.838Z" /></symbol>',16,16,!1,void 0),$i=(0,X.makeIcon)("Icon16PinDot","pin_dot_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="pin_dot_16"><path d="M6.25 4a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5Z" /><path d="m13.892 5.77-3.657-3.664c-.231-.232-.634-.057-.634.263v.526a.896.896 0 0 1-.263.634L7.623 5.244a.895.895 0 0 1-.633.262H3.995c-.565 0-.847.71-.455 1.102l2.29 2.29-3.569 3.574a.894.894 0 0 0 1.263 1.264l3.57-3.572 2.301 2.301c.402.402 1.101.098 1.101-.456V9.013a.9.9 0 0 1 .262-.633l1.715-1.715a.895.895 0 0 1 .633-.263h.523c.327 0 .488-.407.263-.633Z" /></symbol>',16,16,!1,void 0),eo=(0,X.makeIcon)("Icon16Pin","pin_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="pin_16"><path d="m10.235 2.106 3.657 3.663c.225.226.064.633-.263.633h-.523a.895.895 0 0 0-.633.263L10.758 8.38a.896.896 0 0 0-.262.633v2.996c0 .554-.7.858-1.1.456l-2.301-2.3-3.57 3.57a.893.893 0 1 1-1.264-1.263L5.83 8.898l-2.29-2.29c-.391-.392-.109-1.102.456-1.102H6.99a.895.895 0 0 0 .633-.262L9.338 3.53a.896.896 0 0 0 .263-.634V2.37c0-.32.403-.495.634-.263z" fill="currentColor" /></symbol>',16,16,!1,void 0);var no=(0,l.memo)((function(e){var n,t,a,r,s,c=e.orator,d=e.me,u=e.isPinned,_=e.isPinnedByAdmin,v=e.isPinnedByShareScreen,p=e.isUnpinAllowed,f=e.onTooltipChange,h=e.onUnpin,A=e.tooltips,g=e.oratorDevice,m=(0,l.useContext)(E.LangContext).getLang,C=_||v||u,S=(0,l.useCallback)((function(){f("oratorPin",!1),h()}),[h]),I=(0,l.useCallback)((function(){return f("oratorPin",!0)}),[]),T=(0,l.useCallback)((function(){return f("oratorPin",!1)}),[]),N=(g.wasConnected||c.peerId===d)&&!(null===(n=g.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),x=null===(t=g.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled,y=c.shortName||c.name,b=c.shortNameGen||c.shortName||c.name,O=((null===(a=g.mediaSettings)||void 0===a?void 0:a.isAudioEnabled)||(null===(r=g.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||(null===(s=g.mediaSettings)||void 0===s?void 0:s.isVideoEnabled))&&(g.networkStatus||1)<.6,w=(0,o.jsxs)(o.Fragment,{children:[O&&(0,o.jsx)(q,{fill:(g.networkStatus||1)<=.3?"#ff5c5c":"#FECE00"},void 0),x&&(0,o.jsx)("span",(0,i.__assign)({className:"OratorTitle__additionInfo"},{children:m("calls_orator_screen_sharing")}),void 0),x?b:y,N&&(0,o.jsx)(qi,{},void 0),_&&(0,o.jsx)($i,{},void 0),!_&&(v||u)&&(0,o.jsx)(eo,{},void 0)]},void 0);return C?(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({position:"b",align:"center",content:m(_&&p?"calls_hint_admin_pin_for_admin":_?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:A.oratorPin,delay:300,onOpen:I,onClose:T},{children:(0,o.jsx)("button",(0,i.__assign)({className:"OratorTitle OratorTitle--button",onClick:S,disabled:!p},{children:w}),void 0)}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:"OratorTitle"},{children:w}),void 0)})),to=(0,l.memo)((function(e){var n=e.externalId,t=e.isInfoShown,a=e.isPinned,r=e.isPinnedByAdmin,c=e.isHandRaised,d=void 0!==c&&c,u=e.photo,_=e.hasAudio,v=e.isMe,p=void 0!==v&&v,f=e.name,g=e.letter,m=e.wasConnected,C=void 0===m||m,E=e.onClickParticipant,S=e.onDblClickParticipant,I=(0,l.useContext)(y.ConfigContext).anonymPhoto,T=(0,l.useRef)(null),N=(0,k.isParticipantAnonym)(n),x=(0,s.classNames)("Participant","Participant--withAnimation",{"Participant--isPinned":a}),b=(0,k.externalIdToString)(n),O=(0,l.useCallback)((function(e){E&&E(e,n)}),[E,n]),w=(0,l.useCallback)((function(e){S&&S(e,n)}),[S,n]);return(0,o.jsxs)("article",(0,i.__assign)({ref:T,className:x,onClick:O,onDoubleClick:w,"participant-id":b},{children:[(0,o.jsx)(h,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(A.CallPhoto,{id:+n.id,photo:!I&&N?"":u,alt:f||"",letter:g,className:t?"Participant__offsetCard":""},void 0)}),void 0),d&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(U,{className:"Participant__handIcon"},void 0)}),void 0),t&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:f}),void 0),(C||p)&&!_&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0),!r&&a&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)("div",{className:"Participant__pin"},void 0)}),void 0),r&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)(K,{className:"Participant__icon"},void 0)}),void 0)]}),void 0)}));function ao(e){var n,t,a,r,_,v,p,f,h,g,m,C=e.SDK,S=e.navigateToConvo,I=e.navigateToProfile,T=e.onHandCountChanged,N=e.isVirtualBackgroundSupported,x=(0,c.useSelector)((function(e){return e})),M=u(),P=(0,l.useContext)(E.LangContext).getLang,D=(0,l.useContext)(y.ConfigContext),j=D.isModalView,R=D.debugLog,B=D.enableScreenTrack,U=D.enableProducerScreenTrack,H=D.allowPushToTalk,G=x.peer,V=(0,l.useMemo)((function(){var e,n,t;return(0,O.isGroupCallByPeer)(G)||!!(null===(e=x.localDevice.mediaSettings)||void 0===e?void 0:e.isScreenSharingEnabled)||!!(null===(t=null===(n=(0,k.getPeerIdDeviceInfo)(G,x.devices))||void 0===n?void 0:n.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled)}),[G,x.localDevice,x.devices]),F=V?x.callData.conversation:x.participants[G],W=x.localDevice,Z=W.mediaSettings,z=xt.isMediaAllowed("audio",x.localDevice),K=xt.isMediaAllowed("video",x.localDevice),Q=xt.isMediaAllowed("screenSharing",x.localDevice),Y=L(),X=Y>1,q=(0,k.isCallHaveOtherParticipants)(),$=X||(0,k.isParticipantWithVideo)(W),ee=(0,l.useMemo)((function(){var e;if(!V||!(0,k.participantIsAdmin)(W))return!1;if(x.externalId&&!!(null===(e=x.maps.vkIdToDevices.get(+x.externalId.id))||void 0===e?void 0:e.size))return!1;var n=(0,k.getNonAnonymousConnectParticipantsCount)(),t=n.admins;return!!n.users&&!t}),[V,W.roles,x.externalId,x.participants,x.devices,x.me]),ne=V||Y>2,te=ne&&$&&!x.isOratorMode,ae=ne&&$&&x.isOratorMode,ie=null!==x.adminPinnedParticipant,oe=!ie&&null!==x.pinnedParticipant,re=!oe&&null!==x.screenSharingPinnedParticipant,se=x.uiMode===d.UIMode.FULLSCREEN,le=(0,l.useMemo)((function(){return C.browser.isScreenCapturingSupported()}),[]),ce=(null===(n=x.callData)||void 0===n?void 0:n.canFinishCall)||V&&0===G&&(0,k.isCreator)(W),ue=!!x.translation.deferredId&&!x.translation.isOn,ve=(0,i.__read)((0,l.useState)(!1),2),pe=ve[0],fe=ve[1],he=(0,i.__read)((0,l.useState)(!1),2),Ae=he[0],ge=he[1],me=(0,i.__read)((0,l.useState)(0),2),Ce=me[0],Ee=me[1],Se=Mn(x),Ie=(0,l.useMemo)((function(){return Se?function(e){var n,t,a,o=null!==(t=null===(n=e.participantsChunk)||void 0===n?void 0:n.ids.reduce((function(n,t){var a=(0,k.externalIdToString)(t),i=Xn(e,a);return i&&n.push(i),n}),[]))&&void 0!==t?t:Dn;return 0===(null===(a=e.participantsChunk)||void 0===a?void 0:a.countBefore)&&e.externalId&&o.unshift((0,i.__assign)((0,i.__assign)({},e.localDevice),{externalId:e.externalId})),{activeDevices:Dn=(0,Ve.shallowEqual)(Dn,o)?Dn:o}}(x):(0,k.getActiveDevices)(x)}),[x.devices,x.participantsChunk,x.adminPinnedParticipant,x.gridScrollFirstVisible,x.oratorScrollFirstVisible,x.isOratorMode,x.localDevice,x.oratorScrollNumberOfVisible,x.externalId,Se]),Te=(0,i.__read)(function(e){if(e.participantsChunk){var n=Un(e.participantsChunk);return[n,n+e.participantsChunk.ids.length]}var t=e.isOratorMode,a=t?e.oratorScrollNumberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE,i=t?k.PARTICIPANTS_LIST_BUFFER_SIZE.ORATOR:k.PARTICIPANTS_LIST_BUFFER_SIZE.GRID,o=t?e.oratorScrollFirstVisible:e.gridScrollFirstVisible;return[o<i?0:o-i,o+a+i]}(x),2),Ne=Te[0],xe=Te[1],ye=(0,l.useMemo)((function(){var e=Ie.activeDevices;return Se?e:e.slice(Ne,xe)}),[Ie.activeDevices,Se,Ne,xe]),be=(null===(t=x.callData.conversation)||void 0===t?void 0:t.canAddMembers)&&!(0,k.isParticipantAnonym)(x.me),Oe=(0,l.useCallback)((function(e,n){var t=(0,k.isSameExternalId)(x.pinnedParticipant,n)?null:n;(0,k.isSameExternalId)(x.screenSharingPinnedParticipant,n)&&(t=null),x.screenSharingPinnedParticipant&&M({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),M({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}),[x.pinnedParticipant,x.screenSharingPinnedParticipant]),we=(0,l.useCallback)((function(e,n){x.isOratorMode||M({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),(0,k.isSameExternalId)(x.pinnedParticipant,n)||M({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:n})}),[x.isOratorMode,x.pinnedParticipant]),Me=(0,l.useMemo)((function(){return ye.map((function(e){var n,t,a,i,r,s,l,c,d,u,_=e.mediaSettings,v=_.isAudioEnabled,p=_.isScreenSharingEnabled,f=(0,k.isSameExternalId)(e.externalId,x.externalId),h=x.participants[e.externalId.id],A=f?P("calls_own_label"):(null==h?void 0:h.shortName)?null==h?void 0:h.shortName:null==h?void 0:h.name,g=(0,k.externalIdToString)(e.externalId);if(!e.visible)return(0,o.jsx)(to,{externalId:e.externalId,isInfoShown:!0,isMe:f,isHandRaised:e.wasConnected&&(null===(t=null===(n=e.statusData)||void 0===n?void 0:n.hand)||void 0===t?void 0:t.state),hasAudio:!!v,photo:null==h?void 0:h.photo,name:A,letter:null!==(i=null===(a=null==h?void 0:h.name)||void 0===a?void 0:a[0])&&void 0!==i?i:"",wasConnected:e.wasConnected,onClickParticipant:Oe,isPinned:x.isOratorMode&&(0,k.isSameExternalId)(x.pinnedParticipant,e.externalId)||(0,k.isSameExternalId)(x.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:x.isOratorMode&&(0,k.isSameExternalId)(x.adminPinnedParticipant,e.externalId)},g);var m=x.isOratorMode&&(B||U),E=(0,k.getStream)(e,m&&(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)),T=!(m&&(null===(s=e.mediaSettings)||void 0===s?void 0:s.isVideoEnabled)||!p),N=(0,k.isParticipantWithVideo)(e),y=x.localDevice.status===J.ParticipantStatus.CONNECTED?e.status:J.ParticipantStatus.CONNECTED,b=h&&Ot({state:x,SDK:C,dispatch:M,participant:h,addProfileLink:!0,getLang:P,navigateToConvo:S,navigateToProfile:I,separatedList:!1,device:e});return(0,o.jsx)(de,{externalId:e.externalId,isVisible:e.visible,isInfoShown:!0,isMe:f,isHandRaised:null===(c=null===(l=e.statusData)||void 0===l?void 0:l.hand)||void 0===c?void 0:c.state,hasVideo:!!N,hasAudio:!!v,isSharingScreen:!!T,stream:E,photo:null==h?void 0:h.photo,name:A,letter:null!==(u=null===(d=null==h?void 0:h.name)||void 0===d?void 0:d[0])&&void 0!==u?u:"",status:y,allowContain:!1,wasConnected:e.wasConnected,networkStatus:e.networkStatus,onClickParticipant:x.isOratorMode?Oe:void 0,onDblClickParticipant:x.isOratorMode?void 0:we,actions:b,isPinned:x.isOratorMode&&(0,k.isSameExternalId)(x.pinnedParticipant,e.externalId)||(0,k.isSameExternalId)(x.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:x.isOratorMode&&(0,k.isSameExternalId)(x.adminPinnedParticipant,e.externalId)},g)}))}),[ye,x.externalId,x.participants,x.isOratorMode,x.pinnedParticipant,x.screenSharingPinnedParticipant,x.adminPinnedParticipant,x.groupId,x.me,x.peer,x.config,x.localDevice,x.callData,x.permissions]),Pe=function(e){M({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},Le=function(){Be(C,[J.MediaOption.AUDIO,J.MediaOption.VIDEO]).then((function(){M({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_SETTINGS})}))},Ue=function(e){M(e?{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_RECORD}:{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION})},He=(0,l.useCallback)((function(){oo({isModalView:j,uiMode:x.uiMode,changeUIMode:Pe})}),[x.uiMode]);(0,yt.useNavGoListener)(He,!x.config.enableNavChangeCallCollapse),(0,yt.useBoxLayerObserver)(He,!x.config.enableNavChangeCallCollapse);var Ge=(0,l.useCallback)((function(){M({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!x.isOratorMode})}),[x.isOratorMode]),Fe=(0,l.useCallback)((function(){M({type:d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!x.isShownParticipantsAside})}),[x.isShownParticipantsAside]),We=(0,l.useCallback)((function(){M({type:d.E_ACTION.MANAGEMENT,isOpen:!0})}),[]),Ze=(0,l.useCallback)((function(){M({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:gi.CALL_LINK})}),[]),Ke=(0,l.useCallback)((function(){if(!Ae){var e=!Z.isVideoEnabled||!!Z.isScreenSharingEnabled&&!B;(e?Be(C,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){ge(!0),B||Z.isScreenSharingEnabled&&C.captureScreen(!1),C.toggleLocalVideo(e).catch((function(){})).finally((function(){ge(!1)}))})),w.callStats.logEvent({call_event_type:e?d.CallActionEventType.VIDEO_ENABLED:d.CallActionEventType.VIDEO_DISABLED,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer),reason:e?void 0:"manual"})}}),[Z,Ae]),Ye=(0,l.useCallback)((function(){C.captureScreen(!Z.isScreenSharingEnabled).catch((function(){"MacOS"===C.browser.os()&&"Chrome"===C.browser.browserName()?M({type:d.E_ACTION.ERROR,text:P("calls_error_disabled_screen_sharing_macos_chrome")}):M({type:d.E_ACTION.ERROR,text:P("calls_error_disabled_screen_sharing")})})),w.callStats.logEvent({call_event_type:Z.isScreenSharingEnabled?d.CallActionEventType.SCREEN_SHARING_STOPPED:d.CallActionEventType.SCREEN_SHARING_STARTED,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})}),[Z.isScreenSharingEnabled,x.screenSharers,x.callData.callId,x.peer]),Je=(0,l.useCallback)((function(){S(x.peer)===yt.ENavigateToConvoDirection.Messenger&&He()}),[x.peer,x.uiMode]),Xe=(0,l.useCallback)((function(){if(!pe){var e=!Z.isAudioEnabled;(e?Be(C,[J.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;fe(!0),(null===(n=x.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&M({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),C.toggleLocalAudio(e).catch((function(){})).finally((function(){fe(!1)}))}))}}),[Z,pe]),qe=(0,l.useCallback)((function(){var e,n,t,a,o=!(null===(n=null===(e=W.statusData)||void 0===e?void 0:e.hand)||void 0===n?void 0:n.state);C.changeParticipantState({hand:o?d.SdkHandType.RAISED:d.SdkHandType.LOWERED}),M({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i.__assign)((0,i.__assign)({},W.statusData),{hand:{state:!(null===(a=null===(t=W.statusData)||void 0===t?void 0:t.hand)||void 0===a?void 0:a.state),ts:Date.now()}})}}),w.callStats.logEvent({call_event_type:o?d.CallActionEventType.HAND_RAISED:d.CallActionEventType.HAND_LOWERED,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})}),[null===(r=null===(a=W.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state]),en=(0,l.useCallback)((function(){M({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_EXIT})}),[]),nn=(0,l.useCallback)((function(){M({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSFER_ADMIN_RIGHTS})}),[]),tn=(0,l.useCallback)((function(){C.hangup(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer),reason:"none",group_call_users_count:Y})}),[x.callData.callId,x.peer,Y]),an=(0,l.useCallback)((function(){M({type:d.E_ACTION.CHANGE_UI_MODE,mode:se?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),M({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[x.uiMode]),on=(0,l.useCallback)((function(e,n){var t;M({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),rn=(0,l.useCallback)((function(){M({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){ue&&on("streaming",!0)}),[ue]);(0,l.useEffect)((function(){x.isOratorMode||function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===t?void 0:t.offsetWidth)||1/0,i=6*Math.floor(e/a),o=Ie.activeDevices,r=0;r<o.length;r++){var s=n+r,l=s>=i&&s<i+30;o[r].visible!==l&&((0,k.isSameExternalId)(x.externalId,o[r].externalId)?M({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:l}}):$e(M,o[r].externalId,{visible:l}))}}(x.gridScrollPosition,Un(x.participantsChunk))}),[x.isOratorMode,x.uiMode,x.gridScrollPosition,Ie.activeDevices,null===(_=x.participantsChunk)||void 0===_?void 0:_.countBefore]),(0,l.useEffect)((function(){x.isOratorMode&&function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===t?void 0:t.offsetHeight)||0,i=Math.max(0,Math.floor(e/148)-1),o=Math.min(x.config.videoSlotsCount,Math.floor(a/148+3)),r=Ie.activeDevices,s=0;s<r.length;s++){var l=n+s,c=l>=i&&l<i+o;r[s].visible!==c&&((0,k.isSameExternalId)(x.externalId,r[s].externalId)?M({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:c}}):$e(M,r[s].externalId,{visible:c}))}}(x.oratorScrollPosition,Un(x.participantsChunk))}),[x.externalId,x.config.videoSlotsCount,x.isOratorMode,x.uiMode,x.oratorScrollPosition,Ie.activeDevices,null===(v=x.participantsChunk)||void 0===v?void 0:v.countBefore]);var sn=(0,l.useCallback)((0,s.debounce)((function(e){var n,t=(null===(n=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===n?void 0:n.offsetWidth)||1/0,a=6*Math.floor(e/t);mn(x,M,{type:d.E_ACTION.SET_GRID_SCROLL_POSITION,position:e,firstVisible:a,numberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE},C)}),200),[]),ln=(0,l.useCallback)((0,s.throttle)((function(e){var n,t=document.querySelectorAll('[data-calls-id="participant"]')[0],a=t?t.offsetWidth+8:1/0,i=(null===(n=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===n?void 0:n.offsetHeight)||0,o=Math.floor(e/a)-1,r=Math.min(x.config.videoSlotsCount,i/a+3);mn(x,M,{type:d.E_ACTION.SET_ORATOR_SCROLL_POSITION,position:e,firstVisible:o,numberOfVisible:r},C)}),100),[x.config]),cn=(0,l.useMemo)((function(){var e,n,t=[{text:P("calls_call_menu_settings"),key:"settings",onClick:Le,disabled:!1}];if(x.config.streaming&&!(0,k.isParticipantAnonym)(x.me)&&(t.push({text:P("calls_call_menu_translation"),key:"translation",onClick:function(){return Ue(!1)},disabled:!!(null===(e=x.translation)||void 0===e?void 0:e.isOn)&&(!!x.translation.isRecord||Wt(x))}),x.config.enableTranslationSplit)){var a=!(!(null===(n=x.translation)||void 0===n?void 0:n.isOn)||!x.translation.isRecord),i=function(){var e;return a?!Zt(x):!!(null===(e=x.translation)||void 0===e?void 0:e.isOn)}(),o=function(){var e;return(null===(e=x.translation)||void 0===e?void 0:e.isOn)?function(){M({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}:function(){return Ue(!0)}}();t.push({text:a&&Zt(x)?P("calls_record_stop_confirmation"):P("calls_call_menu_recording"),key:"recording",onClick:o,disabled:i}),t.push({separator:!0})}return(0,k.canMuteParticipants)(W)&&V&&(t.push({text:P("calls_call_menu_mute_audio_all_v2"),key:"muteAllAudio",onClick:function(){M({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_AUDIO}})},isEnabled:x.permissions.AUDIO!==J.MuteState.MUTE_PERMANENT}),t.push({text:P("calls_call_menu_mute_video_all_v2"),key:"muteAllVideo",onClick:function(){M({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_VIDEO}})},isEnabled:x.permissions.VIDEO!==J.MuteState.MUTE_PERMANENT})),(0,k.canMuteParticipants)(W)&&V&&q&&(t.push({text:P("calls_call_menu_enable_media_request"),key:"unmuteRequest",onClick:function(){C.muteParticipant(null,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_ALL_TO_UNMUTE,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})}}),t.push({separator:!0})),N&&t.push({text:P("calls_virtual_background"),key:d.POPUP_VIRUTAL_BACKGROUND,onClick:function(){M({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}}),R&&(t.push({separator:!0}),t.push({text:P("calls_call_menu_debug"),key:"debugLog",onClick:function(){window.__VKCallsSDKLogs__()},disabled:!1})),t}),[x.peer,x.config.streaming,x.me,x.groupId,null===(p=x.translation)||void 0===p?void 0:p.isOn,null===(f=x.translation)||void 0===f?void 0:f.isRecord,x.conversationOptions,x.permissions,x.callData.callId,x.localDevice.roles,W,V,q]);(0,l.useEffect)((function(){return function(){M({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var dn=(0,l.useCallback)((function(){ie&&(0,k.canPinParticipants)(W)?(C.pinParticipant(x.adminPinnedParticipant,!0).then((function(){M({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})):(M({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),M({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:null}))}),[x.adminPinnedParticipant,x.peer,x.callData.callId]),un=(0,l.useCallback)((function(e){z&&Xi(e,!!Z.isAudioEnabled,M,x)}),[z,Z.isAudioEnabled,x.notification]);(0,l.useEffect)((function(){H&&z&&Qi(x.pushToTalkEnabled,Z,!0)}),[]),(0,l.useEffect)((function(){return H&&!function(e){return e.uiMode===d.UIMode.COLLAPSED}(x)&&x.pushToTalkEnabled?(e=un,window.addEventListener("keydown",e),window.addEventListener("keyup",e),function(){!function(e){window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}(un)}):function(){};var e}),[x.uiMode,x.pushToTalkEnabled,un]);var _n=(0,l.useMemo)((function(){var e;return(0,o.jsx)(Qe,{dispatch:M,notification:x.notification,participant:x.participants[null===(e=x.notification)||void 0===e?void 0:e.data]},void 0)}),[x.notification,x.participants[null===(h=x.notification)||void 0===h?void 0:h.data]]),vn=(0,l.useMemo)((function(){return(0,o.jsx)(Wi,{},void 0)}),[x.waitingHall,x.shouldShowDesktopAppNotification,x.shouldShowWarningDesktopAppNotification,x.join]);(0,l.useEffect)((function(){if(!x.callData.localTimeStamp&&!(0,O.isGroupCallByPeer)(x.peer)&&!ze(x,P)){var e=(0,k.getPeerIdDeviceInfo)(x.peer,x.devices);e&&e.status===J.ParticipantStatus.CONNECTED&&M({type:d.E_ACTION.LOCAL_TIME_START,data:Date.now()})}}),[x]),(0,l.useEffect)((function(){V&&Ee(Y)}),[Y]);var fn=(0,l.useRef)({}),hn=(0,l.useRef)({});return(0,l.useEffect)((function(){var e,n,t,a,o,r=[],s=function(e){var n,t=x.devices[e],a=t&&x.participants[t.externalId.id],i=a?a.peerId:e.split(":")[0];return(!a||(0,Ve.isEmpty)(null==t?void 0:t.mediaSettings)||!a.name)&&(null!==(n=fn.current[i])&&void 0!==n?n:0)<5&&(void 0===hn.current[i]||Date.now()-hn.current[i]>1e4)},l=Date.now();try{for(var c=(0,i.__values)(ye),d=c.next();!d.done;d=c.next()){var u=d.value,_=(0,k.externalIdToString)(u.externalId),v=+u.externalId.id;s(_)&&(r.push(v),fn.current[v]=(null!==(o=fn.current[v])&&void 0!==o?o:0)+1,hn.current[v]=l)}}catch(n){e={error:n}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var p=(0,i.__values)(x.speakersInHeader),f=p.next();!f.done;f=p.next()){s(_=f.value)&&x.devices[_]&&r.push(+x.devices[_].externalId.id)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(t)throw t.error}}if(window.Calls&&r.length>0){var h=x.callData.callId||"",A={withConversation:!x.callData.conversation,awaitImages:!1};pn(x,M,window.Calls,h,r,A)}}),[x.peer,x.speakersInHeader,ye]),(0,o.jsx)(b,(0,i.__assign)({onClose:ee?nn:tn,isCautionBoxShown:!ee,onBackdropClick:He},{children:(0,o.jsx)(ke,(0,i.__assign)({info:(0,o.jsx)(na,{onHandCountChanged:T},void 0),callMenuActions:cn,isVideoAllowed:Z.isVideoEnabled||K,isAudioAllowed:Z.isAudioEnabled||z,isVideoEnabled:B?!!Z.isVideoEnabled:!!Z.isVideoEnabled&&!Z.isScreenSharingEnabled,isAudioEnabled:Z.isAudioEnabled,isScreenSharingEnabled:Z.isScreenSharingEnabled,isOratorMode:x.isOratorMode,isFullScreen:se,onToggleVideo:Ke,onToggleAudio:Xe,onToggleScreenShare:Ye,onLeaveCall:ee?nn:ce?en:tn,onCollapseCall:j?He:null,onToggleOratorMode:Ge,onFullScreenToggle:an,onTooltipChange:on,onHidePanel:rn,onChat:Je,onHandClick:qe,isParticipantControlActive:x.isManagementOpen,isLayoutSwitchShown:V&&X,isHandRaised:null===(m=null===(g=W.statusData)||void 0===g?void 0:g.hand)||void 0===m?void 0:m.state,isHandControlShown:V,isChatControlShown:!!G&&!x.groupId,isScreenShareControlShown:Q&&le,isStreamingControlShown:ue,isChainControlShown:be,onDeferredStreamStart:function(){if(x.translation.deferredId){var e={isOn:!1,startStreamParams:{upcomingStreamParams:{ovId:x.translation.deferredId}}};M({type:d.E_ACTION.SET_TRANSLATION,data:e}),M({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})}},onParticipantsClick:We,chatUnreadCount:x.chatUnreadCount,notification:_n,tooltips:x.tooltips,onChainClick:Ze,notificationWithButton:vn,participantCount:Ce,isPopupOrModalOpen:!(!x.popup&&!x.isManagementOpen)},{children:(0,o.jsxs)(o.Fragment,{children:[!ne&&(0,o.jsx)(_e,{},void 0),te&&(0,o.jsx)(De,(0,i.__assign)({onScroll:sn,scrollPosition:x.gridScrollPosition,participantsCount:Y,participantsShiftCount:Ne},{children:Me}),void 0),ae&&(0,o.jsx)(je,(0,i.__assign)({orator:io(x,P,Ye),oratorTitle:(0,o.jsx)(no,{orator:(0,k.getOrator)(x).participant,oratorDevice:(0,k.getOrator)(x).device,me:x.me,isPinned:oe,isPinnedByAdmin:ie,isPinnedByShareScreen:re,isUnpinAllowed:(0,k.canPinParticipants)(W)||!ie,onUnpin:dn,tooltips:x.tooltips,onTooltipChange:on},void 0),onToggleParticipantsAside:Fe,isShownParticipantsAside:x.isShownParticipantsAside,onScroll:ln,scrollPosition:x.oratorScrollPosition,participantsAsideCount:Y,participantsAsideShift:0===Ne?0:148*Ne-8},{children:Me}),void 0),ne&&!$&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(A.CallPhoto,{id:G,photo:F&&F.photo||"",waves:!0,alt:F&&F.tab||"",className:"CallPhoto--orator"},void 0)},void 0)]},void 0)}),void 0)}),void 0)}function io(e,n,t){var a,i,r,s,l,c=(0,k.getOrator)(e),d=c.device,u=c.participant;"externalId"in d?(r=(0,k.isSameExternalId)(d.externalId,e.externalId),s=(0,k.externalIdToString)(d.externalId),l=d.externalId):(r=(null==u?void 0:u.peerId)===e.me,s=null==u?void 0:u.peerId,l=e.externalId||(0,k.getDefaultExternalId)()),r&&e.groupId&&e.meGroup&&(u=u&&(0,tn.mergeGroupToParticipant)(e.meGroup,u));var _=(0,k.isParticipantWithVideo)(d),v=(0,k.getStream)(d);return(0,o.jsx)(ce,{externalId:l,isOrator:!0,isInfoShown:!0,isMe:r,hasVideo:!!_,hasAudio:!!(null===(a=d.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isSharingScreen:!!(null===(i=d.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),stream:v,photo:null==u?void 0:u.photo,name:r?n("calls_own_label"):null==u?void 0:u.name,status:d.status,wasConnected:d.wasConnected,networkStatus:d.networkStatus,allowContain:!0,onStopScreenShare:t},s)}function oo(e){var n=e.isModalView,t=e.uiMode,a=e.changeUIMode;n&&(t===d.UIMode.FULLSCREEN?((0,ta.pause)(.3,null).then((function(){a(d.UIMode.COLLAPSED)})),a(d.UIMode.DEFAULT)):a(d.UIMode.COLLAPSED))}var ro=function(e,n,t,a){var i=Math.max(e,Math.min(n,t));return Math.abs(i-e)<a?e:Math.abs(i-n)<a?n:i},so={bottom:0,left:0,right:0,top:0},lo=[15,-15],co=function(e){var n=e.children,t=e.style,a=e.startCoords,r=void 0===a?lo:a,s=e.padding,c=void 0===s?so:s,d=e.className,u=e.onUpdateStartCoords,_=e.ignoredSelectors,v=(0,l.useRef)(null),p=(0,l.useRef)(!1),f=(0,i.__read)(function(){var e=(0,i.__read)((0,l.useState)((function(){return[window.innerHeight,window.innerWidth]})),2),n=e[0],t=e[1],a=(0,l.useRef)();return(0,l.useEffect)((function(){var e=function(){a.current&&clearTimeout(a.current),a.current=setTimeout((function(){t([window.innerHeight,window.innerWidth])}),300)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),n}(),2),h=f[0],A=f[1],g=(0,i.__read)(function(e){var n=(0,i.__read)((0,l.useState)([0,0]),2),t=n[0],a=n[1];return(0,l.useEffect)((function(){if(e.current){var n=e.current.getBoundingClientRect();a([n.width,n.height])}}),[]),t}(v),2),m=g[0],C=g[1],E=(0,i.__read)((0,l.useState)([0,0]),2),S=(0,i.__read)(E[0],2),I=S[0],T=S[1],N=E[1],x=(0,i.__read)((0,l.useState)(r),2),y=(0,i.__read)(x[0],2),b=y[0],O=y[1],w=x[1],M=(0,l.useCallback)((function(e,n){var t=0+c.left,a=0-c.top;return[ro(t,A-m-c.right,e,10),ro(-h+C+c.bottom,a,n,10)]}),[A,h,m,C,c]);(0,l.useEffect)((function(){w(M(b,O))}),[M]),(0,l.useEffect)((function(){null==u||u([b,O])}),[b,O,u]);var P=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),p.current||N([e.shiftX,e.shiftY])}),[b,O]),k=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),p.current?p.current=!1:(w((function(n){var t=(0,i.__read)(n,2),a=t[0],o=t[1];return M(a+e.shiftX,o+e.shiftY)})),N([0,0]))}),[M]),L=(0,l.useCallback)((function(e){(function(e,n){return!!n&&n.some((function(n){var t,a;return null===(a=(t=e.originalEvent.target).closest)||void 0===a?void 0:a.call(t,n)}))})(e,_)&&(p.current=!0)}),[]),D=(0,i.__read)(M(b+I,O+T),2),j=D[0],R=D[1];return(0,o.jsx)(Fa.Touch,(0,i.__assign)({className:d,Component:"div",getRootRef:v,style:(0,i.__assign)((0,i.__assign)({},t),{transform:"translate("+j+"px, "+R+"px)"}),onStart:L,onMove:P,onEnd:k},{children:n}),void 0)};function uo(e){var n={h:!1,v:!1};if(!e)return n;var t=document.querySelector(e);return t?(t.scrollHeight>window.innerHeight&&(n.v=!0),t.scrollWidth>window.innerWidth&&(n.h=!0),n):((0,J.debugMessage)(J.DebugMessageType.ERROR,{hook:"useDragStaticElement",desc:"padding.checkScrollSelector (="+e+") is invalid"}),n)}var _o={key:"calls_collapsed_call_position",getPosition:function(){var e=sessionStorage.getItem(_o.key);return(0,s.isString)(e)?JSON.parse(e):void 0},setPosition:function(e){sessionStorage.setItem(_o.key,JSON.stringify(e))}},vo=function(e){var n=e.children,t=(0,l.useContext)(y.ConfigContext).withAnimation,a=(0,s.classNames)("CollapsedCall",{"CollapsedCall--withAnimation":t});return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},po=function(e){var n=e.children,t=function(e){var n=(0,i.__read)((0,l.useState)({h:!1,v:!1}),2),t=n[0],a=n[1],o=(0,l.useRef)();return(0,l.useLayoutEffect)((function(){a(uo(e))}),[e]),(0,l.useEffect)((function(){var n=function(){o.current&&clearTimeout(o.current),o.current=setTimeout((function(){a(uo(e))}),300)};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[e]),t}("body"),a=(0,l.useMemo)((function(){return{bottom:t.h?30:15,left:15,right:t.v?30:15,top:15}}),[t]),r=(0,l.useMemo)((function(){return _o.getPosition()||[15,-15]}),[]),c=(0,l.useMemo)((function(){return[".CallVideoWidget__buttons"]}),[]),d=(0,l.useCallback)((function(e){_o.setPosition(e)}),[]),u=(0,l.useContext)(y.ConfigContext).withAnimation,_=(0,s.classNames)("CollapsedCall","CollapsedCall--draggable",{"CollapsedCall--withAnimation":u});return(0,o.jsx)(co,(0,i.__assign)({className:_,padding:a,startCoords:r,onUpdateStartCoords:d,ignoredSelectors:c},{children:n}),void 0)},fo=function(e){var n=e.id,t=e.photo,a=e.title,r=e.status,s=e.isIncoming,l=e.onClick,c=e.children;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallWidget",onClick:l},{children:[(0,o.jsx)(h,{id:n,className:"CallWidget__background"},void 0),(0,o.jsx)(A.CallPhoto,{id:n,photo:t,waves:s,alt:a||"",className:"CallWidget__photo"},void 0),(0,o.jsx)("h1",(0,i.__assign)({className:"CallWidget__name"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallWidget__status"},{children:r}),void 0),c]}),void 0)},ho=function(e){var n=e.localVideoStream,t=e.isLocalAudioEnabled,a=e.isLocalAudioAllowed,r=e.isLocalScreenSharing,s=e.participantId,c=e.isMe,u=void 0!==c&&c,_=e.isWithVideo,v=e.isWithAudio,p=e.isScreenSharing,f=e.stream,h=e.photo,A=e.name,g=e.status,S=void 0===g?J.ParticipantStatus.CONNECTED:g,I=e.networkStatus,T=e.onRestoreCall,N=e.onToggleAudio,x=e.children,y=e.isRecord,b=(0,l.useContext)(E.LangContext).getLang,O=(0,i.__read)((0,l.useState)(!1),2),w=O[0],M=O[1],P=le().storedVideoOptions;(0,l.useEffect)((function(){n||M(!1)}),[n,w]);var L=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),T()}),[T]),D=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),N&&N()}),[N]),j=(0,l.useCallback)((function(e){var n,t;(null===(t=(n=e.target).closest)||void 0===t?void 0:t.call(n,".CallVideoWidget__buttons"))||T()}),[T]);return(0,o.jsxs)("div",(0,i.__assign)({className:"CallVideoWidget",onDoubleClick:j},{children:[n&&(0,o.jsx)(B,{className:"CallVideoWidget__local",participantId:(0,k.externalIdToString)(s),stream:n,isMirrored:!r&&P[d.EVideoOptionType.IS_VIDEO_MIRRORED],isLocalSchreenShare:r,isContained:!1,isStartWithVisible:!0},void 0),y&&(0,o.jsx)(Bt,{className:"CallVideoWidget__is-record-icon",fill:"#FF3347",width:16,height:16},void 0),(0,o.jsx)(ce,{externalId:s,hasVideo:_,hasAudio:v,isSharingScreen:p,isMe:u,stream:f,photo:h,name:A,status:S,allowContain:!1,networkStatus:I},void 0),x,(0,o.jsx)(ve,(0,i.__assign)({alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"left",marginTop:6,text:b(t?"calls_mute":"calls_unmute")},{children:(0,o.jsx)(m,{type:t?"mute":"unmute",onClick:D,disabled:!a},void 0)}),void 0)}),void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"right",text:b("calls_restore"),marginTop:6},{children:(0,o.jsx)(m,{type:"restore",onClick:L},void 0)}),void 0)}),void 0)]}),void 0)},Ao=function(e){var n,t,a,r=e.SDK,s=P((function(e){return e})),c=u(),_=(0,l.useContext)(E.LangContext).getLang,v=s.peer,p=(0,Ve.isAnyoneWithVideo)(s),f=(0,O.isGroupCallByPeer)(v)?s.callData.conversation:s.participants[s.peer],h=s.localDevice,A=(0,k.getCallVisibleParticipant)(s,p),g=(0,k.isParticipantWithVideo)(h)&&A&&!(0,k.isSameExternalId)(A.externalId,s.externalId),m=P((function(e){return e.translation.isOn&&!!e.translation.isRecord})),C=xt.isMediaAllowed("audio",s.localDevice),S=(0,l.useCallback)((function(){c({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),Ki(!1)}),[]),I=(null===(n=null==h?void 0:h.mediaSettings)||void 0===n?void 0:n.isAudioEnabled)||C,T=(0,l.useCallback)((function(){var e;r.toggleLocalAudio(!(null===(e=h.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[s]);return(0,o.jsxs)(o.Fragment,{children:[s.mode===d.Mode.INCOMING&&(0,o.jsx)(vo,{children:(0,o.jsx)(fo,{id:v,title:(null==f?void 0:f.tab)||"",photo:(null==f?void 0:f.photo)||"",status:_("calls_incoming_collapsed"),isIncoming:!0,onClick:S},void 0)},void 0),s.mode!==d.Mode.INCOMING&&(0,o.jsx)(po,{children:(0,o.jsx)(ho,(0,i.__assign)({localVideoStream:g?(0,k.getStream)(h):void 0,isLocalAudioEnabled:!!(null===(t=h.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isLocalAudioAllowed:I,isLocalScreenSharing:!!(null===(a=h.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled)},go(s,A,f),{onRestoreCall:S,onToggleAudio:T,isRecord:m}),void 0)},void 0)]},void 0)};function go(e,n,t){var a,i,o=n&&e.participants[n.externalId.id];return n&&o?{participantId:n.externalId,isMe:+n.externalId.id===e.me,isWithVideo:(0,k.isParticipantWithVideo)(n),isWithAudio:!!(null===(a=n.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isScreenSharing:!!(null===(i=n.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),stream:(0,k.getStream)(n),photo:o.photo,name:o.name,status:n.status,networkStatus:n.networkStatus||1}:{participantId:(0,k.getDefaultExternalId)(),isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:(null==t?void 0:t.photo)||"",name:(null==t?void 0:t.tab)||"",status:(null==t?void 0:t.status)||J.ParticipantStatus.CONNECTED,networkStatus:1}}var mo="incoming",Co="outgoing",Eo="connecting",So="connected",Io="end";function To(e){var n,t=e.onBeforeCallStart,a=e.onAfterCallFinish,r=e.callSounds,s=(0,c.useSelector)((function(e){return e})),u=(0,l.useRef)(),_=((n={}).incoming=(0,l.useRef)(null),n.outgoing=(0,l.useRef)(null),n.connecting=(0,l.useRef)(null),n.connected=(0,l.useRef)(null),n.end=(0,l.useRef)(null),n),v={controls:!1,preload:"auto"},p=(0,l.useCallback)((function(e){var n=_[e].current;n&&n.paused&&n.play().catch((function(){}))}),[]),f=(0,l.useCallback)((function(e){var n=_[e].current;n&&!n.paused&&(n.pause(),n.currentTime=0)}),[]),h=(0,l.useCallback)((function(){Object.keys(_).forEach(f)}),[]),A=(0,l.useCallback)((function(e){var n=_[e].current;if(n){var t=n.volume;n.volume=0,n.play().catch((function(){})),n.pause(),n.currentTime=0,n.volume=t}}),[]),g=(0,l.useCallback)((function(){t&&t()}),[t]),m=(0,l.useCallback)((function(){a&&a()}),[a]);return(0,l.useEffect)((function(){return Gi.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(_).forEach(A),document.body.removeEventListener("mousedown",e)})),function(){h(),m()}}),[]),(0,l.useEffect)((function(){var e=u.current||s,n=s;e.mode!==n.mode&&(e.mode!==d.Mode.READY||n.mode!==d.Mode.INCOMING&&n.mode!==d.Mode.CALL||g(),e.mode===d.Mode.INCOMING&&f(mo),n.mode===d.Mode.INCOMING&&p(mo),n.mode!==d.Mode.READY||e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL||(h(),p(Io),m()));var t=n.me,a=e.participants,o=n.participants,r=e.localDevice.status,l=n.localDevice.status,c=e.devices,_=n.devices;r!==l&&(r===J.ParticipantStatus.CONNECTING&&f(Eo),l===J.ParticipantStatus.CONNECTING&&p(Eo));var v=(0,Ve.objectSome)(o,(function(e){var n=e.peerId;return!!a[n]&&(0,k.someDeviceByParticipant)(a[n],(function(e){return e.status===J.ParticipantStatus.CONNECTED}))})),A=(0,Ve.objectSome)(o,(function(e){var n=e.peerId,t=c[n],a=_[n];return t&&a&&t.status!==a.status&&a.status===J.ParticipantStatus.CONNECTED}));!v&&A&&p(So),n.mode===d.Mode.CALL&&(!function(e,n,t,a){var o,r,s=!1;try{for(var l=(0,i.__values)(Object.values(e)),c=l.next();!c.done;c=l.next()){var d=c.value;if(d.peerId!==n){if((0,k.someDeviceByParticipant)(d,(function(e){return e.status===J.ParticipantStatus.CONNECTED})))return!1;(0,k.someDeviceByParticipant)(d,(function(e){return e.status===J.ParticipantStatus.WAITING}))&&(!a||t.has(d.peerId))&&(s=!0)}}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return s}(o,t,n.participantsAddedByMe,(0,O.isGroupCallByPeer)(s.peer))?f(Co):p(Co)),u.current=s}),[s]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("audio",(0,i.__assign)({src:r.incoming,ref:_.incoming,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.outgoing,ref:_.outgoing,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connected,ref:_.connected,loop:!1},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connecting,ref:_.connecting,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.end,ref:_.end,loop:!1},v),void 0)]},void 0)}var No=t(56589),xo=t(79806),yo=t(74041);function bo(e){var n=e.cameras,t=e.mics,a=e.noiseCancellationOptions,r=e.videoResolutionOptions,c=e.currentCamId,u=e.currentMicId,_=e.currentNoiseCancellation,v=e.currentVideoResolution,p=e.isCamAvailable,f=void 0!==p&&p,h=e.isMicAvailable,A=void 0!==h&&h,g=e.onCameraChange,m=e.onMicChange,S=e.onNoiseCancellationChange,I=e.onVideoResolutionChange,T=e.pushToTalkEnabled,N=e.onPushToTalkChange,x=(0,l.useContext)(E.LangContext).getLang,b=(0,l.useContext)(y.ConfigContext).allowPushToTalk,O=(0,l.useRef)(null);!function(e){var n=e.kind,t=e.resolution,a=e.mediaElRef,i=e.streamRef,o=e.deviceId,r=e.isActive,s={deviceId:o};"video"===n&&t&&(s.width={min:428,max:d.VideoWidth[t]||d.VideoWidth.SD,ideal:d.VideoWidth[t]||d.VideoWidth.SD},s.height={min:240,max:d.VideoHeight[t]||d.VideoHeight.SD,ideal:d.VideoHeight[t]||d.VideoHeight.SD});(0,l.useEffect)((function(){r&&wo(n,s).then((function(e){var n;null===(n=i.current)||void 0===n||n.getTracks().forEach((function(e){return e.stop()}));var t=a.current;t&&(i.current=e,t.srcObject=e,t.volume=0,t.play())})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,{err:e,deviceId:o,kind:n,kindParams:s})}))}),[o,r,t]),(0,l.useEffect)((function(){return function(){var e=i.current;e&&e.getTracks().forEach((function(e){return e.stop()}));var n=a.current;n&&(n.srcObject=null)}}),[])}({kind:"video",resolution:v,mediaElRef:O,streamRef:(0,l.useRef)(null),deviceId:c,isActive:f});var w=le().storedVideoOptions;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__camera"},{children:f?(0,o.jsx)("video",(0,i.__assign)({ref:O},{controls:!1,crossOrigin:"anonymous",playsInline:!0},{className:(0,s.classNames)({CallSettings__cameraStream:w[d.EVideoOptionType.IS_VIDEO_MIRRORED]},"CallSettings__cameraContent")}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallSettings__cameraStub","CallSettings__cameraContent")},{children:x("calls_no_camera")}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:x("calls_settings_camera")}),void 0),f?(0,o.jsx)(No.default,{options:n.map(Oo),value:c,onChange:function(e){var n=e.selected;return g(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(va.default,(0,i.__assign)({className:"CallSettings__field"},{children:x("calls_settings_no_camera")}),void 0)]}),void 0),f&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:x("calls_settings_video_resolution")}),void 0),(0,o.jsx)(No.default,{options:r,value:v,onChange:function(e){var n=e.selected;return I(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:x("calls_settings_mic")}),void 0),A?(0,o.jsx)(No.default,{options:t.map(Oo),value:u,onChange:function(e){var n=e.selected;return m(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(va.default,(0,i.__assign)({className:"CallSettings__field"},{children:x("calls_settings_no_mic")}),void 0)]}),void 0),b&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",{className:"CallSettings__label"},void 0),(0,o.jsx)(yo.default,(0,i.__assign)({className:"CallSettings__field",onChange:N,checked:T},{children:x("calls_settings_push_to_talk_mode_description")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:x("calls_settings_push_to_talk_mode_hint"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(xo.default,{className:"CallSettings__hint","aria-label":x("calls_settings_push_to_talk_mode_hint")},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:x("calls_settings_noise")}},void 0)}),void 0),A?(0,o.jsx)(No.default,{options:a,value:_,onChange:function(e){var n=e.selected;return S(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(va.default,(0,i.__assign)({className:"CallSettings__field"},{children:x("calls_settings_no_mic")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:x("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(xo.default,{className:"CallSettings__hint","aria-label":x("calls_settings_noise_description")},void 0)}),void 0)]}),void 0)]}),void 0)}function Oo(e){return{value:e.deviceId,label:e.label}}function wo(e,n){return(0,i.__awaiter)(this,void 0,Promise,(function(){var t,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia((a={video:!1,audio:!1},a[e]=n,a))];case 1:return[2,i.sent()];case 2:if(t=i.sent(),(0,J.debugMessage)(J.DebugMessageType.ERROR,{src:"[CallSettings][useDeviceOutput][getUserMedia]",err:t,kind:e,kindParams:n}),"OverconstrainedError"===(null==t?void 0:t.name)&&"video"===e&&Object.keys(n).length>1&&"deviceId"in n)return[2,wo(e,{deviceId:n.deviceId})];throw t;case 3:return[2]}}))}))}function Mo(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({onClose:n,title:r("calls_settings"),appearance:"blue",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:t},{children:r("calls_save")}),void 0)]},void 0),className:"CallSettingsModal"},{children:a}),void 0)}function Po(e){var n,t,a=e.SDK,r=(0,ue.useLang)().getLang,c=P((function(e){return e})),_=u(),v=c.config.fullHD,p=c.mode,f=!!(null===(n=c.localDevice.mediaSettings)||void 0===n?void 0:n.isVideoEnabled),h=!!(null===(t=c.localDevice.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),A=xt.isMediaAllowed("audio",c.localDevice),g=(0,l.useMemo)((function(){return[{label:r("calls_noise_neural"),value:d.NoiseCancellationTypes.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:r("calls_noise_simple"),value:d.NoiseCancellationTypes.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:r("calls_noise_none"),value:d.NoiseCancellationTypes.NONE,data:{denoise:!1,denoiseAnn:!1}}]}),[r]),m=(0,l.useMemo)((function(){var e=[{label:r("calls_video_resolution_sd"),value:d.VideoResolutionTypes.SD},{label:r("calls_video_resolution_hd"),value:d.VideoResolutionTypes.HD}];return v&&e.push({label:r("calls_video_resolution_fhd"),value:d.VideoResolutionTypes.FHD}),e}),[r,v]),C=a.browser.getCameras(),E=a.browser.getMicrophones(),S=a.browser.hasCamera()&&a.browser.hasCameraPermission(),I=a.browser.hasMicrophone()&&a.browser.hasMicrophonePermission(),T=a.browser.getSavedCamera(),N=a.browser.getSavedMicrophone(),x=S&&(T&&T.deviceId||C[0].deviceId),y=I&&(N&&N.deviceId||E[0].deviceId),b=(0,i.__read)((0,l.useState)(!1===x?void 0:x),2),O=b[0],w=b[1],M=(0,i.__read)((0,l.useState)(!1===y?void 0:y),2),k=M[0],L=M[1],D=(0,i.__read)((0,l.useState)(c.noiseCancellation),2),j=D[0],R=D[1],B=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY),U=(0,i.__read)((0,l.useState)(B===d.VideoResolutionTypes.FHD?d.VideoResolutionTypes.FHD:B===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD),2),H=U[0],G=U[1],V=(0,i.__read)((0,l.useState)(c.pushToTalkEnabled),2),F=V[0],W=V[1];return(0,o.jsx)(Mo,(0,i.__assign)({onClose:function(){_({type:d.E_ACTION.TOGGLE_POPUP})},onSubmit:function(){var e,n=[Promise.resolve()];!T&&x===O&&p!==d.Mode.READY&&!f||!O||T&&T.deviceId===O||(f?n.push(a.changeDevice("videoinput",O)):n.push(a.browser.saveDeviceId("videoinput",O))),!k||N&&N.deviceId===k||(h?n.push(a.changeDevice("audioinput",k)):n.push(a.browser.saveDeviceId("audioinput",k))),c.noiseCancellation!==j&&n.push(a.setMediaModifiers((null===(e=g.find((function(e){return e.value===j})))||void 0===e?void 0:e.data)||{denoise:!0,denoiseAnn:!0}).then((function(){_({type:d.E_ACTION.SET_NOISE_CANCELLATION,data:j})})));var t=function(){return Promise.resolve()};c.localVideoResolution!==H&&(console.debug("set resolution from -> to: ",c.localVideoResolution,H,d.VideoWidth[H],d.VideoHeight[H]),t=function(){return a.setLocalResolution(d.VideoWidth[H],d.VideoHeight[H],{effect:{width:d.VideoWidth[H],height:d.VideoHeight[H]}}).catch((function(e){console.error(e)})).finally((function(){s.localStorage.setItem(d.VIDEO_RESOLUTION_STORAGE_KEY,H),_({type:d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION,data:H})}))}),c.pushToTalkEnabled!==F&&(A&&Qi(F,c.localDevice.mediaSettings),_({type:d.E_ACTION.SET_PUSH_TO_TALK_ENABLE,data:F})),Promise.all(n).then(t).then((function(){_({type:d.E_ACTION.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),_({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:(0,o.jsx)(bo,{mics:E,cameras:C,noiseCancellationOptions:g,videoResolutionOptions:m,currentCamId:O,currentMicId:k,currentNoiseCancellation:j,currentVideoResolution:H,isCamAvailable:S,isMicAvailable:I,onCameraChange:w,onMicChange:L,onNoiseCancellationChange:function(e){return R(e)},onVideoResolutionChange:function(e){return G(e)},pushToTalkEnabled:F,onPushToTalkChange:function(){W(!F)}},void 0)}),void 0)}var ko=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e){switch(this.props.mode){case d.Mode.CALL:this.props.SDK.hangup();break;case d.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)},n.prototype.render=function(){return this.state.hasError?null:this.props.children},n}(l.Component),Lo=function(e){var n=e.children;return(0,o.jsx)("h2",(0,i.__assign)({className:"JoinHeader"},{children:n}),void 0)},Do=t(11541),jo=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"},void 0)}),void 0)};const Ro=(0,X.makeIcon)("Icon28LaptopOutline","laptop_outline_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="laptop_outline_28"><path clip-rule="evenodd" d="M8 5h-.151c-.781 0-1.4-.001-1.93.171A3.5 3.5 0 0 0 3.67 7.418C3.5 7.95 3.5 8.568 3.5 9.348V19H2.162a1.162 1.162 0 0 0-.367 2.265l1.466.489c.276.092.415.138.556.17.125.029.253.05.38.062.145.014.29.014.582.014H23.22c.291 0 .437 0 .581-.014.128-.012.256-.033.381-.062.141-.032.28-.078.556-.17l1.466-.49A1.162 1.162 0 0 0 25.838 19H24.5V9.349c0-.781.001-1.4-.171-1.93a3.5 3.5 0 0 0-2.247-2.248C21.55 5 20.932 5 20.152 5H20zM6.536 7.073C6.724 7.013 6.992 7 8 7h12c1.008 0 1.276.012 1.464.073a1.5 1.5 0 0 1 .963.963c.06.188.073.456.073 1.464V19h-17V9.5c0-1.008.012-1.276.073-1.464a1.5 1.5 0 0 1 .963-.963z" fill="currentColor" fill-rule="evenodd" /></symbol>',28,28,!1,void 0),Bo=(0,X.makeIcon)("Icon28UserOutline","user_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="user_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M17.5 8.5C17.5 6.566 15.934 5 14 5a3.499 3.499 0 0 0-3.5 3.5c0 1.934 1.566 3.5 3.5 3.5s3.5-1.566 3.5-3.5Zm2 0c0 3.039-2.461 5.5-5.5 5.5a5.499 5.499 0 0 1-5.5-5.5C8.5 5.461 10.961 3 14 3s5.5 2.461 5.5 5.5ZM7 20.643c0 .943-.08.857.456.857h13.588c.536 0 .456.086.456-.857 0-2.288-3.304-3.643-7.25-3.643S7 18.355 7 20.643Zm-2 0C5 16.763 9.299 15 14.25 15s9.25 1.763 9.25 5.643c0 2.016-.781 2.857-2.456 2.857H7.456C5.78 23.5 5 22.66 5 20.643Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0);var Uo=function(e){var n=e.isAnonym,t=e.title,a=e.label,r=e.items,l=e.onChangeName,c=e.name,d=e.namePlaceholder,u=e.joinWithVideoText,_=e.joinWithAudioText,v=e.onJoinWithVideo,p=e.onJoinWithAudio,f=e.disabled,h=e.inputDisabled,A=e.callByNameShow,g=e.onCallByNameClick,m=e.onCallViaNativeAppClick,C=e.callViaNativeAppShow,E=e.callByNameTitle,S=e.callViaNativeAppTitle;return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("JoinScreen",{"JoinScreen--anonym":n})},{children:[(0,o.jsx)(Lo,{children:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"JoinScreen__members"},{children:[(0,o.jsx)(Do.AvatarsStack,{items:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"JoinScreen__membersLabel"},{children:a}),void 0)]}),void 0),(0,o.jsxs)("footer",(0,i.__assign)({className:"JoinScreen__footer"},{children:[n&&(0,o.jsx)(ua.default,{onChange:l,className:"JoinScreen__input",value:c,placeholder:d,disabled:h,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&v()}},void 0),(0,o.jsxs)(Ea.default,(0,i.__assign)({appearance:"primary",onClick:v,disabled:f,type:"submit"},{children:[(0,o.jsx)(jo,{className:"JoinScreen__icon"},void 0),(0,o.jsx)("span",{children:u},void 0)]}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"primary",title:_,"aria-label":_,onClick:p,disabled:f},{children:(0,o.jsx)(ti,{className:"JoinScreen__icon"},void 0)}),void 0)]}),void 0),(A||C)&&(0,o.jsxs)(oa.default,(0,i.__assign)({border:!1,className:"JoinScreen__options"},{children:[C&&(0,o.jsx)(ra.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:m,icon:(0,o.jsx)(Ro,{className:"JoinScreen__optionIcon"},void 0)},{children:S}),void 0),A&&(0,o.jsx)(ra.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:g,icon:(0,o.jsx)(Bo,{className:"JoinScreen__optionIcon"},void 0)},{children:E}),void 0)]}),void 0)]}),void 0)},Ho=t(73479),Go=t(71154);function Vo(e){var n=e.onVolumeLevelReached,t=e.needCheckMicEnabled,a=e.vectorLength,o=e.volumeLevelDetection,r=e.callbackFactorStep,s=e.sensitivityCoefficient,l=e.onVolumeLevelUpdated,c=e.debugCallback,d=function(e){var n=[],t=0;return function(a){if(n.push(a),t+=a,n.length>e){var i=n.shift();t-=i||0}return t/n.length}}(a),u=0,_=!1;return function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];c&&c(e);var v=(0,i.__read)(e,2),p=v[0],f=v[1],h=p>o;_!==h&&l&&l(h),_=h,0!==u&&f&&(u=0);var A=d(p);t&&f||p/A>(1+u)/s&&p>o&&(u+=r,n())}}function Fo(e,n){var t=Object.keys(e),a=Object.keys(n);return t.length===a.length&&t.every((function(e){return n[e]}))}function Wo(e,n){return e.length===n.length&&e.every((function(e,t){return e===n[t]}))}var Zo="calls_token";function zo(e){s.localStorage.setItem(Zo,e)}function Ko(e){var n=s.localStorage.getItem(Zo);return n?Promise.resolve(n):(0,nn.getCallAuthToken)(e).then((function(e){return e.token}))}var Qo={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function Yo(e){switch(e){case J.ParticipantStatus.WAITING:return 1;case J.ParticipantStatus.CONNECTING:return 2;case J.ParticipantStatus.CONNECTED:return 3;default:return 0}}var Jo,Xo=function(){return Qo},qo=function(e){var n,t;Qo=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},Qo),e),{connectionStep:(n=e.connectionStep,t=Qo.connectionStep,n&&Yo(n)&&Yo(n)>Yo(t)?n:t)})},$o=function(){Qo={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}};function er(e){Jo=e}function nr(e,n,t,a){var i,o,r,s=Xo(),l=s.startType,c=s.entryPoint,u=s.timeStart,_=s.isGroupCall,v=s.hadVideoEnabled,p=s.isOutgoingCall,f=!e||e===d.HANGUP_TYPE_HUNGUP&&!t,h=l&&function(e,n,t){var a;a=e===d.CallType.VIDEO?n?d.CallStatReachedType.GROUP_VIDEO:d.CallStatReachedType.VIDEO:t?n?d.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:d.CallStatReachedType.AUDIO_TO_VIDEO:n?d.CallStatReachedType.GROUP_AUDIO:d.CallStatReachedType.AUDIO;return a}(l,_,v),A={type:h,result:f?d.CallStatResult.SUCCESS:d.CallStatResult.FAIL,failReason:f?null:tr(e,t),callSource:c,totalDuration:u?Date.now()-u:0};p&&(a&&console.log(A),i=n,r=[(o=A).type||"",o.result,o.failReason||"",o.callSource||"",o.totalDuration],Jo&&Jo({name:"call_stats",value:i,keys:r}))}function tr(e,n){var t=Xo().isOutgoingCall,a=Xo().connectionStep;switch(!0){case n:return d.CallStatFailReason.CONNECTION_LOST;case e===d.HANGUP_TYPE_CANCELED:return d.CallStatFailReason.LOCAL_DECLINE;case e===d.HANGUP_TYPE_REJECTED:return d.CallStatFailReason.REMOTE_DECLINE;case e===d.HANGUP_TYPE_BUSY:return d.CallStatFailReason.REMOTE_BUSY;case e===d.HANGUP_TYPE_MISSED:return t?d.CallStatFailReason.REMOTE_TIMEOUT:null;case a===J.ParticipantStatus.CONNECTING:return d.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!a:return d.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}function ar(e,n,t){void 0===n&&(n=!0);var a="";return e&&n?a=t("calls_error_no_cam_and_mic"):e?a=t("calls_error_no_cam"):n&&(a=t("calls_error_no_mic")),a}function ir(e,n){var t;return((t={})[d.MediaError.CAMERA_PERMISSION]=n("calls_error_no_cam"),t[d.MediaError.MIC_PERMISSION]=n("calls_error_no_mic"),t[d.MediaError.CAMERA_ACCESS]=n("calls_error_cameralock"),t[d.MediaError.MIC_ACCESS]=n("calls_error_miclock"),t[d.MediaError.MIC_NOT_FOUND]=n("calls_error_nomic"),t[d.MediaError.SCREEN_PERMISSION]=n("calls_error_screenpermission"),t[d.MediaError.SCREEN_ACCESS]=n("calls_error_screenlock"),t)[e]}function or(e,n){return function(t){e&&e({msg:t}),(null==n?void 0:n.onError)&&n.onError(new Error(t)),console.error(t)}}var rr=t(62090);function sr(e,n,t,a,o,r){var l,c,u,_,v,p,f,h,A,g=a.dispatch,m=a.getState(),C=m.me,E=(0,Ve.compose)(_r,Ve.startCallRetryWrapper.bind(null,cr.bind(null,n,e,a))),S=(0,Ve.compose)(n.joinCallByLink,Ve.startCallRetryWrapper.bind(null,cr.bind(null,n,e,a))),I=m.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoHeight.SD:d.VideoHeight.HD,T=m.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoWidth.SD:d.VideoWidth.HD,N=function(){switch(!0){case m.config.enableDomainBender:return"bender";case r:return"vk_corp";default:return}}(),x=function(){if(m.config.enableCustomScreenSharePacketSize&&(0,s.isNumber)(m.config.customScreenSharePacketSize))return m.config.customScreenSharePacketSize}(),y={apiKey:t.key,apiEnv:t.is_dev?"VIDEOTEST":"PROD",anonymToken:t.is_anonym?t.token:"",filteredMessages:!0,batchParticipantsOnStart:!0,serverAudioRed:m.config.enableServerAudioRed,p2pAudioRed:m.config.enableP2PAudioRed,useParticipantListChunk:Mn(m),participantListChunkInitCount:(A=window.innerHeight,wn(Math.max(Math.ceil(A/140),8))),voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},domain:N,videoTracksCount:m.config.enableVideoSlots?m.config.videoSlotsCount:void 0,videoMaxHeight:I,videoMaxWidth:T,videoEffectMaxHeight:I,videoEffectMaxWidth:T,debugLog:m.config.debugLog,consumerScreenTrack:m.config.enableScreenTrack,producerScreenTrack:m.config.enableProducerScreenTrack,callStatReportEnabled:!0,joinFromMultipleDevices:m.config.enableMultipleDevices,h264spsPpsIdrInKeyframe:!!m.config.enableSpsPpsIdrInKeyframe,consumerScreenDataChannelPacketSize:x,onLocalStream:function(n,t){e.debug&&console.warn("onLocalStream",n,t),g({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{stream:n,mediaSettings:t}}),qo({hadVideoEnabled:t.isVideoEnabled})},onLocalStreamUpdate:function(n,t){e.debug&&console.warn("onLocalStreamUpdate",n,t);var i=a.getState(),o=i.localDevice.mediaSettings;xt.decreasePermissionsOnce(i,g,n),n.isScreenSharingEnabled!==(null==o?void 0:o.isScreenSharingEnabled)&&i.externalId&&((0,k.toggleScreenSharing)(i,g,n.isScreenSharingEnabled,i.externalId),n.isScreenSharingEnabled?e.eventHandlers.onScreenSharingEnabled&&e.eventHandlers.onScreenSharingEnabled():e.eventHandlers.onScreenSharingDisabled&&e.eventHandlers.onScreenSharingDisabled()),qo({hadVideoEnabled:n.isVideoEnabled})},onRemoteStream:function(n,t){e.debug&&console.warn("onRemoteStream",n.id,t),Mn(m)?function(e,n,t){rt(e,n,t.externalId,{stream:t.stream})}(a.getState(),g,{externalId:n,stream:t}):$e(g,n,{stream:t})},onScreenStream:function(n,t){e.debug&&console.warn("onScreenStream",n,t);var i=a.getState();xt.decreasePermissionsOnce(i,g,t),g({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{screenSharingStream:n,mediaSettings:t}})},onRemoteScreenStream:function(n,t){e.debug&&console.warn("onRemoteScreenStream",n.id,t),Mn(m)?function(e,n,t){rt(e,n,t.externalId,{screenSharingStream:t.stream})}(a.getState(),g,{externalId:n,stream:t}):$e(g,n,{screenSharingStream:t})},onConversation:function(t,i,o,r){if(e.debug&&((0,J.debugMessage)(J.DebugMessageType.LOG,{type:"start call info",os:yi.Platform.OS,arch:yi.Platform.ARCH,isMobile:yi.Platform.isMobile,browser:(0,yi.getBrowserInfo)(),config:a.getState().config,cameras:n.browser.getCameras(),microphones:n.browser.getMicrophones(),hasMicrophonePermission:n.browser.hasMicrophonePermission(),hasCameraPermission:n.browser.hasCameraPermission(),screenHeight:window.screen.availHeight,screenWidth:window.screen.availWidth,windowHeight:window.screen.height,windowWidth:window.screen.width}),console.warn("onConversation",t,i,r)),!a.getState().callData.ts){var s=Date.now();g({type:d.E_ACTION.TIME_START,data:s})}var l=a.getState().peer;0!==l&&un(0,g,l),en(m,g,r)},onConversationParticipantListChunk:function(n){!function(e,n,t,a){var i=[];a.participants.forEach((function(e){i.push(e.uid);var t=e.participantState;if(t){var a=(0,k.convertParticipantStateFromSDK)(t);Kn(n,e.uid,a)}})),qn(e,n,t,i),Fn(e,n,a)}(m,g,e,n)},onParticipantJoined:function(t,i){!function(e,n,t,a,i){var o=i.externalId,r=i.markers;if(Mn(e)){var s=Wn(r),l=e.participantsChunk;if(l&&s){var c=lt(e),d=l.ids||[],u=mt(s,e),_=0===c&&0===l.countBefore;if(!(u<0)){if(0===u&&!_)return ot(n,{countBefore:l.countBefore+1}),void gt(e,n,t);var v=ft(l,e);u>=d.length&&v?ot(n,{countAfter:l.countAfter+1}):pt(e,n,a,{externalId:o,markers:r})}}}}(a.getState(),g,n,e,{externalId:t,markers:i})},onRemoteMediaSettings:function(t,i,o){var r,s=(0,k.externalIdToString)(t),l=a.getState(),c=l.devices[s],d=null==c?void 0:c.mediaSettings;if((null==d?void 0:d.isVideoEnabled)!==i.isVideoEnabled||(null==d?void 0:d.isAudioEnabled)!==i.isAudioEnabled||(null==d?void 0:d.isScreenSharingEnabled)!==i.isScreenSharingEnabled){e.debug&&console.warn("onRemoteMediaSettings",t,i);var u=!!(null===(r=null==c?void 0:c.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled),_=i.isScreenSharingEnabled;_!==u&&(0,k.toggleScreenSharing)(l,g,_,t,!0);var v=xt.getDecreasedPermissionsOnce(d,i,null==c?void 0:c.permissionsOnce);Mn(l)?Ln(l,g,n,e,{externalId:t,markers:o,mediaSettings:i,permissionsOnce:v}):$e(g,t,{mediaSettings:i,permissionsOnce:v}),qo({hadVideoEnabled:i.isVideoEnabled})}},onRemoteStatus:function(n,t,o){var r,s,l=a.getState();e.debug&&console.warn("onRemoteStatus",n,t,o);var c=[];try{for(var u=(0,i.__values)(n),_=u.next();!_.done;_=u.next()){var v=_.value,p=+v.id,f=l.participants[p];f&&f.shortName||c.push(p);var h={status:t};o&&(h.statusData=o),$e(g,v,h)}}catch(e){r={error:e}}finally{try{_&&!_.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}if(e&&c.length>0){var A=l.callData.callId||"",m={withConversation:!l.callData.conversation,awaitImages:!1};pn(l,g,e,A,c,m)}qo({connectionStep:t});var C=+(null==n?void 0:n[0].id);if(C===l.peer){var E=(0,k.getPeerIdDeviceInfo)(C,Ye.GlobalStore.getCallsState().devices),S=function(e,n){var t={call_event_type:e,session_id:l.callData.callId,peer_id:l.peer,is_group_call:!1};n&&(t.reason=n),w.callStats.logEvent(t)};if(t===J.ParticipantStatus.CONNECTED){if(S(d.CallActionEventType.CALL_CONNECTED),rr.mailRuCounter.push(rr.EMailRuGoals.JoinCall),!(null==E?void 0:E.wasConnected)&&(0,k.isCreator)(l.localDevice)){var I=Xo().startType;S(d.CallActionEventType.OUTGOING_CALL_ACCEPTED_REMOTELY,null==I?void 0:I.toString())}}else t===J.ParticipantStatus.WAITING&&S(d.CallActionEventType.OUTGOING_CALL_REMOTE_RINGING)}},onPermissionsError:function(t){if(e.debug&&console.warn("onPermissionsError",t),a.getState().mode===d.Mode.CALL){switch(t){case d.MediaError.CAMERA_PERMISSION:case d.MediaError.CAMERA_ACCESS:n.toggleLocalVideo(!1);break;case d.MediaError.MIC_ACCESS:case d.MediaError.MIC_NOT_FOUND:n.toggleLocalAudio(!1);break;case d.MediaError.SCREEN_PERMISSION:case d.MediaError.SCREEN_ACCESS:n.captureScreen(!1)}g({type:d.E_ACTION.ERROR,text:ir(t,o)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t,i){e.debug&&console.warn("onRemoteRemoved",t);var o=a.getState();Mn(o)&&Pn(o,g,n,{externalId:t,markers:i}),g({type:d.E_ACTION.REMOVE_USER,participantId:t})},onCallState:function(n,t,i){var o,r,s;e.debug&&console.warn("onCallState",n,t,i);var l=i.id,c=i.direction,u=i.joinLink,_=i.externalId,v=i.options;if(!l||!a.getState().callData.callId){g({type:d.E_ACTION.CALL_STATE,callData:{callId:l},joinLink:u,externalId:_}),g({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:v});var p=a.getState(),f=p.peer,h=p.participants,A=p.entryPoint;if(!f){var C=[];(0,Ve.objectForEach)(h,(function(e){C.push(e.peerId)})),C.length&&pn(m,g,e,l,C,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!1})}var E=a.getState().peer||0;(0,O.isGroupCallByPeer)(E)&&[J.CallDirection.JOINING,J.CallDirection.OUTGOING].includes(c)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:l,peer_id:E,is_group_call:!0,source:A}),rr.mailRuCounter.push(rr.EMailRuGoals.JoinCall)),(null===(o=a.getState())||void 0===o?void 0:o.startOptions)&&(null===(s=null===(r=a.getState())||void 0===r?void 0:r.startOptions)||void 0===s?void 0:s.createLink)&&gn(g,l,a.getState().groupId)}},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(n){e.debug&&console.warn("onSpeakerChanged",n),g({type:d.E_ACTION.SET_ORATOR,orator:n})},onJoinStatus:function(n,t){e.debug&&console.warn("onJoinStatus",n,t)},onHangup:function(t,i){var o,r=t.hangup;e.debug&&console.warn("onHangup",r,i);var s=r&&![d.HANGUP_TYPE_CANCELED,d.HANGUP_TYPE_MISSED,d.HANGUP_TYPE_HUNGUP].includes(r),l=a.getState(),c=r&&r===d.HANGUP_TYPE_HUNGUP,u=(0,O.isGroupCallByPeer)(l.peer);if(l.mode===d.Mode.CALL&&s||l.localDevice.status===J.ParticipantStatus.WAITING_HALL&&r===d.HANGUP_TYPE_REMOVED){var _=d.CALL_HANGUP_MODAP_MAP[r],v=!!(null===(o=l.lastCallData)||void 0===o?void 0:o.isMeEndedCallForAll)&&(r===J.HangupType.KILLED||r===J.HangupType.KILLED_WITHOUT_DELETE);g({type:d.E_ACTION.HANGUP,data:r}),(0,Ve.conditionalPausedPromise)(v||d.HANGUP_DELAY).finally((function(){g({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),_&&g({type:d.E_ACTION.TOGGLE_POPUP,data:_})}))}else if(m.config.showFeedbackScreen&&c){var p=l.callData.ts,f=(p?Math.floor((Date.now()-p)/1e3):0)>10&&0===Math.floor(3*Math.random()),h=0===Math.floor(5*Math.random());u&&f||h?(g({type:d.E_ACTION.MANAGEMENT,isOpen:!1}),g({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.FEEDBACK})):l.mode!==d.Mode.ERROR&&g({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}else l.mode!==d.Mode.ERROR&&g({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY});e.isInActiveCall=!1;var A=(0,Ve.isInReconnect)(l);if(nr(r,i=i||"",A,e.debug),!A&&!u){var C="none";r===J.HangupType.MISSED?C="timeout":r===J.HangupType.BUSY&&(C="busy");var E=l.callData.conversation,S={call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_REMOTELY,session_id:i,peer_id:(null==E?void 0:E.peerId)||0,is_group_call:!1,reason:C};w.callStats.logEvent(S)}e.authorizedGroupId&&function(e,n,t,a){ur(e,n,t,0,a)}(n,e,a,g),$o(),vi(l)},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),(0,O.isGroupCallByPeer)(a.getState().peer)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:a.getState().callData.callId,peer_id:a.getState().peer,is_group_call:(0,O.isGroupCallByPeer)(a.getState().peer)}),rr.mailRuCounter.push(rr.EMailRuGoals.JoinCall))},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(cr(n,e,a),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(n){e.debug&&console.warn("onFingerprintChange",n)},onVolumesDetected:(l={onUpdate:function(e){g({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:e.speakers,speakersInHeader:e.speakersInHeader}})},volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,debugCallback:function(){e.debug}},c=l.onUpdate,u=l.volumeLevelDetection,_=l.debugCallback,v={},p=[],f={},h=[],function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];_&&_(e);var t=(0,i.__read)(e,1),a=t[0];f=Object.keys(f).reduce((function(e,n){return f[n]-1>0&&(e[n]=f[n]-1),e}),{});var o=a.reduce((function(e,n){var t=n.uid,a=n.volume,i=(0,k.externalIdToString)(t);return a>u&&(e[i]=!0,f[i]=3),e}),{});h=Object.keys(f);var r=!1,s={speakers:v,speakersInHeader:p};Fo(v,o)||(s.speakers=o,v=o,r=!0),Wo(p,h)||(s.speakersInHeader=h,p=h,r=!0),r&&c(s)}),onLocalVolume:Vo({onVolumeLevelReached:function(){var e=a.getState();g({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.SPEAKING_ON_MUTE}}),w.callStats.logEvent({call_event_type:d.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,O.isGroupCallByPeer)(e.peer)})},onVolumeLevelUpdated:function(e){var n,t=null===(n=a.getState().localDevice.mediaSettings)||void 0===n?void 0:n.isAudioEnabled,o=a.getState().speakers,r=(0,i.__assign)({},o),s=a.getState().externalId,l=s?(0,k.externalIdToString)(s):C;e&&t&&s?r[l]=!0:!e&&s&&delete r[l],r[l]!==o[l]&&g({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:r}})},needCheckMicEnabled:!0,volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(n,t,a){e.debug&&console.warn("onChatMessage",n,t,a)},onCustomData:function(n,t){e.debug&&console.warn("onCustomData",n,t)},onNetworkStatusChanged:function(n){var t,a;if(e.debug&&console.warn("onNetworkStatusChanged",n),(0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetwork||!(0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetworkP2P)try{for(var o=(0,i.__values)(n),r=o.next();!r.done;r=o.next()){var s=r.value;$e(g,s.uid,{networkStatus:s.rating})}}catch(e){t={error:e}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(t)throw t.error}}},onLocalNetworkStatusChanged:function(n){e.debug&&console.warn("onLocalNetworkStatusChanged",n),((0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetwork||!(0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetworkP2P)&&g({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{networkStatus:n}})},onDebugMessage:function(n){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];e.debug&&console.warn.apply(console,(0,i.__spreadArray)(["onDebugMessage",n],(0,i.__read)(t),!1))},onRemoteParticipantState:function(t,i,o){var r,s,l,c,u,_,v,p;i=(0,k.convertParticipantStateFromSDK)(i);var f=(0,k.externalIdToString)(t),h=+t.id,A=a.getState(),m=!!(null!==(c=null===(l=null===(s=null===(r=A.devices[f])||void 0===r?void 0:r.statusData)||void 0===s?void 0:s.hand)||void 0===l?void 0:l.state)&&void 0!==c?c:null===(u=A.handState)||void 0===u?void 0:u[f]);if(m!==!!(null===(_=null==i?void 0:i.hand)||void 0===_?void 0:_.state)){e.debug&&console.warn("onRemoteParticipantState",t,i);var C=!!(null===(v=a.getState().participants[+t.id])||void 0===v?void 0:v.name);Mn(A)?function(e,n,t,a,i){var o=i.externalId,r=i.markers,s=i.participantState;Kn(n,o,s);var l=nt(e,r);tt(e.participantsChunk,l)?Bn(e,n,a,o,{markers:r,statusData:s}):Yn(e,n,(0,k.externalIdToString)(o)),zn(e,n,t,a,{externalId:o,markers:r})}(A,g,n,e,{externalId:t,markers:o,participantState:i}):$e(g,t,{statusData:i}),(null===(p=null==i?void 0:i.hand)||void 0===p?void 0:p.state)&&!m&&C&&h!==A.me&&g({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.RAISED_HAND,data:h}})}},onRolesChanged:function(n,t){e.debug&&console.warn("onRolesChanged",n,t);var i=a.getState().participants[n.id];t.includes(J.UserRole.ADMIN)&&i&&i.peerId!==m.me&&g({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE,data:n.id}}),g({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:+n.id,data:t})},onLocalRolesChanged:function(t){if(e.debug&&console.warn("onLocalRolesChanged",t),t.includes(J.UserRole.ADMIN)){g({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.ADMIN_ROLE_GRANTED,ts:Date.now()}});var i=a.getState();i.config.enableParticipantListChunk?Ct(i,g,n):Tt.getParticipantsMuteStates(n)}t.includes(J.UserRole.ADMIN)||t.includes(J.UserRole.CREATOR)?m.config.allowWaitingHall&&(0,O.isWaitingHallEnabled)(a.getState())&&function(e,n){(0,J.getWaitingHall)(null,void 0).then((function(t){return xa(t.totalCount,t.participants,e,n)}))}(a.getState(),g):(Tt.abortGetParticipants(),a.getState().waitingHall&&function(e){e({type:d.E_ACTION.SET_WAITING_HALL,data:void 0})}(g)),g({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{roles:t}})},onDeviceSwitched:function(n,t){e.debug&&console.warn("onDeviceSwitched",n,t)},onMuteStates:function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];e.debug&&console.warn("onMuteStates",xt.mapArgs.apply(null,t));var o=new(xt.bind.apply(xt,(0,i.__spreadArray)([void 0],(0,i.__read)(t),!1)));o.updateCallMuteState(n),o.updatePersonalMuteState(),o.updatePersonalPermissionsOnce(),o.updateExternalMuteState(),o.attractAttentionIfNeeded()},onRecordStarted:function(n,t,a,i,o,r){e.debug&&console.warn("onRecordStarted",n,t,a,i);var s={isOn:!0,videoId:o?+o:void 0,ownerId:r?+r:void 0,host:n,startTime:a,link:r&&o?"https://"+Fi()+D(r,o):void 0,startStreamParams:void 0,isRecord:"RECORD"===i};g({type:d.E_ACTION.SET_TRANSLATION,data:s})},onRecordStopped:function(){e.debug&&console.warn("onRecordStopped"),g({type:d.E_ACTION.SET_TRANSLATION,data:{isOn:!1,hasPermission:!1}}),g({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION,data:!0})},onLocalPin:function(n){var t;e.debug&&console.warn("onLocalPin",{unpin:n});var i=a.getState(),o=i.localDevice;n||g({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.PINNED_BY_ADMIN}}),n||(null===(t=o.mediaSettings)||void 0===t?void 0:t.isAudioEnabled)||g({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_ADMIN_PIN_UNMUTE_REQUEST}),n||i.isOratorMode||g({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),i.externalId&&g({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:n?null:i.externalId})},onPinnedParticipant:function(t,o,r){e.debug&&console.warn("onPinnedParticipant",t,o);var s=a.getState(),l=s.participants[t.id];!o&&l&&((null==l?void 0:l.shortName)||(null==l?void 0:l.name))&&g({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_PINNED_BY_ADMIN,data:t.id}}),s.isOratorMode||g({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),function(e,n,t,a,o){var r=o.externalId,s=o.pin,l=o.markers;(0,i.__awaiter)(this,void 0,void 0,(function(){var o,c,d,u,_,v,p;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return o=Wn(l),Mn(e)&&o?(c=(0,k.externalIdToString)(r),d=Jn(e,c),u=et(e,r),_=u>-1,v=nt(e,l),p=tt(e.participantsChunk,v),zn(e,n,t,a,{externalId:r,markers:l}),p&&$n(n,r,{markers:l}),s&&d?[2]:s&&!d||p&&!_?[4,at(e,n,t,a,{externalId:r,marker:o})]:[3,2]):[2];case 1:return i.sent(),[2];case 2:return!d||p||s||Yn(e,n,c),[2]}}))}))}(s,g,n,e,{externalId:t,pin:!o,markers:r}),g({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:o?null:t})},onOptionsChanged:function(n){e.debug&&console.warn("onOptionsChanged",n),g({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:n})},onLocalStatus:function(n){e.debug&&console.warn("onLocalStatus",n);var t=a.getState(),o=t.callData,r=t.me,s=t.localDevice.status===J.ParticipantStatus.WAITING_HALL&&n===J.ParticipantStatus.WAITING,l=n===J.ParticipantStatus.CONNECTED&&!t.peer;o.callId&&!(0,k.isParticipantAnonym)(r)&&(l||s)&&(0,nn.getConversationsByCall)([o.callId]).then((function(e){var n=e.items,t=(0,i.__read)(n,1)[0].peer.id;return vr(a,t,void 0)})).catch((function(e){var n;if(951===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;throw e})).catch(Go.handlePromiseError),g({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{status:n,wasConnected:!0}})},onChatRoomUpdated:function(n,t,i){e.debug&&console.warn("onChatRoomUpdated",n,t,i),n===J.ChatRoomEventType.ATTENDEE&&xa(t,i,a.getState(),g)},onJoinLinkChanged:function(n){e.debug&&console.warn("onJoinLinkChanged",n);var t=a.getState(),i=t.callData.callId||"",o=(0,O.isAuthedByGroupId)(t)?t.groupId:0;fn(a.dispatch,i,!1,o)}};e.authorized=!1,e.authorizedGroupId=0,e.debugMessage=J.debugMessage,e.call=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v){void 0===u&&(u=0),void 0===v&&(v={});var p=(0,O.getMediaOptions)({video:s,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(lr):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return dr(e)})).then((function(){return ur(n,e,a,u,o)})).then((function(){return Be(n,p)})).then((function(){return vr(a,r,l)})).then((function(t){return Promise.all([on(t),i(e,n,a,p,r)])})).then((function(){return gr(n,v)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),qo({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:c,startType:s?d.CallType.VIDEO:d.CallType.AUDIO}),w.callStats.logEvent({call_event_type:s?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!1,source:c,group_call_users_count:2}),rr.mailRuCounter.push(rr.EMailRuGoals.StartP2PCall),pr(a,r,l)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),hr(a,n,e,(0,O.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startGroupCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v,p){void 0===_&&(_=!0),void 0===v&&(v=null),void 0===p&&(p={});var f=(0,O.getMediaOptions)({video:c,audio:!0}),h=l?l.filter(za.isUserPeer):[];return e.debug&&l&&l.length!==h.length&&console.warn("Some ids cannot get into the call.",l.filter((function(e){return!(0,za.isUserPeer)(e)}))),e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(lr):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return dr(e)})).then((function(){return ur(n,e,a,0,o)})).then((function(){return Be(n,f)})).then((function(){return vr(a,r,s)})).then((function(e){return sn(a.getState(),o,r,e[0])})).then((function(){return i(e,n,a,f,r)})).then((function(){return gr(n,p)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),_&&(h&&h.length?o({type:d.E_ACTION.GROUP_CALL_SETUP,open:!0,peerId:r,preselectedIds:h}):o({type:d.E_ACTION.MANAGEMENT,isOpen:!0})),v&&o({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),pr(a,r,s),qo({timeStart:Date.now(),isOutgoingCall:!0,startType:c?d.CallType.VIDEO:d.CallType.AUDIO,entryPoint:u,isGroupCall:!0}),w.callStats.logEvent({call_event_type:c?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!0,source:u,group_call_users_count:1}),rr.mailRuCounter.push(rr.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),hr(a,n,e,(0,O.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u){void 0===l&&(l=!0),void 0===c&&(c=0),void 0===u&&(u={});var _=(0,O.getMediaOptions)({video:r,audio:!0});if(e.isInActiveCall)return Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(lr);e.isInActiveCall=!0;var v=(0,O.getDefaultConversation)(t);return Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return dr(e)})).then((function(){return ur(n,e,a,c,o)})).then((function(){return Be(n,_)})).then((function(){return Promise.all([i(e,n,a,_),on([v])])})).then((function(){return gr(n,u)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.LOAD_PEERS,conversation:v,members:[],peerId:0}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL}),l&&o({type:d.E_ACTION.MANAGEMENT,isOpen:!0});var e=a.getState().callData.callId;(null==u?void 0:u.createLink)&&(e?gn(o,e,c):o({type:d.E_ACTION.SET_START_OPTIONS,data:u})),qo({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:s,startType:r?d.CallType.VIDEO:d.CallType.AUDIO,isGroupCall:!0}),w.callStats.logEvent({call_event_type:r?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:e,peer_id:0,is_group_call:!0,source:s,group_call_users_count:1}),rr.mailRuCounter.push(rr.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),hr(a,n,e,!0,t,o)}))}}(e,n,o,a,E),e.joinCallByLink=function(e,n,t,a,o){var r=a.dispatch;return function(s,l,c,u,_,v,p){void 0===c&&(c=!1),void 0===_&&(_=0),void 0===v&&(v=void 0);var f=(0,O.getMediaOptions)({video:c,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(lr):(e.isInActiveCall=!0,r({type:d.E_ACTION.SET_ENTRYPOINT,entryPoint:u}),(0,k.isParticipantAnonym)(a.getState().me)?Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return dr(e)})).then((function(){return Be(n,f)})).then((function(){return o(s,f).then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,joinLink:s,vkJoinLink:p})}))})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),hr(a,n,e,!0,t,r)})):Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return dr(e)})).then((function(){return ur(n,e,a,_,r)})).then((function(){return Be(n,f)})).then((function(){return o(s,f)})).then((function(e){var n=e.id;return(0,nn.getConversationsByCall)([n])})).then((function(e){var n=e.items;if(!(null==n?void 0:n.length))return 0;var t=(0,i.__read)(n,1)[0].peer.id;return vr(a,t,l).then((function(e){return on(e)})),t})).catch((function(e){var n,t;if(8===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;if((0,Ve.hasIn)(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.error_code,951,1007))return 0;throw e})).then((function(e){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:e,joinLink:s}),v&&r({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),e&&pr(a,e,l),w.callStats.logEvent({call_event_type:d.CallActionEventType.GROUP_CALL_JOINED,session_id:a.getState().callData.callId,peer_id:null!=e?e:0,is_group_call:!0,source:u,group_call_users_count:(0,k.getActiveParticipantsCount)(a.getState())})})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),hr(a,n,e,!0,t,r)})))}}(e,n,o,a,S),e.showJoinPopup=function(e,n,t){var a=t.dispatch;return function(o,r){var s=t.getState().mode;return s===d.Mode.CALL||s===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){a({type:d.E_ACTION.ERROR,text:n("calls_already_in_call_error")})})):(a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),(0,nn.getJoinLinkDetails)(o).then(Ve.normalizePreviewData.bind(null,n)).then((function(e){a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.JOIN,data:(0,i.__assign)((0,i.__assign)({},e),{entryPoint:r})})})).catch((function(t){var i;e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.warn("getJoinLinkDetails",t);var o=(0,Ve.getTextForApiErrorByCode)(null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.error_code,!0,n);console.error(o),a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.ERROR,text:o,handleType:d.ErrorHandleType.FATAL})})))}}(e,o,a),e.acceptCall=function(e,n,t,a){var i=a.dispatch;return function(o,r){var s=a.getState(),l=s.peer,c=s.callData,u=(0,O.getMediaOptions)({video:o,audio:r});return Be(n,u).then((function(){return n.acceptCall(u)})).then((function(n){var t=n.acceptTime;i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,ts:t}),e.isInActiveCall=!0,w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:c.callId,peer_id:l,is_group_call:(0,O.isGroupCallByPeer)(l),reason:o?d.CallType.VIDEO:d.CallType.AUDIO}),rr.mailRuCounter.push(rr.EMailRuGoals.AcceptCall)})).catch((function(n){i({type:d.E_ACTION.ERROR,text:ar(o,!0,t),handleType:d.ErrorHandleType.DECLINE}),e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),(0,J.debugMessage)(J.DebugMessageType.ERROR,n),console.error(n)}))}}(e,n,o,a),e.showCallByNamePopup=function(e,n,t,a){var i=a.dispatch;return function(e,n,o){var r=a.getState().mode;return r===d.Mode.CALL||r===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){i({type:d.E_ACTION.ERROR,text:t("calls_already_in_call_error")})})):Promise.resolve().then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),i({type:d.E_ACTION.CALL_BY_NAME,data:{peerId:e,joinLink:o,entryPoint:n}})})).catch((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}}(0,0,o,a),e.showCreateCallByLinkPopup=function(e,n,t,a){var i=a.dispatch;return function(e){var n=a.getState().mode;return n===d.Mode.CALL||n===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(lr):Promise.resolve().then((function(){i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CREATE_CALL,entryPoint:e})}))}}(0,0,0,a),e.showPlanCalendarEventPopup=function(e){var n=e.dispatch;return function(){return e.getState().mode===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(lr):Promise.resolve().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_PLAN_CALENDAR_EVENT})}))}}(a),e.store=a;var b=Vi(m.config.browserWarnings);if(null==b?void 0:b.block){var M=function(){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START})};e.call=M,e.startGroupCall=M,e.startCall=M,e.acceptCall=M,e.joinCallByLink=function(e){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,joinLink:e})},e.showJoinPopup=M,e.showCallByNamePopup=M,e.showCreateCallByLinkPopup=M,e.showPlanCalendarEventPopup=M}var P=t.token?Promise.resolve(t.token):Ko(t.is_dev),L=function(t){return Promise.resolve().then((function(){return(0,k.isParticipantAnonym)(a.getState().me)?Promise.resolve():n.authorize(t).then((function(){return zo(t)})).then((function(){return e.authorized=!0})).catch((function(e){throw s.localStorage.removeItem(Zo),e}))}))};return P.then((function(t){return n.init(y).then((function(){m.config.debugLog&&e.setDebug(!0)})).then((function(){return L(t)}))}))}function lr(e){if(e===d.CallErrorType.ALREADY_IN_CALL)console.log("Already in call");else console.log(e)}function cr(e,n,t){return function(e,n,t){return(0,nn.getCallAuthToken)(t.getState().isDev).then((function(t){var a=t.token;return e.authorize(a).then((function(){return zo(a)})).then((function(){return n.authorized=!0}))}))}(e,n,t).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),console.error("Could not authorize with token request",e)}))}function dr(e){return new Promise((function(n){e.initializing.finally((function(){n()}))}))}function ur(e,n,t,a,i,o){return void 0===o&&(o=!1),new Promise((function(r,s){a||n.authorizedGroupId||r(),a&&n.authorizedGroupId===a&&r(),o||(w.callStats.setEventCommonData(),i({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:0,groupMembers:[],unableToCallGroupMembersIds:[]})),(0,nn.getCallAuthToken)(t.getState().isDev,a).then((function(t){var l=t.token;e.authorize(l).then((function(){n.authorizedGroupId=a,o?r():a?(0,nn.getGroupById)(-a).then((function(e){if(e.groups){var n=e.groups[0];i({type:d.E_ACTION.SET_GROUP,groupId:a,meGroup:(0,tn.normalizeGroup)(n)}),w.callStats.setEventCommonData({group_id:a}),r()}})).catch((function(e){s(e)})):r()}))}))}))}function _r(e,n,t,a,i,o){void 0===i&&(i=0),void 0===o&&(o=[]);var r=e.authorizedGroupId?e.id:0,s=(0,Ve.createPayload)(i,a,r);if(!i)return n.callTo(void 0,a,s,!0);if(!(0,O.isGroupCallByPeer)(i))return Ar(e,t,i).then((function(e){return n.forceRelayPolicy(e),n.callTo(i.toString(),a,s)}));var l=o.filter((function(e){return e=Number(e),(0,za.isUserPeer)(e)&&e!==t.getState().me}));return n.callTo(l,a,s,!0)}function vr(e,n,t){var a=e.dispatch;return!!t||n?(t?Promise.resolve((0,Ve.convertClientData)(t)):(0,nn.retryLoadCallPeers)(n).then(Ve.convertServerData)).then((function(e){var t=(0,i.__read)(e,3),o=t[0],r=t[1],s=t[2];return hn(a,s||o),a({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r,peerId:n}),e})):Promise.reject("Cannot load data")}function pr(e,n,t){var a=e.dispatch;return!!t&&n?(0,nn.retryLoadCallPeers)(n).then((function(e){var n=(0,i.__read)((0,Ve.convertServerData)(e),2),t=n[0],o=n[1];return hn(a,e.items[0]),on([t,o])})).then((function(e){var n=(0,i.__read)(e,2),t=n[0],o=n[1];a({type:d.E_ACTION.LOAD_PEERS,conversation:t,members:o})})):Promise.resolve()}function fr(e,n,t){switch(!0){case function(e){var n=e||{},t=n.hangup,a=n.message;return!(!t||!a)}(e):case function(e){var n=e||{},t=n.hangup;return n.message&&void 0===t}(e):return(0,Ve.getTextForServerError)(e.message,n,t);case function(e){var n;return["TypeError","SyntaxError","RangeError","EvalError","URIError"].includes(null===(n=null==e?void 0:e.__proto__)||void 0===n?void 0:n.name)}(e):return t("calls_error");case function(e){return!!e.error_msg}(e):return(0,Ve.getTextForServerError)(e.error_msg,n,t);case function(e){return"number"==typeof e}(e):return(0,Ve.getTextForClientError)(e,n,t);case function(e){return!!e}(e):default:return t("calls_sorry_error")}}function hr(e,n,t,a,i,o){var r,s;try{var l=fr(e,a,i);n.hangup(),t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e),o({type:d.E_ACTION.ERROR,text:l,handleType:d.ErrorHandleType.FATAL}),(null===(r=t.eventHandlers)||void 0===r?void 0:r.onErrorStartCall)&&(null===(s=t.eventHandlers)||void 0===s||s.onErrorStartCall())}catch(t){throw(0,J.debugMessage)(J.DebugMessageType.ERROR,t),console.error(t),n.hangup(),e}}function Ar(e,n,t){var a=n.getState();return a.ipSettingEnabled&&"all"!==a.privacySettings.callsIp?(0,za.isChatPeer)(t)?Promise.resolve(!0):e.isFriend?Promise.resolve(!e.isFriend(t)):Object.keys(a.friendsCache).length>0?Promise.resolve(!a.friendsCache[t]):(0,Ve.exponentialRetry)(rn)(e,a,n.dispatch).then((function(){return Ar(e,n,t)})):Promise.resolve(!1)}function gr(e,n){void 0===n&&(n={}),n&&(n.conversationOptions&&Object.keys(n.conversationOptions).length>0&&e.changeConversationOptions(n.conversationOptions),n.mediaOptions&&Object.keys(n.mediaOptions).length>0&&e.muteParticipant(null,n.mediaOptions))}var mr=function(e){var n=e.isAnonym,t=e.joinLink,a=e.vkJoinLink,r=e.title,s=e.members,c=e.membersCount,u=e.conversationData,_=e.withPopup,v=e.onBeforeCallStart,p=e.onAfterCallFinish,f=e.onClose,h=e.bridge,A=e.entryPoint,g=e.tabIsMaster,m=e.tabIsIdle,C=e.onError,S=e.isDev,T=e.okPublicKey,N=(0,l.useContext)(E.LangContext),x=N.getLang,b=N.langNumeric,O=(0,i.__read)((0,l.useState)(""),2),w=O[0],M=O[1],P=(0,i.__read)((0,l.useState)(null),2),L=P[0],D=P[1],j=(0,i.__read)((0,l.useState)(!1),2),R=j[0],B=j[1],U=!1,H=(0,l.useContext)(y.ConfigContext).allowCallByName,G=s?s.slice(0,3).map((function(e){var n=e.firstName||e.shortName||e.name||"";return e.photo_100?{src:e.photo_100,alt:n,key:e.peerId}:{id:e.peerId,text:n.slice(0,1)}})):[],V=(0,l.useCallback)((function(e){M(e.target.value)}),[]),F=(0,l.useCallback)((function(e){if(n)return U?Promise.resolve():(U=!0,function(e,n,t,a,i,o){if(e)return Promise.resolve(e);return(0,nn.getJoinLinkDetails)(t,!0).then((function(e){var r=e.secret,s=void 0===r?"":r,l=e.user_id,c=void 0===l?0:l,u=e.preview;return(0,nn.getAnonymCallToken)(t,c,a,s).then((function(e){var t,r=e.token,s=e.secret,l=void 0===s?"":s,_={is_dev:Cr(o),key:i,token:r,ok_user:c,secret:l,is_anonym:!0,me:{canAddMembers:!1,firstName:a,peerId:c,id:c,sex:"0",shortName:a,name:a,lastName:"",link:"",photo:"",photo_100:"",shortNameGen:""}},v={callPreview:{tab:null==u?void 0:u.title,photo:null===(t=null==u?void 0:u.photo)||void 0===t?void 0:t.photo_200},callsCredentials:_,callsOkStaging:Cr(o),callsLogging:!1,CallsIncomingCall:!1,callsAllowBanParticipant:!1,callsFeedbackScreenEnabled:!1,callsVideoSlotsEnabled:!0,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:[{browser:"safari"},{browser:"firefox"}],callsAllowCallByName:!1,callsEnableScreenTrack:!0,callsEnableProducerScreenTrack:!0,callsAllowWaitingHall:!1,callsAllowPushToTalk:!1,callsBadNetwork:!1,callsBadNetworkP2P:!1,callsDesktopAppNotification:!1,callsLazyLoading:!1,callsEnableDomainBender:!1,callsEnableMultipleDevices:!1,callsEnableTranslationSplit:!1,callsEnableNavChangeCallCollapse:!0};return n(v),v}))}))}(L,D,a,w,T,S).then((function(e){return function(e){var n=e.bridge,t=e.inited,a=e.setInited,o=e.data,r=e.onBeforeCallStart,s=e.onAfterCallFinish,l=e.tabIsMaster,c=e.tabIsIdle,d=e.langUtils;return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,u,_,v,p,f,h,A,g,m,C,E,S,I,T,N,x,y,b,O,w,M,P,k,L;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return t?[2,Promise.resolve()]:(e=o.callPreview,u=o.callsCredentials,_=o.callsOkStaging,v=o.callsLogging,p=o.CallsIncomingCall,f=o.callsAllowBanParticipant,h=o.callsFeedbackScreenEnabled,A=o.callsVideoSlotsEnabled,g=o.videoSlotsCount,m=o.browserWarnings,C=o.callsAllowCallByName,E=o.callsEnableScreenTrack,S=o.callsEnableProducerScreenTrack,I=o.callsAllowWaitingHall,T=o.callsAllowPushToTalk,N=o.callsBadNetwork,x=o.callsBadNetworkP2P,y=o.callsDesktopAppNotification,b=o.callsLazyLoading,O=o.callsEnableDomainBender,w=o.callsEnableMultipleDevices,M=o.callsEnableTranslationSplit,P=o.callsEnableNavChangeCallCollapse,k=o.callsCustomScreenSharePacketSize,L=o.callsEnableCustomScreenSharePacketSize,[4,n.init({callPreview:e,callsCredentials:u,imHash:"",callsOkStaging:_,onBeforeCallStart:r,onAfterCallFinish:s,tabIsMaster:l,tabIsIdle:c,langUtils:d,toggles:{debugLog:v,incomingCall:p,allowBanParticipant:f,showFeedbackScreen:h,enableVideoSlots:A,videoSlotsCount:g,browserWarnings:m,allowCallByName:C,enableScreenTrack:E,enableProducerScreenTrack:S,allowWaitingHall:I,allowPushToTalk:T,badNetwork:N,badNetworkP2P:x,desktopAppNotification:y,lazyLoading:b,enableDomainBender:O,enableMultipleDevices:w,enableTranslationSplit:M,enableNavChangeCallCollapse:P,enableCustomScreenSharePacketSize:L,customScreenSharePacketSize:k}})]);case 1:return i.sent(),a(!0),[2]}}))}))}({bridge:h,inited:R,setInited:B,data:e,onBeforeCallStart:v,onAfterCallFinish:p,tabIsMaster:g,tabIsIdle:m,langUtils:N})})).then((function(){return h.joinCallByLink(t,null,e,A,void 0,void 0,a)})).catch((function(e){h.eventHandlers.onError&&e&&h.eventHandlers.onError(e);var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Ve.getTextForApiErrorByCode)(e.error.error_code,!0,x):fr(e,!0,x)||x("calls_unknown_error"),C&&C(n)})).finally((function(){U=!1})));if(f&&f(),!u)throw Error("no peer_id to join");return h.joinCallByLink(t,[u,s],e,A,void 0,void 0,a).catch((function(e){var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Ve.getTextForApiErrorByCode)(e.error.error_code,!0,x):x("calls_unknown_error"),C&&C(n)})),Promise.resolve()}),[t,f,w,L,R,T]),W=(0,l.useCallback)((function(){f&&f()}),[f]),Z=(0,l.useMemo)((function(){return(0,Za.escape)((0,Za.decodeHTMLEntities)(r||""))}),[r]),z=(0,l.useCallback)((function(){h.showCallByNamePopup(null,A,t)}),[]),K=(0,l.useCallback)((function(){h.showStartCallModal(null,t)}),[]),Q=(0,o.jsx)(Uo,{isAnonym:!!n,name:w,onChangeName:V,namePlaceholder:x("calls_name_placeholder"),title:Z,label:(0,Ve.getParticipantsListLabel)(s||[],G,(function(e){return(0,k.isParticipantGroup)(e.peerId)?e.name:e.firstName}),x,b,c),items:G,joinWithVideoText:x("calls_join_with_video"),joinWithAudioText:x("calls_join_with_audio"),onJoinWithVideo:function(){return F(!0)},onJoinWithAudio:function(){return F(!1)},disabled:!!n&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(w),inputDisabled:!!L,callByNameShow:H&&!n,callByNameTitle:x("calls_call_by_name_join_by"),callByNameDescription:"",onCallByNameClick:z,callViaNativeAppShow:!n,callViaNativeAppTitle:x("calls_call_via_native_app_join"),onCallViaNativeAppClick:K},void 0);return _?(0,o.jsxs)(I.default,(0,i.__assign)({onClose:W},{children:[(0,o.jsx)(Ho.ModalHeader,{title:x("calls_invite"),onClose:W},void 0),Q]}),void 0):Q},Cr=function(e){return void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv};var Er=function(e){var n=e.children;return(0,o.jsx)("div",(0,i.__assign)({className:"ErrorPopupText"},{children:n}),void 0)},Sr=function(e){var n=e.title,t=e.onClose,a=e.actionButtons,r=e.text;return(0,o.jsx)(aa.default,(0,i.__assign)({appearance:"blue",title:n,onClose:t,actionButtons:a,className:"CallError"},{children:(0,o.jsx)(Er,{children:r},void 0)}),void 0)},Ir=function(e){var n=e.title,t=e.text,a=e.onCloseFatal,r=e.handleType,s=e.callId,c=e.bridge,_=u(),v=(0,l.useContext)(E.LangContext).getLang,p=function(){switch(_({type:d.E_ACTION.ERROR,isClosed:!0}),r){case d.ErrorHandleType.FATAL:a();break;case d.ErrorHandleType.DECLINE:(0,J.declineCall)().catch((function(){}));break;case d.ErrorHandleType.PROCESS:(0,J.processPush)(s||"").then((function(){(0,J.declineCall)().catch((function(){}))})).catch((function(e){c.debug&&console.error("Delayed by error push process error",e)}))}},f=t||v("calls_error"),h=f.match(/<\s?[a-zA-Z0-9]+\s?\/?>/)?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:f}},void 0):f;return(0,o.jsx)(Sr,{title:n||v("calls_oops"),onClose:p,actionButtons:(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:p},{children:v("calls_close")}),void 0),text:h},void 0)},Tr=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.title;return(0,o.jsx)(aa.default,(0,i.__assign)({onClose:n,title:r,appearance:"blue",actionButtons:t,className:"CallExitModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallExitModal__text"},{children:a}),void 0)}),void 0)},Nr=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=t.conversationOptions.find((function(e){return"RECURRING"===e})),_=function(){w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:t.callData.callId,peer_id:t.peer,is_group_call:(0,O.isGroupCallByPeer)(t.peer),reason:"none",group_call_users_count:(0,k.getActiveParticipantsCount)(t)})},v=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP})}),[]),p=r(s?"calls_exit_call_disconnect_all":"calls_force_call_finish_v2"),f=r(s?"calls_exit_call_desc":"calls_sure_leave_call_v2");return(0,o.jsx)(Tr,{onClose:v,actionButtons:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){a({type:d.E_ACTION.TOGGLE_POPUP}),_(),pi(0,t,a,r)},appearance:"secondary"},{children:p}),"forceCallFinish"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return a({type:d.E_ACTION.TOGGLE_POPUP}),_(),n.hangup()}},{children:r("calls_exit")}),"leave")],description:f,title:r("calls_exit_call")},void 0)},xr=function(e,n){var t=(0,i.__read)((0,l.useState)([0,0]),2),a=(0,i.__read)(t[0],2),o=a[0],r=a[1],s=t[1],c=(0,l.useRef)(new Map);(0,l.useEffect)((function(){var e=function(){return s([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]);var u=Mn(n);(0,l.useEffect)((function(){if(n.mode===d.Mode.CALL){var t=u?function(e,n,t,a){var i=Cn(e,n,t);return i.forEach((function(e,n){var t=a.get(n);!e.stopStream||t&&!t.stopStream||i.delete(n)})),a.forEach((function(e,n){if(!i.has(n)&&!e.stopStream){var t=Sn({externalId:e.uid},e.mediaType);i.set(n,t)}})),i}(n,o,r,c.current):Cn(n,o,r),a=function(e,n){var t=[];return n.forEach((function(n,a){var i=e.get(a);(En(i)||En(n))&&(i&&function(e,n){var t=e,a=n;if(!0===t.stopStream&&!0===a.stopStream)return!0;if(!0===t.stopStream||!0===a.stopStream)return!1;var i=e,o=n;return i.fit===o.fit&&i.width===o.width&&i.height===o.height&&i.priority===o.priority}(i,n)||t.push(n))})),t}(c.current,t);a.length>0&&(c.current=t,e.updateDisplayLayout(a))}else c.current=new Map}),[o,r,n.peer,n.participants,n.devices,n.mode,n.uiMode,n.isOratorMode,n.orator,n.pinnedParticipant,n.adminPinnedParticipant,n.screenSharingPinnedParticipant,n.translation,u])};var yr=function(e){var n=e.isIncoming,t=void 0!==n&&n,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=s(t?"calls_reject_title":"calls_hangup_description"),v=s(t?"calls_reject_description":"calls_hangup_description"),p=(0,l.useCallback)((function(){r({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!1})}),[]),f=function(){p(),t?(0,J.declineCall)().catch((function(){})):((0,J.hangup)().catch((function(){})),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:(0,k.getActiveParticipantsCount)(a)}))},h=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"secondary",onClick:p},{children:s("calls_cancel_reject")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:f},{children:s("calls_reject")}),void 0)]},void 0),A=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:f},{children:s("calls_yes")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:p},{children:s("calls_no")}),void 0)]},void 0);return(0,o.jsx)(Sr,{title:_,onClose:p,actionButtons:t?h:A,text:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:v}},void 0)},void 0)},br=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"MuteParticipantModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:t&&(0,o.jsx)("div",(0,i.__assign)({className:"MuteParticipantModal__content"},{children:t}),void 0)}),void 0)};function Or(e){var n,t,a=e.isAudio,i=e.isSingle,o=e.isPermanent,r=e.participantExternalId,s=e.logEvent,l=e.closeDialog,c=function(e){var n=Xe(["isPermanent","isCurrentlyOn","isMediaAllowed"]),t=function(e,n){return(0,Ve.objectReduce)(n,(function(n,t,a){return t?n|e[a]:n}),0)}(n,e);if(Je(t,n.isPermanent))return J.MuteState.MUTE_PERMANENT;if(t===n.isCurrentlyOn)return J.MuteState.UNMUTE;return J.MuteState.MUTE}({isPermanent:o,isCurrentlyOn:e.isCurrentlyOn,isMediaAllowed:e.isMediaAllowed}),d=a?((n={})[J.MediaOption.AUDIO]=c,n):((t={})[J.MediaOption.VIDEO]=c,t[J.MediaOption.SCREEN_SHARING]=c,t);(0,J.muteParticipant)(i?r:null,d).catch(console.log).finally(l),s(o?ui.CallStatMuteType.ONCE:ui.CallStatMuteType.PERMANENT)}var wr=function(){var e,n,t,a,r,s=P((function(e){return e})),c=u(),_=(0,ue.useLang)().getLang,v=null===(n=null===(e=s.participantsManagement)||void 0===e?void 0:e.device)||void 0===n?void 0:n.externalId,p=(0,k.isSameExternalId)(v,s.externalId),f=function(e,n,t){if(!t)return;if(!n)return e.devices[(0,k.externalIdToString)(t)];return e.localDevice}(s,p,v),h=v&&s.participants[v.id],A=null!==(a=null===(t=s.participantsManagement)||void 0===t?void 0:t.mode)&&void 0!==a?a:d.ParticipantsManagementMode.SINGLE,g=p?s.localDevice:h,m=[d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.ALL_AUDIO].includes(A),C=[d.ParticipantsManagementMode.SINGLE,d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.SINGLE_VIDEO].includes(A),E=(0,i.__read)((0,l.useState)(!0),2),S=E[0],I=E[1],T=(0,i.__read)((0,l.useState)(null!==(r=null==h?void 0:h.name)&&void 0!==r?r:""),2),N=T[0],x=T[1],y=function(){var e=!1,n=!1,t=!1,a=_("calls_mute_participant_dialog_action_v2"),i="",o=!1;switch(A){case d.ParticipantsManagementMode.SINGLE_AUDIO:var r=Mr(g);e=!(o=xt.isMediaAllowed("audio",f,!0))||r,t=!!(null==f?void 0:f.mediaSettings.isAudioEnabled),a=_(o?"calls_mute_participant_dialog_action_v2":"calls_mic_turn_on"),i=_(o?"calls_mute_participant_dialog_title_audio":"calls_unmute_participant_dialog_title_audio_v2").replace("{name}",N);break;case d.ParticipantsManagementMode.SINGLE_VIDEO:r=Mr(g);e=!(o=xt.isMediaAllowed("video",f,!0))||r,t=!(!(null==f?void 0:f.mediaSettings.isVideoEnabled)&&!(null==f?void 0:f.mediaSettings.isScreenSharingEnabled)),a=_(o?"calls_mute_participant_dialog_action_v2":"calls_mute_participant_dialog_action_video_ss"),i=_(o?"calls_mute_participant_dialog_title_video":"calls_unmute_participant_dialog_title_video_v2").replace("{name}",N);break;case d.ParticipantsManagementMode.ALL_AUDIO:(n=s.permissions[J.MediaOption.AUDIO]===J.MuteState.MUTE_PERMANENT)&&(a=_("calls_mute_participant_dialog_action_mics")),e=n,i=_(n?"calls_unmute_all_participants_audio_title":"calls_mute_all_participants_dialog_title_audio");break;case d.ParticipantsManagementMode.ALL_VIDEO:(n=s.permissions[J.MediaOption.VIDEO]===J.MuteState.MUTE_PERMANENT)&&(a=_("calls_mute_participant_dialog_action_video_ss")),e=n,i=_(n?"calls_unmute_all_participants_video_title":"calls_mute_all_participants_dialog_title_video")}return{isPermanentHide:e,onMuteTitle:a,title:i,isCurrentlyOn:t,isMediaAllowed:o}}(),b=y.isPermanentHide,M=y.onMuteTitle,L=y.title,D=y.isCurrentlyOn,j=y.isMediaAllowed;(0,l.useEffect)((function(){C&&!(0,k.isParticipantAnonym)((null==h?void 0:h.peerId)||0)?(c({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){h&&h.peerId<0?(0,nn.getGroupById)(-h.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch(n):(0,nn.loadUsers)({user_ids:h&&String(h.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)||"")})).catch(n)})).then((function(e){x(e),I(!1),c({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)):I(!1)}),[s.participantsManagement]);var R=function(e){var n=e.callEventType,t=e.sessionId,a=e.peerId,i=e.isGroupCall;return function(e){return w.callStats.logEvent({call_event_type:n,session_id:t,peer_id:a,is_group_call:i,mute_permanent:e})}}({callEventType:C?d.CallActionEventType.USER_MICS_AND_VIDEO_DISABLED:d.CallActionEventType.ALL_MICS_AND_VIDEO_DISABLED,sessionId:s.callData.callId,peerId:s.peer,isGroupCall:(0,O.isGroupCallByPeer)(s.peer)}),B=(0,l.useCallback)((function(){c({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT})}),[]),U=(0,l.useCallback)((function(e,n){Or({isAudio:m,isSingle:C,isPermanent:e,participantExternalId:n,logEvent:R,closeDialog:B,isCurrentlyOn:D,isMediaAllowed:j})}),[m,C,R,B,D,j]),H=(0,l.useCallback)((function(){U(!0,C&&v?v:null)}),[U,v,C]),G=(0,l.useCallback)((function(){U(!1,C&&v?v:null)}),[U,v,C]);return C&&S?null:(0,o.jsx)(br,{title:L,onClose:B,actionButtons:(0,o.jsxs)(o.Fragment,{children:[!b&&(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:H,appearance:"secondary"},{children:_("calls_mute_participant_permanent_dialog_action")}),"mute_permanent"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:G},{children:M}),"mute")]},void 0)},void 0)};function Mr(e){return(0,k.isCreator)(e)||(0,k.isAdmin)(e)}var Pr,kr=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"UnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},Lr=function(e){var n=e.SDK,t=e.popup,a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=(0,c.useSelector)((function(e){return e})),_=s.localDevice,v=_.mediaSettings,p=(0,Ve.hasIn)(t,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_VIDEO_REQUEST),f=(0,Ve.hasIn)(t,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_AUDIO_REQUEST),h=function(){a({type:d.E_ACTION.TOGGLE_POPUP})},A=function(){var e=_.mediaSettings;(null==e?void 0:e.isAudioEnabled)||(v.isAudioEnabled?Promise.resolve():Be(n,[J.MediaOption.AUDIO])).then((function(){var e;(null===(e=s.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&a({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)}))},g=function(){var e=_.mediaSettings;(null==e?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled)||(!v.isVideoEnabled||v.isScreenSharingEnabled?Be(n,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){n.toggleLocalVideo(!0).catch(console.log)}))},m=function(){A(),h()},C=function(){A(),g(),h()},S=function(){g(),h()},I=(0,l.useMemo)((function(){var e="",n="",t=[];return p&&f?(e=r("calls_dialog_unmute_request_audio_and_video_title"),n=r("calls_dialog_unmute_request_audio_and_video_description"),t.push((0,o.jsx)(Ea.default,(0,i.__assign)({onClick:m,appearance:"secondary"},{children:r("calls_dialog_unmute_request_mic_only_action")}),"mic"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:C},{children:r("calls_dialog_unmute_request_action")}),"all"))):f?(e=r("calls_dialog_unmute_request_audio_title"),n=r("calls_dialog_unmute_request_audio_description"),t.push((0,o.jsx)(Ea.default,(0,i.__assign)({onClick:m},{children:r("calls_dialog_unmute_request_mic_action")}),"mic"))):p&&(e=r("calls_dialog_unmute_request_video_title"),n=r("calls_dialog_unmute_request_video_description"),t.push((0,o.jsx)(Ea.default,(0,i.__assign)({onClick:S},{children:r("calls_dialog_unmute_request_camera_only_action")}),"video"))),{actions:t,title:e,desc:n}}),[p,f,r]);return(0,o.jsx)(kr,{onClose:h,title:I.title,description:I.desc,actionButtons:I.actions},void 0)},Dr=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"AssignAdminModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AssignAdminModal__content"},{children:t}),void 0)}),void 0)},jr=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0})),a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,i.__read)((0,l.useState)(!0),2),_=s[0],v=s[1],p=(0,i.__read)((0,l.useState)(""),2),f=p[0],h=p[1],A=(0,l.useContext)(E.LangContext).getLang;(0,l.useEffect)((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){t&&t.peerId<0?(0,nn.getGroupById)(-t.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch((function(e){return n(e)})):(0,nn.loadUsers)({user_ids:t&&String(t.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)+" "+(null==t?void 0:t.last_name))})).catch((function(e){return n(e)}))})).then((function(e){h(e),v(!1),r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}),[t]);var g=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT})}),[]),m=(0,l.useCallback)((function(){var e=(0,k.getParticipantExternalId)(t);e?(n.grantRoles(e,[J.UserRole.ADMIN],!1).then((function(){t&&r({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:t.peerId,data:t.roles?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.roles),!1),[J.UserRole.ADMIN],!1):[J.UserRole.ADMIN]})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASSIGN_ADMIN,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer)}),g()):g()}),[]);return _?null:(0,o.jsx)(Dr,{onClose:g,title:A("calls_dialog_assign_admin_role_title"),description:A("calls_dialog_assign_admin_role_description").replace("{name}",f),actionButtons:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:g,appearance:"secondary"},{children:A("calls_dialog_assign_admin_role_action_later")}),"cancel"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:m},{children:A("calls_dialog_assign_admin_role_action_primary")}),"primary")]},void 0)},Rr=t(92110),Br="wakeLock"in navigator&&!0,Ur=null,Hr=!1,Gr=function(){null!==Ur&&"visible"===document.visibilityState&&Fr()},Vr=function(){var e,n,t,a;Pr||((Pr=document.createElement("video")).setAttribute("title","Wake lock"),Pr.setAttribute("playsinline",""),e=Pr,n="mp4",t="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=",(a=document.createElement("source")).src=t,a.type="video/"+n,e.appendChild(a),Pr.addEventListener("loadedmetadata",(function(){Pr&&Pr.addEventListener("timeupdate",(function(){Pr&&Pr.currentTime>.5&&(Pr.currentTime=Math.random())}))}))),Pr.play().catch((function(){}))};function Fr(){if(!Br)return Vr();Hr||(Hr=!0,document.addEventListener("visibilitychange",Gr));try{navigator.wakeLock.request("screen").then((function(e){(Ur=e).addEventListener("release",(function(){}))}))}catch(e){console.error(e.name+", "+e.message)}}function Wr(){Br?Ur&&Ur.release().then((function(){Ur=null})):Pr&&Pr.pause()}var Zr=t(73947);function zr(e){var n=e.onClose,t=e.onSubmit,a=e.title,r=e.children,s=e.isWithBackButton,c=e.onBackClick,d=e.contentClassName,u=void 0===d?"TranslationCreateModal__content":d,_=e.isRecord,v=(0,l.useContext)(E.LangContext).getLang,p=n&&t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:v("calls_cancel")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:t},{children:v(_?"calls_record_start":"calls_translation_start")}),void 0)]},void 0);return(0,o.jsx)(aa.default,(0,i.__assign)({className:"TranslationCreateModal",title:a,onClose:n,backText:s?v("calls_back"):void 0,onBack:c,actionButtons:p},{children:(0,o.jsx)("div",(0,i.__assign)({className:u},{children:l.Children.toArray(r).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)}var Kr,Qr,Yr=t(28581),Jr=t(21086),Xr=t(31897);function qr(e){var n=e.onSubmit,t=e.onClose,a=e.isRecord,r=(0,l.useContext)(E.LangContext),s=r.getLang,d=r.langShortDateTime,u=(0,c.useSelector)((function(e){return e})),_=function(){var e=(new Date).toISOString().split("T")[0];return s("calls_translation_title_default_value").replace("%s",e)},v=function(e,n,t){return void 0===n&&(n=""),void 0===t&&(t=""),{id:e,name:n,photo:t,isGroup:e<0}},p=function(e){var n=[{value:Kr.ONLY_ME,label:s("calls_translation_privacy_only_me_and_chat")},{value:Kr.FRIENDS,label:s("calls_translation_privacy_friends_and_chat")}];return e&&n.push({value:Kr.ALL,label:s("calls_translation_privacy_all_users")}),n},f=u.participants[u.me],h=u.config,A=(0,i.__read)((0,l.useState)(_()),2),g=A[0],m=A[1],C=(0,i.__read)((0,l.useState)(""),2),S=C[0],I=C[1],T=(0,i.__read)((0,l.useState)(u.groupId?Kr.ALL:Kr.ONLY_ME),2),N=T[0],x=T[1],y=(0,i.__read)((0,l.useState)((function(){return p(!f.isClosed||!!u.groupId)})),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)((function(){var e,n;return u.groupId?v(u.groupId,null===(e=u.meGroup)||void 0===e?void 0:e.name,null===(n=u.meGroup)||void 0===n?void 0:n.photo):v(f.peerId,f.name,f.photo)})),2),M=w[0],P=w[1],k=(0,i.__read)((0,l.useState)(Qr.MAIN),2),L=k[0],D=k[1],j=(0,i.__read)((0,l.useState)({}),2),R=j[0],B=j[1],U=(0,i.__read)((0,l.useState)((function(){return u.groupId&&u.meGroup?[{value:u.meGroup.peerId,label:u.meGroup.name}]:[{value:f.peerId,label:f.name}]})),2),H=U[0],G=U[1],V=(0,i.__read)((0,l.useState)([]),2),F=V[0],W=V[1],Z=(0,i.__read)((0,l.useState)(!1),2),z=Z[0],K=Z[1],Q=(0,i.__read)((0,l.useState)([]),2),Y=Q[0],J=Q[1],X=(0,i.__read)((0,l.useState)([]),2),q=X[0],$=X[1],ee=(0,l.useCallback)((function(){var e=g.trim(),t=S.trim(),a={};if(Object.keys(R).length>0){e||(e=R.title),t||(t=R.description);var i=t!=R.title||e!=R.description;i||(i=M.id>0&&R.privacy_view.category!=N),i&&(0,nn.sendVideoEdit)(M.id,R.id,e,t,N).catch((function(e){return console.error(e)}));var o={ovId:R.ov_id};R.live_start_time&&(o.startTime=R.live_start_time),a.upcomingStreamParams=o}else a.streamParams={name:e||_(),description:t,privacy_view:N,group_id:M.id<0?-M.id:0,call:1};n(a)}),[g,S,N,M,R]);(0,l.useEffect)((function(){if(!u.groupId)try{(0,nn.getGroupsForStreaming)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(H),!1);e.length>0&&(e.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),G(n),W(e))})).catch(console.error)}catch(e){console.log(e)}}),[]),(0,l.useEffect)((function(){B({}),K(!1),J([]),(0,nn.getUpcomingLives)([M.id]).then((function(e){var n=[];e.count>0&&(n=e.items.filter((function(e){return""!==e.ov_id})));var t=n.length>0;if(K(t),J(n),t){var a=[];n.forEach((function(e){e.owner_id&&e.owner_id>0&&a.push(e.owner_id.toString())})),a&&(0,nn.loadUsers)({user_ids:a.join(",")}).then((function(e){var n=[];e.forEach((function(e){n.push({id:e.id,name:e.first_name+" "+e.last_name})})),$(n)})).catch((function(e){return console.error(e)}))}})).catch((function(e){return console.error(e)}))}),[M]);var ne=function(e){var n=e.date;e.live_start_time&&(n=e.live_start_time);var t=n-Date.now()/1e3;return t>0&&t<Ft.WEEK?s("calls_translation_date_label_soon"):""},te=function(e){if(!(e>0))return M.name;var n=q.filter((function(n){return n.id==e}));if(n.length>0){var t=n[0];if(t)return t.name}return""};return(0,o.jsxs)(o.Fragment,{children:[L===Qr.MAIN&&(0,o.jsxs)(zr,(0,i.__assign)({onClose:t,onSubmit:ee,title:s(a?"calls_record_box_title":"calls_translation_box_title"),isRecord:a},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__link"},{children:[(0,o.jsxs)(oa.default,{children:[!!H.length&&(0,o.jsx)(ra.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(sa.ListIcon,{icon:(0,o.jsx)("img",{className:"TranslationCreateForm__ownerIcon",src:M.photo,alt:M.name},void 0),color:sa.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(No.default,{className:"TranslationCreateFormOptions__longselect",options:H,value:M.id,onChange:function(e){var n=e.selected.value;n<0?F.forEach((function(e){e.id==-n&&(x(Kr.ALL),O(p(!0)),P(v(-e.id,e.name,e.photo_100)))})):(O(p(!f.isClosed)),x(Kr.ONLY_ME),P(v(f.peerId,f.name,f.photo)))},disabled:H.length<=1},void 0)},{children:s(a?"calls_record_owner_title":"calls_translation_owner_title")}),void 0),z&&!a&&(0,o.jsxs)(ra.default,(0,i.__assign)({onClick:function(){z&&D(Qr.SELECT_POSTPONE)},chevron:!0,border:!0,icon:(0,o.jsx)(sa.ListIcon,{icon:(0,o.jsx)(Jr.TimeIcon,{},void 0),color:sa.ListIconColors.GREEN},void 0)},{children:[s("calls_translation_postponed_title"),Object.keys(R).length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__copyControl"},{children:(0,o.jsx)(Xr.default,(0,i.__assign)({className:"TranslationCreateForm__copyButton",onClick:function(e){e.preventDefault(),e.stopPropagation(),B({}),m(_()),I("")}},{children:s("calls_translation_postponed_reset")}),void 0)}),void 0)]}),void 0),!h.sferum&&(0,o.jsx)(ra.default,(0,i.__assign)({border:!1,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(sa.ListIcon,{icon:(0,o.jsx)(Yr.PrivacyIcon,{},void 0),color:sa.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(No.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:M.isGroup,options:b,value:N,onChange:function(e){x(e.selected.value)}},void 0)},{children:s("calls_translation_who_can_see_video_privacy")}),void 0)]},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__privacyHint"},{children:s(a?"calls_record_who_can_see_video_privacy_hint":"calls_translation_who_can_see_video_privacy_hint")}),void 0)]}),void 0),(0,o.jsxs)("form",(0,i.__assign)({className:"TranslationCreateForm__main",onSubmit:ee},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__section"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_title"),(0,o.jsx)(ua.default,{className:"TranslationCreateForm__field",value:g,onChange:function(e){var n=e.target;m(n.value)},placeholder:s("calls_translation_name_placeholder")},void 0)]}),void 0)}),void 0),!a&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_description"),(0,o.jsx)(Zr.default,{className:"TranslationCreateForm__field",placeholder:s("calls_translation_description_placeholder"),value:S,onChange:function(e){var n=e.target;I(n.value)}},void 0)]}),void 0)}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__tabSection"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__warning"},{children:s(a?"calls_record_notification_warning":"calls_translation_notification_warning")}),void 0)}),void 0)]}),void 0)]}),void 0),L===Qr.SELECT_POSTPONE&&(0,o.jsx)(zr,(0,i.__assign)({title:s("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:function(){return D(Qr.MAIN)},onClose:t,contentClassName:"TranslationCreateForm__modalVideo"},{children:(0,o.jsx)("div",{children:Y.length>0&&(0,o.jsx)(oa.default,(0,i.__assign)({className:"TranslationCreateForm__VideoList"},{children:Y.map((function(e,n){return(0,o.jsxs)(ra.default,(0,i.__assign)({className:"TranslationCreateForm__videoItem",active:e.id===R,border:!0,canBeHovered:!0,selectable:!0,onClick:function(){return(n=e).owner_id>0&&(0,nn.getVideos)(n.owner_id,[n.owner_id+"_"+n.id],!0).then((function(e){if(e.count>0){var t=e.items.filter((function(e){return e.id==n.id}));t.length>0&&(n.privacy_view=t[0].privacy_view,B(n),n.privacy_view&&x(n.privacy_view.category))}})),B(n),D(Qr.MAIN),m(n.title),void I(n.description);var n},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoLink"},{children:s("calls_translation_select_video_link")}),void 0)},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoImagePreview"},{children:[(0,o.jsx)("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title},void 0),ne(e)&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoImageLabel"},{children:ne(e)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDescription"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoTitle"},{children:e.title}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoOwner"},{children:te(e.owner_id)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDate"},{children:(t=e,a=t.date,t.live_start_time&&(a=t.live_start_time),d(1e3*a))}),void 0)]}),void 0)]}),n);var t,a}))}),void 0)},void 0)}),void 0)]},void 0)}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(Kr||(Kr={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}(Qr||(Qr={}));var $r=function(e){var n,t=e.isRecord,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP})}),[]),v=Wt(a),p=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]),f=(0,l.useCallback)((function(e){var n,a;if(null==e?void 0:e.upcomingStreamParams){var i=e.upcomingStreamParams,o=i.startTime,s=i.ovId;if(o&&o>Date.now()/1e3+4)return An(s,t).finally(_)}var l={isOn:!1,startStreamParams:e,isRecord:t,name:null===(n=e.streamParams)||void 0===n?void 0:n.name};return t&&(null===(a=l.startStreamParams)||void 0===a?void 0:a.streamParams)&&(l.startStreamParams.streamParams.is_call_record=1),r({type:d.E_ACTION.SET_TRANSLATION,data:l}),r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN}),Promise.resolve()}),[t]),h=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}),[]);return(null===(n=a.translation)||void 0===n?void 0:n.isOn)?(0,o.jsx)(ia,(0,i.__assign)({title:s("calls_translation_menu_title"),actionButtons:v?[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:p,appearance:"negative"},{children:s("calls_translation_menu_stop")}),"stop")]:[],onCloseModal:_},{children:(0,o.jsx)(da,{isLinkBlockShown:!0,linkBlockTitle:s("calls_translation_menu_link"),onLinkBlockClick:h,callUrlLink:a.translation.link},void 0)}),void 0):(0,o.jsx)(qr,{onSubmit:f,onClose:_,isRecord:t},void 0)},es=function(e){var n=e.onClose,t=e.actionButtons,a=e.isRecord,r=(0,ue.useLang)().getLang,s=r(a?"calls_record_stop_confirmation":"calls_translation_stop_confirmation"),l=r(a?"calls_record_stop_sure":"calls_translation_stop_sure");return(0,o.jsx)(aa.default,(0,i.__assign)({onClose:n,title:s,appearance:"blue",actionButtons:t,className:"TranslationStopModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStopModal__text"},{children:l}),void 0)}),void 0)},ns=function(){var e=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=P((function(e){return e.translation.isRecord})),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return{dispatch:e,getLang:n,isRecord:t,onClose:a}}(),n=e.dispatch,t=e.getLang,a=e.isRecord,r=e.onClose;return(0,o.jsx)(es,{onClose:r,actionButtons:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:r,appearance:"secondary"},{children:t("calls_cancel")}),"cancel"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){(0,nn.stopVideoStream)().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:t("calls_translation_stop")}),"stop")],isRecord:a},void 0)};var ts=function(e){var n=e.link,t=(0,l.useContext)(E.LangContext).getLang,a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=(0,l.useCallback)((function(){return s(!0)}),[]),d=(0,l.useCallback)((function(){return s(!1)}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"TranslationLink__info"},{children:t("calls_translation_link_info")}),void 0),(0,o.jsx)(ua.default,{readOnly:"readonly",className:"TranslationLink__input",value:n},void 0),n&&(0,o.jsx)(Ci.CopyText,(0,i.__assign)({text:n,onCopyDone:c},{children:(0,o.jsx)(Ea.default,{children:t("calls_translation_link_copy")},void 0)}),void 0),(0,o.jsx)(_a.default,(0,i.__assign)({className:"TranslationLink__copied",shown:r,callback:d},{children:t("calls_translation_link_copied")}),void 0)]}),void 0)},as=function(e){var n,t=e.onBack,a=e.link,r=e.linkExtractor,s=u(),_=(0,l.useContext)(E.LangContext).getLang,v=(0,c.useSelector)((function(e){return e.translation})),p=(0,l.useCallback)((function(){s({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return(0,o.jsx)(ia,(0,i.__assign)({title:_("calls_translation_link"),onCloseModal:p,isWithBackButton:!!t,onBackClick:t},{children:(0,o.jsx)(ts,{link:null!==(n=null==r?void 0:r(v))&&void 0!==n?n:a},void 0)}),void 0)},is=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"AdminPinUnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AdminPinUnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},os=function(e){var n=e.SDK,t=u(),a=(0,l.useContext)(E.LangContext).getLang,r=(0,c.useSelector)((function(e){return e})),s=r.localDevice.mediaSettings,_=function(){t({type:d.E_ACTION.TOGGLE_POPUP})};return(0,o.jsx)(is,{onClose:_,title:a("calls_admin_pin_dialog_title"),description:a("calls_admin_pin_dialog_description"),actionButtons:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:_,appearance:"secondary"},{children:a("calls_admin_pin_dialog_cancel")}),"cancel"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){(s.isAudioEnabled?Promise.resolve():Be(n,[J.MediaOption.AUDIO])).then((function(){var e;(null===(e=r.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&t({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)})).then((function(){return _()}))}},{children:a("calls_admin_pin_dialog_action")}),"mic")]},void 0)},rs=function(e){var n=e.participants,t=e.selected,a=e.onSelect,r=e.onClose,s=e.onCallForceFinish,c=e.onRightsTransfer,d=e.onSearch,u=e.isCreator,_=(0,ue.useLang)().getLang,v=P((function(e){return e.me})),p=(0,l.useMemo)((function(){return n.filter((function(e){return e.peerId!==v}))}),[n,v]);return(0,o.jsx)(ia,(0,i.__assign)({title:_("calls_dialog_creator_exit_title"),onCloseModal:r,actionButtons:(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"secondary",onClick:s},{children:_("calls_force_call_finish")}),"force"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:c},{children:_(null===t?"calls_leave_call":"calls_dialog_creator_exit_action")}),"action")]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TransferAdminRightsModal__content"},{children:[(0,o.jsx)(ua.default,{onChange:function(e){return d(e.target.value)},placeholder:_("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"},void 0),(0,o.jsxs)(oa.default,(0,i.__assign)({border:!1},{children:[(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({extra:p.length},{children:_("calls_call_participants")}),void 0),!p.length&&(0,o.jsx)(Re.default,{children:_("calls_participants_not_found")},void 0),p.map((function(e){return(0,o.jsx)(ra.default,(0,i.__assign)({className:"TransferAdminRightsModal__item",onClick:function(){return a(t!==e.peerId?e:null)},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TransferAdminRightsModal__label","aria-selected":t===e.peerId},{children:t===e.peerId?_("calls_dialog_creator_exit_selected"):_("calls_dialog_creator_exit_select")}),void 0)},{children:(0,o.jsx)(Ca.default,{size:"34",title:e.name,photo:e.photo},void 0)}),e.peerId)}))]}),void 0)]}),void 0)}),void 0)},ss=function(e){var n=e.SDK,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,s=(0,i.__read)((0,l.useState)((function(){var e=(0,Ve.objectFilter)(a.participants,(function(e){return e.peerId===a.me||!(0,k.isParticipantAnonym)(e.peerId)&&(0,k.someDeviceByParticipant)(e,(function(e){return e.status===J.ParticipantStatus.CONNECTED}))}));return e})),2),_=s[0],v=s[1],p=(0,i.__read)((0,l.useState)(null),2),f=p[0],h=p[1],A=(0,l.useCallback)((function(e){return e.name}),[]),g=(0,l.useCallback)((function(e){return e.peerId}),[]),m=x(_,A,g),C=(0,l.useMemo)((function(){return(0,k.getActiveParticipantsCount)(a)}),[a.participants]),S=function(){return w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:C})},I=(0,l.useMemo)((function(){return(0,k.isCreator)(a.localDevice)}),[a.localDevice]),T=(0,l.useCallback)((function(e){v(e?m.search(e):m.list),h(null)}),[a]),N=function(){t({type:d.E_ACTION.TOGGLE_POPUP})},y=function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup().catch(console.log)},b=(0,l.useCallback)((function(e){h(null===e?null:e.peerId)}),[]);return(0,l.useEffect)((function(){f&&!_.find((function(e){return e.peerId===f}))&&h(null)}),[f]),(0,o.jsx)(rs,{participants:_,onClose:N,onSelect:b,selected:f,onCallForceFinish:function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup(),pi(0,a,t,r)},onRightsTransfer:function(){if(null!==f){var e=(0,k.getParticipantExternalId)(a.participants[f]);e&&(n.grantRoles(e,[J.UserRole.ADMIN],!1).then((function(){return y()})).catch(console.log),N())}else y()},onSearch:T,isCreator:I},void 0)},ls=function(e){var n=e.onCloseModal,t=e.counter,a=e.onStopTranslation,r=e.isRecord,s=(0,l.useContext)(E.LangContext).getLang,c=s(r?"calls_record_cancel_button":"calls_translation_cancel_button");return(0,o.jsx)(I.default,(0,i.__assign)({disableBackdropClick:!0,disableEscapeClose:!0,className:"TranslationStartCountdownModal",onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__counter"},{children:t}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({className:"TranslationStartCountdownModal__stop",onClick:a,appearance:"overlay_secondary"},{children:c}),void 0)]}),void 0)}),void 0)};function cs(){var e=u(),n=P((function(e){return e})),t=(0,i.__read)((0,l.useState)(3),2),a=t[0],r=t[1],s=P((function(e){return e.translation.isRecord})),c=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]),_=(0,l.useCallback)((function(){var e,t=null===(e=n.translation)||void 0===e?void 0:e.startTime;t&&t>=Date.now()&&(0,nn.stopVideoStream)(),c()}),[]);return(0,l.useEffect)((function(){var e=setInterval((function(){return r(a-1)}),Ft.SECOND_JS);return function(){return clearInterval(e)}}),[a]),(0,l.useEffect)((function(){var e,t;if(a<=0){var i=null===(e=n.translation)||void 0===e?void 0:e.startStreamParams;(null==i?void 0:i.streamParams)?(t=i.streamParams,(0,nn.videoStartStreaming)(t).then((function(e){return(0,J.startStream)(!!t.is_call_record,null,String(e.stream.ov_id))})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))):(null==i?void 0:i.upcomingStreamParams)&&An(i.upcomingStreamParams.ovId),c()}}),[a]),(0,o.jsx)(ls,{onCloseModal:c,counter:a,onStopTranslation:_,isRecord:s},void 0)}var ds,us=function(e){var n=e.onClose,t=e.actionButtons,a=e.onAllowReconnectChange,r=e.description,s=e.allowBan,c=e.banText,d=(0,l.useContext)(E.LangContext).getLang,u=(0,l.useContext)(y.ConfigContext).allowBanParticipant,_=(0,i.__read)((0,l.useState)(!0),2),v=_[0],p=_[1],f=(0,l.useCallback)((function(e,n){a&&a(n),p(n)}),[]);return(0,o.jsx)(aa.default,(0,i.__assign)({className:"KickParticipantModal",appearance:"blue",title:d("calls_kick_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"KickParticipantModal__content"},{children:[r,u&&s&&(0,o.jsx)("div",{children:(0,o.jsx)(yo.default,(0,i.__assign)({className:"KickParticipantModal__checkbox",onChange:f,checked:v},{children:c}),void 0)},void 0)]}),void 0)}),void 0)},_s=function(){var e,n=u(),t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langSex,s=P((function(e){return e.waitingHall})),c=P((function(e){var n;return null===(n=e.participantKick)||void 0===n?void 0:n.participant})),_=P((function(e){var n;return(null===(n=e.participantKick)||void 0===n?void 0:n.type)===d.KickParticipantType.CALL})),v=P((function(e){return e.callData.conversation})),p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],h=p[1],A=!!c&&(!(0,k.participantIsAdmin)(c)&&!(0,k.participantIsChatAdmin)(c,v)),g=(0,l.useCallback)((function(){n({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK})}),[]),m=(0,l.useCallback)((function(){(0,k.kickParticipant)(c,!f).then((function(){!_&&s&&(null==c?void 0:c.peerId)&&Na(null==c?void 0:c.peerId,s,n)})),g()}),[c,f,s]),C=(0,l.useCallback)((function(e){h(e)}),[]),S=_?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text",I=r(null==c?void 0:c.sex,S,a(S,!0)).replace("{user}",null!==(e=null==c?void 0:c.name)&&void 0!==e?e:""),T=a(_?"calls_kick_participant_kick_button_text":"calls_kick_participant_from_waiting_hall_button_text"),N=a(_?"calls_kick_participant_with_ban_setting":"calls_kick_participant_from_waiting_hall_with_ban_setting");return(0,o.jsx)(us,{onClose:g,onAllowReconnectChange:C,description:I,allowBan:A,banText:N,actionButtons:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:g,appearance:"secondary"},{children:a("calls_cancel")}),"cancel"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:m},{children:T}),"stop")]},void 0)},vs=function(e){var n=e.title,t=e.children,a=e.sendButtonClick,r=e.skipButtonClick,s=e.sendButtonDisabled,c=void 0===s||s,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen"},{children:[(0,o.jsx)("div",{className:"FeedbackScreen__close",onClick:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__title"},{children:n}),void 0),t,(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__actions"},{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"overlay_secondary",onClick:r},{children:d("calls_feedback_skip")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"overlay_primary",onClick:a,disabled:c},{children:d("calls_feedback_send")}),void 0)]}),void 0)]}),void 0)},ps=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 19.2l5.7 3.5a.2.2 0 00.3-.3L18.4 16l5.1-4.3a.2.2 0 00-.1-.4l-6.7-.5-2.5-6.1a.2.2 0 00-.4 0l-2.5 6.1-6.7.5a.2.2 0 00-.1.4l5 4.3L8 22.4a.2.2 0 00.3.3zm0 2.3l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4z"},void 0)}),void 0)},fs=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 21.5l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4L14 21.5z"},void 0)}),void 0)};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADVANCE=1]="ADVANCE"}(ds||(ds={}));var hs=function(e){var n=e.onSuccessFeedback,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,_=(0,i.__read)((0,l.useState)(ds.DEFAULT),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(!0),2),h=f[0],A=f[1],g=(0,i.__read)((0,l.useState)(!1),2),m=g[0],C=g[1],S=new Map([["DID_NOT_HEAR_INTERLOCUTOR",r("calls_feedback_reason_did_not_hear_interlocutor")],["DID_NOT_SEE_INTERLOCUTOR",r("calls_feedback_reason_did_not_see_interlocutor")],["BAD_VIDEO_QUALITY",r("calls_feedback_reason_bad_video_quality")],["VIDEO_FREEZES",r("calls_feedback_reason_video_freezes")],["VERY_QUIET_SOUND",r("calls_feedback_reason_very_quiet_sound")],["BAD_SOUND_QUALITY",r("calls_feedback_reason_bad_sound_quality")],["SOUND_DID_NOT_MATCH_THE_VIDEO",r("calls_feedback_reason_sound_did_not_match_the_video")],["FAILED_TO_TURN_ON_CAMERA_OR_MICROPHONE",r("calls_feedback_reason_failed_to_turn_on_camera_or_microphone")]]),I=(0,i.__read)((0,l.useState)({user_response:0,feedback:[],custom_feedback:void 0}),2),T=I[0],N=I[1],x=(0,i.__read)((0,l.useState)(Array.from(S,(function(e){return{name:(0,i.__read)(e,1)[0],checked:!1}}))),1),y=x[0],M=function(){t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},P=function(e){var n=e.target.getAttribute("data-response");if(n){var t=parseInt(n,10);t<=3&&p(ds.ADVANCE),N((0,i.__assign)((0,i.__assign)({},T),{user_response:t})),A(!1)}},k=function(e,n){y.forEach((function(t){t.name===e&&(t.checked=n)})),N((function(e){return(0,i.__assign)((0,i.__assign)({},e),{feedback:y.filter((function(e){return e.checked})).map((function(e){return e.name}))})}))},L=function(e,n){C(n)},D=function(e){N((0,i.__assign)((0,i.__assign)({},T),{custom_feedback:e.currentTarget.value}))};return(0,o.jsx)(b,(0,i.__assign)({onClose:M,onBackdropClick:M},{children:(0,o.jsx)("section",(0,i.__assign)({className:"Call"},{children:(0,o.jsx)(vs,(0,i.__assign)({title:v===ds.DEFAULT?r("calls_feedback_default_title"):r("calls_feedback_advance_title"),sendButtonClick:function(){var e=(a.lastCallData?a.lastCallData.peerId:0)||0;w.callStats.logEvent({call_event_type:d.CallActionEventType.USER_FEEDBACK_RECEIVED,session_id:a.lastCallData?a.lastCallData.callId:"",peer_id:e,is_group_call:(0,O.isGroupCallByPeer)(e),user_response:T.user_response,feedback:T.feedback,custom_feedback:m&&T.custom_feedback?T.custom_feedback:void 0}),t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),n&&n()},skipButtonClick:M,sendButtonDisabled:h},{children:v===ds.DEFAULT?(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__stars",onClick:P},{children:[1,2,3,4,5].map((function(e,n){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("FeedbackScreen__star",{"FeedbackScreen__star--active":e<=T.user_response}),"data-response":e},{children:[(0,o.jsx)(ps,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--outline"},void 0),(0,o.jsx)(fs,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--filled"},void 0)]}),n)}))}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__voting"},{children:[Array.from(S,(function(e){var n=(0,i.__read)(e,2),t=n[0],a=n[1];return(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem"},{children:(0,o.jsx)(yo.default,(0,i.__assign)({name:t,className:"FeedbackScreen__votingItemCheckbox",onChange:k},{children:a}),void 0)}),t)})),(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem FeedbackScreen__votingItem--custom"},{children:[(0,o.jsx)(yo.default,{name:"CUSTOM_FEEDBACK",className:"FeedbackScreen__votingItemCheckbox",onChange:L},void 0),(0,o.jsx)(Zr.default,{className:"FeedbackScreen__votingItemTextArea",placeholder:r("calls_feedback_custom_reason_placeholder"),grow:!1,disabled:!m,onChange:D},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)}),void 0)},As=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.subDescription,s=e.avatarsItems,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"UnbanMembersModal",appearance:"blue",title:c("calls_unban_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"UnbanMembersModal__content"},{children:[(0,o.jsx)(Do.AvatarsStack,{items:s},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__description"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__subDescription"},{children:r}),void 0)]}),void 0)}),void 0)},gs=function(e){var n,t=e.SDK,a=u(),r=(0,l.useContext)(E.LangContext),s=r.getLang,_=r.langNumeric,v=r.langSex,p=(0,c.useSelector)((function(e){return e})),f=(0,k.participantIsAdmin)(p.localDevice),h=null===(n=p.membersUnban)||void 0===n?void 0:n.members,A=(0,l.useCallback)((function(){a({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:null})}),[]),g=(0,l.useCallback)((function(){null==h||h.forEach((function(e){t.addParticipant(String(e.id),{unban:!0})})),A()}),[p.membersUnban]);if(!h||0===h.length)return(0,o.jsx)(o.Fragment,{},void 0);var m=null==h?void 0:h.length,C=_(m,"calls_unban_participant_text",s("calls_unban_participant_text",!0)),S="",I=[];if(1===m){var T=h[0];S=v(T.sex,"calls_unban_participant_description_text_one_person",s("calls_unban_participant_description_text_one_person",!0)).replace("{user}",T.name),I.push((0,tn.getMemberForUserStack)(T))}else{var N=[h[0].name,h[1].name];I=h.slice(0,2).map((function(e){return(0,tn.getMemberForUserStack)(e)}));if(m<=3)3===m&&(N.push(h[2].name),I.push((0,tn.getMemberForUserStack)(h[2]))),S=s("calls_unban_participant_description_text_two_persons").replace("{users}",N.join(", "));else{var x=m-2;S=_(x,"calls_unban_participant_description_text_more_persons",s("calls_unban_participant_description_text_more_persons",!0)).replace("{users}",N.join(", ")).replace("{users_count}",x),I.push({id:x,text:"+"+x})}}var y=f?[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:A,appearance:"secondary"},{children:s("calls_unban_participant_cancel_button_text")}),"cancel"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:g},{children:s("calls_unban_participant_ok_button_text")}),"stop")]:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:A},{children:s("calls_unban_participant_disallowed_button_text")}),"cancel")];return(0,o.jsx)(As,{onClose:A,description:C,subDescription:S,actionButtons:y,avatarsItems:I},void 0)};const ms=(0,X.makeIcon)("Icon28DownloadOutline","download_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="download_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M21 22a1 1 0 1 1 0 2H7a1 1 0 0 1 0-2h14ZM14 2a1 1 0 0 1 1 1v13.585l5.293-5.292a1 1 0 0 1 1.414 1.414l-7 7a1 1 0 0 1-1.414 0l-7-7a1 1 0 0 1 1.414-1.414L13 16.585V3a1 1 0 0 1 1-1Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),Cs=(0,X.makeIcon)("Icon28VideocamOutline","videocam_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="videocam_outline_28"><path fill-rule="evenodd" d="M9.357 5h4.286c1.084 0 1.958 0 2.666.058.729.06 1.369.185 1.961.487a5 5 0 0 1 2.185 2.185c.231.454.36.936.433 1.464l.437-.284.903-.585c.239-.155.52-.338.773-.471.255-.134.794-.395 1.482-.348a2.7 2.7 0 0 1 1.975 1.07c.415.552.49 1.148.516 1.434.026.285.026.62.026.904v6.172c0 .284 0 .619-.026.904-.026.286-.1.882-.516 1.434a2.7 2.7 0 0 1-1.975 1.07c-.688.047-1.227-.214-1.482-.348a10.407 10.407 0 0 1-.773-.47l-.905-.588-.435-.282c-.074.528-.202 1.01-.433 1.464a5 5 0 0 1-2.185 2.185c-.592.302-1.232.428-1.961.487C15.6 23 14.727 23 13.643 23H9.357c-1.084 0-1.958 0-2.666-.058-.728-.06-1.369-.185-1.96-.487a5 5 0 0 1-2.186-2.185c-.302-.592-.428-1.232-.487-1.961C2 17.6 2 16.727 2 15.643v-3.286c0-1.084 0-1.958.058-2.666.06-.728.185-1.369.487-1.961A5 5 0 0 1 4.73 5.545c.592-.302 1.233-.428 1.961-.487C7.4 5 8.273 5 9.357 5ZM21 15.643v-4.138l2.27-1.472c.563-.365.844-.548 1.077-.532a.7.7 0 0 1 .513.277c.14.187.14.522.14 1.192v6.06c0 .67 0 1.005-.14 1.192a.7.7 0 0 1-.513.277c-.233.016-.514-.167-1.077-.532L21 16.495v-.852ZM6.854 7.05c-.605.05-.953.142-1.216.276a3 3 0 0 0-1.311 1.311c-.134.263-.226.611-.276 1.216-.05.617-.051 1.41-.051 2.546v3.2c0 1.137 0 1.929.051 2.546.05.605.142.953.276 1.216a3 3 0 0 0 1.311 1.311c.263.134.611.226 1.216.276.617.05 1.41.051 2.546.051h4.2c1.137 0 1.929 0 2.546-.051.605-.05.953-.142 1.216-.276a3 3 0 0 0 1.311-1.311c.134-.263.226-.611.276-1.216.05-.617.051-1.41.051-2.546v-3.2c0-1.137 0-1.929-.051-2.546-.05-.605-.142-.953-.276-1.216a3 3 0 0 0-1.311-1.311c-.263-.134-.611-.226-1.216-.276-.617-.049-1.41-.05-2.546-.05H9.4c-1.137 0-1.929 0-2.546.051Z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0);function Es(){var e,n,t,a=(0,c.useSelector)((function(e){return e})),r=u(),_=(0,l.useContext)(E.LangContext).getLang,v=!(null===(e=a.join)||void 0===e?void 0:e.joinLink),p=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),f=p[0],h=p[1],A=(0,i.__read)((0,l.useState)(!f),2),g=A[0],m=A[1],C=(0,l.useRef)(Oi()),S=null!==C.current,I=(0,i.__read)((0,l.useState)(!f),2),T=I[0],N=I[1],x=function(){var e,n,t,i;return(null===(e=a.join)||void 0===e?void 0:e.joinLink)?Bi(Ui({joinLink:null===(n=a.join)||void 0===n?void 0:n.joinLink,userId:null===(t=window.vk)||void 0===t?void 0:t.id})):Bi(function(e){var n=e.peerId,t=e.userId,a=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?peerId="+n+"&userId="+t;return console.log("deeplink: ",a),a}({peerId:a.peer,userId:null===(i=window.vk)||void 0===i?void 0:i.id}))};(0,l.useEffect)((function(){x().then((function(){m(!1)})).catch((function(){m(!1)}))}),[f]);var y=function(){r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},O=null!==(t=null===(n=Vi(a.config.browserWarnings))||void 0===n?void 0:n.block)&&void 0!==t&&t;return(0,o.jsx)(b,(0,i.__assign)({onClose:y,onBackdropClick:y},{children:(0,o.jsxs)(Fa.ModalCard,(0,i.__assign)({nav:"StartCallModal",header:(0,o.jsx)(V.default,{children:_(g&&S?"calls_download_started":f?"calls_app_title":v?"calls_start_call_after_install_app":"calls_join_call_after_install_app")},void 0),subheader:T?_("calls_download_and_install_app_for_pc"):f?_(v?"calls_try_manual_start_lesson":"calls_try_manual_join_lesson"):g?_("calls_wait_until_app_downloaded"):"",className:"StartCallModal"},{children:[g&&S&&C.current?(0,o.jsxs)(l.Fragment,{children:[(0,o.jsx)(Fa.Spinner,{size:"large",className:"StartCallModal__action"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"StartCallModal__text"},{children:_("calls_downloading_file").replace("{file}",C.current.filename)}),void 0)]},void 0):T?C.current&&S?(0,o.jsx)(Fa.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(ms,{},void 0),onClick:function(){return e=C.current.url,n=C.current.filename,wi(),bi(e,n),m(!0),void setTimeout((function(){h(!0),m(!1),N(!1)}),3e3);var e,n},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(Fa.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(ms,{},void 0),href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank",onClick:function(){wi(),N(!1)},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(Fa.Button,(0,i.__assign)({mode:"secondary",size:"l",before:(0,o.jsx)(Cs,{},void 0),onClick:x,className:"StartCallModal__action"},{children:_(v?"calls_start_in_app":"calls_join_call_in_app")}),void 0),!T&&(0,o.jsxs)(Fa.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[(0,o.jsx)("div",{children:_("calls_apps_for_all_platform")},void 0),(0,o.jsx)(Fa.Link,(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank"},{children:_("calls_open_app_list")}),void 0)]}),void 0),!O&&(0,o.jsxs)(Fa.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[_("calls_calls_troubles_with_app"),(0,o.jsx)("br",{},void 0),(0,o.jsx)(Fa.Link,(0,i.__assign)({onClick:function(){var e,n,t,i,o=a.peer;if(window.Calls)if(null===(e=a.join)||void 0===e?void 0:e.joinLink){var r=null!==(n=a.entryPoint)&&void 0!==n?n:d.CallStatSource.CONVO_JOIN_SNIPPET;window.Calls.joinCallByLink(null===(t=a.join)||void 0===t?void 0:t.joinLink,void 0,!1,r)}else{var s=null!==(i=a.entryPoint)&&void 0!==i?i:d.CallStatSource.CONVO_LIST;if(o)o>2e9?window.Calls.startGroupCall(o,void 0,null,!1,s):window.Calls.call(o,!1,void 0,s);else window.Calls.startCall(!1,s)}}},{children:_(v?"calls_calls_start_lesson_in_browser":"calls_join_call_in_browser")}),void 0)]}),void 0),O&&(0,o.jsx)(Fa.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:_("calls_warning_native_app_description")}),void 0)]}),void 0)}),void 0)}var Ss=t(98037),Is=function(e){var n=e.items,t=e.actionButtons,a=e.onListItemClick,r=e.selectedId,s=e.onClose,c=e.onSearchChange,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)(I.default,(0,i.__assign)({className:"CallByNameModal",onClose:s},{children:[(0,o.jsx)(Ho.ModalHeader,{title:d("calls_call_by_name_title"),onClose:s},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallByNameModal__content"},{children:[(0,o.jsx)(ha.BlockSearchInput,{className:"CallByNameModalList__input",placeholder:d("calls_call_by_name_search_placeholder"),onChange:c,onInput:c,onPaste:c},void 0),(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({extra:n.length||""},{children:d("calls_call_by_name_list_header")}),void 0),0!==n.length&&(0,o.jsx)(oa.default,(0,i.__assign)({border:!1,className:"CallByNameModalList__list"},{children:n.map((function(e){return function(e,n){var t=null;return t=n===e.id?(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__selected"},{children:d("calls_call_by_name_selected")}),void 0):(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__select"},{children:d("calls_call_by_name_select")}),void 0),(0,o.jsx)(ra.default,(0,i.__assign)({onClick:function(){return a(e.id)},className:"CallByNameModalList__listItem",aside:t},{children:(0,o.jsx)(Ca.default,{photo:(0,o.jsx)(A.CallPhoto,{id:e.id,photo:e.photo,alt:e.name||"",className:"CallByNameModalList__photo"},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.id)}(e,r)}))}),void 0),0===n.length&&(0,o.jsx)(Re.default,{children:d("calls_call_by_name_not_found")},void 0)]}),void 0),(0,o.jsx)(Ss.ModalFooter,{actionButtons:t},void 0)]}),void 0)},Ts=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,i.__read)((0,l.useState)([]),2),s=r[0],_=r[1],v=(0,i.__read)((0,l.useState)(t.me),2),p=v[0],f=v[1],h=(0,l.useContext)(E.LangContext).getLang,A=(0,i.__read)((0,l.useState)(""),2),g=A[0],m=A[1],C=(0,l.useCallback)((function(e){return e.name}),[]),S=(0,l.useCallback)((function(e){return e.id}),[]),I=x([],C,S),T=t.participants[t.me],N=g?I.search(g):s,y=(0,l.useCallback)((function(e){m(e.target.value)}),[]),b=function(e,n){void 0===n&&(n=!1);var t="id"in e?e.id:e.peerId,a="screen_name"in e?"/"+e.screen_name:e.link,i="photo_100"in e?e.photo_100:e.photo;return{id:n?t:-t,name:(0,Za.escape)(e.name),link:a,photo:i}};(0,l.useEffect)((function(){var e=[b(T,!0)];(0,nn.getGroupsForCall)().then((function(n){n.count>0&&n.items.forEach((function(n){e.push(b(n))}))})).finally((function(){_(e),e.forEach((function(e){return I.add(e)}))}))}),[]);var O=(0,l.useCallback)((function(e){if(t.callByName){var a=t.callByName,i=a.peerId,o=a.entryPoint,r=a.joinLink;r?n.joinCallByLink(r,void 0,e,o,p>0?0:p):i?n.call(i,e,void 0,o,p>0?0:p):n.startCall(e,o,!0,p>0?0:p)}}),[p]);if(!s.length)return(0,o.jsx)(Rr.default,{},void 0);var w=[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return O(!1)},appearance:"secondary"},{children:h("calls_call_by_name_audio_button")}),"callByNameByAudio"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){return O(!0)}},{children:h("calls_call_by_name_video_button")}),"callByNameByVideo")];return(0,o.jsx)(Is,{items:N,actionButtons:w,selectedId:p,onListItemClick:function(e){f(e)},onClose:function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},participantMe:T,onSearchChange:y},void 0)},Ns=function(e){var n,t,a,i=e.SDK,r=(0,c.useSelector)((function(e){return e})),s=u(),_=r.localDevice,v=r.externalId,p=r.participants[r.me],f=(0,l.useCallback)((function(){s({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})}),[]),h=(0,l.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=r.localDevice.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[r.localDevice.mediaSettings]);return(0,o.jsx)(vo,{children:v&&(0,o.jsx)(ho,{onRestoreCall:f,isMe:!0,isLocalAudioEnabled:!!(null===(n=_.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalAudioAllowed:!0,isLocalScreenSharing:!1,onToggleAudio:h,photo:p.photo,name:p.name,participantId:v,isWithVideo:(0,k.isParticipantWithVideo)(_),isWithAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isScreenSharing:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:(0,k.getStream)(_),status:_.status,networkStatus:_.networkStatus},void 0)},void 0)},xs=function(e){var n=e.name,t=e.letter,a=e.hasAudio,r=e.hasVideo,s=e.stream,l=e.wasConnected,c=e.externalId;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHall"},{children:(0,o.jsx)("main",(0,i.__assign)({className:"WaitingHall__main"},{children:(0,o.jsx)(ce,{externalId:c,hasVideo:r,hasAudio:a,isSharingScreen:!1,stream:s,isMe:!0,name:n,letter:t,allowContain:!0,wasConnected:l,networkStatus:1},void 0)}),void 0)}),void 0)},ys=function(e){var n=e.text;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo__text"},{children:n}),void 0)}),void 0)};function bs(e){var n,t,a,r=e.SDK,s=e.navigateToConvo,_=(0,c.useSelector)((function(e){return e})),v=u(),p=(0,l.useContext)(E.LangContext).getLang,f=(0,l.useContext)(y.ConfigContext),h=f.isModalView,A=f.enableScreenTrack,g=_.peer,m=_.localDevice.mediaSettings,C=_.uiMode===d.UIMode.FULLSCREEN,S=(0,i.__read)((0,l.useState)(!1),2),I=S[0],T=S[1],N=(0,i.__read)((0,l.useState)(!1),2),x=N[0],O=N[1],w=function(e){return v({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},M=(0,l.useCallback)((function(){h&&(_.uiMode===d.UIMode.FULLSCREEN?((0,ta.pause)(.3,null).then((function(){w(d.UIMode.COLLAPSED)})),w(d.UIMode.DEFAULT)):w(d.UIMode.COLLAPSED))}),[_.uiMode]),P=(0,l.useCallback)((function(){if(!I){var e=!m.isAudioEnabled;(e?Be(r,[J.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;T(!0),(null===(n=_.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&v({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),r.toggleLocalAudio(e).finally((function(){T(!1)}))}))}}),[m,I]),L=(0,l.useCallback)((function(){if(!x){var e=!m.isVideoEnabled||!!m.isScreenSharingEnabled&&!A;(e?Be(r,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){O(!0),A||m.isScreenSharingEnabled&&r.captureScreen(!1),r.toggleLocalVideo(e).finally((function(){O(!1)}))}))}}),[m,x]),D=(0,l.useCallback)((function(){M(),s(_.peer)}),[_.peer,_.uiMode]),j=(0,l.useCallback)((function(){r.hangup()}),[]),R=(0,l.useCallback)((function(){v({type:d.E_ACTION.CHANGE_UI_MODE,mode:C?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[_.uiMode]),B=(0,l.useCallback)((function(e,n){var t;v({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),U=(0,l.useCallback)((function(){v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){return function(){v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var H=(0,l.useMemo)((function(){var e;return(0,o.jsx)(Qe,{dispatch:v,notification:_.notification,participant:_.participants[null===(e=_.notification)||void 0===e?void 0:e.data]},void 0)}),[_.notification,_.participants[null===(n=_.notification)||void 0===n?void 0:n.data]]),G=_.hangupType===d.HANGUP_TYPE_REMOVED?p("calls_waiting_hall_removed"):p("calls_waiting_hall_info");return(0,o.jsx)(b,(0,i.__assign)({onClose:j,onBackdropClick:M},{children:(0,o.jsx)(ke,(0,i.__assign)({info:null,isVideoAllowed:!0,isAudioAllowed:!0,isVideoEnabled:!!m.isVideoEnabled,isAudioEnabled:!!m.isAudioEnabled,isFullScreen:C,onToggleAudio:P,onToggleVideo:L,onLeaveCall:j,onCollapseCall:h?M:null,onFullScreenToggle:R,onTooltipChange:B,onHidePanel:U,onChat:D,isChatControlShown:!!g&&!_.groupId,chatUnreadCount:_.chatUnreadCount,notification:H,tooltips:_.tooltips,notificationWithButton:null,withoutPadding:!0},{children:(0,o.jsxs)(o.Fragment,{children:[!!m.isVideoEnabled&&_.externalId&&(0,o.jsx)(xs,{name:"",letter:null===(t=_.participants[_.me].name)||void 0===t?void 0:t.slice(0,1),hasAudio:!!(null===(a=_.localDevice.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),externalId:_.externalId,stream:(0,k.getStream)(_.localDevice),hasVideo:(0,k.isParticipantWithVideo)(_.localDevice),wasConnected:!!_.localDevice.wasConnected},void 0),(0,o.jsx)(ys,{text:G},void 0)]},void 0)}),void 0)}),void 0)}var Os=function(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=e.onChangeVideoOption,s=e.videoOptions,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({onClose:n,title:c("calls_virtual_background"),appearance:"blue",disableEscapeClose:!0,actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__options"},{children:(0,o.jsx)(yo.default,(0,i.__assign)({checked:!!s[d.EVideoOptionType.IS_VIDEO_MIRRORED],name:d.EVideoOptionType.IS_VIDEO_MIRRORED,onChange:r},{children:c("calls_mirror_display_view")}),void 0)}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:c("calls_cancel")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:t},{children:c("calls_save")}),void 0)]},void 0),className:"VirtualBackgroundSettingsModal"},{children:a}),void 0)},ws=function(e,n){return ws=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},ws(e,n)};function Ms(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}ws(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}function Ps(e,n,t,a){return new(t||(t=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,s)}l((a=a.apply(e,n||[])).next())}))}function ks(e,n){var t,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=n.call(e,r)}catch(e){o=[6,e],a=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Ls,Ds=function(e,n){void 0===n&&(n=[]);var t=n.join(","),a=new Blob(["("+e+")("+t+");"],{type:"application/javascript; charset=utf-8"});return window.URL.createObjectURL(a)};!function(e){e.IE="IE",e.Safari="Safari",e.Chrome="Chrome",e.Edge="Edge",e.Firefox="Firefox",e.Yandex="Yandex",e.Opera="Opera",e.Sferum="Sferum"}(Ls||(Ls={}));var js,Rs,Bs,Us,Hs,Gs,Vs,Fs=(js=navigator.appVersion,Rs=navigator.appName,Bs=navigator.userAgent,Us=[],function(){return Us.length?Us:Us=function(){var e,n=!1,t=0,a=Bs.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1]))return e=/\brv[ :]+(\d+)/g.exec(Bs),[Ls.IE,e&&e[1]||"Unknown",n,t];if("Safari"===a[1]){if(e=Bs.match(/\bEdge\/(\d+)/))return[Ls.Edge,e[1]||"Unknown",n,t];if(e=Bs.match(/\bCriOS\/(\d+)/))return[Ls.Chrome,e[1],!0,+e[1]];if(e=Bs.match(/\bFxiOS\/(\d+)/))return[Ls.Firefox,e[1],!1,t];if(e=Bs.match(/\bYaBrowser\/(\d+)/))return[Ls.Yandex,e[1],!1,t];if(e=Bs.match(/\bOPT\/(\d+)/))return[Ls.Opera,e[1],!1,t]}if(a[1]===Ls.Chrome){if(n=!0,t=Number(a[2]),e=Bs.match(/\bOPR\/(\d+)/))return[Ls.Opera,e[1]||"Unknown",n,t];if(e=Bs.match(/\bYaBrowser\/(\d+)/))return[Ls.Yandex,e[1]||"Unknown",n,t];if(e=Bs.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return[Ls.Sferum,e[1]||"Unknown",n,t];if(e=Bs.match(/\bEdge?\/(\d+)/))return[Ls.Edge,e[1]||"Unknown",n,t];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return[Ls.Opera,"Hidden",n,t]}return e=Bs.match(/version\/(\d+)/i),[a[2]?a[1]:Rs,e&&e[1]||a[2]||js,n,t]}()}),Ws=function(e){return Ps(void 0,void 0,void 0,(function(){return ks(this,(function(n){return[2,new Promise((function(n,t){var a=document.createElement("img");a.crossOrigin="anonymous",a.onerror=function(e){t("Failed image loading: "+e)},a.onload=function(){return n(a)},a.src=e}))]}))}))},Zs=function(){function e(){this._backgroundCanvas=document.createElement("canvas")}return e.prototype.resize=function(e,n,t,a){var i,o,r=(void 0===a?{}:a).ctxOptions,s=(o={width:0,height:0},"number"==typeof(i=e).width&&"number"==typeof i.height&&(o.height=i.height,o.width=i.width),o),l=s.height,c=s.width,d=this._backgroundCanvas,u=d.getContext("2d",r);if(!u)throw new Error("ctx did not initialized");d.width=n,d.height=t;var _=Math.max(d.width/c,d.height/l),v=d.width/2-c/2*_,p=d.height/2-l/2*_;return u.drawImage(e,v,p,c*_,l*_),d},e}(),zs=(Hs=function(e,n){e.exports=function(e){var n,t,a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,a){n=e,t=a}));var o,r={};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var s="./this.program",l=function(e,n){throw n},c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),void 0!==a&&a&&(c=a),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var d,u=i.print||console.log.bind(console),_=i.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);r=null,i.arguments,i.thisProgram&&(s=i.thisProgram),i.quit&&(l=i.quit),i.wasmBinary&&(d=i.wasmBinary);var v,p=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&P("no native wasm support detected");var f,h,A,g,m,C=!1,E="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function S(e,n,t){for(var a=n+t,i=n;e[i]&&!(i>=a);)++i;if(i-n>16&&e.subarray&&E)return E.decode(e.subarray(n,i));for(var o="";n<i;){var r=e[n++];if(128&r){var s=63&e[n++];if(192!=(224&r)){var l=63&e[n++];if((r=224==(240&r)?(15&r)<<12|s<<6|l:(7&r)<<18|s<<12|l<<6|63&e[n++])<65536)o+=String.fromCharCode(r);else{var c=r-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&r)<<6|s)}else o+=String.fromCharCode(r)}return o}function I(e){f=e,i.HEAP8=h=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=g=new Int32Array(e),i.HEAPU8=A=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var T,N,x,y=[],b=[],O=[],w=0,M=null;function P(e){i.onAbort&&i.onAbort(e),_(e+=""),C=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var n=new WebAssembly.RuntimeError(e);throw t(n),n}function k(e){return e.startsWith("data:application/octet-stream;base64,")}function L(e){try{if(e==T&&d)return new Uint8Array(d);throw"both async and sync fetching of the wasm failed"}catch(e){P(e)}}function D(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var t=n.func;"number"==typeof t?void 0===n.arg?m.get(t)():m.get(t)(n.arg):t(void 0===n.arg?null:n.arg)}else n(i)}}function j(e){try{return v.grow(e-f.byteLength+65535>>>16),I(v.buffer),1}catch(e){}}i.preloadedImages={},i.preloadedAudios={},k(T="https://st.mycdn.me/static/callseffects/0-0-3/tflite-simd.wasm")||(N=T,T=i.locateFile?i.locateFile(N,c):c+N),x=function(){return performance.now()};var R={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var n in R)void 0===R[n]?delete e[n]:e[n]=R[n];var t=[];for(var n in e)t.push(n+"="+e[n]);B.strings=t}return B.strings}var U={mappings:{},buffers:[null,[],[]],printChar:function(e,n){var t=U.buffers[e];0===n||10===n?((1===e?u:_)(S(t,0)),t.length=0):t.push(n)},varargs:void 0,get:function(){return U.varargs+=4,g[U.varargs-4>>2]},getStr:function(e){var n=function(e,n){return e?S(A,e,void 0):""}(e);return n},get64:function(e,n){return e}},H={a:function(){P()},m:function(e,n){var t;if(0===e)t=Date.now();else{if(1!==e&&4!==e)return 28,g[V()>>2]=28,-1;t=x()}return g[n>>2]=t/1e3|0,g[n+4>>2]=t%1e3*1e3*1e3|0,0},i:function(e,n){P("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},c:function(e,n){P("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},g:function(){return 2147483648},k:function(e,n,t){A.copyWithin(e,n,n+t)},l:function(e){var n,t=A.length,a=2147483648;if((e>>>=0)>a)return!1;for(var i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),j(Math.min(a,((n=Math.max(e,o))%65536>0&&(n+=65536-n%65536),n))))return!0}return!1},d:function(e){for(var n=x();x()-n<e;);},e:function(e,n){var t=0;return B().forEach((function(a,i){var o=n+t;g[e+4*i>>2]=o,function(e,n,t){for(var a=0;a<e.length;++a)h[n++>>0]=e.charCodeAt(a);h[n>>0]=0}(a,o),t+=a.length+1})),0},f:function(e,n){var t=B();g[e>>2]=t.length;var a=0;return t.forEach((function(e){a+=e.length+1})),g[n>>2]=a,0},o:function(e){!function(e,n){var t;t=e,p||(i.onExit&&i.onExit(t),C=!0),l(t,new F(t))}(e)},h:function(e){return 0},j:function(e,n,t,a,i){},b:function(e,n,t,a){for(var i=0,o=0;o<t;o++){for(var r=g[n+8*o>>2],s=g[n+(8*o+4)>>2],l=0;l<s;l++)U.printChar(e,A[r+l]);i+=s}return g[a>>2]=i,0},n:function e(n,t){e.randomDevice||(e.randomDevice=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){P("randomDevice")}}());for(var a=0;a<t;a++)h[n+a>>0]=e.randomDevice();return 0}};!function(){var e={a:H};function n(e,n){var t,a=e.exports;i.asm=a,I((v=i.asm.p).buffer),m=i.asm.A,t=i.asm.q,b.unshift(t),function(e){if(w--,i.monitorRunDependencies&&i.monitorRunDependencies(w),0==w&&M){var n=M;M=null,n()}}()}function a(e){n(e.instance)}function o(n){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return L(T)})):fetch(T,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+T+"'";return e.arrayBuffer()})).catch((function(){return L(T)}))).then((function(n){return WebAssembly.instantiate(n,e)})).then((function(e){return e})).then(n,(function(e){_("failed to asynchronously prepare wasm: "+e),P(e)}))}if(w++,i.monitorRunDependencies&&i.monitorRunDependencies(w),i.instantiateWasm)try{return i.instantiateWasm(e,n)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(d||"function"!=typeof WebAssembly.instantiateStreaming||k(T)||"function"!=typeof fetch?o(a):fetch(T,{credentials:"same-origin"}).then((function(n){return WebAssembly.instantiateStreaming(n,e).then(a,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),o(a)}))}))).catch(t)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.q).apply(null,arguments)},i._setNumThreads=function(){return(i._setNumThreads=i.asm.r).apply(null,arguments)},i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.u).apply(null,arguments)},i._getInputDim=function(){return(i._getInputDim=i.asm.v).apply(null,arguments)},i._getOutputDim=function(){return(i._getOutputDim=i.asm.w).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.x).apply(null,arguments)},i._updateRecurrentState=function(){return(i._updateRecurrentState=i.asm.y).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.z).apply(null,arguments)};var G,V=i.___errno_location=function(){return(V=i.___errno_location=i.asm.B).apply(null,arguments)};function F(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function W(e){function t(){G||(G=!0,i.calledRun=!0,C||(D(b),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),O.unshift(e);var e;D(O)}()))}w>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),y.unshift(e);var e;D(y)}(),w>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(M=function e(){G||W(),G||(M=e)},i.run=W,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return W(),e.ready}},Hs(Gs={exports:{}}),Gs.exports),Ks="https://st.mycdn.me/static/callseffects",Qs=Ks+"/0-0-3",Ys=Ks+"/0-0-5",Js=Ks+"/0-0-6",Xs=Ks+"/0-0-8",qs=Ks+"/0-0-9",$s={segmentation:{models:{"192x256":Qs+"/segmentation-model.tflite"},wasm:{tfliteSimd:Qs+"/tflite-simd.wasm"}},backgrounds:[{id:3012,preview:Ys+"/3012-preview.png",original:Ys+"/3012-original.jpg",description:"elephant in the white room",tags:["default"]},{id:3013,preview:Ys+"/3013-preview.png",original:Ys+"/3013-original.jpg",description:"old native stove in russian historic house",tags:["default"]},{id:3014,preview:Ys+"/3014-preview.png",original:Ys+"/3014-original.jpg",description:"flying baloons surrounded by mountains",tags:["default"]},{id:3015,preview:Ys+"/3015-preview.png",original:Ys+"/3015-original.jpg",description:"two pilots driving a plate",tags:["default"]},{id:3016,preview:Ys+"/3016-preview.png",original:Ys+"/3016-original.jpg",description:"sauna",tags:["default"]},{id:3017,preview:Ys+"/3017-preview.png",original:Ys+"/3017-original.jpg",description:"red chairs in movie theater",tags:["default"]},{id:3018,preview:Ys+"/3018-preview.png",original:Ys+"/3018-original.jpg",description:"sleeping person in train cart",tags:["default"]},{id:3019,preview:Ys+"/3019-preview.jpg",original:Ys+"/3019-original.jpg",description:"Little Big icons on pink background",tags:["star"]},{id:3020,preview:Ys+"/3020-preview.jpg",original:Ys+"/3020-original.jpg",description:"Violet wild mint (2 colors split background)",tags:["star"]},{id:3021,preview:Ys+"/3021-preview.jpg",original:Ys+"/3021-original.jpg",description:"Klava Koka left the chat and in love with MDK",tags:["star"]},{id:3022,preview:Ys+"/3022-preview.jpg",original:Ys+"/3022-original.jpg",description:"Some half-naked dude with rifle",tags:["star"]},{id:3023,preview:Ys+"/3023-preview.jpg",original:Ys+"/3023-original.jpg",description:'"Cirle" photo collage',tags:["star"]},{id:3024,preview:Ys+"/3024-preview.jpg",original:Ys+"/3024-original.jpg",description:"Gazgolder & red carpet on the wall",tags:["star"]},{id:3025,preview:Ys+"/3025-preview.jpg",original:Ys+"/3025-original.jpg",description:"Gazgolder & VK Clips collab pink-yellow-blue collage",tags:["star"]},{id:3026,preview:Ys+"/3026-preview.jpg",original:Ys+"/3026-original.jpg",description:"Crem Soda people collage",tags:["star"]},{id:3027,preview:Ys+"/3027-preview.jpg",original:Ys+"/3027-original.jpg",description:"Dmitry Glukhovsky collage",tags:["star"]},{id:3028,preview:Js+"/3028-preview.jpeg",original:Js+"/3028-original.jpeg",description:"Dogs in space",tags:["cosmonautics-day-2022"]},{id:3029,preview:Xs+"/3029-preview.jpg",original:Xs+"/3029-original.jpg",description:"Blackboard with e=mc2 formulas",tags:["teachers-day-2022"]},{id:3030,preview:qs+"/3030-preview.jpg",original:qs+"/3030-original.jpg",description:"vk 2022 birthday",tags:["vk-2022-birthday"]}],icons:{starBackground:{id:"icon-star-background",description:"Icon for indicating that virtual background is from stars",url:Ys+"/icon-star-background.svg",type:"svg"}}},el=function(){function e(){}return e.workerFn=function(e){console.log("here goes the worker...");var n=null,t=!1,a={"192x256":[192,256]},i={processSizeKey:"192x256",inputMemoryOffset:0,outputMemoryOffset:0,maskArray:null,numThreads:2},o=function(){c.call(null,"log",Array.from(arguments))},r=function(){c.call(null,"warn",Array.from(arguments))};function s(s,c,d){return void 0===c&&(c={}),void 0===d&&(d=!1),t=d,o("[createModel]",s,c,{debugFlag:d}),e().then((function(e){return function(e,n){return o("[loadModel][modelPath]",e,n),fetch(n).then((function(e){return e.arrayBuffer()})).then((function(n){o("Model buffer size:",n.byteLength);var t=i.numThreads,a=e._getModelBufferMemoryOffset();return o("Model buffer memory offset:",a),o("Loading model buffer..."),e.HEAPU8.set(new Uint8Array(n),a),o("_loadModel result:",e._loadModel(n.byteLength,t)),{inputMemoryOffset:e._getInputMemoryOffset(0)/4,outputMemoryOffset:e._getOutputMemoryOffset(0)/4}}))}(e,s).then((function(t){return n=e,t}))})).then((function(e){var n=c.processSizeKey||i.processSizeKey,t=a[n],o=t[0],r=t[1],s=new Float32Array(o*r);l(Object.assign({maskArray:s},e,c))})).catch((function(e){n=null,r("simd error",e),self.postMessage({type:"error",error:e})}))}function l(e){Object.assign(i,e),o("settings updated",i)}function c(e,n){if(void 0===e&&(e="log"),"function"==typeof console[e]&&t){var a=["[segmentation-worker]"].concat(n);console[e].apply(null,a)}}self.onmessage=function(e){try{switch(e.data.type){case"create":s(e.data.modelPath,e.data.settings,e.data.debug).then((function(){self.postMessage({type:"ready"})}));break;case"frame":var t=function(e){var t=i.maskArray,o=i.inputMemoryOffset,s=i.outputMemoryOffset,l=a[i.processSizeKey],c=l[0],d=l[1];if(n){if(t){for(var u=0,_=0;u<c*d;u++,_+=4)n.HEAPF32[o+_]=e.data[_]/255,n.HEAPF32[o+_+1]=e.data[_+1]/255,n.HEAPF32[o+_+2]=e.data[_+2]/255,n.HEAPF32[o+_+3]=t[u];n._runInference(),n._updateRecurrentState(1,1);var v=new ImageData(d,c);for(u=0,_=0;u<c*d;u++,_+=4)t[u]=n.HEAPF32[s+u],v.data[_+3]=255*t[u];return v}r("no maskArray created")}else r("no tfliteSIMD instance!")}(e.data.imageData);t&&self.postMessage({type:"frame",segmentationMask:t,resizedImage:e.data.imageData},[t.data.buffer,e.data.imageData.data.buffer]);break;case"params":l(e.data.params);break;default:r("unhandled event",e.data)}}catch(e){r("onmessage error",e),self.postMessage({type:"error",error:e})}}},e}(),nl=function(){function e(e){var n=this,t=e.onFrame,a=e.onReady,i=e.onError;this._settings={modelKey:"192x256",processSizeKey:"192x256"},this._processSize={"192x256":[192,256]},this._worker=null,this._worker=new Worker(Ds(el.workerFn,[zs,JSON.stringify({})])),this._worker.onmessage=function(e){switch(e.data.type){case"ready":a(n);break;case"frame":t({image:n._canvasImageBackup,resizedImage:e.data.resizedImage,segmentationMask:e.data.segmentationMask});break;case"error":null==i||i(e.data);break;default:console.warn("unhandled event type",e.data)}},this._canvas=document.createElement("canvas"),this._canvasImageBackup=document.createElement("canvas");var o=this._canvas.getContext("2d"),r=this._canvasImageBackup.getContext("2d");if(!o||!r)throw new Error("can't get ctx for canvas");this._ctx=o,this._ctxImageBackup=r}return e.prototype.createModel=function(e){var n,t=this._settings,a=$s.segmentation.models[t.modelKey];null===(n=this._worker)||void 0===n||n.postMessage({type:"create",modelPath:a,settings:t,debug:e})},e.prototype.setParams=function(e){var n=this._worker,t=this._settings;Object.assign(t,e),null==n||n.postMessage({type:"params",params:t})},e.prototype.requestSegmentation=function(e){var n=this,t=n._settings,a=n._canvas,i=n._ctx,o=n._worker,r=n._processSize[t.processSizeKey],s=r[0],l=r[1];this._saveImage(e),a.width=l,a.height=s,i.drawImage(e,0,0,l,s);var c=i.getImageData(0,0,l,s);null==o||o.postMessage({type:"frame",imageData:c},[c.data.buffer])},e.prototype._saveImage=function(e){var n=this._ctxImageBackup,t=this._canvasImageBackup,a=function(e){var n={height:0,width:0};return"number"==typeof e.height?n.height=e.height:n.height=e.height.baseVal.value,"number"==typeof e.width?n.width=e.width:n.width=e.width.baseVal.value,n}(e),i=a.height,o=a.width;t.height=i,t.width=o,n.clearRect(0,0,o,i),n.drawImage(e,0,0,o,i)},e.prototype.destroy=function(){this._worker&&(this._worker.terminate(),this._worker=null)},e}(),tl=function(){function e(){}return e.updateSegmentationParams=function(n){Object.assign(e._params.segmentation,n)},e.getSegmentationParams=function(){return e._params.segmentation},e.setDebug=function(n){e._params.debug=n},e.getDebug=function(){return!!e._params.debug},e._params={segmentation:{processSizeKey:"192x256",modelKey:"192x256"}},e}(),al=function(){function e(){this._timeouts=new Map,this._throttles=new Map,this._worker=new Worker(Ds(e.workerFn))}return e.prototype.initWorker=function(e){var n=void 0===e?{}:e,t=n.onError,a=n.onTimeout,i=n.onThrottle,o=n.onReady;return Ps(this,void 0,void 0,(function(){var e=this;return ks(this,(function(n){return[2,new Promise((function(n,r){e._worker.addEventListener("message",(function(s){switch(s.data.type){case"timeout":e._callTimeout(s.data.id),null==a||a(s.data);break;case"throttle":e._callThrottle(s.data.id),null==i||i(s.data);break;case"error":null==t||t(s.data),r(s.data);break;case"ready":null==o||o(s.data),n()}})),e._worker.addEventListener("error",(function(e){null==t||t(e),r(e)})),e._worker.postMessage({type:"ready"})}))]}))}))},e.workerFn=function(){var e=new Map,n=new Map;self.onmessage=function(t){switch(t.data.type){case"timeout":!function(n,t){void 0===t&&(t=5);var a=setTimeout((function(){self.postMessage({type:"timeout",id:n}),e.delete(n)}),t);e.set(n,a)}(t.data.id,t.data.ms);break;case"throttle":!function(e,t){void 0===t&&(t=5);var a=n.get(e);a&&clearTimeout(a);var i=setTimeout((function(){self.postMessage({type:"throttle",id:e}),n.delete(e)}),t);n.set(e,i)}(t.data.id,t.data.ms);break;case"ready":self.postMessage({type:"ready"});break;default:self.postMessage({type:"error",data:t.data})}},self.postMessage({type:"ready"})},e.prototype.postTimeout=function(e,n,t){void 0===t&&(t=5),this._timeouts.set(e,n),this._worker.postMessage({type:"timeout",id:e,ms:t})},e.prototype.postThrottle=function(e,n,t){void 0===t&&(t=5),this._throttles.set(e,n),this._worker.postMessage({type:"throttle",id:e,ms:t})},e.prototype._callTimeout=function(e){var n=this._timeouts.get(e);n&&(this._timeouts.delete(e),n())},e.prototype._callThrottle=function(e){var n=this._throttles.get(e);n&&(this._throttles.delete(e),n())},e.prototype.destroy=function(){this._worker.terminate(),this._throttles.clear(),this._timeouts.clear()},e}();!function(e){e.NONE="none",e.BLUR="blur",e.BACKGROUND="background"}(Vs||(Vs={}));var il=function(){function e(e){var n=void 0===e?{}:e,t=n.segmentation,a=n.debug;this._effect=null,this._net=null,this._video=null,this._canvas=null,this._stream=null,this._track=null,this._sendNextFrame=null,this._timerWorker=null,t&&tl.updateSegmentationParams(t),a&&tl.setDebug(a)}return e.prototype._createDom=function(e){var n=function(e){var n,t,a=e.defaults,i=e.track,o=i.getSettings(),r=i.getConstraints(),s=a;return t=["width","height"],"object"==typeof(n=o)&&(Array.isArray(t)?t.every((function(e){return e in n})):t in n)||!function(e){return"object"==typeof e?Array.isArray(e)?!e.length:!Object.keys(e).length:"string"==typeof e?!e.length:!e}(r)?(o.height?s.height=o.height:"number"==typeof r.height?s.height=r.height:"object"==typeof r.height&&(s.height=r.height.exact||r.height.ideal||r.height.max||r.height.min||s.height),o.width?s.width=o.width:"number"==typeof r.width?s.width=r.width:"object"==typeof r.width&&(s.width=r.width.exact||r.width.ideal||r.width.max||r.width.min||s.width),s):s}({track:e,defaults:{height:360,width:640}}),t=n.width,a=n.height;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.height=a,this._canvas.width=t,this._canvas.style.bottom="0",this._canvas.style.left="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas)),this._video||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.height=a,this._video.width=t,this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},e.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvas=null,this._video=null},e.prototype._createStream=function(e){return Ps(this,void 0,void 0,(function(){var n=this;return ks(this,(function(t){if(!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._stream=this._canvas.captureStream(0),[2,new Promise((function(t,a){var i=n._video;i.srcObject=new MediaStream([e]),i.onloadeddata=function(){var e;i.width=i.videoWidth,i.height=i.videoHeight,n._track=null===(e=n._stream)||void 0===e?void 0:e.getVideoTracks()[0],t()},i.onerror=function(){return a(new Error("Video element error"))};var o=i.play(),r=function(){return a(new Error("Autoplay is disabled"))};o?o.catch(r):r()}))]}))}))},e.prototype._createNet=function(){return Ps(this,void 0,void 0,(function(){var e=this;return ks(this,(function(n){return[2,new Promise((function(n,t){var a=tl.getDebug()?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.warn.apply(console,e),t()}:void 0;new nl({onFrame:function(n){e._drawFrame(n)},onReady:n,onError:a}).createModel(tl.getDebug())}))]}))}))},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),this._video.srcObject=null)},e.prototype._drawFrame=function(e){var n,t=this;this._net&&this._video&&this._effect&&this._canvas&&this._video&&this._effect&&(this._effect.draw(e),this._track&&(this._track.requestFrame(),null===(n=this._timerWorker)||void 0===n||n.postTimeout(Date.now(),(function(){t._video&&t._sendNextFrame&&t._sendNextFrame(t._video)}))))},e.prototype._cleanup=function(e){var n=void 0===e?{}:e,t=n.removeWorkerNet,a=n.removeWorkerTimer;this._effect&&(this._effect.destroy(),this._effect=null),this._removeStream(),this._removeDom(),t&&this._net&&(this._net.destroy(),this._net=null),a&&this._timerWorker&&(this._timerWorker.destroy(),this._timerWorker=null)},e.prototype._setEffect=function(e,n){return Ps(this,void 0,void 0,(function(){var t,a=this;return ks(this,(function(i){switch(i.label){case 0:return this._timerWorker?[3,2]:(this._timerWorker=new al,[4,this._timerWorker.initWorker()]);case 1:i.sent(),i.label=2;case 2:return this._net?[3,4]:(t=this,[4,this._createNet()]);case 3:t._net=i.sent(),i.label=4;case 4:return this._effect&&(this._effect=null),this._sendNextFrame=function(e){var n;null===(n=a._timerWorker)||void 0===n||n.postThrottle("img-segm",(function(){var n;null===(n=a._net)||void 0===n||n.requestSegmentation(e)}),1e3/60)},this._removeStream(),this._createDom(n),[4,this._createStream(n)];case 5:if(i.sent(),!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._effect=e,this._effect.video=this._video,this._effect.canvas=this._canvas,this._sendNextFrame(this._video),[2]}}))}))},e.prototype.setEffect=function(e,n){var t;return Ps(this,void 0,void 0,(function(){var a;return ks(this,(function(i){switch(i.label){case 0:if(!e)return this._cleanup(),[2,n];e.effect!==(null===(t=this._effect)||void 0===t?void 0:t.effect)&&e.destroy(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._setEffect(e,n)];case 2:return i.sent(),[2,this._track||n];case 3:throw a=i.sent(),this._cleanup(),a;case 4:return[2]}}))}))},e.prototype.stopEffect=function(){this._cleanup()},Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect?this._effect.effect:Vs.NONE},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._cleanup({removeWorkerNet:!0,removeWorkerTimer:!0})},e}(),ol=function(e){var n=e.gl,t=e.fs,a=e.vs,i=n.createShader(n.VERTEX_SHADER);if(!i)throw new Error("vertex shader didn't initialized");n.shaderSource(i,a),n.compileShader(i);var o=n.createShader(n.FRAGMENT_SHADER);if(!o)throw new Error("fragment shader didn't initialized");n.shaderSource(o,t),n.compileShader(o);var r=n.createProgram();if(!r)throw new Error("shader program didn't initialized");if(n.attachShader(r,i),n.attachShader(r,o),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r);return n.deleteShader(i),n.deleteShader(o),{program:r}},rl=function(e){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),n},sl=function(e,n,t){var a=rl(e);if(!a)throw new Error("texture was not created");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null);var i=e.createFramebuffer();if(!i)throw new Error("framebuffer was not created");return e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),{framebuffer:i,texture:a}},ll=function(e,n,t,a){e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,a,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},cl=function(e,n){e.bindFramebuffer(e.FRAMEBUFFER,n),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null)},dl=function(e,n){return{aTextureCoord:e.getAttribLocation(n,"aTextureCoord"),aVertexCoord:e.getAttribLocation(n,"aVertexCoord")}},ul="attribute vec3 aVertexCoord;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexCoord, 1.0);\n  vTextureCoord = aTextureCoord;\n}",_l=function(){function e(e){var n=this;this.gl=e,this.program=ol({fs:"precision highp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uAlphaTexture;\nuniform float uLowerBound;\nuniform float uUpperBound;\n\nvoid main(void) {\n  vec4 color = texture2D(uAlphaTexture, vTextureCoord);\n  if (color.a < uLowerBound) {\n    color.a = 0.0;\n  } else {\n    if (color.a < uUpperBound) {\n      color.a = (color.a - uLowerBound) / (uUpperBound - uLowerBound);\n    } else {\n      color.a = 1.0;\n    }\n  }\n  gl_FragColor = color;\n}",gl:e,vs:ul}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uLowerBound:function(e){var t=n.gl.getUniformLocation(n.program,"uLowerBound");n.gl.uniform1f(t,e)},uUpperBound:function(e){var t=n.gl.getUniformLocation(n.program,"uUpperBound");n.gl.uniform1f(t,e)}},this.attributes=dl(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),vl=function(){function e(e){var n=this;this.gl=e,this.program=ol({fs:"precision highp float;\n\nuniform sampler2D uCameraFrameTexture;\nuniform sampler2D uBackgroundTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  vec4 cameraFrameColor = texture2D(uCameraFrameTexture, vTextureCoord);\n  vec4 backgroundColor = texture2D(uBackgroundTexture, vTextureCoord);\n  vec4 alphaMask = texture2D(uAlphaTexture, vTextureCoord);\n  gl_FragColor = mix(backgroundColor, cameraFrameColor, alphaMask.a);\n}",gl:e,vs:ul}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uCameraFrameTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uCameraFrameTexture");n.gl.uniform1i(t,e)},uBackgroundTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uBackgroundTexture");n.gl.uniform1i(t,e)}},this.attributes=dl(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),pl=function(){function e(e){var n=this;this.gl=e,this.program=ol({fs:"// https://github.com/Jam3/glsl-fast-gaussian-blur\n\nprecision highp float;\n\nuniform sampler2D texture;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color;\n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor = blur13(texture, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={texture:function(e){var t=n.gl.getUniformLocation(n.program,"texture");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),fl=function(){function e(e){var n=this;this.gl=e,this.program=ol({fs:"precision highp float;\n\nuniform sampler2D uTextureOriginal;\nuniform sampler2D uTextureMask;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur13(sampler2D image, sampler2D maskTexture, vec2 uv, vec2 resolution,\n            vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  float sumCof = 0.0;\n\n  vec4 c = texture2D(image, uv);\n  vec4 m = texture2D(maskTexture, uv);\n  color += c * 0.1964825501511404 * (1.0 - m.a);\n  sumCof += 0.1964825501511404 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off1 / resolution));\n  m = texture2D(maskTexture, uv + (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off1 / resolution));\n  m = texture2D(maskTexture, uv - (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off2 / resolution));\n  m = texture2D(maskTexture, uv + (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off2 / resolution));\n  m = texture2D(maskTexture, uv - (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off3 / resolution));\n  m = texture2D(maskTexture, uv + (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off3 / resolution));\n  m = texture2D(maskTexture, uv - (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  return sumCof > 0.0 ? color / sumCof : vec4(0.0, 0.0, 0.0, 0.0);\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor =\n      blur13(uTextureOriginal, uTextureMask, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={uTextureOriginal:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureOriginal");n.gl.uniform1i(t,e)},uTextureMask:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureMask");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),hl=function(){function e(e){this.textures={background:null,image:null,resizedImage:null,segmentationMask:null},this.parameters={blurStrength:.8,fixSegmentation:!0,fixSegmentationBlurStrength:.25,fixSegmentationIterations:8,alphaCutterLowerBound:.4,alphaCutterUpperBound:.6},this.$canvas=e;var n=this.$canvas.getContext("webgl");if(!n)throw new Error("getting ctx failed");this.gl=n;var t=this.gl;this.onresize=this.onresize.bind(this),this.onresize(),this.pBlurFastWithMask=new fl(this.gl),this.pBackgroundComposer=new vl(this.gl),this.pBlurFast=new pl(this.gl),this.pAlphaCutter=new _l(this.gl),this.vertices=[1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0,-1,1,0,0,1],this.indices=[0,1,3,1,2,3];var a=t.createBuffer(),i=t.createBuffer();if(!a||!i)throw new Error("create buffer error");this.positionBuffer=a,this.indexBuffer=i,t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.fbs={blur:this.createTextureLayers(),segmentationFix:this.createTextureLayers()},this.textures={background:rl(t),image:rl(t),resizedImage:rl(t),segmentationMask:rl(t)},window.addEventListener("resize",this.onresize)}return e.prototype.onresize=function(){var e=this,n=e.$canvas,t=e.gl,a=e.fbs,i=n.width||n.clientWidth,o=n.height||n.clientHeight;n.width=i,n.height=o,t.viewport(0,0,i,o),a&&function(e,n){for(var t=n.height,a=n.width,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];i.forEach((function(n){n.forEach((function(n){cl(e,n.framebuffer),ll(e,n.texture,a,t)}))}))}(t,{width:i,height:o},a.blur,a.segmentationFix)},e.prototype.loadTextures=function(e){var n=e.image,t=e.resizedImage,a=e.segmentationMask,i=e.background,o=this.gl,r=this.textures;return o.bindTexture(o.TEXTURE_2D,r.image),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),i||(o.bindTexture(o.TEXTURE_2D,r.resizedImage),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),o.bindTexture(o.TEXTURE_2D,r.segmentationMask),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),i&&(o.bindTexture(o.TEXTURE_2D,r.background),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i)),o.bindTexture(o.TEXTURE_2D,null),r},e.prototype.close=function(){var e=this,n=e.gl,t=e.positionBuffer,a=e.indexBuffer,i=e.pBackgroundComposer,o=e.pBlurFast,r=e.pBlurFastWithMask,s=e.pAlphaCutter,l=e.fbs,c=e.textures;window.removeEventListener("resize",this.onresize),n.bindBuffer(n.ARRAY_BUFFER,null),n.deleteBuffer(t),n.deleteBuffer(a),n.useProgram(null),i.destroy(),o.destroy(),r.destroy(),s.destroy(),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){n.forEach((function(n){e.deleteFramebuffer(n.framebuffer),e.deleteTexture(n.texture)}))}))}(n,l.blur,l.segmentationFix),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){return e.deleteTexture(n)}))}(n,c.background,c.image,c.resizedImage,c.segmentationMask)},e.prototype.drawGeometry=function(){var e=this,n=e.gl,t=e.indexBuffer,a=e.indices;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.drawElements(n.TRIANGLES,a.length,n.UNSIGNED_SHORT,0)},e.prototype.createTextureLayers=function(){var e=this.gl,n=this.$canvas,t=n.width,a=n.height;return[sl(e,t,a),sl(e,t,a)]},e.prototype.setGeometry=function(e,n){var t=this.gl,a=this.positionBuffer;t.bindBuffer(t.ARRAY_BUFFER,a),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,3,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),void 0!==n&&(t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT))},e.prototype.setParameters=function(e){Object.assign(this.parameters,e)},e.prototype.draw=function(e){var n,t,a=this,i=a.gl,o=a.$canvas,r=a.parameters,s=a.pBlurFastWithMask,l=a.pBackgroundComposer,c=a.pBlurFast,d=a.pAlphaCutter,u=a.fbs,_=r.fixSegmentation,v=r.fixSegmentationBlurStrength,p=r.blurStrength,f=r.fixSegmentationIterations,h=r.alphaCutterLowerBound,A=r.alphaCutterUpperBound,g=o.width,m=o.height;i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.viewport(0,0,g,m),i.disable(i.BLEND),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var C=this.loadTextures(e),E=null,S=e.background?C.background:null;if(_){c.bind(),this.setGeometry(c.attributes.position),c.uniforms.iResolution(g,m,0),c.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,C.segmentationMask),c.uniforms.texture(0);for(var I=0,T=0;T<f;++T){var N=(f-T-1)*v,x=T%2==0?[N,0]:[0,N];(n=c.uniforms).direction.apply(n,x),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[I%2].framebuffer),this.drawGeometry(),i.bindTexture(i.TEXTURE_2D,u.segmentationFix[I%2].texture),++I}d.bind(),this.setGeometry(d.attributes.aVertexCoord,d.attributes.aTextureCoord),d.uniforms.uLowerBound(h),d.uniforms.uUpperBound(A),d.uniforms.uAlphaTexture(0),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[I%2].framebuffer),this.drawGeometry(),E=u.segmentationFix[I%2].texture}if(!S){s.bind(),this.setGeometry(s.attributes.position),s.uniforms.iResolution(g,m,0),s.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),s.uniforms.uTextureMask(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,C.resizedImage),s.uniforms.uTextureOriginal(1);var y=0;for(T=0;T<8;++T)N=(8-T-1)*p,x=T%2==0?[N,0]:[0,N],(t=s.uniforms).direction.apply(t,x),i.bindFramebuffer(i.FRAMEBUFFER,u.blur[y%2].framebuffer),this.drawGeometry(),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,u.blur[y%2].texture),++y;S=u.blur[(y-1)%2].texture}l.bind(),this.setGeometry(l.attributes.aVertexCoord,l.attributes.aTextureCoord),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),l.uniforms.uAlphaTexture(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,S),l.uniforms.uBackgroundTexture(1),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,C.image),l.uniforms.uCameraFrameTexture(2),i.bindFramebuffer(i.FRAMEBUFFER,null),this.drawGeometry()},e}(),Al=function(){function e(e){this._effect=e}return Object.defineProperty(e.prototype,"video",{set:function(e){this._video=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e}(),gl=function(e){function n(){var n=e.call(this,Vs.BACKGROUND)||this;return n._imageEdit=new Zs,n._WebGlBlend=null,n}return Ms(n,e),n.prototype.setBackgroundImage=function(e){return Ps(this,void 0,void 0,(function(){var n,t;return ks(this,(function(a){switch(a.label){case 0:return n=this,e?[4,Ws(e)]:[3,2];case 1:return t=a.sent(),[3,3];case 2:t=void 0,a.label=3;case 3:return n._nextBackgroundImage=t,[2]}}))}))},n.prototype._updateBackground=function(){try{if(this._nextBackgroundImage){var e=this._canvas,n=this._imageEdit,t=e.width,a=e.height;this._backgroundImage=n.resize(this._nextBackgroundImage,t,a),delete this._nextBackgroundImage}}catch(e){console.warn(e)}},n.prototype.draw=function(e){try{if(this._WebGlBlend||(this._WebGlBlend=new hl(this._canvas)),this._nextBackgroundImage&&this._updateBackground(),this._WebGlBlend){var n=Object.assign({background:this._backgroundImage},e);this._WebGlBlend.draw(n)}}catch(e){console.warn(e)}},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGlBlend&&(this._WebGlBlend.close(),this._WebGlBlend=null)},n}(Al),ml=function(e){function n(){var n=e.call(this,Vs.BLUR)||this;return n._WebGLEffects=null,n._savedOptions=null,n}return Ms(n,e),n.prototype.draw=function(e){try{this._WebGLEffects||(this._WebGLEffects=new hl(this._canvas),this._savedOptions&&this._WebGLEffects.setParameters(this._savedOptions)),this._WebGLEffects.draw(e)}catch(e){console.warn(e)}},n.prototype.setEffects=function(e){this._savedOptions=e,this._WebGLEffects&&this._WebGLEffects.setParameters(e)},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGLEffects&&(this._WebGLEffects.close(),this._WebGLEffects=null)},n}(Al),Cl=function(){function e(e){this.params=e}return e.prototype.getMappedParams=function(){return{id:this.params.id,originalUrl:this.params.original,previewUrl:this.params.preview,isPredefined:!0,tags:this.params.tags}},e}(),El=[{audio:!1,video:{frameRate:25,height:250,width:436}},{audio:!1,video:{frameRate:25}},{audio:!1,video:!0}],Sl=function(){var e,n,t=new Map;[3030,3029,3028,3019,3026,3027,3023,3024,3025,3020,3021,3022,3015,3013,3016,3012,3014,3017,3018].forEach((function(e){return t.set(e,null)}));try{for(var a=(0,i.__values)($s.backgrounds),o=a.next();!o.done;o=a.next()){var r=o.value;t.has(r.id)&&t.set(r.id,new Cl(r))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return(0,i.__spreadArray)([],(0,i.__read)(t.values()),!1).filter(Boolean)}(),Il=function(e){var n;return null===(n=e.sizes)||void 0===n?void 0:n.reduce((function(e,n){return e[n.type]=n.url,e}),{})},Tl=function(e){var n=Il(e);return(null==n?void 0:n.x)||(null==n?void 0:n.m)||(null==n?void 0:n.s)||""},Nl=function(e,n){if(n){var t=n.find((function(n){return n.id===e}));if(t)return Promise.resolve({id:t.id,url:t.originalUrl})}return(0,nn.photosGetAllImages)({photo_ids:""+e}).then((function(e){try{var n=e.items[0];return n?{id:n.id,url:Tl(n)}:null}catch(e){return null}}))},xl=t(71982),yl=function(e){var n=e.children,t=e.className,a=e.style,r=e.passedRef,c=(0,i.__rest)(e,["children","className","style","passedRef"]),d=(0,l.useCallback)((function(){}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)(t),style:a,ref:r},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__item--radio"},{children:(0,o.jsx)(xl.default,(0,i.__assign)({},c,{onChange:d}),void 0)}),void 0)]},void 0)},bl=(0,l.memo)((function(e){var n=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(yl,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--with-border")},{children:n("calls_virtual_background_settings_no_background")}),void 0)})),Ol=(0,l.memo)((function(e){return(0,o.jsx)(yl,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--blur")}),void 0)})),wl=t(45898),Ml=(0,l.memo)((function(){return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--add-image")},{children:(0,o.jsx)(wl.default,{},void 0)}),void 0)})),Pl=(0,l.forwardRef)((function(e,n){var t=(0,i.__rest)(e,[]);return(0,o.jsx)("div",(0,i.__assign)({},t,{ref:n,style:{width:18,height:18}},{children:(0,o.jsxs)("svg",(0,i.__assign)({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("rect",{width:"18",height:"18",rx:"2",fill:"black",fillOpacity:"0.4"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.10202 5L5 6.10202L7.89798 9L5 11.898L6.10202 13L9 10.102L11.898 13L13 11.898L10.102 9L13 6.10202L11.898 5L9.10108 7.7969L9 7.89798L6.10202 5Z",fill:"white",fillOpacity:"0.72"},void 0)]}),void 0)}),void 0)})),kl=t(54190),Ll=(0,l.memo)((function(e){var n=e.backgroundUrl,t=e.checked,a=e.onDelete,r=e.photoId,c=e.isPredefinedBackground,d=e.isStarBackground,u=(0,i.__rest)(e,["backgroundUrl","checked","onDelete","photoId","isPredefinedBackground","isStarBackground"]),_=(0,l.useContext)(E.LangContext).getLang,v=(0,l.useRef)(null),p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],h=p[1],A=(0,l.useMemo)((function(){return(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:_(t?"calls_cant_remove_background":"calls_delete_background")}},void 0)}),[t]),g=(0,l.useCallback)((function(e){e.stopPropagation(),t||a(r)}),[t,r]);return(0,l.useEffect)((function(){var e,t;return v.current&&(e=new IntersectionObserver((function(a){var o,r;try{for(var s=(0,i.__values)(a),l=s.next();!l.done;l=s.next()){l.value.isIntersecting&&(e.disconnect(),(t=new Image).src=n,t.onload=function(){h(!1),t.remove()})}}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}}),{threshold:0,root:null}),e.observe(v.current)),function(){t&&(t.onload=null,t.remove()),null==e||e.disconnect()}}),[]),(0,o.jsxs)(yl,(0,i.__assign)({},u,{checked:t,className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--background",{"VirtualBackgroundSettings__item--background-star":!f&&!!d}),passedRef:v,style:{backgroundImage:f?void 0:"url("+n+")"}},{children:[f&&(0,o.jsx)(kl.DivBlockSkeleton,{classNames:"VirtualBackgroundSettings__item--background__skeleton",height:80},void 0),!c&&!f&&(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item--background__deletebtn",{"VirtualBackgroundSettings__item--background__deletebtn--disabled":t}),onClick:g},{children:(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:A,className:"VirtualBackgroundSettings__item__popper",position:"t",align:"center"},{children:(0,o.jsx)(Pl,{},void 0)}),void 0)}),void 0)]}),void 0)})),Dl=function(){var e=(0,c.useSelector)((function(e){return e.me}));return{isAnonymous:(0,k.isParticipantAnonym)(e)}},jl=function(){function e(e){this.$c=e,this.gl=this.$c.getContext("webgl")}return e.prototype.draw=function(){var e=this.gl;null==e||e.clearColor(0,0,0,0),null==e||e.clear(e.COLOR_BUFFER_BIT)},e}(),Rl=function(e){var n=e.backgroundList,t=e.$srcElement,a=e.userStream,o=(0,l.useRef)(null),r=(0,l.useRef)(null),s=(0,l.useRef)(null),c=(0,l.useRef)(null);null===c.current&&(c.current=new Zs);var u=(0,l.useRef)(null),_=(0,l.useRef)(d.EVideoEffectType.NONE),v=(0,l.useRef)(d.EVideoEffectType.NONE),p=(0,l.useRef)(void 0),f=(0,l.useRef)(null),h=(0,l.useRef)(null),A=(0,l.useRef)(!1),g=(0,i.__read)((0,l.useState)(!1),2),m=g[0],C=g[1],E=(0,l.useCallback)((function(e){A.current="play"===e,C("play"===e)}),[]),S=(0,l.useCallback)((function(e,n){void 0===n&&(n=!1),v.current=e,n||(_.current=e)}),[]),I=(0,l.useCallback)((function(){if(f.current&&clearTimeout(f.current),A.current)if(t.current&&r.current)try{r.current.requestSegmentation(t.current)}catch(e){console.error("[useVideoEffects][onRequestSegmentation][error]",e)}else f.current=setTimeout((function(){I()}),300)}),[]),T=(0,l.useCallback)((function(e){var t,a,r;if(null===(t=o.current)||void 0===t?void 0:t.isReady)switch(e){case d.EVideoEffectType.ADD:break;case d.EVideoEffectType.BLUR:S(e),p.current&&(p.current=void 0),A.current||(E("play"),I());break;case d.EVideoEffectType.NONE:S(e),p.current&&(p.current=void 0),null===(a=u.current)||void 0===a||a.draw(),E("stop");break;default:var s=n.find((function(n){return n.id===e}));s&&(S(e,!0),(r=s.originalUrl,(0,i.__awaiter)(void 0,void 0,Promise,(function(){return(0,i.__generator)(this,(function(e){return[2,new Promise((function(e,n){var t=document.createElement("img");t.crossOrigin="anonymous",t.onerror=function(e){n("Failed image loading: "+e)},t.onload=function(){return e(t)},t.src=r}))]}))}))).then((function(n){if(!o.current)throw new Error("output canvas is not initialized");if(!c.current)throw new Error("ImageEdit class is not initialized");if(v.current!==e)throw new Error("Settings changed during load");var t=o.current,a=t.width,i=t.height;return c.current.resize(n,a,i)})).then((function(n){if(v.current!==e)throw new Error("Settings changed during load");S(e),p.current=n,A.current||(E("play"),I())})).catch(console.warn))}else h.current=function(){T(e)}}),[n]),N=(0,l.useCallback)((function(e){switch(_.current){case d.EVideoEffectType.ADD:case d.EVideoEffectType.NONE:break;case d.EVideoEffectType.BLUR:requestAnimationFrame((function(){var n;null===(n=s.current)||void 0===n||n.draw(e),A.current&&I()}));break;default:requestAnimationFrame((function(){var n,t=Object.assign({background:p.current},e);null===(n=s.current)||void 0===n||n.draw(t),A.current&&I()}))}}),[]);return(0,l.useEffect)((function(){var e;if(a){if(o.current){var n=a.getVideoTracks()[0].getSettings(),t=n.width,l=n.height;o.current.width=t||436,o.current.height=l||250,o.current.isReady=!0,null===(e=h.current)||void 0===e||e.call(h);s.current=new hl(o.current),u.current=new jl(o.current);var c=new Promise((function(e,n){var t=new nl({onReady:e,onError:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,(0,i.__spreadArray)([],(0,i.__read)(e),!1)),n()},onFrame:N});t.createModel(!0)})).then((function(e){return r.current=e,e})).catch((function(){r.current=null}));return function(){var e,n;null===(e=s.current)||void 0===e||e.close(),null===(n=r.current)||void 0===n||n.destroy(),c.then((function(e){e&&e.destroy()})),s.current=null,r.current=null,h.current=null}}console.error("[useVideoEffects][on-userStream-update] canvas is not initialized")}}),[a]),{$canvas:o,onRequestSegmentation:I,onUpdateVideoEffectsSettings:T,isPlaying:m}},Bl=t(23326),Ul=function(e){e.getTracks().forEach((function(e){return e.stop()}))},Hl=function(e){var n=e.className;return(0,o.jsx)("svg",(0,i.__assign)({className:n,width:"4",height:"4",viewBox:"0 0 4 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 4V0H0C2.20898 0 4 1.79077 4 4Z",fill:"white"},void 0)}),void 0)},Gl=(0,l.memo)((function(e){var n=e.onClick,t=e.id,a=e.content;return(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettingsCarousel__Item",onClick:function(){return null==n?void 0:n(t)}},{children:a}),void 0)})),Vl=function(e){var n=e.backgroundList,t=e.onDeleteBackground,a=e.onChooseBackground,r=e.chosen,c=e.videoOptions,u=e.isSferum,_=(0,ue.useLang)().getLang,v=function(e){var n=(0,i.__read)((0,l.useState)(null),2),t=n[0],a=n[1],o=(0,i.__read)((0,l.useState)(!1),2),r=o[0],s=o[1],c=(0,l.useRef)(!1),d=(0,Bl.useIsMounted)(),u=(0,l.useRef)(0),_=(0,l.useCallback)((function(){if(!c.current){s(!1),c.current=!0;var n=function(t){return navigator.mediaDevices.getUserMedia(t).then((function(e){d()?a(e):Ul(e),c.current=!1})).catch((function(t){++u.current<e.length?n(e[u.current]):(a(null),s(t),c.current=!1)}))};n(e[u.current])}}),[e]);return(0,l.useEffect)((function(){_();var e=function(){u.current=0,_()};return navigator.mediaDevices.addEventListener("devicechange",e),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[_]),(0,l.useEffect)((function(){return function(){t&&Ul(t)}}),[t]),{userStream:t,error:r,updateUserMediaStream:_}}(El),p=v.userStream,f=v.error,h=v.updateUserMediaStream,A=function(e){var n=e.userStream,t=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t.current){var e=function(e){var n=e.getVideoTracks()[0].getSettings(),t=n.width,a=void 0===t?436:t,i=n.height;return{width:a,height:void 0===i?250:i}}(n),a=e.height,i=e.width;t.current.height=a,t.current.width=i,t.current.srcObject=n}}),[n]),{$video:t}}({userStream:p}).$video,g=Rl({backgroundList:n,$srcElement:A,userStream:p}),m=g.$canvas,C=g.onUpdateVideoEffectsSettings,E=g.isPlaying,S=function(e){var n=e.onDeleteBackground,t=e.backgroundList,a=e.chosen,r=e.onUpdateVideoEffectsSettings,s=e.onChooseBackground,c=e.isSferum,u=Dl().isAnonymous;(0,l.useEffect)((function(){a!==d.EVideoEffectType.NONE&&r(a)}),[]);var _=(0,l.useCallback)((function(e){s(e),r(e)}),[s,r]),v=(0,l.useMemo)((function(){return t.map((function(e){var t;return{id:e.id,onClick:_,content:(0,o.jsx)(Ll,{checked:a===e.id,backgroundUrl:e.previewUrl,onDelete:n,photoId:e.id,isPredefinedBackground:e.isPredefined,isStarBackground:null===(t=e.tags)||void 0===t?void 0:t.includes("star")},void 0)}}))}),[a,t,_]);return{carouselItems:(0,l.useMemo)((function(){var e=[{id:d.EVideoEffectType.NONE,onClick:_,content:(0,o.jsx)(bl,{checked:a===d.EVideoEffectType.NONE},void 0)},{id:d.EVideoEffectType.BLUR,onClick:_,content:(0,o.jsx)(Ol,{checked:a===d.EVideoEffectType.BLUR},void 0)}];return c||(u||e.push({id:d.EVideoEffectType.ADD,onClick:_,content:(0,o.jsx)(Ml,{},void 0)}),e.push.apply(e,(0,i.__spreadArray)([],(0,i.__read)(v),!1))),e}),[a,v,_])}}({backgroundList:n,onDeleteBackground:t,onUpdateVideoEffectsSettings:C,onChooseBackground:a,chosen:r,isSferum:u}).carouselItems;return(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__userStream"},{children:[p&&(0,o.jsx)("video",(0,i.__assign)({className:(0,s.classNames)("Video",{"Video--visible":!E},"Video--contain",{"Video--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]}),ref:A,controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,autoPlay:!0},{children:"Video tag is not supported"}),void 0),(0,o.jsx)("canvas",{ref:m,className:(0,s.classNames)("VirtualBackgroundSettings__userCanvas",{"VirtualBackgroundSettings__userCanvas--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]},{"VirtualBackgroundSettings__userCanvas--playing":E})},void 0),f&&(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__error"},{children:[(0,o.jsx)("div",{children:_("profile_no_camera_access")},void 0),(0,o.jsx)("div",{children:(0,o.jsx)(Ea.default,(0,i.__assign)({className:"VirtualBackgroundSettings__error__btn",size:"m",onClick:h},{children:_("calls_button_allow_access")}),void 0)},void 0)]}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({VirtualBackgroundSettings__carousel__modalFix:!0,"VirtualBackgroundSettings__carousel__modalFix--sferum":u})},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__carousel"},{children:S.map((function(e){return(0,o.jsx)(Gl,{id:e.id,onClick:e.onClick,content:e.content},e.id)}))}),void 0),(0,o.jsx)(Hl,{className:"VirtualBackgroundSettings__carousel__cornerIcon"},void 0)]}),void 0)]}),void 0)},Fl=t(99939),Wl=function(){var e=(0,Fl.useSendStatsData)().sendStatsData,n=(0,l.useCallback)((function(n,t,a){var i=_i(n,t,a),o=i.disabledActionType,r=i.prevSendValue,s=i.effectDuration;null!==o&&e(o,{background_id:r,background_duration:s})}),[e]),t=(0,l.useCallback)((function(t,a){var i,o=Date.now(),r=oe();r&&n(a,o,r),i=t>4e3?Fl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_SELECTED:Fl.ECallActionEventType.VIRTUAL_BACKGROUND_SELECTED,e(i,{background_id:t}),re(o)}),[e,n]),a=(0,l.useCallback)((function(e){var t=oe();if(t){var a=Date.now();n(e,a,t),se()}}),[n]),i=(0,l.useCallback)((function(n){e(Fl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_ADDED,{background_id:n})}),[e]);return{sendVirtualBackgroundSelected:t,sendVirtualBackgroundDisabled:a,sendVirtualBackgroundDeleted:(0,l.useCallback)((function(n){e(Fl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DELETED,{background_id:n})}),[e]),sendVirtualBackgroundAdded:i}},Zl=function(){var e=u();return{onClose:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:null})}),[]),onClosePopupCalendar:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING})}),[])}},zl=function(e){var n=e.photos,t=e.onSuccessPhotoUpload,a=e.isSferum,o=u(),r=Wl(),s=r.sendVirtualBackgroundAdded,c=r.sendVirtualBackgroundDeleted,_=Dl().isAnonymous,v=(0,l.useRef)([]),p=(0,i.__read)((0,l.useState)(!1),2),f=p[0],h=p[1];(0,l.useEffect)((function(){n.length||_||a||(0,nn.photosGetAllImages)().then((function(e){o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Kl(e.items||[])})}))}),[]);var A=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));t&&(v.current.push(t),o({type:d.E_ACTION.VB_REMOVE_USER_PHOTO,photoId:e}))}),[n]),g=(0,l.useCallback)((function(){var e=v.current;return v.current=[],function(e,n){var t=e.map((function(e){return(0,nn.photosDelete)({photo_id:e.id})}));return Promise.allSettled(t).then((function(t){t.forEach((function(t,a){"fulfilled"===t.status&&n(e[a].id)}))}))}(e,c)}),[c]),m=(0,l.useCallback)((function(){var e=v.current;v.current=[];var t=n.concat(e);o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Kl(t)})}),[n]),C=(0,l.useCallback)((function(e){return h(!0),(0,nn.photosSaveBackgroundPhoto)(e).then((function(e){var n=e[0];if(!n)throw new Error("Something wrong with uploaded photo");return o({type:d.E_ACTION.VB_ADD_USER_PHOTO,photo:n}),t(n),s(n.id),n})).finally((function(){h(!1)}))}),[t,s]);return{photos:n,onAddBackground:C,onDeleteBackground:A,onSaveSettings:g,onCancelSettings:m,loadingUpload:f}};function Kl(e){return e.sort((function(e,n){return e.date<n.date?1:-1}))}var Ql,Yl=function(e){var n=e.children,t=e.onClose,a=e.onSubmit,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({onClose:t,title:r("calls_warning"),appearance:"blue",className:"UploadBackgroundErrorModal",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:t,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:a},{children:r("calls_retry_action")}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundErrorModal__content"},{children:n}),void 0)}),void 0)},Jl=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO})}),[]);return(0,o.jsx)(Yl,(0,i.__assign)({onClose:t,onSubmit:a},{children:n("calls_error_upload_background_image")}),void 0)},Xl=function(e){var n=e.children,t=e.onClose,a=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({onClose:t,title:a("calls_upload_image_for_background"),appearance:"blue",className:"UploadBackgroundPhotoModal",footerHint:a("calls_if_you_have_problems_with_upload")},{children:n}),void 0)},ql=function(e){var n=e.onSubmit,t=e.loading,a=(0,l.useContext)(E.LangContext).getLang,r=(0,l.useRef)(null),s=function(e){var n=e.$inputEl,t=e.onSubmit,a=(0,i.__read)((0,l.useState)({}),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,l.useCallback)((function(){n.current&&(n.current.onchange=function(e){var n;d(!1);var a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(a){var i=new FileReader;i.onload=function(){var e=new Image;e.onload=function(){!function(e){return(e.width>=510||e.width>7e3)&&(e.height>=200||e.height>7e3)}(e)?d(!0):(r({file:a,image:e}),t&&t(a))},e.onerror=function(){return d(!0)},e.src=i.result},i.onerror=function(){return d(!0)},i.readAsDataURL(a)}},n.current.click())}),[]);return{error:c,fileData:o,onClick:u}}({$inputEl:r,onSubmit:n}),c=s.onClick,d=s.error,u=(0,l.useMemo)((function(){return(""+a("profile_oph_err_size")).replace("{sorry}","<b>"+a("global_sorry_error")+"</b>").replace("{min}","200").replace("{max}","7000")}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto"},{children:[(0,o.jsx)("input",{ref:r,type:"file",className:"UploadBackgroundPhoto__upload"},void 0),d&&(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__error"},{children:[(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__left"},void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__right",dangerouslySetInnerHTML:{__html:u}},void 0)]}),void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__description",dangerouslySetInnerHTML:{__html:a("calls_you_can_upload_description")}},void 0),!t&&(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__button"},{children:(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:c},{children:a("calls_choose_file")}),void 0)}),void 0),t&&(0,o.jsx)("div",{className:"UploadBackgroundPhoto__progress"},void 0)]}),void 0)},$l=function(e){var n=e.onAddBackground,t=e.loading,a=u(),r=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),s=(0,l.useCallback)((function(e){n(e).then(r).catch((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_ERROR})}))}),[r]);return(0,o.jsx)(Xl,(0,i.__assign)({onClose:r},{children:(0,o.jsx)(ql,{loading:t,onSubmit:s},void 0)}),void 0)},ec=(0,l.memo)((function(e){var n=e.SDK,t=(0,i.__read)((0,l.useState)(!1),2),a=t[0],r=t[1],s=P((function(e){return e.popup})),_=P((function(e){return e.virtualBackgroundSettings.photos})),v=P((function(e){return!!e.config.sferum})),p=function(e){var n=e.photos;return{backgroundList:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(n),!1),(0,i.__read)(Sl),!1).map((function(e){return e instanceof Cl?e.getMappedParams():{id:e.id,originalUrl:Tl(e),previewUrl:(n=e,t=Il(n),(null==t?void 0:t.o)||(null==t?void 0:t.p)||(null==t?void 0:t.q)||(null==t?void 0:t.x)||(null==t?void 0:t.s)||""),isPredefined:!1};var n,t}))}),[n])}}({photos:_}).backgroundList,f=Zl().onClose,h=function(){var e=(0,c.useSelector)((function(e){return e.localDevice.stream})),n=(0,c.useSelector)((function(e){return e.localDevice.mediaSettings}));return{userStream:e,isVideoEnabled:!!(null==n?void 0:n.isVideoEnabled)}}(),A=h.userStream,g=h.isVideoEnabled,m=function(e){var n=e.backgroundList,t=u(),a=(0,i.__read)((0,l.useState)(ae),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){switch(e){case d.EVideoEffectType.BLUR:r(e);break;case d.EVideoEffectType.ADD:t({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO});break;case d.EVideoEffectType.NONE:r(e);break;default:n.some((function(n){return n.id===e}))&&r(e)}}),[n]),c=(0,l.useRef)(null),_=(0,l.useCallback)((function(e){return c.current=e}),[]);return(0,l.useEffect)((function(){c.current&&(s(c.current.id),c.current=null)}),[s]),{chosen:o,setChosen:r,onClick:s,onSuccessPhotoUpload:_}}({backgroundList:p}),C=m.chosen,E=m.setChosen,S=m.onClick,I=m.onSuccessPhotoUpload,T=zl({photos:_,onSuccessPhotoUpload:I,isSferum:v}),N=T.onCancelSettings,x=T.loadingUpload,y=T.onAddBackground,b=T.onDeleteBackground,O=T.onSaveSettings,w=function(e){var n=e.SDK,t=(0,l.useMemo)((function(){return{background:new gl,blur:new ml,effect:new il({debug:!0})}}),[]);(0,l.useEffect)((function(){return n.setVideoEffects(t.effect),function(){t.effect.destroy()}}),[]);var a=(0,l.useCallback)((function(e){switch(e.type){case d.EVideoEffectType.BACKGROUND:t.background.setBackgroundImage(e.value).then((function(){n.changeVideoEffect(t.background)}));break;case d.EVideoEffectType.BLUR:n.changeVideoEffect(t.blur);break;case d.EVideoEffectType.NONE:n.changeVideoEffect(null);case d.EVideoEffectType.ADD:}}),[]);return{onSettingsChange:a}}({SDK:n}).onSettingsChange;!function(e){var n=e.userStream,t=e.onSettingsChange,a=e.backgroundList,i=e.isVideoEnabled,o=Wl(),r=o.sendVirtualBackgroundSelected,s=o.sendVirtualBackgroundDisabled;(0,l.useEffect)((function(){if(n){var e=ae();i?"number"==typeof e?Nl(e,a).then((function(n){n&&(t({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r(n.id,e))})):e===d.EVideoEffectType.BLUR&&(t({type:d.EVideoEffectType.BLUR}),r(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):(t({type:d.EVideoEffectType.NONE}),s(e))}}),[n,i])}({onSettingsChange:w,userStream:A,backgroundList:p,isVideoEnabled:g});var M=function(e){var n=e.chosen,t=e.settingsOpened,a=e.onSettingsChange,i=e.setChosen,o=e.backgroundList,r=e.isVideoEnabled,s=Wl(),c=s.sendVirtualBackgroundSelected,u=s.sendVirtualBackgroundDisabled,_=(0,l.useRef)(null);return(0,l.useEffect)((function(){t&&(_.current=n)}),[t]),{onApplySettings:(0,l.useCallback)((function(){if(_.current!==n){var e=ae();ie(n),"number"==typeof n?Nl(n,o).then((function(n){n&&(a({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r&&c(n.id,e))})):n===d.EVideoEffectType.BLUR?(a({type:d.EVideoEffectType.BLUR}),r&&c(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):n===d.EVideoEffectType.NONE&&(a({type:d.EVideoEffectType.NONE}),r&&u(e))}}),[a,o,n,c,u,r]),onRestoreSettings:(0,l.useCallback)((function(){_.current&&i(_.current)}),[i])}}({chosen:C,onSettingsChange:w,settingsOpened:a,setChosen:E,backgroundList:p,isVideoEnabled:g}),k=M.onRestoreSettings,L=M.onApplySettings,D=le(),j=D.videoOptions,R=D.onRestoreSettings,B=D.onSaveSettings,U=D.onChangeVideoOption;(0,l.useEffect)((function(){se()}),[]),(0,l.useEffect)((function(){s!==d.POPUP_VIRUTAL_BACKGROUND||a||r(!0)}),[s]);var H=(0,l.useCallback)((function(){O(),f(),r(!1),L(),B()}),[O,f,L,B]),G=(0,l.useCallback)((function(){N(),f(),r(!1),k(),R()}),[N,f,k,R]);return(0,o.jsxs)(o.Fragment,{children:[s===d.POPUP_VIRUTAL_BACKGROUND&&(0,o.jsx)(Os,(0,i.__assign)({onClose:G,onSubmit:H,onChangeVideoOption:U,videoOptions:j},{children:(0,o.jsx)(Vl,{chosen:C,backgroundList:p,onDeleteBackground:b,onChooseBackground:S,videoOptions:j,isSferum:v},void 0)}),void 0),s===d.POPUP_UPLOAD_BACKGROUND_PHOTO&&(0,o.jsx)($l,{onAddBackground:y,loading:x},void 0),s===d.POPUP_UPLOAD_BACKGROUND_ERROR&&(0,o.jsx)(Jl,{},void 0)]},void 0)})),nc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallUserIconGradient)"},void 0),(0,o.jsx)("path",{d:"M17.25 10.25a3.25 3.25 0 1 0-6.5 0 3.25 3.25 0 1 0 6.5 0ZM7.5 18.462v.7c0 .463.375.838.838.838h11.325a.838.838 0 0 0 .837-.837v-.701C20.5 15.769 16.17 15 14 15s-6.5.77-6.5 3.462Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallUserIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#70B2FF"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#5C9CE6"},void 0)]}),void 0)},void 0)]}),void 0)},tc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallWaitingHallIconGradient)"},void 0),(0,o.jsx)("path",{d:"M13.85 6.85h1.072c1.529 0 2.095.127 2.657.428.493.263.88.65 1.143 1.143.3.562.428 1.129.428 2.657v5.842c0 1.528-.127 2.098-.428 2.66a2.74 2.74 0 0 1-1.143 1.14c-.562.3-1.128.43-2.657.43H13.85",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round"},void 0),(0,o.jsx)("path",{d:"M10.85 10.85 14 14l-3.15 3.15M6.85 14h6.6",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round",strokeLinejoin:"round"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallWaitingHallIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#50C750"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#32B332"},void 0)]}),void 0)},void 0)]}),void 0)},ac=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallAnonymousIconGradient)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"m9.52 10.906.503-2.328A2 2 0 0 1 11.978 7h4.044a2 2 0 0 1 1.955 1.578l.503 2.328a.916.916 0 0 1 .015.094H20a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h1.505a.902.902 0 0 1 .015-.094Zm3.447 7a2.5 2.5 0 1 1-.217-1.497 4.984 4.984 0 0 1 2.5 0 2.5 2.5 0 1 1-.217 1.498 3.488 3.488 0 0 0-2.066 0Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallAnonymousIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},ic=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallCameraIcon)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.772 10.865C7.5 11.4 7.5 12.1 7.5 13.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092c.535.273 1.235.273 2.635.273h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092c.273-.535.273-1.235.273-2.635v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C15.6 9.5 14.9 9.5 13.5 9.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417v-2.464a.5.5 0 0 1 .223-.416Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallCameraIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},oc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallMicrophoneIcon)"},void 0),(0,o.jsx)("path",{d:"M11.498 10.5c0-1.38 1.12-2.5 2.502-2.5a2.501 2.501 0 0 1 2.503 2.5v3c0 1.38-1.12 2.5-2.503 2.5a2.501 2.501 0 0 1-2.502-2.5v-3Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M9.194 13.767a.75.75 0 0 1 .891.576 4.005 4.005 0 0 0 7.83 0 .75.75 0 0 1 1.468.314 5.508 5.508 0 0 1-4.632 4.292v1.301a.75.75 0 0 1-1.502 0v-1.3a5.508 5.508 0 0 1-4.632-4.293.75.75 0 0 1 .577-.89Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallMicrophoneIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},rc=function(){return(0,l.useContext)(E.LangContext)},sc=function(e){var n=e.actionButtons,t=e.onClose,a=e.ownerOptions,r=e.selectedOwnerId,s=e.waitingHall,l=e.allowAnon,c=e.onGroupSelectChange,d=e.onChangeWaitingHall,u=e.onChangeAllowAnon,_=e.microphoneOptions,v=e.cameraOptions,p=e.onMicrophoneSelectChange,f=e.onCameraSelectChange,h=e.selectedMicrophoneOption,A=e.selectedCameraOption,g=rc().getLang;return(0,o.jsxs)(I.default,(0,i.__assign)({className:"CreateCallByLinkModal",onClose:t,disableBodyScroll:!0},{children:[(0,o.jsx)(Ho.ModalHeader,{title:g("calls_create_call_by_link_title"),onClose:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CreateCallByLinkModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CreateCallByLinkModal__description"},{children:g("calls_create_call_by_link_description")}),void 0),(0,o.jsxs)(oa.default,{children:[(0,o.jsx)(ra.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(nc,{},void 0),aside:(0,o.jsx)(No.default,{className:"CreateCallByLinkModalOptions__longselect",options:a,value:r,onChange:c,disabled:a.length<=1},void 0)},{children:g("calls_create_call_by_link_by_name")}),void 0),(0,o.jsx)(hi,(0,i.__assign)({canBeHovered:!1,onClick:d,icon:(0,o.jsx)(tc,{},void 0),hint:g("calls_menu_waiting_hall_description"),aside:(0,o.jsx)(F.default,{onChange:d,checked:s},void 0)},{children:g("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(hi,(0,i.__assign)({canBeHovered:!1,onClick:u,icon:(0,o.jsx)(ac,{},void 0),hint:g("calls_create_call_by_link_anon_hint_shedule"),aside:(0,o.jsx)(F.default,{onChange:u,checked:l},void 0)},{children:g("calls_create_call_by_link_anon")}),void 0),(0,o.jsx)(ra.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(oc,{},void 0),aside:(0,o.jsx)(No.default,{className:"CreateCallByLinkModalOptions__longselect",options:_,value:h,onChange:p},void 0)},{children:g("calls_create_call_by_link_microphones")}),void 0),(0,o.jsx)(ra.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(ic,{},void 0),aside:(0,o.jsx)(No.default,{className:"CreateCallByLinkModalOptions__longselect",options:v,value:A,onChange:f},void 0)},{children:g("calls_create_call_by_link_cameras")}),void 0)]},void 0)]}),void 0),(0,o.jsx)(Ss.ModalFooter,{actionButtons:n},void 0)]}),void 0)},lc=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=rc().getLang,s=t.participants[t.me],_=(0,i.__read)((0,l.useState)(s.peerId),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)([{value:s.peerId,label:s.name}]),2),h=f[0],A=f[1],g=(0,i.__read)((0,l.useState)(!1),2),m=g[0],C=g[1],E=(0,i.__read)((0,l.useState)(!0),2),S=E[0],I=E[1],T=(0,i.__read)((0,l.useState)(J.MuteState.UNMUTE),2),N=T[0],x=T[1],y=(0,i.__read)((0,l.useState)(J.MuteState.UNMUTE),2),b=y[0],O=y[1];(0,l.useEffect)((function(){(0,nn.getGroupsForCall)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(h),!1);e.count>0&&(e.items.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),A(n))}))}),[]);var w=(0,l.useCallback)((function(e){p(Number(e.selected.value))}),[]),M=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),C(!m))}),[m]),P=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),I(!S))}),[S]),k=(0,l.useCallback)((function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),L=(0,l.useCallback)((function(){var e,a={};S||(a[J.ConversationOption.REQUIRE_AUTH_TO_JOIN]=!0),m&&(a[J.ConversationOption.WAITING_HALL]=!0);var i={};N!==J.MuteState.UNMUTE&&(i[J.MediaOption.AUDIO]=N),b!==J.MuteState.UNMUTE&&(i[J.MediaOption.VIDEO]=b,i[J.MediaOption.SCREEN_SHARING]=b),n.startCall(!1,null!==(e=t.entryPoint)&&void 0!==e?e:d.CallStatSource.HISTORY_CREATE,!1,v>0?0:v,{conversationOptions:a,createLink:!0,mediaOptions:i})}),[v,m,S,N,b]),D=[(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:k,appearance:"tertiary"},{children:r("calls_cancel")}),"cancel"),(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:L},{children:r("calls_create_call_by_link")}),"call")],j=[{value:J.MuteState.UNMUTE,label:r("calls_create_call_by_link_phone_option_allow_always")},{value:J.MuteState.MUTE,label:r("calls_create_call_by_link_phone_option_disallow_entrance")},{value:J.MuteState.MUTE_PERMANENT,label:r("calls_create_call_by_link_phone_option_disallow_always")}],R=function(e){var n=J.MuteState.UNMUTE;return e==J.MuteState.MUTE?n=J.MuteState.MUTE:e==J.MuteState.MUTE_PERMANENT&&(n=J.MuteState.MUTE_PERMANENT),n},B=(0,l.useCallback)((function(e){x(R(String(e.selected.value)))}),[]),U=(0,l.useCallback)((function(e){O(R(String(e.selected.value)))}),[]);return(0,o.jsx)(sc,{actionButtons:D,onClose:k,ownerOptions:h,selectedOwnerId:v,waitingHall:m,allowAnon:S,onGroupSelectChange:w,onChangeWaitingHall:M,onChangeAllowAnon:P,microphoneOptions:j,cameraOptions:j,onMicrophoneSelectChange:B,onCameraSelectChange:U,selectedMicrophoneOption:N,selectedCameraOption:b},void 0)},cc=function(e){var n=e.onClose,t=e.title,a=e.description,r=e.btnText;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"OnHangupModal",onClose:n,title:t,appearance:"blue",actionButtons:(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:n},{children:r}),void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"OnHangupModal__description"},{children:a}),void 0)}),void 0)},dc=function(){var e=(0,ue.useLang)().getLang,n=Zl().onClose,t=(0,c.useSelector)((function(e){return e.popup})),a=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.opponentName})),i=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.isMeEndedCallForAll})),r=u(),s="",_="",v=e("calls_close"),p=!1;switch(t){case d.POPUP_ON_CALL_HANGUP_BUSY:s=e("calls_user_busy"),_=e("calls_user_busy_description").replace("{username}",a||e("calls_opponent"));break;case d.POPUP_ON_CALL_HANGUP_KILLED:if(i){p=!0;break}s=e("calls_join_error_not_found_conversation"),_=e("calls_admin_ended_call_for_everyone");break;case d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE:if(i){p=!0;break}s=e("calls_meeting_ended_title"),_=e("calls_meeting_ended_desc"),v=e("calls_warning_ok");break;case d.POPUP_ON_CALL_HANGUP_BANNED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_banned");break;case d.POPUP_ON_CALL_HANGUP_REMOVED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_kicked")}return(0,l.useEffect)((function(){return function(){r({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})}}),[]),(0,l.useEffect)((function(){p&&n()}),[p,n]),p?null:(0,o.jsx)(cc,{onClose:n,title:s,description:_,btnText:v},void 0)};!function(e){e[e.Wall=0]="Wall",e[e.Community=1]="Community",e[e.History=2]="History",e[e.IM=3]="IM"}(Ql||(Ql={}));var uc=function(){return(0,o.jsx)("svg",(0,i.__assign)({width:"11",height:"6",viewBox:"0 0 11 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M0.75 0.75L5.5 5.25L10.25 0.75",stroke:"#AEB7C2",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},void 0)}),void 0)},_c=t(11798),vc=function(e){var n=e.id,t=e.onClick,a=e.text,r=e.type,l=void 0===r?"regular":r;return(0,o.jsxs)("span",(0,i.__assign)({className:(0,s.classNames)("TokenInput__token",{"TokenInput__token--add":"add"===l}),onClick:"add"===l?function(){return t()}:void 0},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"TokenInput__label"},{children:a}),void 0),(0,o.jsx)("button",(0,i.__assign)({"data-id":n,className:"TokenInput__remove",onClick:function(){return t(n)}},{children:(0,o.jsx)(_c.default,{},void 0)}),void 0)]}),n)},pc="https://vk.com/images/icons/im_multichat_50.png",fc=function(){},hc=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;return t&&t.photo_50||pc},Ac=function(e,n){var t,a;switch(e.conversation.peer.type){case"chat":return(null===(a=null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.photo)||void 0===a?void 0:a.photo_50)||pc;case"user":return hc(n,e.conversation.peer.id);default:return pc}},gc=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;if(!t||!t.first_name)return"";var a=t.first_name;return t.last_name&&(a+=" "+t.last_name),a},mc=function(e,n){var t;switch(e.conversation.peer.type){case"chat":return(null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.title)||"";case"user":return gc(n,e.conversation.peer.id);default:return""}},Cc=(0,l.forwardRef)((function(e,n){var t=e.handleAddToken,a=e.handleChange,r=e.handleRemoveToken,c=e.handleSelect,d=e.opened,u=e.tokens,_=e.value,v=e.filteredOptions,p=e.onClickAway,f=e.loading,h=(0,ue.useLang)().getLang,A=function(e){var n=e.ref,t=e.onClickAway,a=(0,l.useCallback)((function(e){var a;switch(e.code){case"Escape":n&&"function"!=typeof n&&(null===(a=n.current)||void 0===a||a.blur()),t();break;case"Tab":t()}}),[n,t]);return{handleClickAway:a}}({ref:n,onClickAway:p}).handleClickAway;return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ModalSendMessage__MultiSelect",{"ModalSendMessage__MultiSelect--hidden":!!f&&!v.length})},{children:(0,o.jsx)(Xa.default,{opened:d,placeholder:h("calls_enter_recipient_or_dialog_name"),removeTokenPlaceholder:"Remove",disableEmptyList:!!f,tokens:u,hasMore:!1,onChange:a,value:_,onSelect:c,onRemoveToken:r,disableOnSelectInputFocus:!0,hideInputWithName:!0,renderInput:function(){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TokenInput","ModalSendMessage__TokenInput",{"ModalSendMessage__TokenInput--opened":d&&!f}),onClick:t},{children:[u.map((function(e){return(0,o.jsx)(vc,(0,i.__assign)({},e,{onClick:r}),e.id)})),!(!u.length||d)&&(0,o.jsx)(vc,{id:"token-add",text:h("calls_add"),type:"add",onClick:fc},"token-add"),(!u.length||d)&&(0,o.jsx)("input",{ref:n,className:"ModalSendMessage__input",type:"text",value:_,onChange:a,onKeyDown:A,placeholder:h("calls_enter_recipient_or_dialog_name")},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__angle-icon"},{children:(0,o.jsx)(uc,{},void 0)}),void 0)]}),void 0)},renderSuggest:function(e){return(0,o.jsx)(Ca.default,{"data-id":e.id,photo:e.photo,title:e.text,onClick:function(){return c(e.id)}},e.id)},data:v,notFoundText:h("calls_search_empty_list")},void 0)}),void 0)})),Ec=function(e){var n=e.options,t=e.onChangeInput,a=(0,i.__read)((0,l.useState)(""),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)([]),2),_=u[0],v=u[1],p=(0,i.__read)((0,l.useState)((function(){return(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),2),f=p[0],h=p[1],A=(0,l.useRef)(null),g=(0,l.useCallback)((function(){d(!1),r("")}),[]);(0,l.useEffect)((function(){null==t||t(o)}),[o]),(0,l.useEffect)((function(){h(function(e,n,t){var a=t.reduce((function(e,n){return e[n.id]=!0,e}),{}),i=e.toLowerCase();return n.filter((function(e){return!a[e.id]&&e.text.toLowerCase().includes(i)}))}(o,n,_))}),[o,n,_]),function(e){var n=e.selector,t=e.opened,a=e.onClose;(0,l.useEffect)((function(){if(t){var e=function(e){var t=e.target;t instanceof HTMLElement&&(t.closest(n)||a(!1))};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}}),[t])}({selector:".ModalSendMessage__MultiSelect",onClose:g,opened:c});var m=(0,l.useCallback)((function(e){var n=e.target.value;r(n),d(!0)}),[]),C=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));return t&&v((function(e){var n=new Set(e);return n.add({id:t.id,text:t.text,src:t.photo}),(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),d(!1),r(""),Promise.resolve()}),[n]),E=(0,l.useCallback)((function(e){v((function(n){return n.filter((function(n){return n.id!==e}))})),d(!1)}),[]),S=(0,l.useCallback)((function(e){var n,t=e.target,a=null===(n=t.closest)||void 0===n?void 0:n.call(t,".TokenInput__token");a&&!a.classList.contains("TokenInput__token--add")||(d(!0),r(""),requestAnimationFrame((function(){var e;null===(e=A.current)||void 0===e||e.focus()})))}),[_,n]);return{ref:A,filteredOptions:f,handleAddToken:S,handleChange:m,handleRemoveToken:E,handleSelect:C,onClickAway:g,opened:c,options:n,tokens:_,value:o}},Sc=function(e){var n=e.onClose,t=e.title,a=e.onSubmit,r=e.optionsIM,s=e.submitDisabled,c=e.initialText,d=e.onChangeInputIM,u=e.loading,_=(0,ue.useLang)().getLang,v=(0,i.__read)((0,l.useState)(c||""),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(Ql.IM),1)[0],A=Ec({options:r,onChangeInput:d}),g=(0,l.useCallback)((function(e){var n=e.target.value;f(n)}),[]),m=(0,l.useCallback)((function(){switch(h){case Ql.IM:var e=A.tokens.map((function(e){return e.id}));if(!e.length||!p)break;a({text:p,ids:e,destination:h})}}),[p,A.tokens,a,h]),C=!p||!A.tokens.length;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"ModalSendMessage",onClose:n,title:t,actionButtons:(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"primary",onClick:m,disabled:C||s},{children:_("calls_send")}),void 0),disableEscapeClose:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Main"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__Destination"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__RadioDestination"},{children:(0,o.jsx)(Cc,(0,i.__assign)({loading:u},A),void 0)}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Message"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"ModalSendMessage__Message__title"},{children:_("calls_your_message")}),void 0),(0,o.jsx)(Zr.default,{value:p,onChange:g},void 0)]}),void 0)]}),void 0)}),void 0)},Ic=t(73521),Tc=t(84356),Nc=function(){var e=(0,ue.useLang)().getLang,n=(0,Tc.usePromiseError)().handleError,t=u(),a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=P((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=function(){var e=(0,Tc.usePromiseError)().handleError,n=(0,l.useRef)([]),t=(0,l.useRef)([]),a=(0,i.__read)((0,l.useState)([]),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)([]),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],p=(0,Bl.useIsMounted)(),f=(0,l.useRef)(null),h=P((function(e){var n;return+((null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me)})),A=xc(),g=xc(),m=(0,l.useCallback)((function(a){f.current&&clearTimeout(f.current);var o=g.getId();if(!a||a.length<=2)return d(n.current),void r(t.current);var s=A.getId();f.current=setTimeout((function(){v(!0),Promise.allSettled([(0,nn.messagesSearch)({q:a}),(0,nn.friendsSearch)(h,a,20)]).then((function(e){var a=(0,i.__read)(e,2),s=a[0],l=a[1];if(p()&&o===g.prevId.current){var c,u;if("fulfilled"===s.status)(c=s.value).count&&c.conversations?r(c.conversations.map((function(e){var n,t,a;return{id:e.peer.id.toString(),photo:(null===(t=null===(n=e.chat_settings)||void 0===n?void 0:n.photo)||void 0===t?void 0:t.photo_50)||pc,text:(null===(a=e.chat_settings)||void 0===a?void 0:a.title)||""}}))):r(t.current);if("fulfilled"===l.status)(c=l.value).count?d((void 0===(u=c.items)&&(u=[]),u.map((function(e){return{id:e.id.toString(),photo:hc(e,e.id),text:gc(e,e.id)}})))):d(n.current)}})).catch(e).finally((function(){p()&&s===A.prevId.current&&v(!1)}))}),300)}),[]);return(0,l.useEffect)((function(){v(!0),(0,nn.messagesGetConversations)().then((function(e){if(p()){var n=function(e,n){var t,a;void 0===n&&(n=[]);var o=[];try{for(var r=(0,i.__values)(e),s=r.next();!s.done;s=r.next()){var l=s.value;"chat"===l.conversation.peer.type&&o.push({id:l.conversation.peer.id.toString(),photo:Ac(l,n),text:mc(l,n)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}return o}(e.items,e.profiles);t.current=n,r(n)}})).catch(e).finally((function(){p()&&v(!1)}))}),[]),{conversations:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),(0,i.__read)(o),!1)}),[o,c]),loading:_,fetchSearchFriends:m}}(),v=_.conversations,p=_.fetchSearchFriends,f=_.loading,h=xc().getId,A=Zl().onClosePopupCalendar,g=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),m=(0,Ic.useCalendarEventDetails)({meParticipant:g}),C=(0,Bl.useIsMounted)(),E=(0,l.useCallback)((function(e){if(e)return s(!0),e.destination===Ql.IM?Promise.allSettled(e.ids.map((function(n){return(0,nn.messagesSend)({peer_id:+n,message:e.text,random_id:h()})}))).then(A).catch(n).finally((function(){C()&&s(!1)})):void 0}),[]),S=(0,l.useCallback)((function(){t({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})}),[t]);return(0,o.jsx)(Sc,{onClose:S,onSubmit:E,optionsIM:v,title:e("calls_send_call_link_title"),submitDisabled:r,initialText:m.getDescription(c),onChangeInputIM:p,loading:f},void 0)};function xc(){var e=(0,l.useRef)(0);return e.current||(e.current=Date.now()),{getId:(0,l.useCallback)((function(){return e.current=Date.now(),e.current}),[]),prevId:e}}var yc=t(49336),bc=function(){return(0,o.jsxs)("svg",(0,i.__assign)({width:"40",height:"46",viewBox:"0 0 40 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("path",{d:"M30.5607 17.4393C31.1464 18.0251 31.1464 18.9749 30.5607 19.5607L18.5607 31.5607C17.9749 32.1464 17.0251 32.1464 16.4393 31.5607L10.4393 25.5607C9.85355 24.9749 9.85355 24.0251 10.4393 23.4393C11.0251 22.8536 11.9749 22.8536 12.5607 23.4393L17.5 28.3787L28.4393 17.4393C29.0251 16.8536 29.9749 16.8536 30.5607 17.4393Z",fill:"var(--accent)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1.5C12 0.671573 11.3284 0 10.5 0C9.67157 0 9 0.671573 9 1.5V3.10786L8.92347 3.11398C7.49669 3.23055 6.28944 3.47376 5.18709 4.03544C3.39955 4.94624 1.94624 6.39955 1.03544 8.18709C0.473764 9.28944 0.230548 10.4967 0.113976 11.9235C-2.00495e-05 13.3187 -1.09936e-05 15.0497 2.21849e-07 17.234V31.766C-1.09936e-05 33.9503 -2.00495e-05 35.6813 0.113976 37.0765C0.230548 38.5033 0.473764 39.7106 1.03544 40.8129C1.94624 42.6004 3.39955 44.0538 5.18709 44.9646C6.28944 45.5262 7.49669 45.7695 8.92347 45.886C10.3187 46 12.0497 46 14.234 46H25.766C27.9503 46 29.6813 46 31.0765 45.886C32.5033 45.7695 33.7106 45.5262 34.8129 44.9646C36.6004 44.0538 38.0538 42.6004 38.9646 40.8129C39.5262 39.7106 39.7695 38.5033 39.886 37.0765C40 35.6813 40 33.9503 40 31.766V17.234C40 15.0497 40 13.3187 39.886 11.9235C39.7695 10.4967 39.5262 9.28944 38.9646 8.18709C38.0538 6.39955 36.6004 4.94624 34.8129 4.03544C33.7106 3.47376 32.5033 3.23055 31.0765 3.11398C31.0511 3.1119 31.0256 3.10986 31 3.10786V1.5C31 0.671573 30.3284 0 29.5 0C28.6716 0 28 0.671573 28 1.5V3.00568C27.3129 2.99999 26.5702 3 25.766 3H21.5V1.5C21.5 0.671573 20.8284 0 20 0C19.1716 0 18.5 0.671573 18.5 1.5V3H14.234C13.4299 3 12.6871 2.99999 12 3.00568V1.5ZM28 6.0059C27.3158 6.00017 26.5546 6 25.7 6H21.5V7.5C21.5 8.32843 20.8284 9 20 9C19.1716 9 18.5 8.32843 18.5 7.5V6H14.3C13.4454 6 12.6842 6.00017 12 6.0059V7.5C12 8.32843 11.3284 9 10.5 9C9.67157 9 9 8.32843 9 7.5V6.11854C7.85638 6.22335 7.13009 6.41241 6.54906 6.70846C5.32601 7.33163 4.33164 8.32601 3.70846 9.54906C3.39819 10.158 3.20543 10.9265 3.10401 12.1678C3.00117 13.4265 3 15.035 3 17.3V31.7C3 33.965 3.00117 35.5735 3.10401 36.8322C3.20543 38.0735 3.39819 38.842 3.70846 39.4509C4.33164 40.674 5.32601 41.6684 6.54906 42.2915C7.15801 42.6018 7.92651 42.7946 9.16776 42.896C10.4265 42.9988 12.035 43 14.3 43H25.7C27.965 43 29.5735 42.9988 30.8322 42.896C32.0735 42.7946 32.842 42.6018 33.4509 42.2915C34.674 41.6684 35.6684 40.674 36.2915 39.4509C36.6018 38.842 36.7946 38.0735 36.896 36.8322C36.9988 35.5735 37 33.965 37 31.7V17.3C37 15.035 36.9988 13.4265 36.896 12.1678C36.7946 10.9265 36.6018 10.158 36.2915 9.54906C35.6684 8.32601 34.674 7.33163 33.4509 6.70846C32.8699 6.41241 32.1436 6.22335 31 6.11854V7.5C31 8.32843 30.3284 9 29.5 9C28.6716 9 28 8.32843 28 7.5V6.0059Z",fill:"var(--accent)"},void 0)]}),void 0)},Oc=function(e){var n=e.onClose,t=e.text,a=e.onCopyLink,r=e.onCopyText,s=e.onSendByMessage,l=(0,ue.useLang)().getLang;return(0,o.jsx)(yc.BaseModal,(0,i.__assign)({className:"CallsModalEventPlanned",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__wrap"},{children:[(0,o.jsx)(bc,{},void 0),(0,o.jsx)("h3",(0,i.__assign)({className:"CallsModalEventPlanned__title"},{children:l("calls_event_planned")}),void 0),(0,o.jsx)("textarea",{className:"CallsModalEventPlanned__preview",value:t,readOnly:!0},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__buttons"},{children:[(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"primary",onClick:r},{children:l("calls_copy_invite_text")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"link",onClick:a},{children:l("calls_copy_invite_link")}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({appearance:"link",onClick:s},{children:l("calls_send_text_by_im")}),void 0)]}),void 0)]}),void 0)}),void 0)},wc=t(209),Mc=function(){var e=(0,Tc.usePromiseError)().handleError,n=(0,ue.useLang)().getLang,t=(0,wc.useNotifier)().showText,a=u(),i=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),r=Zl().onClosePopupCalendar,l=(0,Ic.useCalendarEventDetails)({meParticipant:i}),c=P((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=l.getDescription(c);return c?(0,o.jsx)(Oc,{onClose:r,text:_,onCopyLink:function(){c?(0,s.copyTextToClipboard)(c.join_link).then((function(){t(n("calls_create_call_by_link_copied"))})).catch(e):(0,Go.handlePromiseError)("No event stored is store to copy :(")},onCopyText:function(){c?(0,s.copyTextToClipboard)(_).then((function(){t(n("calls_create_call_by_link_text_copied"))})).catch(e):(0,Go.handlePromiseError)("No event stored is store to copy :(")},onSendByMessage:function(){a({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_ON_CALL_SEND_LINK})}},void 0):null},Pc=t(37184),kc=t(62833),Lc=t(82659),Dc=t(86969),jc=function(){var e=Zl().onClosePopupCalendar,n=(0,ue.useLang)().getLang,t=function(){var e=u(),n=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),t=P((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEventOwnerOptions})),a=(0,l.useMemo)((function(){var e={value:n.peerId,label:n.name,profile:(0,i.__assign)((0,i.__assign)({},n),{id:n.peerId})};return(0,i.__spreadArray)([e],(0,i.__read)(t||[]),!1)}),[t,n]);return(0,l.useEffect)((function(){(0,nn.getGroupsForCall)().then((function(n){if(n.count>0){var t=(n.items||[]).map((function(e){return{value:-e.id,label:e.name||"",profile:e}}));e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS,data:t})}}))}),[]),{ownerOptions:a,meParticipant:n}}(),a=t.ownerOptions,r=t.meParticipant,c=function(){var e=u(),n=(0,i.__read)((0,l.useState)(!1),2),t=n[0],a=n[1],o=(0,Tc.usePromiseError)().handleError,r=(0,wc.useNotifier)().showText,c=(0,ue.useLang)().getLang,_=(0,Dc.useSendStatsDataCallScheduled)().sendCallScheduled,v=(0,rr.useMailRuCounter)().mailRuCounter,p=(0,Bl.useIsMounted)(),f=Zl().onClosePopupCalendar,h=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),A=(0,Ic.useCalendarEventDetails)({meParticipant:h}).getDescription;return{handleOnSubmit:(0,l.useCallback)((function(n){return a(!0),(0,nn.messagesStartCall)((0,kc.mapFormData)(n)).then((function(t){if(p()){var a=new Date(n.start),i={start:a,title:n.name,repeatRule:n.rrule,join_link:t.join_link,call_id:t.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},l=A(i);switch(i.description=l,(0,s.copyTextToClipboard)(l).then((function(){r(c("calls_create_call_by_link_text_copied"))})).catch(o),_({creatorId:n.groupId,sharingChannel:n.calendar}),v.push(rr.EMailRuGoals.ScheduledCall),n.calendar){case Lc.ECalendar.Other:return e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:i}),void e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL});case Lc.ECalendar.Google:var u=(0,kc.google)((0,kc.mapGoogleIcsUrl)(i,c));(0,kc.openLinkInNewTab)(u,a);break;case Lc.ECalendar.iCloud:case Lc.ECalendar.Outlook:u=(0,kc.ics)((0,kc.mapGoogleIcsUrl)(i,c));(0,kc.openLinkInNewTab)(u,a,!1)}f()}})).catch(o).finally((function(){p()&&a(!1)}))}),[]),loading:t}}(),_=c.handleOnSubmit,v=c.loading;return(0,o.jsx)(Pc.ModalScheduleCall,{headerTitle:n("calls_plan_event"),onClose:e,onSubmit:_,userSelectOptions:a,myUserId:r.peerId,loading:v},void 0)};var Rc=function(e){var n,t,a,r,s,_,v,p=e.SDK,f=e.bridge,h=e.onBeforeCallStart,A=e.onAfterCallFinish,g=e.tabIsMaster,m=e.navigateToConvo,C=e.callSounds,E=e.navigateToProfile,S=e.onHandCountChanged,I=e.onSuccessFeedback,T=e.okPublicKey,N=e.config,x=e.streamUrlExtractor,y=N.allowAddMembers,b=N.incomingCall,w=N.showFeedbackScreen,k=(0,c.useSelector)((function(e){return e})),L=u(),D=(0,l.useCallback)((function(){L({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),j=(0,i.__read)((0,l.useState)(null),2),R=j[0],B=j[1],U=(0,l.useCallback)((function(e){L({type:d.E_ACTION.ERROR,text:e})}),[]),H=(0,l.useCallback)((function(){return L({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]);(0,l.useEffect)((function(){return k.mode===d.Mode.CALL?((0,O.increaseCallsCount)(),Fr(),function(){Wr()}):function(){}}),[k.mode]),function(e,n,t,a){void 0===a&&(a=[]);var i=window.document,o=i.documentElement,r=o.requestFullscreen||o.webkitRequestFullscreen;if(r){var s=!o.requestFullscreen,c=s?i.webkitExitFullscreen:i.exitFullscreen,d=s?"webkitfullscreenchange":"fullscreenchange",u=s?"webkitFullscreenElement":"fullscreenElement";(0,l.useEffect)((function(){var e=function(){i.fullscreenElement?n&&n():t&&t()};return i.addEventListener(d,e),function(){return i.removeEventListener(d,e)}}),[]),(0,l.useEffect)((function(){e&&!i[u]?r.call(i.documentElement):!e&&i[u]&&c.call(i)}),a)}}(k.uiMode===d.UIMode.FULLSCREEN&&k.mode===d.Mode.CALL,(function(){var e;window.FastChat&&(B(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!0,"call")}),(function(){var e;k.uiMode===d.UIMode.FULLSCREEN&&L({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(R),B(null)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!1,"call")}),[k.uiMode,k.mode]),xr(p,k),(0,l.useEffect)((function(){if(k.mode===d.Mode.CALL&&((0,O.increaseCallsCount)(),k.callsCount%3==0)){var e=setTimeout((function(){return L({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!0})}),1e3);return function(){return clearTimeout(e)}}}),[k.mode]);var G,V=(0,l.useMemo)((function(){return function(){try{var e=window,n=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.CanvasCaptureMediaStreamTrack&&!0,t=Fs()[0]===Ls.Safari;return n&&!t}catch(e){return!1}}()}),[]);return G=P((function(e){return!!e.config.sferum})),(0,l.useMemo)((function(){var e=G?ee.Sferum:ee.VkCalls;ne.setAppType(e)}),[G]),(0,o.jsx)(ko,(0,i.__assign)({SDK:p,mode:k.mode,onReset:H},{children:(0,o.jsxs)(o.Fragment,{children:[(b||g())&&(0,o.jsx)(To,{onBeforeCallStart:h,onAfterCallFinish:A,callSounds:C},void 0),k.localDevice.status!==J.ParticipantStatus.WAITING_HALL&&k.mode===d.Mode.CALL&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(ao,{SDK:p,isVirtualBackgroundSupported:V,navigateToConvo:m,navigateToProfile:E,onHandCountChanged:S},void 0),k.localDevice.status===J.ParticipantStatus.WAITING_HALL&&k.mode===d.Mode.CALL&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(bs,{SDK:p,navigateToConvo:m},void 0),k.mode===d.Mode.INCOMING&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(M,{SDK:p,bridge:f},void 0),k.localDevice.status!==J.ParticipantStatus.WAITING_HALL&&k.mode!==d.Mode.READY&&k.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(Ao,{SDK:p},void 0),k.localDevice.status===J.ParticipantStatus.WAITING_HALL&&k.mode!==d.Mode.READY&&k.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(Ns,{SDK:p},void 0),k.mode===d.Mode.START&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(Es,{},void 0),w&&k.mode===d.Mode.FEEDBACK&&(0,o.jsx)(hs,{onSuccessFeedback:I},void 0),k.mode===d.Mode.CALL_BY&&(0,o.jsx)(Ts,{bridge:f},void 0),k.mode===d.Mode.JOIN&&(0,o.jsx)(mr,(0,i.__assign)({},k.join,{bridge:f,withPopup:!0,onClose:D,onError:U,okPublicKey:T}),void 0),k.mode===d.Mode.CREATE_CALL&&(0,o.jsx)(lc,{bridge:f},void 0),k.errorShown&&(0,o.jsx)(Ir,{title:null===(n=k.error)||void 0===n?void 0:n.title,text:null===(t=k.error)||void 0===t?void 0:t.text,handleType:null===(a=k.error)||void 0===a?void 0:a.handleType,callId:null===(r=k.error)||void 0===r?void 0:r.callId,bridge:f,onCloseFatal:D},void 0),k.cautionShown&&(0,o.jsx)(yr,{isIncoming:k.isIncoming},void 0),k.groupCallSetup&&(0,o.jsx)(ci,{SDK:p},void 0),k.isManagementOpen&&(0,o.jsx)(Ei,{bridge:f,SDK:p,navigateToProfile:E,navigateToConvo:m,allowAddMembers:y},void 0),k.popup===d.POPUP_SETTINGS&&(0,o.jsx)(Po,{SDK:p},void 0),k.popup===d.POPUP_TRANSLATION&&(0,o.jsx)($r,{},d.POPUP_TRANSLATION),k.popup===d.POPUP_RECORD&&(0,o.jsx)($r,{isRecord:!0},d.POPUP_RECORD),k.popup===d.POPUP_TRANSLATION_START_COUNTDOWN&&(0,o.jsx)(cs,{},void 0),k.popup===d.POPUP_TRANSLATION_STOP&&(0,o.jsx)(ns,{},void 0),k.popup===d.POPUP_TRANSLATION_SHARE&&(0,o.jsx)(as,{link:k.translation.link,linkExtractor:x},void 0),k.popup===d.POPUP_EXIT&&(0,o.jsx)(Nr,{SDK:p},void 0),k.popup===d.POPUP_TRANSFER_ADMIN_RIGHTS&&(0,o.jsx)(ss,{SDK:p},void 0),(0,Ve.hasIn)(k.popup,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_AUDIO_REQUEST,d.POPUP_UNMUTE_VIDEO_REQUEST)&&(0,o.jsx)(Lr,{SDK:p,popup:k.popup},void 0),k.popup===d.POPUP_ADMIN_PIN_UNMUTE_REQUEST&&(0,o.jsx)(os,{SDK:p},void 0),(0,Ve.hasIn)(k.popup,d.POPUP_ON_CALL_HANGUP_BUSY,d.POPUP_ON_CALL_HANGUP_KILLED,d.POPUP_ON_CALL_HANGUP_BANNED,d.POPUP_ON_CALL_HANGUP_REMOVED,d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE)&&(0,o.jsx)(dc,{},void 0),(null===(s=k.misc)||void 0===s?void 0:s.popupCalendarPlanning)===d.POPUP_ON_CALL_SEND_LINK&&(0,o.jsx)(Nc,{},void 0),(null===(_=k.misc)||void 0===_?void 0:_.popupCalendarPlanning)===d.POPUP_SHARE_PLANNED_CALL&&(0,o.jsx)(Mc,{},void 0),(null===(v=k.misc)||void 0===v?void 0:v.popupCalendarPlanning)===d.POPUP_PLAN_CALENDAR_EVENT&&(0,o.jsx)(jc,{},void 0),V&&(0,o.jsx)(ec,{SDK:p},void 0),k.participantKick&&(0,o.jsx)(_s,{SDK:p},void 0),k.membersUnban&&(0,o.jsx)(gs,{SDK:p},void 0),k.participantsManagement&&(0,o.jsx)(wr,{},void 0),k.adminAssignment&&(0,o.jsx)(jr,{SDK:p},void 0),k.isLoaderVisible&&(0,o.jsx)(Rr.default,{},void 0)]},void 0)}),void 0)},Bc=t(40182);function Uc(e,n,t,a,o){var r=a.reduce((function(a,r){switch(r.type){case d.INCOMING_CALL:if(!Hc(e,r)){a.push(Promise.resolve());break}var s=(0,Ve.isGroupCallEvent)(r),l=s,c=(0,Ve.convertCallerFromLongpoll)(r.payload);if(!s&&c.peerId<0)JSON.parse((0,Za.decodeHTMLEntities)(r.payload.payload)).with_join_link&&(l=!0);if(l){var u=s?(0,Ve.convertChatFromLongpoll)(r.payload):(0,O.getDefaultConversation)(o);if(n({type:d.E_ACTION.LOAD_PEERS,conversation:u,members:[c],peerId:u.peerId,caller:s?u:c}),u.photo&&a.push(an(u.photo).catch((function(e){return(0,J.debugMessage)(J.DebugMessageType.WARN,e)}))),s){var _=function(e,n,t,a){return(0,nn.retryLoadCallPeers)(a).then((function(e){var a=(0,i.__read)((0,Ve.convertServerData)(e),3),o=a[0],r=a[1],s=a[2];hn(n,s),on([o,r]).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)})),n({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r})}))}(0,n,t,u.peerId);a.push(_)}}else n({type:d.E_ACTION.LOAD_PEERS,conversation:c,members:[c],peerId:c.peerId});c.photo&&a.push(an(c.photo).catch((function(e){n({type:d.E_ACTION.LOAD_PEERS,members:[(0,i.__assign)((0,i.__assign)({},c),{photo:""})]}),(0,J.debugMessage)(J.DebugMessageType.WARN,e)})))}return a}),[]);return Promise.all(r)}function Hc(e,n){return function(e){return!!e.payload.call_id}(n)&&e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL}function Gc(){return(0,c.useSelector)((function(e){return e})).isLoaderVisible?(0,o.jsx)(Rr.default,{},void 0):null}var Vc=t(14890),Fc=function(e,n,t,a){var o,r=a.isDev,s=void 0!==r&&r,l=a.token,c=a.config,u=void 0===c?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,incomingCall:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:c,_=a.localVideoResolution,v=void 0===_?d.VideoResolutionTypes.SD:_,p=a.friends,f=void 0===p?[]:p,h=a.friendsCache,A=a.privacySettings,g=a.ipSettingEnabled,m=a.pushToTalkEnabled,C=void 0!==m&&m,E=a.friendsCount,S=window.vk&&window.vk.id||e.peerId;return{anonymSecret:l,me:S,groupId:0,mode:d.Mode.READY,peer:0,participants:(o={},o[S]=(0,i.__assign)({},e),o),devices:{},localDevice:{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1,videoStreams:[]},statusData:{hand:{state:!1,ts:Date.now()}},networkStatus:1,roles:[],permissions:{audio:J.MuteState.UNMUTE,video:J.MuteState.UNMUTE,screenSharing:J.MuteState.UNMUTE},status:J.ParticipantStatus.WAITING},callData:{type:null,ts:null,localTimeStamp:null,conversation:t},imHash:n,isDev:s,popup:null,uiMode:d.UIMode.DEFAULT,orator:null,adminPinnedParticipant:null,screenSharingPinnedParticipant:null,screenSharingNeedDisableOratorModeAfterStop:!0,screenSharingOldPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!0,chatMembers:[],groupMembers:[],groupMembersCount:0,preselectedIds:null,friends:f,friendsCount:E,speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translation:{deferredId:null,isOn:!1},participantsManagement:null,adminAssignment:null,participantKick:null,membersUnban:null,noiseCancellation:d.NoiseCancellationTypes.NEURAL,config:u,localVideoResolution:v,conversationOptions:[],privacySettings:{callsIp:(null==A?void 0:A.callsIp)||"friends"},friendsCache:h||{},groupMembersCache:{},unableToCallGroupMembersIds:[],ipSettingEnabled:g||!1,isIncoming:!1,pushToTalkEnabled:C,gridScrollPosition:0,gridScrollFirstVisible:0,oratorScrollPosition:0,oratorScrollFirstVisible:0,oratorScrollNumberOfVisible:5,callsCount:(0,O.getCallsCount)(),shouldShowDesktopAppNotification:!1,shouldShowWarningDesktopAppNotification:!0,virtualBackgroundSettings:{photos:[],videoOptions:{}},permissions:{},maps:{vkIdToDevices:new Map}}};function Wc(e,n){var t,a,o,r,l,c,u,_,v,p,f,h,A,g,m,C,E;switch(n.type){case d.E_ACTION.LOAD_PEERS:var S=n.conversation||e.callData.conversation,I={};try{for(var T=(0,i.__values)(n.members),N=T.next();!N.done;N=T.next()){var x=N.value;x&&x.peerId&&(I[x.peerId]=(0,i.__assign)((0,i.__assign)({},e.participants[x.peerId]||{}),x))}}catch(e){t={error:e}}finally{try{N&&!N.done&&(a=T.return)&&a.call(T)}finally{if(t)throw t.error}}return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),I),callData:(0,i.__assign)((0,i.__assign)({},e.callData),{conversation:S}),peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,caller:"caller"in n?n.caller:e.caller});case d.E_ACTION.CHANGE_MODE:var y=n.mode!==d.Mode.READY&&n.data&&n.data.type?n.data.type:null;if(n.mode===d.Mode.READY||n.mode===d.Mode.FEEDBACK){S=e.callData&&e.callData.conversation;var b=Fc(e.participants[e.me],e.imHash,S,{token:e.anonymSecret,config:e.config,localVideoResolution:e.localVideoResolution,friends:e.friends,friendsCache:e.friendsCache,friendsCount:e.friendsCount,privacySettings:e.privacySettings,ipSettingEnabled:e.ipSettingEnabled,isDev:e.isDev});return n.mode===d.Mode.FEEDBACK&&(b.mode=d.Mode.FEEDBACK,b.lastCallData={callId:null!==(c=null===(l=e.callData)||void 0===l?void 0:l.callId)&&void 0!==c?c:"",peerId:null!==(u=e.peer)&&void 0!==u?u:0}),b.virtualBackgroundSettings=e.virtualBackgroundSettings,b.misc=e.misc,e.hangupType===J.HangupType.BUSY?b.lastCallData=(0,i.__assign)((0,i.__assign)({},b.lastCallData||{}),{opponentName:null===(_=e.participants[e.peer])||void 0===_?void 0:_.name}):e.hangupType!==J.HangupType.KILLED&&e.hangupType!==J.HangupType.KILLED_WITHOUT_DELETE||(b.lastCallData=(0,i.__assign)((0,i.__assign)({},b.lastCallData||{}),{isMeEndedCallForAll:null===(v=e.lastCallData)||void 0===v?void 0:v.isMeEndedCallForAll})),b}e.maps.vkIdToDevices.clear();var O=(0,i.__assign)((0,i.__assign)({},e),{mode:n.mode,peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,callData:(0,i.__assign)((0,i.__assign)({},e.callData),{type:y,ts:n.ts||e.callData.ts||null}),hangupType:e.hangupType,entryPoint:n.entryPoint||e.entryPoint,join:(0,i.__assign)({},e.join||{})});return n.joinLink&&O.join&&(O.join.joinLink=n.joinLink),n.vkJoinLink&&O.join&&(O.join.vkJoinLink=n.vkJoinLink),O;case d.E_ACTION.HANGUP:return(0,i.__assign)((0,i.__assign)({},e),{hangupType:n.data});case d.E_ACTION.TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{ts:n.data})});case d.E_ACTION.LOCAL_TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{localTimeStamp:n.data})});case d.E_ACTION.REMOVE_USER:var w=(0,k.externalIdToString)(n.participantId),M=e.devices[w]?function(e,n,t){var a;return(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)((0,i.__assign)({},e.devices),(a={},a[n]=(0,i.__assign)((0,i.__assign)({},e.devices[n]),t),a))})}(e,w,{status:void 0,statusData:void 0,wasConnected:void 0,mediaSettings:{},stream:void 0,screenSharingStream:void 0}):(0,i.__assign)({},e);if(null===(p=e.maps.vkIdToDevices.get(+n.participantId.id))||void 0===p||p.delete(w),e.screenSharers[w]&&delete M.screenSharers[w],(0,k.isSameExternalId)(e.orator,n.participantId)&&(M.orator=null),(0,k.isSameExternalId)(e.pinnedParticipant,n.participantId)&&(M.pinnedParticipant=null),(0,k.isSameExternalId)(e.adminPinnedParticipant,n.participantId)&&(M.adminPinnedParticipant=null),(0,k.isSameExternalId)(e.screenSharingPinnedParticipant,n.participantId)&&(M.screenSharingPinnedParticipant=null),e.participantsAddedByMe.has(+n.participantId.id)){var P=new Set(e.participantsAddedByMe);P.delete(+n.participantId.id),M.participantsAddedByMe=P}return M;case d.E_ACTION.SET_CHAT_INFO:return(0,i.__assign)((0,i.__assign)({},e),{chatMembers:n.data,chatData:n.conversation});case d.E_ACTION.GROUP_CALL_SETUP:return(0,i.__assign)((0,i.__assign)({},e),{groupCallSetup:n.open,peer:n.peerId||e.peer||0,preselectedIds:n.preselectedIds});case d.E_ACTION.TOGGLE_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data||null});case d.E_ACTION.UPDATE_HASH:return(0,i.__assign)((0,i.__assign)({},e),{imHash:n.hash});case d.E_ACTION.CHANGE_UI_MODE:return(0,i.__assign)((0,i.__assign)({},e),{uiMode:n.mode||d.UIMode.DEFAULT});case d.E_ACTION.TOGGLE_ORATOR_MODE:return(0,i.__assign)((0,i.__assign)({},e),{isOratorMode:n.isOratorMode});case d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE:return(0,i.__assign)((0,i.__assign)({},e),{isShownParticipantsAside:n.isShownParticipantsAside});case d.E_ACTION.SET_ORATOR:return(0,i.__assign)((0,i.__assign)({},e),{orator:n.orator||null});case d.E_ACTION.SET_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{pinnedParticipant:n.pinnedParticipant});case d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{adminPinnedParticipant:n.data});case d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{screenSharingPinnedParticipant:n.screenSharingPinnedParticipant,screenSharingNeedDisableOratorModeAfterStop:!!n.screenSharingNeedDisableOratorModeAfterStop,screenSharingOldPinnedParticipant:n.screenSharingOldPinnedParticipant||null});case d.E_ACTION.MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{isManagementOpen:n.isOpen,managementView:n.managementView});case d.E_ACTION.CALL_STATE:O=(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),n.callData),join:(0,i.__assign)({},e.join||{}),externalId:n.externalId||e.externalId});return n.joinLink&&O.join&&(O.join.joinLink=n.joinLink),n.vkJoinLink&&O.join&&(O.join.vkJoinLink=n.vkJoinLink),O;case d.E_ACTION.CALL_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{notification:n.notification});case d.E_ACTION.JOIN:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.JOIN,join:n.data});case d.E_ACTION.CALL_BY_NAME:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.CALL_BY,callByName:n.data});case d.E_ACTION.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{mode:n.handleType===d.ErrorHandleType.FATAL?d.Mode.ERROR:e.mode,errorShown:!n.isClosed,error:{title:n.title,text:n.text,handleType:n.handleType,callId:n.callId}});case d.E_ACTION.CHANGE_PARTICIPANT_ROLES:w=n.participantId;return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),(o={},o[w]=(0,i.__assign)((0,i.__assign)({},e.participants[w]||{}),{roles:n.data}),o))});case d.E_ACTION.SET_SCREEN_SHARER:return(0,i.__assign)((0,i.__assign)({},e),{screenSharers:(0,i.__assign)((0,i.__assign)({},e.screenSharers),(r={},r[(0,k.externalIdToString)(n.participantId)]=n.isScreenSharingEnabled,r))});case d.E_ACTION.SET_FRIENDS:return(0,i.__assign)((0,i.__assign)({},e),{friends:n.data,friendsCache:(0,tn.createFriendsCache)(n.data),friendsCount:n.friendsCount});case d.E_ACTION.SET_GROUP_MEMBERS:return(0,i.__assign)((0,i.__assign)({},e),{groupMembersCount:n.groupMembersCount,groupMembers:n.groupMembers,unableToCallGroupMembersIds:n.unableToCallGroupMembersIds,groupMembersCache:(0,tn.createFriendsCache)(n.groupMembers)});case d.E_ACTION.SET_SPEAKERS:var L=n.data,D=L.speakers,j=L.speakersInHeader;return e=(0,i.__assign)((0,i.__assign)({},e),{speakers:D||e.speakers,speakersInHeader:j||e.speakersInHeader});case d.E_ACTION.UPDATE_PARTICIPANTS_BATCH:return function(e,n){var t=(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)({},e.devices)}),a=e.maps.vkIdToDevices;return(0,Ve.objectForEach)(n,(function(o){var r=(0,k.externalIdToString)(o.externalId),s=e.devices[r]||{};if(void 0===(null==s?void 0:s.status)&&o.status===J.ParticipantStatus.HANGUP)delete t.devices[r];else{var l=a.get(+o.externalId.id);l||(l=new Set,a.set(+o.externalId.id,l)),l.add(r);var c=o.statusData?(0,i.__assign)((0,i.__assign)({},s.statusData),o.statusData):s.statusData,d=s.wasConnected||o.status===J.ParticipantStatus.CONNECTED,u=Object.assign({},s.mediaSettings,o.mediaSettings);t.devices[r]=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e.devices[r]),n[r]),{statusData:c,wasConnected:d,mediaSettings:u})}})),t}(e,n.data);case d.E_ACTION.REMOVE_DEVICE_FROM_CACHE:var R=(0,i.__assign)({},e.devices);return delete R[w=n.id],(0,i.__assign)((0,i.__assign)({},e),{devices:R});case d.E_ACTION.SET_UNREAD_COUNT:return(0,i.__assign)((0,i.__assign)({},e),{chatUnreadCount:n.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in n?n.chatUpToMsgId:e.chatUpToMsgId});case d.E_ACTION.SHOW_CAUTION_BOX:return(0,i.__assign)((0,i.__assign)({},e),{cautionShown:n.isOpen,isIncoming:n.isIncoming||e.isIncoming});case d.E_ACTION.SHOW_LOADER:return(0,i.__assign)((0,i.__assign)({},e),{isLoaderVisible:n.isLoaderVisible});case d.E_ACTION.SET_ENTRYPOINT:return(0,i.__assign)((0,i.__assign)({},e),{entryPoint:n.entryPoint});case d.E_ACTION.SET_TOOLTIP:var B=n.tooltips?n.tooltips:Object.keys(e.tooltips).reduce((function(e,n){return e[n]=!1,e}),{});return(0,i.__assign)((0,i.__assign)({},e),{tooltips:(0,i.__assign)((0,i.__assign)({},e.tooltips),B)});case d.E_ACTION.MANUAL_ADD_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{participantsAddedByMe:(n.participants||[]).reduce((function(e,n){return e.add(n),e}),new Set(e.participantsAddedByMe))});case d.E_ACTION.SET_TRANSLATION:return(0,i.__assign)((0,i.__assign)({},e),{translation:(0,i.__assign)((0,i.__assign)({},e.translation),n.data)});case d.E_ACTION.UPDATE_ANON_SECRET:return(0,i.__assign)((0,i.__assign)({},e),{anonymSecret:n.secret});case d.E_ACTION.TOGGLE_PARTICIPANTS_KICK:return(0,i.__assign)((0,i.__assign)({},e),{participantKick:n.data?{participant:n.data.participant,type:n.data.type}:null});case d.E_ACTION.UNBAN_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{membersUnban:n.data?{members:n.data.members}:null});case d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{participantsManagement:n.data?{mode:n.data.mode,device:n.data.device}:null});case d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT:return(0,i.__assign)((0,i.__assign)({},e),{adminAssignment:n.data?{participant:n.data.participant}:null});case d.E_ACTION.SET_NOISE_CANCELLATION:return(0,i.__assign)((0,i.__assign)({},e),{noiseCancellation:n.data});case d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION:return(0,i.__assign)((0,i.__assign)({},e),{localVideoResolution:n.data});case d.E_ACTION.SET_CONVERSATION_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{conversationOptions:n.data});case d.E_ACTION.SET_PRIVACY_SETTINGS:return(0,i.__assign)((0,i.__assign)({},e),{privacySettings:n.data});case d.E_ACTION.SET_GROUP:return(0,i.__assign)((0,i.__assign)({},e),{groupId:n.groupId,meGroup:n.meGroup});case d.E_ACTION.SET_WAITING_HALL:return(0,i.__assign)((0,i.__assign)({},e),{waitingHall:n.data});case d.E_ACTION.SET_PUSH_TO_TALK_ENABLE:return(0,i.__assign)((0,i.__assign)({},e),{pushToTalkEnabled:n.data});case d.E_ACTION.SET_GRID_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{gridScrollPosition:n.position,gridScrollFirstVisible:n.firstVisible});case d.E_ACTION.SET_ORATOR_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{oratorScrollPosition:n.position,oratorScrollFirstVisible:n.firstVisible,oratorScrollNumberOfVisible:n.numberOfVisible});case d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowDesktopAppNotification:n.data});case d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowWarningDesktopAppNotification:n.data});case d.E_ACTION.SET_START_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{startOptions:n.data});case d.E_ACTION.VB_SET_USER_PHOTOS:return Zc(e,{photos:(0,i.__spreadArray)([],(0,i.__read)(n.photos),!1)});case d.E_ACTION.VB_ADD_USER_PHOTO:return Zc(e,{photos:(0,i.__spreadArray)([n.photo],(0,i.__read)(e.virtualBackgroundSettings.photos),!1)});case d.E_ACTION.VB_REMOVE_USER_PHOTO:return Zc(e,{photos:e.virtualBackgroundSettings.photos.filter((function(e){return e.id!==n.photoId}))});case d.E_ACTION.VB_SET_VIDEO_OPTIONS:return Zc(e,{videoOptions:n.videoOptions});case d.E_ACTION.SET_CALL_PERMISSIONS:return(0,s.isEqual)(n.data,e.permissions)?e:(0,i.__assign)((0,i.__assign)({},e),{permissions:n.data});case d.E_ACTION.SET_PARTICIPANTS_CHUNK:return(0,i.__assign)((0,i.__assign)({},e),{participantsChunk:(0,i.__assign)({countBefore:null!==(h=null===(f=e.participantsChunk)||void 0===f?void 0:f.countBefore)&&void 0!==h?h:0,ids:null!==(g=null===(A=e.participantsChunk)||void 0===A?void 0:A.ids)&&void 0!==g?g:[],countAfter:null!==(C=null===(m=e.participantsChunk)||void 0===m?void 0:m.countAfter)&&void 0!==C?C:0},n.data)});case d.E_ACTION.SET_PARTICIPANT_HAND_STATE:var U=n.key,H=n.value,G=e.handState;if((null!==(E=null==G?void 0:G[U])&&void 0!==E&&E)===H)return e;var V=(0,i.__assign)({},G);return V[U]=H,H||delete V[U],(0,i.__assign)((0,i.__assign)({},e),{handState:V});case d.E_ACTION.CLEAN_LAST_CALL_DATA:return zc(e,{opponentName:void 0,isMeEndedCallForAll:void 0});case d.E_ACTION.SET_LAST_CALL_DATA:return zc(e,n.data);case d.E_ACTION.SET_LOCAL_DEVICE:return(0,i.__assign)((0,i.__assign)({},e),{localDevice:(0,i.__assign)((0,i.__assign)({},e.localDevice),n.data)});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT:return Kc(e,{plannedCalendarEvent:n.data});case d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING:return Kc(e,{popupCalendarPlanning:n.data});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS:return Kc(e,{plannedCalendarEventOwnerOptions:n.data});case d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowRecordEndedDesktopAppNotification:n.data});default:return e}}function Zc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{virtualBackgroundSettings:(0,i.__assign)((0,i.__assign)({},e.virtualBackgroundSettings),n)})}function zc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{lastCallData:(0,i.__assign)((0,i.__assign)({},e.lastCallData||{}),n)})}function Kc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{misc:(0,i.__assign)((0,i.__assign)({},e.misc||{}),n)})}var Qc=t(87080);function Yc(e,n){switch(n.type){case Qc.HistoryScreenActionTypes.DELETE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{deleteCallId:n.data});case Qc.HistoryScreenActionTypes.SET_CURRENT_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{currentCalls:n.data});case Qc.HistoryScreenActionTypes.SET_HISTORY_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{historyCalls:n.data});case Qc.HistoryScreenActionTypes.SET_PROFILES:return(0,i.__assign)((0,i.__assign)({},e),{profiles:(0,i.__assign)((0,i.__assign)({},e.profiles),n.data)});case Qc.HistoryScreenActionTypes.SET_URLS:return(0,i.__assign)((0,i.__assign)({},e),{joinLinks:(0,i.__assign)((0,i.__assign)({},e.joinLinks),n.data)});case Qc.HistoryScreenActionTypes.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{error:n.data});case Qc.HistoryScreenActionTypes.SET_LOADING:return(0,i.__assign)((0,i.__assign)({},e),{loading:n.data});case Qc.HistoryScreenActionTypes.SET_SHOW_CREATE_BUTTON:return(0,i.__assign)((0,i.__assign)({},e),{showCreateCall:n.data});case Qc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCalls:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCalls||{}),n.data):void 0});case Qc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCallsPreview:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCallsPreview||{}),n.data):void 0});case Qc.HistoryScreenActionTypes.SET_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data});case Qc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{scheduledEditableCall:n.data});case Qc.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE:return(0,i.__assign)((0,i.__assign)({},e),{callsQueueResponse:n.data});default:return e}}var Jc=function(e){var n=e.onClose,t=e.actionButtons,a=e.text,r=rc().getLang;return(0,o.jsx)(aa.default,(0,i.__assign)({className:"DeleteCallModal",title:r("calls_history_delete_modal_title"),actionButtons:t,onClose:n,appearance:"blue"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"DeleteCallModal__content"},{children:a}),void 0)}),void 0)},Xc=t(95098),qc=c.useSelector,$c=function(){return(0,c.useDispatch)()},ed=t(50611),nd=function(){var e=$c(),n=rc(),t=n.getLang,a=n.langShortDateTime,r=qc((function(e){return e.deleteCallId})),s=qc((function(e){return e.profiles})),c=qc((function(e){return e.historyCalls})),d=qc((function(e){return e.currentCalls})),u=r in c?c[r]:null,_=(0,l.useCallback)((function(){e((0,ed.dispatchDeleteCall)(-1))}),[]),v=(0,l.useCallback)((function(){if((null==u?void 0:u.type)&&"merged"===(null==u?void 0:u.type)&&(null==u?void 0:u.items)){var n=u.items.reduce((function(e,n){return(null==n?void 0:n.id)&&e.push(n.id),e}),[]);n.length>0&&(0,J.removeHistoryRecords)(n)}else(null==u?void 0:u.id)&&(0,J.removeHistoryRecords)([u.id]);c.splice(r,1),e((0,ed.dispatchSetHistoryCalls)((0,i.__spreadArray)([],(0,i.__read)(c),!1))),_()}),[u]),p=(0,l.useCallback)((function(){if(null==u?void 0:u.call_id){(0,nn.forceCallFinish)(u.call_id);var n=d.filter((function(e){return e.call_id!==u.call_id}));e((0,ed.dispatchSetCurrentCalls)(n))}v()}),[u]),f=[];if((null==u?void 0:u.can_finish_call)&&(f=f.concat([(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){p()},appearance:"secondary"},{children:t("calls_history_delete_and_finish_call_button")}),"finishAndDeleteCall")])),f=f.concat([(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:function(){v()}},{children:t("calls_history_delete_call_button")}),"deleteCall")]),!u)return(0,o.jsx)(o.Fragment,{},void 0);var h=(0,Xc.getHistoryItemOwner)(u,s),A=h.member,g=h.chat;if(!A&&!g)return(0,o.jsx)(o.Fragment,{},void 0);var m="";if(g)m=t("calls_history_delete_group_call").replace("%name",(0,Ve.shorten)(g.title,50));else{if(!A)return(0,o.jsx)(o.Fragment,{},void 0);var C=u.is_missed,E=u.is_inbound;m=(m=t(C&&E?"calls_history_delete_missed_call":!C&&E?"calls_history_delete_inbound_call":C&&!E?"calls_history_delete_declined_call":"calls_history_delete_outbound_call")).replace("%name",String(A.nameGen||A.name))}var S=(null==u?void 0:u.finished_at)?a(u.finished_at):"";return m=m.replace("%date",S),(0,o.jsx)(Jc,{onClose:_,actionButtons:f,text:m},void 0)},td=t(69050),ad=t(84330),id=t(3244),od=t(6057);const rd=(0,X.makeIcon)("Icon16CalendarOutline","calendar_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="calendar_outline_16"><path fill="currentColor" d="M12 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" /><path fill="currentColor" fill-rule="evenodd" d="M5 .5a.75.75 0 0 1 .75.75v.25H10.251v-.25a.75.75 0 0 1 1.5 0v.318c.347.047.669.13.975.286a3.25 3.25 0 0 1 1.42 1.42c.199.391.28.81.317 1.273.037.448.037.998.037 1.672V9.78c0 .674 0 1.224-.037 1.672-.037.463-.118.882-.317 1.272a3.25 3.25 0 0 1-1.42 1.42c-.391.2-.81.28-1.273.318-.447.037-.998.037-1.671.037H6.219c-.674 0-1.224 0-1.672-.037-.463-.037-.882-.118-1.272-.317a3.25 3.25 0 0 1-1.42-1.42c-.2-.391-.28-.81-.318-1.273-.037-.447-.037-.998-.037-1.672V6.22c0-.674 0-1.224.037-1.672.037-.463.118-.882.317-1.272a3.25 3.25 0 0 1 1.42-1.42c.306-.156.628-.24.976-.287V1.25A.75.75 0 0 1 5 .5ZM10.25 3v.25a.75.75 0 0 0 1.5 0v-.16c.125.028.218.062.294.1a1.75 1.75 0 0 1 .765.766c.074.144.13.343.16.713.027.333.03.751.03 1.331H3c0-.58.004-.998.032-1.331.03-.37.085-.57.159-.713a1.75 1.75 0 0 1 .764-.765c.077-.04.17-.073.295-.101v.16a.75.75 0 1 0 1.5 0V3h4.5ZM3 7.5v2.25c0 .712 0 1.202.032 1.58.03.371.085.57.159.714a1.75 1.75 0 0 0 .765.765c.144.074.343.13.713.16.38.03.869.031 1.581.031h3.5c.712 0 1.202 0 1.58-.032.371-.03.57-.085.714-.159a1.75 1.75 0 0 0 .765-.765c.074-.144.13-.343.16-.713.03-.38.031-.869.031-1.581V7.5H3Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);var sd=function(e){var n=e.onCreateCallClick,t=e.onPlanCalendarEvent,a=rc().getLang;return(0,o.jsx)(id.default,(0,i.__assign)({title:"",isSaved:!1,savedTitle:"",className:""},{children:(0,o.jsx)(oa.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall",border:!1},{children:(0,o.jsx)(ra.default,(0,i.__assign)({chevron:!1,selectable:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(Ea.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:n,size:"s"},{children:[(0,o.jsx)(od.default,{width:16,height:16},void 0),a("calls_page_call_by_link_create")]}),void 0),(0,o.jsxs)(Ea.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:t,appearance:"secondary",size:"s"},{children:[(0,o.jsx)(rd,{},void 0),a("calls_landing_standalone_schedule_call")]}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenCreateCall--title"},{children:a("calls_page_call_by_link_header_v2")}),void 0)}),void 0)}),void 0)}),void 0)},ld=function(e){var n=e.showCreateCall,t=e.onCreateCallClick,a=e.activeMenuItem,r=e.menuItems,s=e.onMenuItemClick,l=e.loading,c=e.banner,d=e.children,u=e.onPlanCalendarEvent;return(0,o.jsx)(td.PageColumns,(0,i.__assign)({narrow:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ad.RightMenu,{tabs:r,activeTab:a,onTabClick:s,loading:l},void 0),c]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen"},{children:[n&&(0,o.jsx)(sd,{onCreateCallClick:function(){return t(ui.CallStatSource.HISTORY_CREATE)},onPlanCalendarEvent:u},void 0),d]}),void 0)}),void 0)},cd=(0,l.createContext)({bridge:{},SDK:{}}),dd=function(){return(0,l.useContext)(cd)},ud=function(){var e=dd().bridge,n=(0,l.useCallback)((function(n){e.showCreateCallByLinkPopup(n)}),[e]),t=(0,l.useCallback)((function(n,t,a){void 0===t&&(t=0),e.showStartCallModal(t,n,a)}),[e]),a=(0,l.useCallback)((function(){e.showPlanCalendarEventPopup()}),[e]),i=(0,l.useCallback)((function(n){var t;null===(t=e.setPlannedCalendarEvent)||void 0===t||t.call(e,n)}),[e]);return{onCreateCallClick:n,onJoin:t,onPlanCalendarEvent:a,setPlannedCalendarEvent:i}},_d=function(){var e=qc((function(e){return e.loading})),n=$c(),t=(0,l.useCallback)((function(e){n((0,ed.dispatchSetLoading)(e))}),[]);return{loading:e,setLoading:t}};const vd=(0,X.makeIcon)("Icon12ArrowDownLeft","arrow_down_left_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_down_left_12"><path d="M3 10a1 1 0 0 1-1-1V4a1 1 0 0 1 2 0v2.586l4.293-4.293a1 1 0 0 1 1.414 1.414L5.415 8.001 8 8a1 1 0 0 1 0 2z" fill="currentColor" /></symbol>',12,12,!1,void 0),pd=(0,X.makeIcon)("Icon12ArrowUpRight","arrow_up_right_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_up_right_12"><path d="M9 2a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V5.414L3.707 9.707a1 1 0 0 1-1.414-1.414l4.292-4.294L4 4a1 1 0 0 1 0-2z" fill="currentColor" /></symbol>',12,12,!1,void 0);var fd=t(67458),hd=t(39446);const Ad=(0,X.makeIcon)("Icon24PhoneOutline","phone_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="phone_outline_24"><g fill="none"><path d="M0 0h24v24H0z" /><path d="M4.477 4.116c-2.924 3.217-1.362 8.196 2.932 12.51 4.204 4.222 9.407 5.8 12.486 2.936 1.685-1.567 1.436-4.343-.645-6.198l-.19-.161c-1.931-1.563-4.734-1.568-6.445-.027l-.088.082-.05-.042c-.187-.16-.43-.381-.724-.673l-.298-.303-.306-.326c-.092-.101-.174-.194-.246-.277l-.124-.147-.07.075c1.69-1.697 1.706-4.72.006-6.75-1.887-2.255-4.75-2.335-6.238-.699zM9.335 5.97c1.18 1.41 1.049 3.371.099 4.325l-.148.14c-.63.567-1.246.901 1.032 3.218 2.458 2.499 2.765 1.622 3.405.952 1.006-1.01 2.975-1.104 4.329.103 1.497 1.334 1.335 2.868.617 3.536-2.222 2.067-6.476.636-9.984-2.888-3.507-3.523-5.064-7.622-2.876-10.03.508-.558 2.101-1.057 3.526.644z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),gd=(0,X.makeIcon)("Icon24VideocamOutline","videocam_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="videocam_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M1 10.9c0-2.24 0-3.36.436-4.216a4 4 0 0 1 1.748-1.748C4.04 4.5 5.16 4.5 7.4 4.5h3.2c2.24 0 3.36 0 4.216.436a4 4 0 0 1 1.748 1.748c.155.305.255.643.32 1.053l.577-.414c.948-.68 1.422-1.02 1.785-1.15a2.8 2.8 0 0 1 3.65 1.874C23 8.418 23 9 23 10.167v4.02c0 1.04 0 1.56-.093 1.9a2.6 2.6 0 0 1-3.309 1.781c-.335-.109-.769-.395-1.637-.967l-1.067-.704c-.064.44-.167.798-.33 1.119a4 4 0 0 1-1.748 1.748c-.856.436-1.976.436-4.216.436H7.4c-2.24 0-3.36 0-4.216-.436a4 4 0 0 1-1.748-1.748C1 16.46 1 15.34 1 13.1v-2.2Zm6.4-4.6h3.2c1.15 0 1.904.001 2.48.049.556.045.787.124.919.19a2.2 2.2 0 0 1 .961.962c.067.132.146.363.191.918.048.577.049 1.331.049 2.481v2.2c0 1.15-.001 1.904-.048 2.48-.046.556-.125.787-.192.919a2.2 2.2 0 0 1-.961.961c-.132.067-.363.146-.918.191-.577.048-1.331.049-2.481.049H7.4c-1.15 0-1.904-.001-2.48-.049-.556-.045-.787-.124-.919-.19a2.2 2.2 0 0 1-.961-.962c-.067-.132-.146-.363-.191-.918C2.8 15.004 2.8 14.25 2.8 13.1v-2.2c0-1.15.001-1.904.049-2.48.045-.556.124-.787.19-.919a2.2 2.2 0 0 1 .962-.961c.132-.067.363-.146.918-.192C5.496 6.301 6.25 6.3 7.4 6.3Zm10.153 3.172.957-.686c.486-.348.808-.579 1.054-.741l.295-.18a1 1 0 0 1 1.302.663s.017.084.027.35c.012.296.012.692.012 1.29v4.02c0 .534 0 .883-.01 1.142a2.89 2.89 0 0 1-.022.288.8.8 0 0 1-1.004.541 2.852 2.852 0 0 1-.253-.14 33.487 33.487 0 0 1-.959-.62l-1.356-.895a247.905 247.905 0 0 1-.35-.237.7.7 0 0 1-.24-.446S17 13.422 17 13.398v-2.85l.005-.403a.7.7 0 0 1 .223-.434s.307-.226.325-.24Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var md,Cd=t(81536);!function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.MESSAGE=2]="MESSAGE",e[e.DELETE=3]="DELETE"}(md||(md={}));var Ed=function(e,n){void 0===n&&(n=0);var t="";if(n){var a=new Date(n);if((0,s.isDateToday)(a)){var i=(0,s.leadingZero)(a.getMinutes());t=a.getHours()+":"+i}else t=n?e(n,!1):""}return t},Sd=function(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}},Id=(0,l.memo)((function(e){var n=e.index,t=e.call,a=e.onMenuItemClick,r=e.selectedOwnerId,c=void 0===r?0:r,d=qc((function(e){return e.profiles})),u=rc(),_=u.getLang,v=u.langShortDate,p=(0,Xc.getHistoryItemOwner)(t,d),f=p.member,h=p.chat,A=(0,l.useMemo)((function(){var e=t.type,r=t.items,l=t.started_at,c=t.finished_at,d="";l&&c&&(d=(0,s.formatDuration)(Math.floor((c-l)/1e3)));var u=function(e){if(void 0===e&&(e=0),!e)return{date:"",time:""};var n=new Date(e),t=n.getDate(),a=n.getMonth()+1,i=n.getFullYear(),o=n.getHours(),r=n.getMinutes();return{date:[(0,s.leadingZero)(t),(0,s.leadingZero)(a),i].join("."),time:[(0,s.leadingZero)(o),(0,s.leadingZero)(r)].join(":")}}(c),p=u.date,A=u.time,g=h?function(e,n,t,a){var i=t.title,o=void 0===i?"":i,r=t.photo_100,s=void 0===r?"":r,l=t.id,c=void 0===l?0:l,d=a.finished_at,u=void 0===d?0:d,_=c?"/im?sel=c"+c:"",v=e("calls_history_call_type_group_hint"),p=Ed(n,u);return{title:o,href:_,hint:p?e("calls_history_call_type_group_time_hint").replace("{time}",p):"",photo:s,status:v}}(_,v,h,t):f?function(e,n,t,a){var r=t.name,l=void 0===r?"":r,c=t.photo,d=void 0===c?"":c,u=t.id,_=void 0===u?0:u,v=t.link,p=void 0===v?"":v,f=a.is_inbound,h=void 0!==f&&f,A=a.finished_at,g=void 0===A?0:A,m=a.reach_status,C=void 0===m?"":m,E=h?(0,o.jsx)(vd,{className:"CallHistoryListItem--hintIcon"},void 0):(0,o.jsx)(pd,{className:"CallHistoryListItem--hintIcon"},void 0),S=Ed(n,g),I="",T=!1;return h?"CANCELLED_BY_INITIATOR"===C?(I=e("calls_history_status_inb_cancelled_by_initiator"),T=!0):I=e("REACHED"===C?"calls_history_status_inb_reached":"REJECTED_BY_RECEIVER"===C?"calls_history_status_inb_reject_by_receiver":"calls_history_status_inb"):"CANCELLED_BY_INITIATOR"===C?I=e("calls_history_status_out_cancelled_by_initiator"):"REACHED"===C?I=e("calls_history_status_out_reached"):"REJECTED_BY_RECEIVER"===C?(I=e("calls_history_status_out_reject_by_receiver"),T=!0):I=e("calls_history_status_out"),{title:l,href:p||"/id"+_,hint:(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallHistoryListItem",{"CallHistoryListItem--important":T})},{children:[E,e("calls_history_call_list_item_description").replace("%type",I).replace("%time",S)]}),void 0),photo:d,status:I}}(_,v,f,t):{},m=g.title,C=void 0===m?"":m,E=g.photo,S=void 0===E?"":E,I=g.href,T=void 0===I?"":I,N=g.hint,x=void 0===N?"":N,y=g.status,b=void 0===y?"":y;C+="merged"===e?" ("+(null==r?void 0:r.length)+")":"";var O=(0,Xc.getHistoryCallPeerId)(t),w=[],M=function(e){return function(){return a(t,e,n)}};return w.push({onClick:function(){},noHover:!0,text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatus"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusFinishTime"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDate"},{children:p}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusTime"},{children:A}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusType"},{children:b}),void 0),!!d&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDuration"},{children:d}),void 0)]}),void 0)}),O&&(w.push(Sd((0,o.jsx)(fd.default,{},void 0),_("calls_history_dropdown_item_message"),M(md.MESSAGE))),w.push({separator:!0})),w.push(Sd((0,o.jsx)(hd.default,{},void 0),_("calls_history_dropdown_item_delete"),M(md.DELETE))),{title:C,photo:S,href:T,hint:x,actions:w,peerId:O}}),[t]),g=A.title,m=A.photo,E=A.href,S=A.hint,I=A.actions,T=A.peerId;return f||h?(0,o.jsx)(ra.default,(0,i.__assign)({className:"CallHistoryListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--aside"},{children:[!!T&&!(null==h?void 0:h.left_or_kicked)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_audio")},{children:(0,o.jsx)(Ad,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return a(t,md.AUDIO,n,c)}},void 0)}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_video")},{children:(0,o.jsx)(gd,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return a(t,md.VIDEO,n,c)}},void 0)}),void 0)]},void 0),(0,o.jsx)(Dt.default,(0,i.__assign)({className:"CallHistoryListItem--asideMenu",trigger:"hover",align:"right",data:I},{children:(0,o.jsx)(Cd.default,{className:"CallHistoryScreen--friendsIcon CallHistoryListItem--asidePointers"},void 0)}),void 0)]}),void 0)},{children:(0,o.jsx)(Ca.default,{className:"CallHistoryListItem--entity",photo:m,title:g,href:E,description:S||_("calls_history_call_type_group_hint"),target:"_blank"},void 0)}),void 0):(0,o.jsx)(o.Fragment,{},void 0)})),Td=t(23985),Nd=function(e){var n=e.calls,t=e.onMenuItemClick,a=e.stubText,r=e.hasMore,s=e.onLoadMore,l=e.selectedOwnerId,c=void 0===l?0:l;return(0,o.jsx)(Td.default,(0,i.__assign)({useWindowScroll:!0,hasMore:r,loadMore:s},{children:(0,o.jsxs)(oa.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[n.map((function(e,n){return(0,o.jsx)(Id,{selectedOwnerId:c,onMenuItemClick:t,call:e,index:n},n)})),0===n.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:a}),void 0)]}),void 0)}),void 0)},xd=(0,l.createContext)({navigateToConvo:function(e){},navigateToProfile:function(e,n){}}),yd=function(){return(0,l.useContext)(xd)},bd=function(){var e=qc((function(e){return e.profiles})),n=qc((function(e){return e.joinLinks})),t=$c(),a=yd().navigateToConvo,i=dd().bridge,o=(0,l.useCallback)((function(o,r,s,l){var c;void 0===l&&(l=0);var u=(0,Xc.getHistoryCallPeerId)(o);if(r===md.AUDIO||r===md.VIDEO){if(i.isInActiveCall)return;var _=r===md.VIDEO;if((0,O.isGroupCallByPeer)(u))if(u in n)i.joinCallByLink(n[u],void 0,_,d.CallStatSource.HISTORY,l);else{var v=(0,Xc.getHistoryItemOwner)(o,e).chat;(null==v?void 0:v.call_in_progress)&&(null===(c=null==v?void 0:v.call_in_progress)||void 0===c?void 0:c.join_link)?i.joinCallByLink(v.call_in_progress.join_link,void 0,_,d.CallStatSource.HISTORY,l):i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else r===md.MESSAGE?a(u):t((0,ed.dispatchDeleteCall)(s))}),[n,e,i]);return{onHistoryAction:o}},Od=function(e){void 0===e&&(e="all");var n=(0,Bl.useIsMounted)(),t=qc((function(e){return e.historyCalls})),a=(0,c.useDispatch)(),o=_d(),r=o.setLoading,s=o.loading,d=(0,i.__read)((0,l.useState)(!1),2),u=d[0],_=d[1],v=(0,i.__read)((0,l.useState)(0),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(!1),2),A=h[0],g=h[1];(0,l.useEffect)((function(){r(!0),(0,ed.loadHistoryCalls)(a,25,p,0,e).then((function(e){var t,a;if(n())return _(null!==(t=e.has_more)&&void 0!==t&&t),f(null!==(a=e.next_from)&&void 0!==a?a:0),e})).then((function(e){e&&(0,ed.updateProfilesAndUrls)(a,[e]).then((function(e){g(!e)}))})).finally((function(){n()&&r(!1)}))}),[]);var m=function(t,i,o,r){return void 0===o&&(o=[]),void 0===r&&(r=!1),(0,ed.loadHistoryCalls)(a,25,t,i,e,o,r).then((function(e){var t,a;return!!n()&&(_(null!==(t=e.has_more)&&void 0!==t&&t),f(null!==(a=e.next_from)&&void 0!==a?a:0),e)})).then((function(e){return!!e&&(0,ed.updateProfilesAndUrls)(a,[e])}))};return{onShowMoreHistory:function(){return m(p,0,t)},loadHistory:m,loading:s,showMoreHistory:u,showLanding:A,setLoading:r}},wd=function(){var e=qc((function(e){return e.historyCalls})),n=rc().getLang,t=Od("missed"),a=t.onShowMoreHistory,r=t.loading,s=t.showMoreHistory,l=bd().onHistoryAction;return r?(0,o.jsx)(id.default,{children:(0,o.jsx)(kl.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsx)(id.default,(0,i.__assign)({title:n("calls_history_missed_list_header"),className:"CallHistoryScreen--content"},{children:(0,o.jsx)(Nd,{calls:e,onMenuItemClick:l,stubText:n("calls_history_missed_list_stub"),hasMore:s,onLoadMore:a},void 0)}),void 0)},Md=t(25432),Pd=t(60837),kd=t(33024),Ld=function(e){var n=e.onChange,t=e.placeholder,a=e.className,r=(0,i.__read)((0,l.useState)(""),2),c=r[0],d=r[1];return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ui_search_new","ui_search",a)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_block"},{children:[(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_button_search"},{children:(0,o.jsx)(Pd.default,{},void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_inner"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ui_search_controls"},{children:!!c&&(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_reset_button ui_search_button_control",onClick:function(){d(""),null==n||n("")}},{children:(0,o.jsx)(kd.default,{},void 0)}),void 0)}),void 0),(0,o.jsx)("form",(0,i.__assign)({onSubmit:function(e){e.preventDefault()}},{children:(0,o.jsx)("input",{type:"text",className:"ui_search_field",placeholder:t,value:c,onChange:function(e){e.preventDefault();var t=e.target.value;d(t),null==n||n(t)}},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},Dd=100;var jd=function(){var e=rc(),n=e.getLang,t=e.langShortDate,a=e.langNumeric,r=e.langSex,s=qc((function(e){return e.meId})),c=_d(),u=c.setLoading,_=c.loading,v=dd().bridge,p=(0,i.__read)((0,l.useState)([]),2),f=p[0],h=p[1],A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],m=A[1],C=(0,i.__read)((0,l.useState)(0),2),E=C[0],S=C[1],I=(0,i.__read)((0,l.useState)(0),2),T=I[0],N=I[1],y=(0,i.__read)((0,l.useState)(""),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)(!1),2),M=w[0],P=w[1],k=(0,l.useRef)(null),L=qc((function(e){return!!e.config.enableNewSearchInput}));(0,l.useEffect)((function(){u(!0);(0,nn.getFriends)(100,E).then((function(e){var n=e.count,t=e.items;N(n);m(100<n),S(100);var a=t.map(tn.normalizeUser);h(a)})).finally((function(){u(!1)}))}),[]);var D=(0,l.useMemo)((function(){return T>Dd}),[T]);(0,l.useEffect)((function(){var e=b;if(D){if(e.length>=1&&!M)return k.current&&clearTimeout(k.current),k.current=setTimeout((function(){P(!0),(0,nn.friendsSearch)(s,e,50).then((function(e){var n=e.count,t=e.items;m(50<n),S(50);var a=t.map(tn.normalizeUser);h(a)})).finally((function(){P(!1)}))}),1e3),function(){clearTimeout(k.current)};0===e.length&&(0,nn.getFriends)(Dd,0).then((function(e){var n=e.count,t=e.items;m(100<n),S(100);var a=t.map(tn.normalizeUser);h(a)}))}}),[b]);var j=(0,l.useCallback)((function(e,n){v.call(e,n,void 0,d.CallStatSource.HISTORY_FRIENDS_LIST)}),[]),R=(0,l.useCallback)((function(e){return e.name}),[]),B=(0,l.useCallback)((function(e){return e.peerId}),[]),U=x(f,R,B),H=b&&!D?U.search(b):f,G=(0,l.useCallback)((function(e){O(e.target.value)}),[]),V=function(e,s){var l,c,d,u,_,v,p,f="";return(null===(l=e.onlineInfo)||void 0===l?void 0:l.is_online)?f="Online":(null===(c=e.onlineInfo)||void 0===c?void 0:c.last_seen)?f=function(e,n,t,a){var i=Math.floor((Date.now()-a)/1e3);return i<60?e("global_just_now"):i<3600?n(Math.floor(i/60),"global_mins_ago",e("global_mins_ago",!0)):i<21600?n(Math.floor(i/3600),"global_hours_ago",e("global_hours_ago",!0)):t(a,!1)}(n,a,t,1e3*(null===(d=e.onlineInfo)||void 0===d?void 0:d.last_seen)):(null===(u=e.onlineInfo)||void 0===u?void 0:u.status)&&(f="recently"===(null===(_=e.onlineInfo)||void 0===_?void 0:_.status)?r(e.sex,"global_online_was_recently",n("global_online_was_recently",!0)):"last_week"===(null===(v=e.onlineInfo)||void 0===v?void 0:v.status)?r(e.sex,"global_online_was_week",n("global_online_was_week",!0)):r(e.sex,"global_online_long_ago",n("global_online_long_ago",!0))),(0,o.jsx)(ra.default,(0,i.__assign)({selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsIcons"},{children:[(0,o.jsx)(Ad,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return j(e.peerId,!1)}},void 0),(0,o.jsx)(gd,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return j(e.peerId,!0)}},void 0)]}),void 0)},{children:(0,o.jsx)(Ca.default,{size:"34",photo:(0,o.jsx)(Md.default,{id:s,photo:e.photo,title:e.name,isOnline:null===(p=e.onlineInfo)||void 0===p?void 0:p.is_online},void 0),title:e.name,href:e.link,description:f,target:"_blank"},void 0)}),s)};return _?(0,o.jsx)(id.default,{children:(0,o.jsx)(kl.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsxs)(id.default,(0,i.__assign)({title:n("calls_page_menu_friends_calls"),className:"CallHistoryScreen--content"},{children:[!L&&(0,o.jsx)(ha.BlockSearchInput,{className:"CallParticipantList__input",value:b,placeholder:n("global_search"),onChange:G,onInput:G,onPaste:G},void 0),L&&(0,o.jsx)(Ld,{className:"CallParticipantList__input--new",placeholder:n("global_search"),onChange:O},void 0),(0,o.jsx)(Td.default,(0,i.__assign)({useWindowScroll:!0,hasMore:g,loadMore:function(){return b&&D?(0,nn.friendsSearch)(s,b,50,E).then((function(e){var n=e.count,t=e.items,a=E+50;m(a<n),S(a);var o=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(t.map(tn.normalizeUser)),!1);return h(o),!0})):(0,nn.getFriends)(Dd,E).then((function(e){var n=e.items,t=E+Dd;m(t<T),S(t);var a=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(n.map(tn.normalizeUser)),!1);return h(a),!0}))}},{children:(0,o.jsxs)(oa.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[H.map((function(e,n){return V(e,n)})),0===H.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:n("calls_page_friends_not_found")}),void 0)]}),void 0)}),void 0)]}),void 0)},Rd=t(80170);var Bd=function(e){var n=e.call,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a,s=qc((function(e){return e.profiles})),c=rc(),u=c.getLang,_=c.langNumeric,v=(0,Xc.getCurrentCallOwner)(n,s),p=v.member,f=v.chat,h=(0,l.useMemo)((function(){var e,t,a=f?function(e){var n=e.title,t=void 0===n?"":n,a=e.photo_100,i=void 0===a?"":a,o=e.id,r=void 0===o?0:o;return{title:t,photo:i,href:r?"/im?sel=c"+r:"",id:r}}(f):p?function(e){var n=e.name,t=void 0===n?"":n,a=e.photo,i=void 0===a?"":a,o=e.link,r=void 0===o?"":o,s=e.id,l=void 0===s?0:s;return{title:t,photo:i,href:r||"/im?sel=c"+l,id:l}}(p):{},o=a.id,r=void 0===o?0:o,l=a.title,c=void 0===l?"":l,d=a.photo,v=void 0===d?"":d,h=a.href,A=void 0===h?"":h,g=n.users_count,m=n.user_ids,C=n.join_link,E=void 0===C?"":C,S=n.caller_id,I=n.name;S&&(0,k.isParticipantGroup)(S)&&(c=I||c);var T=_(g,"calls_history_members_count",u("calls_history_members_count",g)).replace("%n",String(g)),N=m.slice(0,3),x=[];try{for(var y=(0,i.__values)(N),b=y.next();!b.done;b=y.next()){var O=b.value;O in s&&x.push((0,tn.getMemberForUserStack)(s[O]))}}catch(n){e={error:n}}finally{try{b&&!b.done&&(t=y.return)&&t.call(y)}finally{if(e)throw e.error}}return{id:r,title:c,photo:v,href:A,description:T,join_link:E,avatarItems:x}}),[f,n,p,s]),g=h.id,m=h.title,C=h.photo,E=h.href,S=h.description,I=h.avatarItems,T=h.join_link;return p||f?(0,o.jsx)(ra.default,(0,i.__assign)({border:r,className:"CurrentCallsListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)(o.Fragment,{children:[I.length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"CurrentCallsListItem--avatarStack"},{children:(0,o.jsx)(Rd.AvatarsStackNoSvg,{size:Rd.AvatarsStackNoSvgSizes.SIZE_24,items:I},void 0)}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({size:"s",onClick:function(){return t(T,g,d.CallStatSource.HISTORY)}},{children:u("calls_history_join_call_button")}),void 0)]},void 0)},{children:(0,o.jsx)(Ca.default,{photo:(0,o.jsx)(A.CallPhoto,{id:g,photo:C,alt:m,size:"34"},void 0),title:m,href:E,description:S,target:"_blank"},void 0)}),g):(0,o.jsx)(o.Fragment,{},void 0)},Ud=function(e){var n=e.currentCalls,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a;return n.length?(0,o.jsx)(oa.default,(0,i.__assign)({border:!1},{children:n.map((function(e,n){return(0,o.jsx)(Bd,{listItemBorder:r,call:e,onJoin:t},n)}))}),void 0):(0,o.jsx)(o.Fragment,{},void 0)},Hd=function(){var e=$c(),n=qc((function(e){return e.profiles})),t=qc((function(e){return e.currentCalls})),a=qc((function(e){return e.callsQueueResponse})),o=(0,i.__read)((0,l.useState)(!0),2),r=o[0],s=o[1],c=function(){s(!0),(0,ed.loadCurrentCalls)(e).then((function(n){(0,ed.updateProfilesAndUrls)(e,[n])})).finally((function(){s(!1)}))};return(0,l.useEffect)((function(){c()}),[]),(0,l.useEffect)((function(){var e;!!(null===(e=null==a?void 0:a.events)||void 0===e?void 0:e.some((function(e){var n;return"current_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&c()}),[a]),{currentCallsBlockLoading:r,currentCalls:t,profiles:n}},Gd=function(){var e=rc().getLang,n=ud().onJoin,t=Hd(),a=t.currentCallsBlockLoading,r=t.currentCalls,s=t.profiles,c=_d().setLoading,d=(0,l.useMemo)((function(){return a?(0,o.jsx)(id.default,{children:(0,o.jsx)(kl.DivBlockSkeleton,{height:300},void 0)},void 0):(0,o.jsxs)(id.default,(0,i.__assign)({title:e("calls_history_current_list_header"),className:"CallHistoryScreen--content CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(Ud,{currentCalls:r,profiles:s,onJoin:n},void 0),0===r.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:e("calls_history_current_calls_list_stub")}),void 0)]}),void 0)}),[a,r]);return(0,l.useEffect)((function(){c(a)}),[a]),(0,o.jsx)(o.Fragment,{children:d},void 0)};const Vd=(0,X.makeIcon)("Icon28ChainOutline","chain_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="chain_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M12.59 16.83c-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l5.24-5.24a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.436 1.436a.999.999 0 0 1-1.414-1.41l1.43-1.436a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-5.23 5.23a2.982 2.982 0 0 0 0 4.24c.41.39.41 1.03 0 1.42Zm2.82-5.66c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-5.24 5.24a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.431-1.431a1 1 0 0 1 1.414 0h.001c.39.392.39 1.025 0 1.415L5.94 17.82a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l5.23-5.23a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),Fd=(0,X.makeIcon)("Icon28ArrowUpRectangleOutline","arrow_up_rectangle_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" id="arrow_up_rectangle_outline_28"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.07 4.801C6.164 4.216 7.243 4 9.691 4h8.616c2.448 0 3.527.216 4.622.801A5.465 5.465 0 0 1 25.2 7.07c.585 1.096.801 2.175.801 4.623v4.616c0 2.448-.216 3.527-.801 4.622A5.465 5.465 0 0 1 22.93 23.2c-1.095.585-2.174.801-4.622.801H9.692c-2.448 0-3.527-.216-4.623-.801a5.465 5.465 0 0 1-2.268-2.269C2.216 19.835 2 18.756 2 16.308v-4.616c0-2.448.216-3.527.801-4.623A5.466 5.466 0 0 1 5.07 4.801ZM9.691 6c-2.335 0-3.019.212-3.68.565a3.466 3.466 0 0 0-1.447 1.448C4.212 8.673 4 9.357 4 11.692v4.616c0 2.335.212 3.019.565 3.68a3.466 3.466 0 0 0 1.448 1.447c.66.353 1.344.565 3.679.565h8.616c2.335 0 3.019-.212 3.68-.565a3.467 3.467 0 0 0 1.447-1.448c.353-.66.565-1.344.565-3.679v-4.616c0-2.335-.212-3.019-.565-3.68a3.466 3.466 0 0 0-1.448-1.447C21.327 6.212 20.643 6 18.308 6H9.692Z" fill="currentColor" /><path d="M13 18a1 1 0 1 0 2 0v-5.586l1.293 1.293a1 1 0 0 0 1.414-1.414l-3-3a1 1 0 0 0-1.414 0l-3 3a1 1 0 1 0 1.414 1.414L13 12.414V18Z" fill="currentColor" /></symbol>',28,28,!1,void 0);var Wd=function(e){var n=e.onCreateCallClick,t=rc().getLang;return(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--header"},{children:t("calls_screen_landing_header")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--subheader"},{children:t("calls_screen_landing_subheader")}),void 0),(0,o.jsxs)(oa.default,(0,i.__assign)({className:"CallHistoryScreenLanding--list",border:!1},{children:[(0,o.jsx)(ra.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Bo,{},void 0)},{children:t("calls_screen_landing_feature_participants")}),void 0),(0,o.jsx)(ra.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Vd,{},void 0)},{children:t("calls_screen_landing_feature_anon")}),void 0),(0,o.jsx)(ra.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Fd,{},void 0)},{children:t("calls_screen_landing_feature_share")}),void 0)]}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({size:"l",className:"CallHistoryScreenLanding--createButton",onClick:function(){return n(ui.CallStatSource.HISTORY_CREATE)}},{children:t("calls_current_calls_create_call_by_link")}),void 0)]}),void 0)}),void 0)},Zd=t(64891);const zd=(0,X.makeIcon)("Icon28PhoneOutline","phone_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="phone_outline_28"><g fill-rule="nonzero" fill="none"><path d="M0 0h28v28H0z" /><path d="m16.112 17.259-.734.734a.712.712 0 0 1-.75.166c-.73-.269-1.643-.95-2.74-2.047-1.095-1.096-1.778-2.01-2.045-2.74a.712.712 0 0 1 .164-.75l.736-.734c1.354-1.354 1.478-3.487.284-4.903l-.862-1.024c-.984-1.17-2.756-1.288-3.96-.264a3.319 3.319 0 0 0-.974 1.443 3.25 3.25 0 0 0-.159.752c-.44 3.272 1.137 6.707 4.733 10.303 3.596 3.596 7.03 5.174 10.303 4.733a3.318 3.318 0 0 0 2.195-1.134c1.024-1.202.905-2.976-.263-3.96l-1.025-.862c-1.417-1.192-3.55-1.067-4.903.287Zm-2.81-2.561c.525.523.982.92 1.35 1.191 2.124-2.123 5.428-2.317 7.652-.447l1.023.862c2.03 1.708 2.233 4.751.49 6.798-.896 1.036-2.156 1.687-3.442 1.808-3.982.536-7.987-1.303-11.984-5.3-3.997-3.998-5.837-8.004-5.31-11.896.036-.414.122-.822.257-1.22A5.33 5.33 0 0 1 4.91 4.174c2.037-1.732 5.079-1.53 6.785.5l.86 1.023c1.873 2.22 1.681 5.527-.4 7.608.227.413.624.87 1.148 1.394Z" fill="currentColor" /></g></symbol>',28,28,!1,void 0);var Kd,Qd=t(33483),Yd=t(59247);!function(e){e[e.Preview=0]="Preview",e[e.Full=1]="Full"}(Kd||(Kd={}));var Jd=function(e){var n=e.type,t=void 0===n?Kd.Preview:n,a=e.forceUpdate,o=e.disabled,r=e.callerId,s=(0,ue.useLang)().getLang,c=(0,Yd.useLocale)().locale,d=(0,Tc.usePromiseError)().handleError,u=(0,Bl.useIsMounted)(),_=(0,l.useRef)(),v=(0,i.__read)((0,l.useState)(),2),p=v[0],f=v[1],h=$c(),A=qc((function(e){return e.scheduledCalls})),g=qc((function(e){return e.scheduledCallsPreview})),m=qc((function(e){return e.profiles}));(0,l.useEffect)((function(){if(null==p?void 0:p.size){var e=[];p.forEach((function(n){m[n]||e.push(n)})),e.length&&(0,nn.loadCallPeersByPeerIds)(e).then((function(e){if(u()){var n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.profiles||[]),!1),(0,i.__read)(e.groups||[]),!1);n.length&&(0,ed.loadProfiles)(h,n)}})).catch(d)}}),[p,m]);var C=(0,l.useCallback)((function(){if(!o){var e,n=new Date,a={grouped:1};switch(a.start_time=Math.round(n.valueOf()/1e3),r&&(a.caller_id=r),t){case Kd.Full:a.finish_time=a.start_time+31536e3,e=qd;break;case Kd.Preview:a.finish_time=a.start_time+604800,e=Xd}e(h,{loading:!0}),(0,nn.messagesGetScheduledCalls)(a).then((function(t){if(u()){var a=(0,Qd.mapCalls)({now:n,items:null==t?void 0:t.items,locale:c,getLang:s,groups:null==t?void 0:t.groups}),i=a.calls,o=a.callerIds,r=a.total;e(h,{items:i,total:r}),f(o)}})).catch(d).finally((function(){u()&&e(h,{loading:!1})})),_.current=function(){e(h)}}}),[t,o,r]);return(0,l.useEffect)((function(){return function(){var e;null===(e=_.current)||void 0===e||e.call(_)}}),[]),(0,l.useEffect)((function(){C()}),[t,a,r]),{scheduledCalls:A,scheduledCallsPreview:g,fetchData:C}};function Xd(e,n){e({type:Qc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW,data:n})}function qd(e,n){e({type:Qc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS,data:n})}var $d=t(32997),eu=function(e){var n=e.children;return(0,o.jsx)(ra.default,(0,i.__assign)({className:"CallsScheduledRowBlockTitle",selectable:!1,canBeHovered:!1},{children:n}),void 0)},nu=t(767),tu=function(e){var n=e.text,t=e.href,a=e.className,r=e.onClick,l=e.rightIcon,c=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__text"},{children:n}),void 0),l&&(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__icon"},{children:l}),void 0)]},void 0);return t?(0,o.jsx)(Zd.default,(0,i.__assign)({href:t,className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0)},au=function(e){var n,t,a=e.calls,r=e.loading,c=e.onLinkClick,d=e.skeletonHeight,u=e.ownerSelect,_=e.section,v=(0,ue.useLang)().getLang,p=$c(),f=(0,wc.useNotifier)().showText,h=dd().bridge,A=yd().navigateToConvo,g=(0,i.__read)((0,l.useState)((function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone})),1)[0],m=qc((function(e){return e.meId})),C=qc((function(e){return e.profiles[m]})),E=(0,Ic.useCalendarEventDetails)({meParticipant:C}),S=(0,Bl.useIsMounted)(),I="scheduled"===_,T=function(e){var n=e.allCalls,t=e.isScheduledSection,a=(0,i.__read)((0,l.useState)(!1),2),o=a[0],r=a[1],c=(0,l.useCallback)((function(){r((function(e){return!e}))}),[]),d=(0,l.useMemo)((function(){var e,a;if((0,s.isUndefined)(n)||t||o||!n.total||n.total<=3||!Array.isArray(null==n?void 0:n.items))return n;var r=[],l=0;try{for(var c=(0,i.__values)(null==n?void 0:n.items),d=c.next();!d.done;d=c.next()){var u=d.value,_=u.calls,v=(0,i.__rest)(u,["calls"]);if(l>=3)break;var p=3-l,f=_.length<p?_:_.slice(0,p);r.push((0,i.__assign)((0,i.__assign)({},v),{calls:f})),l+=f.length}}catch(n){e={error:n}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(e)throw e.error}}return r.length?(0,i.__assign)((0,i.__assign)({},n),{items:r}):null}),[n,o]);return{isShowAll:o,toggleShowAll:c,calls:d}}({allCalls:a,isScheduledSection:I}),N=T.calls,x=T.isShowAll,y=T.toggleShowAll;(0,l.useEffect)((function(){C||(0,nn.loadChatMembers)(m).then((function(e){(null==e?void 0:e.profiles)&&S()&&(0,ed.loadProfiles)(p,e.profiles)}))}),[C,m]);var b=(0,l.useCallback)((function(e){h.joinCallByLink(e.join_link,void 0,!1,ui.CallStatSource.HISTORY)}),[]),O=(0,l.useCallback)((function(e){e.vk_join_link&&(0,s.copyTextToClipboard)(e.vk_join_link).then((function(){f(v("calls_create_call_by_link_copied"))}))}),[v,f]),w=(0,l.useCallback)((function(e){var n,t,a,i,o={call_id:e.call_id,title:e.name||"",start:new Date(1e3*((null===(n=e.schedule)||void 0===n?void 0:n.time)||0)),timezone:g,duration:(null===(t=e.schedule)||void 0===t?void 0:t.duration)||0,join_link:e.vk_join_link||"",repeatRule:(0,kc.mapRecurrenceRule)(null===(a=e.schedule)||void 0===a?void 0:a.recurrence_rule)};(null===(i=e.group)||void 0===i?void 0:i.name)&&(o.displayName=e.group.name),(0,s.copyTextToClipboard)(E.getDescription(o)).then((function(){f(v("calls_create_call_by_link_text_copied"))}))}),[E,v,f]),M=(0,l.useCallback)((function(e){p({type:Qc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),p({type:Qc.HistoryScreenActionTypes.SET_POPUP,data:Qc.EHistoryScreenPopup.DeleteCalendarEvent})}),[]),P=(0,l.useCallback)((function(e){p({type:Qc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),p({type:Qc.HistoryScreenActionTypes.SET_POPUP,data:Qc.EHistoryScreenPopup.EditCalendarEvent})}),[]),k=(0,l.useCallback)((function(){c&&c(event,"scheduled","calls?section=scheduled")}),[c]),L=(0,l.useCallback)((function(e){var n;(null===(n=e.chat)||void 0===n?void 0:n.peer_id)&&A(e.chat.peer_id)}),[A]),D=function(){var e;return I&&(null===(e=null==u?void 0:u.options)||void 0===e?void 0:e.length)?(0,o.jsx)($d.default,(0,i.__assign)({className:"CallHistoryScreen--listHeaderSelector",disabled:r},u),void 0):c&&!I?(0,o.jsx)(Zd.default,(0,i.__assign)({className:"CallHistoryScreen--moreLink",href:"/calls?section=scheduled",onClick:k},{children:v("calls_show_all")}),void 0):void 0}(),j=!!(null===(n=null==N?void 0:N.items)||void 0===n?void 0:n.length),R=r&&!j,B=!r&&j,U=!(r||j||c&&!(null==u?void 0:u.value)),H=j||U||R,G=r&&j,V=B&&!I&&(null==a?void 0:a.total)&&a.total>3,F=x?v("calls_collapse"):v("calls_history_scheduled_calls_show_all").replace("{count}",((null==a?void 0:a.total)||0)-3);return H?(0,o.jsxs)(id.default,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--content",{"CallHistoryScreen--currentCalls":!R})},{children:[!R&&(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--listHeader","HistoryScreenScheduledCalls__header",{"HistoryScreenScheduledCalls__header--standalone":I&&!U}),right:D},{children:v("calls_scheduled")}),void 0),R&&(0,o.jsx)(kl.DivBlockSkeleton,{height:d||300},void 0),G&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(Le.default,{},void 0)},void 0),B&&(null===(t=null==N?void 0:N.items)||void 0===t?void 0:t.map((function(e,n){return(0,o.jsxs)("div",{children:[(0,o.jsx)(eu,{children:e.title},void 0),e.calls.map((function(t){return(0,o.jsx)(nu.ScheduledCallRow,{call:t,isToday:e.isToday,isTomorrow:e.isTomorrow,onCallEnter:b,onCallCopyLink:O,onCallCopyText:w,onCallDelete:M,onCallEdit:P,onCallMessage:L},t.call_id+"-"+n)}))]},e.title)}))),V&&(0,o.jsx)(tu,{text:F,onClick:y},void 0),U&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:v("calls_history_scheduled_calls_list_stub")}),void 0)]}),void 0):null},iu=function(e){var n=e.historyCalls,t=e.loading,a=e.historyBlockReloading,r=e.selectedOwnerId,s=e.ownerOptions,c=e.onGroupSelectChange,d=e.onHistoryAction,u=e.onShowMoreHistory,_=e.showMoreHistory,v=e.isShowList,p=(0,ue.useLang)().getLang,f=(0,l.useMemo)((function(){return s.length>1?(0,o.jsx)(No.default,{className:"CallHistoryScreen--listHeaderSelector",options:s,value:r,onChange:c},void 0):(0,o.jsx)(o.Fragment,{},void 0)}),[s]),h=(0,l.useMemo)((function(){return p(0===r?"calls_history_list_stub":"calls_history_list_groups_stub")}),[r]),A=!(t||a||v||n.length),g=p("calls_history_list_header");return(0,o.jsxs)(id.default,(0,i.__assign)({title:A?g:void 0},{children:[A&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:h}),void 0),t&&(0,o.jsx)(kl.DivBlockSkeleton,{height:500},void 0),v&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:f},{children:g}),void 0),a&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(Le.default,{},void 0)},void 0),!a&&(0,o.jsx)(Nd,{selectedOwnerId:r,calls:n,onMenuItemClick:d,stubText:h,hasMore:_,onLoadMore:u},void 0)]},void 0)]}),void 0)},ou=function(e){void 0===e&&(e={});var n=e.initialOptions,t=(0,i.__read)((0,l.useState)([]),2),a=t[0],o=t[1];return(0,l.useEffect)((function(){a.length||(0,nn.getGroupsForCall)().then((function(e){var t=e.count,a=e.items,i=n||[];t>0&&(a.forEach((function(e){var n=e.id,t=e.name,a=void 0===t?"":t;i.push({value:-n,label:a})})),o(i))}))}),[]),{ownerOptions:a}},ru=function(){var e=(0,ue.useLang)().getLang,n=(0,c.useStore)(),t=$c(),a=qc((function(e){return e.historyCalls})),o=qc((function(e){return e.joinLinks})),r=qc((function(e){return e.profiles})),s=dd(),d=s.SDK,u=s.bridge,_=(0,i.__read)((0,l.useState)(!1),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(0),2),h=f[0],A=f[1],g=bd().onHistoryAction,m=Od("all"),C=m.onShowMoreHistory,E=m.loading,S=m.showMoreHistory,I=m.loadHistory,T=(0,l.useMemo)((function(){return[{value:0,label:e("calls_history_list_personal_option")}]}),[]),N=ou({initialOptions:T}).ownerOptions,x=(0,l.useCallback)((function(e){var a=Number(e.selected.value);p(!0),A(a),I(0,a,[],!0).then((function(e){p(!1),e&&ur(d,u,n,a,t,!0)}))}),[r,o,a]),y=!E&&(a.length>0||h<0||0===h&&v);return{loading:E,historyCalls:a,historyBlockReloading:v,selectedOwnerId:h,ownerOptions:N,onGroupSelectChange:x,onHistoryAction:g,onShowMoreHistory:C,showMoreHistory:S,isShowList:y,isDisplayBlock:E||y||v}},su=function(){var e=(0,l.useRef)(),n=qc((function(e){return e.callsQueueResponse}));return(0,l.useMemo)((function(){var t;return(null===(t=null==n?void 0:n.events)||void 0===t?void 0:t.some((function(e){var n;return"scheduled_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&(e.current=Date.now()),e.current}),[n])},lu=function(e){var n=e.onMenuItemClick,t=$c(),a=rc().getLang,r=qc((function(e){return e.profiles})),c=qc((function(e){return e.historyCalls})),u=Jd({type:Kd.Preview,forceUpdate:su()}).scheduledCallsPreview,_=ud(),v=_.onCreateCallClick,p=_.onJoin,f=Hd(),h=f.currentCallsBlockLoading,A=f.currentCalls,g=(0,i.__read)((0,l.useState)(!1),2),m=g[0],C=g[1],E=(0,i.__read)((0,l.useState)([]),2),S=E[0],I=E[1],T=(0,i.__read)((0,l.useState)(!1),2),N=T[0],x=T[1],y=ru();(0,l.useEffect)((function(){C(!0),(0,nn.getFriends)(7).then((function(e){var n=e.items.map(tn.normalizeUser);I(n)})).finally((function(){C(!1)}))}),[]);var b=(0,l.useCallback)((function(e,t,a){e.preventDefault(),n(t,a)}),[]),O=(0,l.useCallback)((function(e,n){return!(!e.ctrlKey&&!e.metaKey)||(e.preventDefault(),p("",n,d.CallStatSource.HISTORY_FRIENDS_LIST),!1)}),[]);return(0,l.useEffect)((function(){if(!y.loading){var e=!(h||A.length||y.loading||c.length||0!==y.selectedOwnerId);x(e),t((0,ed.dispatchSetShowCreateButton)(!e))}return function(){t((0,ed.dispatchSetShowCreateButton)(!0))}}),[h,A.length,y.loading,c.length,y.selectedOwnerId]),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--content"},{children:[N&&(0,o.jsx)(id.default,(0,i.__assign)({className:(0,s.classNames)({"CallHistoryScreenLanding--pageBlock":!m&&0===S.length})},{children:(0,o.jsx)(Wd,{onCreateCallClick:v},void 0)}),void 0),m&&(0,o.jsx)(id.default,{children:(0,o.jsx)(kl.DivBlockSkeleton,{height:147},void 0)},void 0),!m&&S.length>0&&(0,o.jsxs)(id.default,{children:[(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:(0,o.jsx)(Zd.default,(0,i.__assign)({href:"/calls?section=friends",onClick:function(){return b(event,"friends","calls?section=friends")},className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_friends_header_link")}),void 0)},{children:a("calls_history_friends_block_header")}),void 0),(0,o.jsx)("ul",(0,i.__assign)({className:"CallHistoryScreen--friendsList"},{children:S.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallHistoryScreen--friendsListItem"},{children:(0,o.jsx)("a",(0,i.__assign)({href:e.link,onClick:function(){return O(event,e.peerId)}},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemContent"},{children:[(0,o.jsx)(Md.default,{className:"CallHistoryScreen--friendsListItemPhoto",photo:e.photo,title:e.name},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemPhotoHoverIcon"},{children:(0,o.jsx)(zd,{fill:"white"},void 0)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemName"},{children:e.firstName}),void 0)]}),void 0)}),void 0)}),e.id)}))}),void 0)]},void 0),h&&(0,o.jsx)(id.default,{children:(0,o.jsx)(kl.DivBlockSkeleton,{height:300},void 0)},void 0),!h&&A.length>0&&(0,o.jsxs)(id.default,(0,i.__assign)({className:"CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(Aa.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",extra:A.length,right:A.length?(0,o.jsx)(Zd.default,(0,i.__assign)({onClick:function(){return b(event,"current","calls?section=current")},href:"/calls?section=current",className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_header_link")}),void 0):""},{children:a("calls_history_current_list_header")}),void 0),(0,o.jsx)(Ud,{currentCalls:A.slice(0,5),profiles:r,onJoin:p},void 0)]}),void 0),(0,o.jsx)(au,{calls:u,loading:null==u?void 0:u.loading,onLinkClick:b,skeletonHeight:300},void 0),y.isDisplayBlock&&(0,o.jsx)(iu,(0,i.__assign)({},y),void 0)]}),void 0)},cu=t(95418),du=function(){var e,n,t,a,i=_d().setLoading,r=(e=(0,ue.useLang)().getLang,n=qc((function(e){return e.meId})),t=(0,l.useMemo)((function(){return[{label:e("calls_all"),value:0},{label:e("calls_history_list_personal_option"),value:n}]}),[n]),a=ou({initialOptions:t}).ownerOptions,(0,cu.useFormSelectValue)({options:a,initialValue:function(){return 0}})),s=Jd({type:Kd.Full,forceUpdate:su(),callerId:r.value}).scheduledCalls;return(0,l.useEffect)((function(){i(!!(null==s?void 0:s.loading))}),[null==s?void 0:s.loading]),(0,o.jsx)(au,{calls:s,loading:null==s?void 0:s.loading,skeletonHeight:500,section:"scheduled",ownerSelect:r},void 0)},uu=function(){var e=ru();return(0,o.jsx)(iu,(0,i.__assign)({},e),void 0)};const _u=(0,X.makeIcon)("Icon24Qr","qr_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="qr_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M19.5 19H21a.5.5 0 0 1 .5.5V21a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM14 19h1.5a.5.5 0 0 1 .5.5V21a.5.5 0 0 1-.5.5H14a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Zm2.75-2.75h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Zm2.75-2.75H21a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5V14a.5.5 0 0 1 .5-.5Zm-5.5 0h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5H14a.5.5 0 0 1-.5-.5V14a.5.5 0 0 1 .5-.5ZM4.5 13h4a2.5 2.5 0 0 1 2.5 2.5v4A2.5 2.5 0 0 1 8.5 22h-4A2.5 2.5 0 0 1 2 19.5v-4A2.5 2.5 0 0 1 4.5 13Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM15.5 2h4A2.5 2.5 0 0 1 22 4.5v4a2.5 2.5 0 0 1-2.5 2.5h-4A2.5 2.5 0 0 1 13 8.5v-4A2.5 2.5 0 0 1 15.5 2Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM4.5 2h4A2.5 2.5 0 0 1 11 4.5v4A2.5 2.5 0 0 1 8.5 11h-4A2.5 2.5 0 0 1 2 8.5v-4A2.5 2.5 0 0 1 4.5 2Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),vu=(0,Ti.makeIcon)("Icon40AppStoreButtonRu","app_store_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="app_store_button_ru_40"><path d="M40.228 17.293h2.295l4.745 12.313h-2.313l-1.155-3.26h-4.918l-1.156 3.26H35.5l4.728-12.313Zm-.76 7.416h3.762l-1.846-5.295h-.052L39.47 24.71Zm8.922-4.019h1.863v1.208h.034c.276-.518.662-.886 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.311.127 1.829.38.529.24.966.58 1.311 1.017.345.425.604.925.777 1.5a6.39 6.39 0 0 1 .258 1.845c0 .598-.08 1.179-.241 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.426-.707.77-1.19 1.035-.483.253-1.053.38-1.708.38a4.39 4.39 0 0 1-.863-.087 3.431 3.431 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.431 2.66 2.66 0 0 1-.552-.638h-.035V32.9H48.39V20.69Zm6.866 4.467c0-.402-.051-.793-.155-1.173a3.08 3.08 0 0 0-.466-1 2.283 2.283 0 0 0-.776-.707 2.06 2.06 0 0 0-1.07-.276c-.828 0-1.455.287-1.88.862-.415.575-.622 1.34-.622 2.294 0 .448.052.868.155 1.259.115.38.282.707.5.983.22.276.478.494.777.655.31.161.667.242 1.07.242.449 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707.207-.3.35-.633.431-1 .092-.38.138-.765.138-1.156Zm3.854-4.467h1.863v1.208h.035c.276-.518.661-.886 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.31.127 1.829.38.529.24.966.58 1.31 1.017.346.425.605.925.777 1.5a6.39 6.39 0 0 1 .26 1.845c0 .598-.081 1.179-.242 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.426-.707.77-1.19 1.035-.484.253-1.053.38-1.709.38a4.39 4.39 0 0 1-.862-.087 3.43 3.43 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.431 2.657 2.657 0 0 1-.553-.638h-.034V32.9H59.11V20.69Zm6.867 4.467c0-.402-.052-.793-.155-1.173a3.084 3.084 0 0 0-.466-1 2.283 2.283 0 0 0-.776-.707 2.06 2.06 0 0 0-1.07-.276c-.828 0-1.455.287-1.881.862-.414.575-.621 1.34-.621 2.294 0 .448.052.868.155 1.259.115.38.282.707.5.983.22.276.478.494.777.655.31.161.667.242 1.07.242.448 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707.207-.3.35-.633.431-1 .092-.38.138-.765.138-1.156Zm10.468.345c0 .471.08.874.241 1.207.161.333.386.61.673.828.288.207.616.362.984.465.38.092.788.138 1.225.138.471 0 .874-.051 1.207-.155.334-.115.604-.258.811-.431.208-.172.357-.368.45-.586.091-.23.137-.46.137-.69 0-.471-.11-.816-.328-1.035a1.72 1.72 0 0 0-.69-.483 13.31 13.31 0 0 0-1.535-.448 248.2 248.2 0 0 1-2.14-.57c-.53-.137-.972-.315-1.329-.534a3.322 3.322 0 0 1-.828-.758 2.771 2.771 0 0 1-.448-.88 3.76 3.76 0 0 1-.121-.948c0-.621.126-1.156.38-1.604.264-.46.609-.84 1.035-1.139a4.38 4.38 0 0 1 1.449-.655 6.123 6.123 0 0 1 1.64-.224 6.16 6.16 0 0 1 1.81.259A4.27 4.27 0 0 1 82.57 18a3.61 3.61 0 0 1 1.035 1.242c.253.483.38 1.046.38 1.69h-2.157c-.057-.793-.328-1.351-.81-1.673-.484-.333-1.1-.5-1.847-.5a3.65 3.65 0 0 0-.777.086 2.179 2.179 0 0 0-.724.259 1.585 1.585 0 0 0-.552.483c-.138.207-.207.465-.207.776 0 .437.132.782.396 1.035.276.24.633.425 1.07.551.046.012.225.064.535.156a79.013 79.013 0 0 1 2.209.586c.38.092.65.16.81.207.403.126.754.299 1.053.517.3.219.547.472.742.759.207.276.357.575.449.897.103.322.155.643.155.965 0 .69-.144 1.282-.431 1.777-.276.483-.645.88-1.105 1.19-.46.31-.983.534-1.57.672a7.244 7.244 0 0 1-1.794.224 7.39 7.39 0 0 1-1.985-.258 4.646 4.646 0 0 1-1.621-.794 3.9 3.9 0 0 1-1.105-1.362c-.276-.563-.42-1.224-.431-1.983h2.157Zm8.773-4.812H86.7v-2.673h1.967v2.674h1.778v1.465h-1.778v4.76c0 .207.006.385.018.535.023.149.063.276.12.379a.68.68 0 0 0 .294.241c.126.046.299.07.517.07h.415c.138-.012.276-.035.414-.07v1.518l-.639.069a5.78 5.78 0 0 1-.638.034c-.518 0-.938-.046-1.26-.138a1.86 1.86 0 0 1-.742-.43 1.658 1.658 0 0 1-.362-.725 6.002 6.002 0 0 1-.104-.983v-5.26h-1.483v-1.465Zm10.905 9.158c-.714 0-1.352-.115-1.916-.345a4.28 4.28 0 0 1-1.415-.983 4.34 4.34 0 0 1-.88-1.483 5.858 5.858 0 0 1-.293-1.897c0-.679.098-1.305.293-1.88.207-.575.5-1.07.88-1.483a4.075 4.075 0 0 1 1.415-.966c.564-.241 1.202-.362 1.916-.362.713 0 1.345.12 1.898.362.563.23 1.035.552 1.415.966.39.414.684.908.879 1.483a5.51 5.51 0 0 1 .311 1.88c0 .69-.104 1.322-.311 1.897a4.056 4.056 0 0 1-2.294 2.466c-.553.23-1.185.345-1.898.345Zm0-1.552c.437 0 .816-.092 1.138-.276.323-.184.587-.426.794-.725.207-.299.357-.632.449-1a4.308 4.308 0 0 0 0-2.294 2.834 2.834 0 0 0-.449-1 2.4 2.4 0 0 0-.794-.724c-.322-.184-.701-.276-1.138-.276-.438 0-.817.092-1.14.276a2.4 2.4 0 0 0-.793.724 3.08 3.08 0 0 0-.466 1 4.815 4.815 0 0 0 0 2.294c.104.368.259.701.466 1 .207.3.472.54.794.725.322.184.702.276 1.139.276Zm6.311-7.606h1.846v1.725h.035a2.06 2.06 0 0 1 .327-.707c.173-.23.374-.437.604-.62a3.06 3.06 0 0 1 .794-.466c.288-.116.581-.173.88-.173.23 0 .385.006.466.017l.276.035v1.897a4.936 4.936 0 0 0-.431-.052 2.514 2.514 0 0 0-.414-.035c-.334 0-.65.07-.949.207a2.056 2.056 0 0 0-.76.587 2.775 2.775 0 0 0-.517.948c-.127.38-.19.816-.19 1.31v4.243h-1.967V20.69Zm12.061 3.674a2.967 2.967 0 0 0-.208-.897 2.1 2.1 0 0 0-.448-.742 1.949 1.949 0 0 0-.69-.517 1.915 1.915 0 0 0-.898-.207c-.345 0-.661.063-.949.19a2.098 2.098 0 0 0-.724.5 2.562 2.562 0 0 0-.483.741 2.73 2.73 0 0 0-.19.932h4.59Zm-4.59 1.293c0 .345.046.678.138 1 .103.322.253.604.448.845.196.242.443.437.742.587.3.138.656.207 1.07.207.575 0 1.035-.121 1.381-.363.356-.253.621-.626.793-1.12h1.864a3.717 3.717 0 0 1-.535 1.293c-.253.38-.558.701-.915.966a3.893 3.893 0 0 1-1.207.569 4.57 4.57 0 0 1-1.381.207c-.701 0-1.323-.115-1.863-.345a3.94 3.94 0 0 1-1.381-.966 4.264 4.264 0 0 1-.845-1.483 6.197 6.197 0 0 1-.276-1.897c0-.632.098-1.23.293-1.794a4.703 4.703 0 0 1 .863-1.5 4.159 4.159 0 0 1 1.363-1.035c.529-.252 1.127-.379 1.794-.379.702 0 1.329.15 1.881.448.564.288 1.03.673 1.398 1.156a4.61 4.61 0 0 1 .794 1.673c.172.62.218 1.264.138 1.931h-6.557ZM38.974 13.574c-.43 0-.826-.051-1.19-.152a2.71 2.71 0 0 1-.947-.467 2.167 2.167 0 0 1-.615-.79c-.148-.318-.222-.697-.222-1.136h.917c.007.324.068.601.182.831.12.223.276.406.464.548.195.135.42.233.675.294.256.06.528.091.817.091.248 0 .48-.034.696-.101.215-.075.4-.176.554-.305a1.414 1.414 0 0 0 .514-1.105c0-.263-.05-.476-.151-.639a1.006 1.006 0 0 0-.403-.385 1.602 1.602 0 0 0-.575-.192 4.417 4.417 0 0 0-.686-.051c-.1 0-.215.003-.342.01a3.43 3.43 0 0 0-.303.01v-.79c.08.013.188.02.323.02h.322c.229 0 .437-.02.626-.061.194-.047.36-.122.494-.223a.977.977 0 0 0 .322-.396c.08-.169.121-.375.121-.618 0-.223-.044-.409-.13-.558a.913.913 0 0 0-.344-.355 1.411 1.411 0 0 0-.494-.202 2.63 2.63 0 0 0-.574-.061c-.531 0-.948.118-1.25.355-.303.23-.481.608-.535 1.135h-.917c.013-.385.09-.72.231-1.004a2.02 2.02 0 0 1 .585-.71 2.5 2.5 0 0 1 .847-.425c.33-.095.686-.142 1.069-.142.343 0 .662.04.958.122.302.074.564.192.786.355.222.162.397.368.524.618.128.243.192.534.192.872 0 .196-.034.378-.1.547a1.642 1.642 0 0 1-.273.457 1.75 1.75 0 0 1-.817.567v.03c.235.048.444.13.625.244a1.614 1.614 0 0 1 .726.913c.06.189.09.382.09.578a2.133 2.133 0 0 1-.645 1.47c-.221.23-.51.422-.866.578-.35.148-.777.223-1.28.223Zm5.437-.051a2.64 2.64 0 0 1-.665-.081 1.527 1.527 0 0 1-.555-.244 1.373 1.373 0 0 1-.373-.456 1.612 1.612 0 0 1-.13-.679c0-.297.05-.54.15-.73.101-.19.233-.341.394-.456.168-.122.356-.213.564-.274.215-.06.434-.111.656-.152.235-.047.457-.081.665-.101.215-.027.403-.061.565-.102a1.02 1.02 0 0 0 .383-.192c.094-.088.141-.213.141-.376a.833.833 0 0 0-.11-.456.682.682 0 0 0-.273-.263 1.055 1.055 0 0 0-.373-.122 2.701 2.701 0 0 0-.403-.03c-.363 0-.666.07-.908.212-.242.136-.373.396-.393.781h-.857a1.87 1.87 0 0 1 .202-.821 1.49 1.49 0 0 1 .484-.538c.201-.142.43-.243.685-.304.262-.06.541-.091.837-.091.235 0 .467.017.696.05.235.035.447.105.635.214.188.101.34.246.454.436.114.189.17.436.17.74v2.697c0 .202.011.351.031.446.027.094.108.142.242.142.06 0 .148-.017.262-.051v.67c-.148.087-.353.13-.615.13-.222 0-.4-.06-.534-.182-.128-.128-.192-.334-.192-.618-.235.284-.51.49-.826.618a2.73 2.73 0 0 1-1.009.183Zm.192-.75c.282 0 .524-.037.726-.112a1.65 1.65 0 0 0 .494-.294c.128-.122.222-.25.282-.385.06-.142.09-.274.09-.396v-.882a.94.94 0 0 1-.422.183c-.175.034-.36.064-.555.091l-.575.081c-.195.027-.37.075-.524.142a.975.975 0 0 0-.383.294c-.094.122-.141.29-.141.507a.77.77 0 0 0 .08.365.81.81 0 0 0 .222.233.98.98 0 0 0 .323.132c.12.027.248.04.383.04Zm3.903-4.603h3.569v.76h-2.712v4.481h-.857V8.17Zm4.384 0h.857v.71h.02c.141-.291.363-.5.665-.63.303-.134.636-.202.998-.202.404 0 .753.074 1.049.223.302.149.551.352.746.608.202.25.353.541.454.872.1.332.151.683.151 1.055 0 .378-.05.733-.151 1.064a2.438 2.438 0 0 1-.444.862 2.059 2.059 0 0 1-.746.578 2.375 2.375 0 0 1-1.038.213 2.528 2.528 0 0 1-.898-.172 2.04 2.04 0 0 1-.443-.244 1.498 1.498 0 0 1-.343-.395h-.02v2.697h-.857v-7.24Zm2.47 4.603c.289 0 .534-.058.736-.173.202-.115.363-.267.484-.456a1.99 1.99 0 0 0 .262-.649c.054-.243.08-.493.08-.75 0-.243-.033-.48-.1-.71a1.8 1.8 0 0 0-.293-.628 1.379 1.379 0 0 0-.504-.436 1.494 1.494 0 0 0-.715-.163c-.29 0-.535.058-.736.173a1.458 1.458 0 0 0-.494.456 1.907 1.907 0 0 0-.283.629 3.237 3.237 0 0 0 .01 1.47c.06.236.155.446.282.628.135.183.306.332.515.447.208.108.46.162.756.162Zm4.111 2.727c-.1 0-.202-.007-.302-.02a1.427 1.427 0 0 1-.293-.071v-.791l.242.081a.88.88 0 0 0 .262.04c.175 0 .316-.04.424-.121.107-.081.201-.2.282-.355l.353-.882-2.067-5.211h.968l1.522 4.288h.02l1.462-4.288h.908l-2.269 5.93c-.1.258-.201.474-.302.65a1.536 1.536 0 0 1-.323.426.963.963 0 0 1-.393.243 1.377 1.377 0 0 1-.494.081Zm6.523-1.977c-.692 0-1.233-.155-1.623-.466-.39-.311-.602-.754-.635-1.329h.867c.027.386.168.663.423.832.256.169.575.253.958.253.41 0 .726-.088.948-.263a.818.818 0 0 0 .332-.67c0-.263-.084-.47-.252-.618-.168-.149-.453-.223-.857-.223h-.695v-.7h.554c.303 0 .562-.06.777-.182.215-.129.322-.348.322-.66 0-.195-.094-.368-.282-.516-.181-.149-.454-.223-.817-.223a2.21 2.21 0 0 0-.463.05 1.33 1.33 0 0 0-.404.163.968.968 0 0 0-.302.294c-.08.121-.131.27-.151.446h-.867c.02-.325.097-.592.231-.801a1.51 1.51 0 0 1 .504-.507c.202-.129.43-.22.686-.274.255-.054.514-.081.776-.081.27 0 .521.027.757.081.235.054.44.142.614.264.182.115.323.26.424.436.108.175.161.385.161.628 0 .304-.087.551-.262.74a1.07 1.07 0 0 1-.575.355v.02c.121.02.242.061.363.122s.229.146.323.254c.094.101.172.23.232.385.06.149.09.324.09.527 0 .284-.06.53-.18.74-.122.21-.283.382-.485.517a2.246 2.246 0 0 1-.695.305 3.13 3.13 0 0 1-.797.1ZM69.28 8.17h.856v4.278l2.46-4.278h1.1v5.241h-.858V9.133l-2.46 4.278H69.28V8.17Zm7.071.76h-1.865v-.76h4.587v.76h-1.865v4.481h-.857v-4.48Zm5.725 4.593c-.416 0-.782-.068-1.098-.203a2.128 2.128 0 0 1-.777-.568 2.478 2.478 0 0 1-.474-.872 3.853 3.853 0 0 1-.15-1.105c0-.392.06-.753.18-1.085a2.67 2.67 0 0 1 .505-.871 2.38 2.38 0 0 1 .776-.568c.303-.135.632-.203.988-.203.464 0 .847.098 1.15.294.309.19.554.433.736.73.188.297.315.622.383.973.073.352.104.686.09 1.004h-3.901c-.007.23.02.45.08.66.06.202.158.384.293.547.134.155.305.28.514.375.208.094.454.142.736.142.363 0 .659-.085.887-.254.235-.169.39-.426.464-.77h.847c-.115.595-.367 1.04-.757 1.338-.39.29-.88.436-1.472.436Zm1.402-3.234a1.696 1.696 0 0 0-.141-.578 1.322 1.322 0 0 0-.313-.467 1.314 1.314 0 0 0-.463-.314 1.373 1.373 0 0 0-.585-.122c-.222 0-.424.041-.605.122a1.35 1.35 0 0 0-.454.314 1.513 1.513 0 0 0-.302.477 1.75 1.75 0 0 0-.131.568h2.994Zm4.803-2.119h2.41c.228 0 .447.017.655.05.215.034.407.098.575.193.168.088.302.216.403.385.101.17.151.386.151.65 0 .283-.067.513-.201.689a1.507 1.507 0 0 1-.565.436v.01c.303.06.541.203.716.425.181.224.272.51.272.862 0 .223-.04.43-.12.619a1.34 1.34 0 0 1-.323.486c-.142.136-.31.244-.504.325a1.77 1.77 0 0 1-.636.111h-2.833V8.17Zm2.672 4.511c.282 0 .494-.08.635-.243a.92.92 0 0 0 .222-.629.734.734 0 0 0-.232-.567c-.154-.142-.413-.213-.776-.213h-1.674v1.652h1.825ZM90.6 10.32c.37 0 .625-.068.766-.203a.693.693 0 0 0 .222-.537c0-.216-.07-.382-.212-.497-.14-.121-.4-.182-.776-.182h-1.472v1.42H90.6Zm-65.982 8.912a5.228 5.228 0 0 1 2.488-4.386 5.347 5.347 0 0 0-4.213-2.279c-1.772-.186-3.49 1.062-4.394 1.062-.92 0-2.312-1.043-3.808-1.012a5.609 5.609 0 0 0-4.722 2.881c-2.041 3.536-.518 8.734 1.437 11.593.978 1.4 2.121 2.964 3.618 2.908 1.464-.061 2.011-.934 3.778-.934 1.751 0 2.264.934 3.79.899 1.57-.025 2.561-1.406 3.506-2.82a11.57 11.57 0 0 0 1.602-3.266 5.05 5.05 0 0 1-3.081-4.646h-.001Zm-2.884-8.545A5.15 5.15 0 0 0 22.911 7a5.232 5.232 0 0 0-3.386 1.753 4.9 4.9 0 0 0-1.208 3.55 4.328 4.328 0 0 0 3.417-1.616Z" /></symbol>',126,40),pu=(0,Ti.makeIcon)("Icon40AppStoreButtonEn","app_store_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="app_store_button_en_40"><path d="M40.228 17.793h2.295l4.745 12.313h-2.313l-1.155-3.26h-4.918l-1.156 3.26H35.5l4.728-12.313Zm-.76 7.415h3.762l-1.846-5.294h-.052l-1.863 5.294Zm8.922-4.018h1.863v1.207h.034c.276-.517.662-.885 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.311.127 1.829.38.529.241.966.58 1.311 1.017.345.426.604.926.777 1.5a6.39 6.39 0 0 1 .258 1.846c0 .598-.08 1.178-.241 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.425-.707.77-1.19 1.035-.483.253-1.053.38-1.708.38a4.39 4.39 0 0 1-.863-.087 3.431 3.431 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.432 2.66 2.66 0 0 1-.552-.638h-.035v4.45H48.39V21.19Zm6.866 4.466a4.41 4.41 0 0 0-.155-1.172 3.08 3.08 0 0 0-.466-1 2.284 2.284 0 0 0-.776-.708 2.06 2.06 0 0 0-1.07-.275c-.828 0-1.455.287-1.88.862-.415.575-.622 1.34-.622 2.294 0 .448.052.867.155 1.258.115.38.282.707.5.983.22.276.478.495.777.656.31.16.667.241 1.07.241.449 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707a2.79 2.79 0 0 0 .431-1 4.88 4.88 0 0 0 .138-1.155Zm3.854-4.466h1.863v1.207h.035c.276-.517.661-.885 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.31.127 1.829.38.529.241.966.58 1.31 1.017.346.426.605.926.777 1.5a6.39 6.39 0 0 1 .26 1.846c0 .598-.081 1.178-.242 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.425-.707.77-1.19 1.035-.484.253-1.053.38-1.709.38a4.39 4.39 0 0 1-.862-.087 3.43 3.43 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.432 2.657 2.657 0 0 1-.553-.638h-.034v4.45H59.11V21.19Zm6.867 4.466c0-.402-.052-.793-.155-1.172a3.084 3.084 0 0 0-.466-1 2.284 2.284 0 0 0-.776-.708 2.06 2.06 0 0 0-1.07-.275c-.828 0-1.455.287-1.881.862-.414.575-.621 1.34-.621 2.294 0 .448.052.867.155 1.258.115.38.282.707.5.983.22.276.478.495.777.656.31.16.667.241 1.07.241.448 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707a2.79 2.79 0 0 0 .431-1c.092-.38.138-.765.138-1.155Zm10.468.345c0 .472.08.874.241 1.207.161.334.386.61.673.828.288.207.616.362.984.466.38.092.788.138 1.225.138.471 0 .874-.052 1.207-.155a2.56 2.56 0 0 0 .811-.431 1.55 1.55 0 0 0 .45-.587c.091-.23.137-.46.137-.69 0-.471-.11-.816-.328-1.034a1.72 1.72 0 0 0-.69-.483 13.31 13.31 0 0 0-1.535-.449c-.576-.149-1.289-.339-2.14-.569-.53-.138-.972-.316-1.329-.534a3.325 3.325 0 0 1-.828-.759 2.771 2.771 0 0 1-.448-.88 3.734 3.734 0 0 1-.121-.948c0-.62.126-1.155.38-1.604a3.49 3.49 0 0 1 1.035-1.138 4.382 4.382 0 0 1 1.449-.655 6.124 6.124 0 0 1 1.64-.224 6.16 6.16 0 0 1 1.81.258 4.27 4.27 0 0 1 1.502.742 3.61 3.61 0 0 1 1.035 1.241c.253.483.38 1.047.38 1.69h-2.157c-.057-.793-.328-1.35-.81-1.672-.484-.334-1.1-.5-1.847-.5-.253 0-.512.028-.777.086a2.181 2.181 0 0 0-.724.258 1.585 1.585 0 0 0-.552.483c-.138.207-.207.466-.207.776 0 .437.132.782.396 1.035.276.241.633.425 1.07.552.046.011.225.063.535.155a79.013 79.013 0 0 1 2.209.586c.38.092.65.161.81.207.403.127.754.3 1.053.518.3.218.547.471.742.759.207.275.357.574.449.896.103.322.155.644.155.966 0 .69-.144 1.282-.431 1.776-.276.483-.645.88-1.105 1.19a4.71 4.71 0 0 1-1.57.673 7.244 7.244 0 0 1-1.794.224 7.39 7.39 0 0 1-1.985-.259 4.646 4.646 0 0 1-1.621-.793 3.9 3.9 0 0 1-1.105-1.363c-.276-.563-.42-1.224-.431-1.983h2.157Zm8.773-4.811H86.7v-2.673h1.967v2.673h1.778v1.466h-1.778v4.76c0 .206.006.385.018.534.023.15.063.276.12.38a.68.68 0 0 0 .294.24c.126.047.299.07.517.07h.415c.138-.012.276-.035.414-.07v1.518c-.219.023-.432.046-.639.07-.207.022-.42.034-.638.034-.518 0-.938-.046-1.26-.138a1.862 1.862 0 0 1-.742-.431 1.658 1.658 0 0 1-.362-.725 6 6 0 0 1-.104-.982v-5.26h-1.483V21.19Zm10.905 9.157c-.714 0-1.352-.115-1.916-.345a4.28 4.28 0 0 1-1.415-.983 4.341 4.341 0 0 1-.88-1.483 5.858 5.858 0 0 1-.293-1.897c0-.678.098-1.305.293-1.88.207-.574.5-1.069.88-1.483a4.075 4.075 0 0 1 1.415-.965c.564-.242 1.202-.363 1.916-.363.713 0 1.345.121 1.898.363.563.23 1.035.552 1.415.965.39.414.684.909.879 1.483a5.51 5.51 0 0 1 .311 1.88c0 .69-.104 1.322-.311 1.897a4.057 4.057 0 0 1-2.294 2.466c-.553.23-1.185.345-1.898.345Zm0-1.552c.437 0 .816-.092 1.138-.276a2.39 2.39 0 0 0 .794-.724c.207-.3.357-.633.449-1a4.308 4.308 0 0 0 0-2.294 2.834 2.834 0 0 0-.449-1 2.4 2.4 0 0 0-.794-.725c-.322-.183-.701-.275-1.138-.275-.438 0-.817.092-1.14.275a2.4 2.4 0 0 0-.793.725 3.08 3.08 0 0 0-.466 1 4.815 4.815 0 0 0 0 2.294c.104.367.259.7.466 1a2.4 2.4 0 0 0 .794.724c.322.184.702.276 1.139.276Zm6.311-7.605h1.846v1.724h.035a2.06 2.06 0 0 1 .327-.707c.173-.23.374-.436.604-.62a3.05 3.05 0 0 1 .794-.466c.288-.115.581-.172.88-.172.23 0 .385.005.466.017l.276.034v1.897a4.936 4.936 0 0 0-.431-.051 2.514 2.514 0 0 0-.414-.035c-.334 0-.65.069-.949.207a2.057 2.057 0 0 0-.76.586 2.78 2.78 0 0 0-.517.949c-.127.38-.19.816-.19 1.31v4.243h-1.967V21.19Zm12.061 3.673a2.967 2.967 0 0 0-.208-.897 2.1 2.1 0 0 0-.448-.741 1.95 1.95 0 0 0-.69-.518 1.915 1.915 0 0 0-.898-.206c-.345 0-.661.063-.949.19a2.1 2.1 0 0 0-.724.5 2.562 2.562 0 0 0-.483.74 2.731 2.731 0 0 0-.19.932h4.59Zm-4.59 1.294c0 .345.046.678.138 1 .103.322.253.603.448.845.196.241.443.437.742.586.3.138.656.207 1.07.207.575 0 1.035-.12 1.381-.362.356-.253.621-.627.793-1.121h1.864a3.717 3.717 0 0 1-.535 1.293 3.83 3.83 0 0 1-.915.966 3.893 3.893 0 0 1-1.207.57 4.57 4.57 0 0 1-1.381.206c-.701 0-1.323-.115-1.863-.345a3.94 3.94 0 0 1-1.381-.965 4.263 4.263 0 0 1-.845-1.484 6.196 6.196 0 0 1-.276-1.896c0-.633.098-1.23.293-1.794a4.702 4.702 0 0 1 .863-1.5 4.161 4.161 0 0 1 1.363-1.035c.529-.253 1.127-.38 1.794-.38.702 0 1.329.15 1.881.449.564.287 1.03.673 1.398 1.155a4.61 4.61 0 0 1 .794 1.673c.172.62.218 1.265.138 1.932h-6.557ZM39.007 6.315a2.827 2.827 0 0 1 3.005 3.17c0 2.039-1.103 3.21-3.005 3.21H36.7v-6.38h2.307Zm-1.315 5.478h1.204a2.008 2.008 0 0 0 2.106-2.295 2.009 2.009 0 0 0-1.238-2.137 2.015 2.015 0 0 0-.868-.145h-1.204v4.577Zm5.44-1.507a2.28 2.28 0 0 1 3.196-2.304 2.283 2.283 0 0 1 1.35 2.304 2.278 2.278 0 0 1-1.349 2.308 2.284 2.284 0 0 1-3.197-2.308Zm3.567 0c0-1.044-.47-1.655-1.293-1.655-.827 0-1.292.61-1.292 1.655 0 1.052.466 1.658 1.292 1.658.824 0 1.293-.61 1.293-1.658Zm7.02 2.41h-.986l-.996-3.547h-.076l-.992 3.547h-.977L48.364 7.88h.965l.863 3.675h.07l.992-3.675h.912l.99 3.675h.076l.86-3.675h.95l-1.323 4.816Zm2.44-4.816h.916v.765h.071a1.442 1.442 0 0 1 1.438-.858 1.569 1.569 0 0 1 1.668 1.791v3.118h-.95v-2.88c0-.773-.337-1.158-1.04-1.158a1.107 1.107 0 0 0-1.151 1.22v2.818h-.951V7.88ZM61.769 6h.95v6.696h-.95V6Zm2.273 4.286a2.28 2.28 0 0 1 3.197-2.304 2.283 2.283 0 0 1 1.349 2.304 2.28 2.28 0 0 1-2.273 2.502 2.286 2.286 0 0 1-2.168-1.564 2.28 2.28 0 0 1-.105-.938Zm3.567 0c0-1.044-.47-1.655-1.293-1.655-.826 0-1.291.61-1.291 1.655 0 1.052.465 1.658 1.291 1.658.824 0 1.293-.61 1.293-1.658Zm1.98 1.048c0-.867.646-1.367 1.793-1.438l1.305-.075v-.416c0-.508-.337-.795-.987-.795-.53 0-.898.194-1.004.535h-.92c.096-.827.875-1.358 1.968-1.358 1.208 0 1.89.601 1.89 1.618v3.29h-.916v-.676h-.075a1.62 1.62 0 0 1-1.447.756 1.457 1.457 0 0 1-1.607-1.441Zm3.098-.412v-.402l-1.177.075c-.664.044-.965.27-.965.694 0 .434.377.686.894.686a1.138 1.138 0 0 0 1.248-1.053Zm2.197-.636c0-1.522.783-2.486 2-2.486a1.59 1.59 0 0 1 1.478.845h.071V6h.951v6.696h-.911v-.761h-.075a1.674 1.674 0 0 1-1.514.84c-1.226 0-2-.964-2-2.49Zm.982 0c0 1.021.482 1.636 1.288 1.636.801 0 1.297-.624 1.297-1.632 0-1.004-.5-1.636-1.297-1.636-.8 0-1.288.619-1.288 1.632Zm7.453 0a2.28 2.28 0 0 1 3.197-2.304 2.283 2.283 0 0 1 1.349 2.304 2.281 2.281 0 0 1-3.198 2.308 2.281 2.281 0 0 1-1.348-2.308Zm3.567 0c0-1.044-.469-1.655-1.293-1.655-.826 0-1.291.61-1.291 1.655 0 1.052.465 1.658 1.291 1.658.824 0 1.293-.61 1.293-1.658ZM89.14 7.88h.915v.765h.071a1.442 1.442 0 0 1 1.438-.858 1.568 1.568 0 0 1 1.669 1.791v3.118h-.952v-2.88c0-.773-.336-1.158-1.04-1.158a1.106 1.106 0 0 0-1.15 1.22v2.818h-.951V7.88Zm9.467-1.199v1.221h1.044v.8h-1.044v2.477c0 .504.208.725.681.725.121 0 .242-.008.363-.022v.792c-.171.03-.344.046-.518.048-1.057 0-1.478-.372-1.478-1.3v-2.72h-.766v-.8h.766v-1.22h.952Zm2.343-.68h.943v2.653h.075a1.479 1.479 0 0 1 1.469-.863 1.586 1.586 0 0 1 1.66 1.796v3.109h-.952V9.82c0-.77-.359-1.159-1.031-1.159a1.122 1.122 0 0 0-.89.329 1.125 1.125 0 0 0-.323.892v2.813h-.951V6Zm9.693 5.394a1.959 1.959 0 0 1-2.089 1.393 2.186 2.186 0 0 1-2.226-2.485 2.224 2.224 0 0 1 2.222-2.516c1.341 0 2.15.915 2.15 2.428v.331h-3.403v.054a1.269 1.269 0 0 0 .767 1.276c.163.07.339.105.516.103a1.159 1.159 0 0 0 1.147-.584h.916Zm-3.346-1.552h2.434a1.166 1.166 0 0 0-1.186-1.248 1.23 1.23 0 0 0-1.248 1.248Z" /><path fill-rule="evenodd" d="M22.91 7a5.15 5.15 0 0 1-1.177 3.687 4.328 4.328 0 0 1-3.416 1.616 4.9 4.9 0 0 1 1.207-3.55A5.232 5.232 0 0 1 22.91 7Zm4.196 7.847a5.228 5.228 0 0 0-2.488 4.385 5.05 5.05 0 0 0 3.082 4.646 11.6 11.6 0 0 1-1.602 3.267c-.945 1.413-1.935 2.793-3.506 2.819-.747.017-1.25-.198-1.776-.422-.549-.234-1.12-.477-2.014-.477-.948 0-1.545.251-2.12.493-.498.21-.98.412-1.658.44-1.496.056-2.64-1.508-3.618-2.907-1.955-2.86-3.478-8.057-1.437-11.593a5.609 5.609 0 0 1 4.722-2.881c.848-.017 1.662.31 2.376.597.546.219 1.033.415 1.432.415.35 0 .825-.188 1.377-.408.87-.345 1.933-.767 3.017-.654a5.347 5.347 0 0 1 4.213 2.28Z" clip-rule="evenodd" /></symbol>',126,40),fu=(0,Ti.makeIcon)("Icon40GooglePlayButtonRu","google_play_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="google_play_button_ru_40"><path d="M98.726 29.122h1.776V17.23h-1.776v11.892Zm15.999-7.609-2.036 5.157h-.062l-2.113-5.157h-1.913l3.169 7.207-1.806 4.009h1.852l4.884-11.216h-1.975Zm-10.074 6.259c-.582 0-1.393-.291-1.393-1.01 0-.918 1.01-1.27 1.883-1.27.78 0 1.148.168 1.623.398a2.154 2.154 0 0 1-2.113 1.882Zm.215-6.518c-1.286 0-2.619.566-3.171 1.82l1.578.658c.337-.658.964-.872 1.623-.872.919 0 1.853.55 1.868 1.53v.122c-.322-.184-1.011-.459-1.852-.459-1.7 0-3.43.934-3.43 2.677 0 1.593 1.393 2.617 2.954 2.617 1.195 0 1.853-.534 2.267-1.163h.061v.919h1.715v-4.56c0-2.111-1.577-3.29-3.613-3.29Zm-10.978 1.708h-2.526v-4.078h2.526c1.328 0 2.082 1.1 2.082 2.039 0 .922-.754 2.039-2.082 2.039Zm-.046-5.732h-4.256v11.892h1.776v-4.505h2.48c1.969 0 3.904-1.425 3.904-3.694 0-2.27-1.935-3.693-3.904-3.693ZM70.633 27.773c-1.227 0-2.254-1.026-2.254-2.436 0-1.425 1.027-2.468 2.254-2.468 1.213 0 2.162 1.043 2.162 2.468 0 1.41-.95 2.436-2.162 2.436Zm2.04-5.593h-.061c-.399-.475-1.166-.905-2.132-.905-2.025 0-3.88 1.778-3.88 4.062 0 2.268 1.855 4.03 3.88 4.03.966 0 1.733-.428 2.132-.919h.06v.582c0 1.55-.826 2.376-2.161 2.376-1.089 0-1.764-.782-2.04-1.44l-1.549.644c.445 1.073 1.626 2.39 3.589 2.39 2.085 0 3.85-1.226 3.85-4.215V21.52h-1.689v.66Zm2.913 6.942h1.78V17.23h-1.78v11.893Zm4.402-3.923c-.046-1.564 1.212-2.36 2.116-2.36.706 0 1.305.352 1.504.858l-3.62 1.502Zm5.521-1.349c-.338-.905-1.365-2.575-3.466-2.575-2.085 0-3.818 1.64-3.818 4.047 0 2.268 1.717 4.046 4.017 4.046 1.857 0 2.929-1.134 3.375-1.793l-1.38-.92c-.46.674-1.09 1.118-1.995 1.118-.904 0-1.549-.413-1.963-1.225l5.414-2.238-.184-.46Zm-43.13-1.333v1.717h4.11c-.123.965-.444 1.67-.935 2.16-.598.598-1.534 1.257-3.174 1.257-2.532 0-4.51-2.038-4.51-4.567 0-2.53 1.978-4.567 4.51-4.567 1.364 0 2.361.535 3.097 1.226l1.212-1.21c-1.028-.982-2.392-1.733-4.31-1.733-3.466 0-6.379 2.82-6.379 6.284s2.913 6.284 6.38 6.284c1.87 0 3.28-.614 4.385-1.763 1.135-1.134 1.488-2.727 1.488-4.015 0-.4-.03-.766-.093-1.073h-5.78Zm10.546 5.256c-1.226 0-2.285-1.01-2.285-2.451 0-1.456 1.06-2.453 2.285-2.453 1.227 0 2.286.997 2.286 2.453 0 1.44-1.06 2.451-2.286 2.451Zm0-6.498c-2.24 0-4.064 1.702-4.064 4.047 0 2.329 1.825 4.046 4.064 4.046 2.24 0 4.065-1.717 4.065-4.046 0-2.345-1.826-4.047-4.065-4.047Zm8.866 6.498c-1.227 0-2.285-1.01-2.285-2.451 0-1.456 1.058-2.453 2.285-2.453s2.285.997 2.285 2.453c0 1.44-1.058 2.451-2.285 2.451Zm0-6.498c-2.239 0-4.064 1.702-4.064 4.047 0 2.329 1.825 4.046 4.064 4.046s4.064-1.717 4.064-4.046c0-2.345-1.825-4.047-4.064-4.047Zm20.993-8.46c-.373-.255-.628-.63-.766-1.127l.836-.331c.071.309.211.551.418.729.207.176.451.265.733.265.303 0 .563-.096.778-.286a.906.906 0 0 0 .323-.708.869.869 0 0 0-.157-.502 1.088 1.088 0 0 0-.431-.36 1.342 1.342 0 0 0-.596-.132h-.489v-.795h.44c.298 0 .545-.082.744-.245a.805.805 0 0 0 .299-.658.767.767 0 0 0-.278-.605 1.02 1.02 0 0 0-.691-.24.923.923 0 0 0-.63.224 1.17 1.17 0 0 0-.355.53l-.803-.332a1.97 1.97 0 0 1 .633-.865c.307-.251.694-.377 1.163-.377.359 0 .678.07.957.211.278.141.496.335.654.58.157.246.235.523.235.832 0 .575-.25 1-.753 1.276v.05a1.7 1.7 0 0 1 .687.554c.177.244.265.539.265.887a1.7 1.7 0 0 1-.26.92 1.815 1.815 0 0 1-.716.65 2.187 2.187 0 0 1-1.019.235c-.442 0-.849-.127-1.221-.38Zm-6.379-5.682h.902v3.28l-.05 1.143h.05l2.658-4.423H81v5.93h-.903V9.7l.05-1.143h-.05l-2.699 4.505h-.993v-5.93Zm-4.926 5.077c.215 0 .405-.05.57-.15.166-.099.294-.23.381-.393a1.07 1.07 0 0 0-.951-1.586h-1.325v2.129h1.325Zm-2.236-5.077h.911v2.111h1.259c.37 0 .711.077 1.026.228.315.152.566.373.754.663.188.29.28.628.28 1.014 0 .387-.093.725-.28 1.015-.189.29-.44.512-.754.667a2.294 2.294 0 0 1-1.026.232h-2.17v-5.93Zm-3.51.861h-1.665v-.861H68.3v.861h-1.656v5.069h-.91V7.994Zm-3.387 2.7-.662-1.818-.223-.68h-.05l-.223.68-.663 1.818h1.821Zm-1.431-3.561h1.034l2.244 5.93H63.19l-.546-1.524h-2.418l-.546 1.524h-1.002l2.236-5.93Zm-3.941 3.288c-.37.326-.825.488-1.366.488-.359 0-.684-.073-.973-.22a1.643 1.643 0 0 1-.683-.633 1.869 1.869 0 0 1-.249-.977V7.133h.92v1.789c0 .359.104.636.314.832.21.196.492.294.844.294.481 0 .878-.187 1.193-.563V7.133h.902v5.93h-.902V10.42Zm-5.274.273-.662-1.818-.224-.68h-.05l-.223.68-.662 1.818h1.82Zm-1.433-3.561h1.036l2.243 5.93h-1.002l-.546-1.524h-2.417l-.547 1.524h-1.002l2.235-5.93Zm-7.401 0h.91v2.874h.05l2.36-2.874h1.142v.05l-2.5 2.964 2.633 2.866v.05H46.27l-2.442-2.717h-.05v2.716h-.91v-5.93ZM37.92 12.79a2.945 2.945 0 0 1-1.114-1.119 3.125 3.125 0 0 1-.406-1.573c0-.575.135-1.1.406-1.574.27-.475.641-.848 1.114-1.118.471-.27.994-.406 1.568-.406.889 0 1.62.323 2.194.97l-.637.62a2.08 2.08 0 0 0-.683-.546 1.97 1.97 0 0 0-.866-.183c-.403 0-.77.093-1.1.278a2.038 2.038 0 0 0-.787.787c-.194.34-.29.73-.29 1.172 0 .441.096.832.29 1.172.193.34.455.602.787.786.33.186.697.278 1.1.278.674 0 1.24-.279 1.698-.837l.654.63a3.026 3.026 0 0 1-2.36 1.068 3.097 3.097 0 0 1-1.569-.405Zm-19.462 5.663L9.17 9.693a2.142 2.142 0 0 1 3.063-.989l.006.003 10.426 6.018-4.208 3.728ZM9 11.015l8.408 8.368.032.034L9 28.336V11.015ZM11.132 31a2.13 2.13 0 0 1-1.965-1.3l9.302-9.26 4.25 4.232-10.472 6.016-.003.002-.031.018h-.001a2.126 2.126 0 0 1-1.08.292Zm8.283-11.5 4.227-4.208 4.41 2.545.015.01.023.013a2.117 2.117 0 0 1-.013 3.732l-.007.004-.006.004-4.386 2.52-4.263-4.62Z" /></symbol>',126,40),hu=(0,Ti.makeIcon)("Icon40GooglePlayButtonEn","google_play_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="google_play_button_en_40"><path fill-rule="evenodd" d="M42.296 24.277V22.55h5.914c.095.288.095.672.095 1.055 0 1.246-.381 2.876-1.526 4.026-1.145 1.246-2.48 1.821-4.388 1.821-3.434 0-6.391-2.875-6.391-6.326 0-3.451 2.957-6.327 6.391-6.327 1.908 0 3.244.767 4.293 1.726l-1.24 1.246c-.763-.671-1.813-1.246-3.148-1.246-2.48 0-4.484 2.012-4.484 4.6 0 2.589 1.908 4.602 4.484 4.602 1.621 0 2.575-.671 3.148-1.246.477-.48.858-1.247.954-2.205h-4.102Zm35.103 4.889h-1.813V17.184H77.4v11.982Zm12.21-11.982H93.9c2.003 0 3.911 1.438 3.911 3.738S95.903 24.66 93.9 24.66h-2.48v4.506h-1.813V17.184Zm9.158 11.982h1.812V17.184h-1.812v11.982Zm3.053-6.135c.477-1.246 1.812-1.822 3.148-1.822 2.003 0 3.624 1.247 3.815 3.356v4.6h-1.717v-.958h-.095c-.477.575-1.05 1.15-2.29 1.15-1.526 0-2.957-1.054-2.957-2.684 0-1.725 1.717-2.684 3.434-2.684.763 0 1.527.288 1.813.48v-.096c-.096-.959-.954-1.534-1.908-1.534-.668 0-1.24.192-1.622.863l-1.621-.671Zm10.969 3.642 2.003-5.176h1.908l-4.865 11.311h-1.812l1.812-4.026-3.148-7.285h1.908l2.099 5.176h.095Zm-27.186-2.78c-.382-.958-1.336-2.588-3.434-2.588-2.1 0-3.816 1.63-3.816 4.122 0 2.3 1.717 4.122 4.006 4.122 1.813 0 2.957-1.15 3.339-1.821l-1.335-.959c-.477.671-1.05 1.15-2.004 1.15s-1.526-.383-2.003-1.245l5.437-2.301-.19-.48Zm-12.878-1.725c-.477-.48-1.24-.959-2.194-.959-2.003 0-3.91 1.822-3.91 4.122 0 2.301 1.812 4.027 3.91 4.027.954 0 1.717-.48 2.099-.96h.095v.576c0 1.534-.858 2.396-2.194 2.396-1.05 0-1.812-.766-2.003-1.437l-1.526.67C67.479 31.659 68.623 33 70.626 33c2.1 0 3.816-1.246 3.816-4.218v-7.285h-1.717v.671Zm-15.072 3.26c0-2.397 1.812-4.123 4.102-4.123s4.102 1.63 4.102 4.122c0 2.397-1.813 4.122-4.102 4.122-2.29 0-4.102-1.821-4.102-4.122Zm-4.77-4.123c-2.289 0-4.101 1.726-4.101 4.122 0 2.3 1.812 4.122 4.102 4.122s4.102-1.725 4.102-4.122c0-2.492-1.813-4.122-4.102-4.122Zm38.539 1.63h2.575c1.24 0 2.004-1.054 2.099-2.109 0-.863-.763-2.013-2.099-2.013h-2.575v4.122Zm11.924 3.834c0 .767.859 1.055 1.431 1.055.954 0 1.908-.767 2.099-1.917l-.142-.058c-.416-.17-.794-.326-1.48-.326-.858 0-1.908.288-1.908 1.246Zm-23.277-1.534c0-1.533 1.24-2.396 2.099-2.396.668 0 1.335.384 1.526.863l-3.625 1.533Zm-11.733.096c0 1.438 1.05 2.493 2.29 2.493s2.194-1.055 2.194-2.493-.954-2.492-2.194-2.492-2.29 1.055-2.29 2.492Zm-6.58 2.493c-1.24 0-2.29-1.055-2.29-2.493s1.05-2.492 2.29-2.492 2.29.959 2.29 2.492c0 1.438-1.05 2.493-2.29 2.493ZM50.594 25.33c0 1.438 1.05 2.493 2.29 2.493s2.288-1.055 2.288-2.493c0-1.533-1.049-2.492-2.289-2.492-1.24 0-2.29 1.055-2.29 2.492Z" clip-rule="evenodd" /><path d="M64.258 13.2c-.83 0-1.53-.304-2.084-.901a3.146 3.146 0 0 1-.841-2.2c0-.873.283-1.612.841-2.198.551-.597 1.251-.901 2.082-.901.82 0 1.52.304 2.083.901.558.605.842 1.344.842 2.198-.01.875-.293 1.614-.842 2.197-.551.603-1.25.904-2.081.904Zm-24.703 0a2.83 2.83 0 0 1-2.093-.89c-.572-.588-.862-1.331-.862-2.209 0-.877.29-1.62.862-2.21a2.798 2.798 0 0 1 2.093-.889c.402 0 .794.084 1.169.254.368.165.668.39.89.665l.054.069-.62.636-.064-.079c-.35-.435-.818-.648-1.438-.648-.554 0-1.036.206-1.434.612-.4.409-.604.945-.604 1.593s.203 1.183.604 1.592c.398.406.88.612 1.434.612.59 0 1.086-.206 1.473-.612.228-.24.37-.574.42-.997h-1.987v-.894h2.84l.012.081c.02.15.041.306.041.45 0 .824-.238 1.492-.709 1.984-.535.583-1.235.88-2.081.88Zm32.845-.127h-.876l-2.683-4.488.023.808v3.678h-.876V7.129h1l.027.046 2.523 4.227-.023-.806V7.13h.885v5.944Zm-14.724 0h-.888v-5.05H55.25V7.13h3.963v.894h-1.539v5.05h.003Zm-3.15 0h-.885V7.13h.885v5.944Zm-4.974 0h-.885v-5.05h-1.54V7.13h3.964v.894h-1.54v5.05Zm-2.985-.01h-3.394V7.13h3.394v.894H44.06v1.631h2.262v.885H44.06v1.63h2.507v.895Zm16.257-1.379c.395.414.876.622 1.434.622a1.87 1.87 0 0 0 1.434-.622c.389-.406.585-.94.585-1.583s-.196-1.179-.583-1.583a1.92 1.92 0 0 0-1.434-.621 1.86 1.86 0 0 0-1.432.621c-.388.407-.585.94-.585 1.583s.194 1.179.58 1.583Zm-44.366 6.769L9.17 9.693a2.142 2.142 0 0 1 3.063-.989l.006.003 10.426 6.018-4.208 3.728ZM9 11.015l8.408 8.368.032.034L9 28.336V11.015ZM11.132 31a2.13 2.13 0 0 1-1.965-1.3l9.302-9.26 4.25 4.232-10.472 6.016-.003.002-.031.018h-.001a2.126 2.126 0 0 1-1.08.292Zm8.283-11.5 4.227-4.208 4.41 2.545.015.01.023.013a2.117 2.117 0 0 1-.013 3.732l-.007.004-.006.004-4.386 2.52-4.263-4.62Z" /></symbol>',126,40),Au=(0,Ti.makeIcon)("Icon40RustoreButtonRu","rustore_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="rustore_button_ru_40"><path fill-rule="evenodd" d="M63.773 31.4c-1.115 0-2.099-.296-2.952-.89a4.345 4.345 0 0 1-1.689-2.428l1.98-.342c.33.604.699 1.055 1.108 1.351.41.285.933.428 1.57.428.591 0 1.075-.131 1.45-.394a1.29 1.29 0 0 0 .58-1.111c0-.343-.108-.628-.324-.856a2.423 2.423 0 0 0-.82-.581 14.447 14.447 0 0 0-1.313-.496 15.093 15.093 0 0 1-1.876-.736 3.67 3.67 0 0 1-1.263-1.077c-.341-.479-.512-1.095-.512-1.847 0-.696.171-1.3.512-1.813a3.38 3.38 0 0 1 1.416-1.198c.592-.273 1.257-.41 1.996-.41 1.047 0 1.945.274 2.696.821.75.547 1.28 1.3 1.586 2.258l-1.945.325c-.216-.49-.517-.867-.904-1.13-.386-.262-.841-.393-1.364-.393-.535 0-.984.126-1.348.377-.364.25-.546.604-.546 1.06 0 .342.102.627.307.855.216.228.489.416.819.565.33.148.773.319 1.33.513.763.262 1.388.519 1.877.77.49.25.904.615 1.245 1.094.353.479.53 1.089.53 1.83 0 .696-.188 1.306-.564 1.83-.364.525-.864.93-1.5 1.215-.627.273-1.32.41-2.082.41Zm-18.103-.171h2.406l-3.344-4.584c.899-.228 1.615-.667 2.15-1.317.546-.661.819-1.442.819-2.343 0-.741-.182-1.397-.546-1.967a3.65 3.65 0 0 0-1.519-1.351c-.648-.33-1.382-.496-2.2-.496H39v12.058h2.047v-4.43h1.45l3.173 4.43Zm-4.623-6.311v-3.866h2.389c.637 0 1.154.183 1.552.548.41.353.614.815.614 1.385 0 .57-.204 1.038-.614 1.403-.398.353-.915.53-1.552.53h-2.389Zm10.101 6.003c.512.32 1.08.479 1.706.479.535 0 1.035-.131 1.501-.393a3.19 3.19 0 0 0 1.126-1.112l.393 1.334h1.467v-8.894h-1.962v5.148c0 .627-.188 1.146-.563 1.557-.375.399-.847.598-1.416.598-.557 0-1.018-.2-1.382-.598-.352-.4-.529-.918-.529-1.557v-5.148h-1.962v5.37c0 .708.142 1.34.427 1.9.296.558.694.997 1.194 1.316Zm23.933.308.17-1.71h-1.825c-.66 0-.99-.331-.99-.992v-4.482h2.645v-1.71h-2.644V19.77h-1.468l-.494 2.565h-1.45v1.71h1.45v4.482c0 .878.25 1.55.75 2.018.5.456 1.234.684 2.201.684h1.655Zm5.948.171c-.91 0-1.73-.194-2.457-.581a4.415 4.415 0 0 1-1.689-1.642c-.398-.707-.597-1.506-.597-2.395 0-.89.199-1.682.597-2.377a4.257 4.257 0 0 1 1.689-1.642c.728-.4 1.547-.599 2.457-.599.91 0 1.723.2 2.44.599.727.387 1.29.935 1.688 1.642.41.695.614 1.488.614 2.377 0 .89-.204 1.688-.614 2.395a4.263 4.263 0 0 1-1.689 1.642c-.716.387-1.53.581-2.44.581Zm0-1.796c.796 0 1.444-.256 1.945-.77.5-.524.75-1.208.75-2.052 0-.844-.25-1.522-.75-2.035-.501-.525-1.15-.787-1.945-.787-.796 0-1.445.262-1.945.787-.5.513-.75 1.191-.75 2.035 0 .844.25 1.528.75 2.052.5.514 1.148.77 1.945.77Zm8.086-7.269h-1.467v8.894h1.962v-5.25c0-1.175.58-1.762 1.74-1.762h1.126l-.171-1.882h-.375c-.558 0-1.035.097-1.433.29-.387.195-.723.525-1.007.993l-.375-1.283ZM102.3 26.68c0 .172-.011.382-.034.633h-7.131c.09.696.375 1.255.853 1.676.477.41 1.086.616 1.825.616.5 0 .95-.097 1.348-.29.41-.195.722-.457.938-.787l1.843.307a3.645 3.645 0 0 1-1.655 1.899c-.774.445-1.638.667-2.593.667-.887 0-1.684-.194-2.389-.581a4.36 4.36 0 0 1-1.638-1.642c-.386-.707-.58-1.506-.58-2.395 0-.89.194-1.682.58-2.377a4.203 4.203 0 0 1 1.638-1.642c.705-.4 1.502-.599 2.389-.599.887 0 1.677.2 2.371.599a4.086 4.086 0 0 1 1.638 1.625c.398.684.597 1.448.597 2.291Zm-4.606-2.804a2.47 2.47 0 0 0-1.553.513c-.432.342-.728.803-.887 1.385h4.913a2.625 2.625 0 0 0-.92-1.368c-.433-.354-.95-.53-1.553-.53Z" clip-rule="evenodd" /><path d="M39 15.791v-2.715h.209a.792.792 0 0 0 .536-.189c.146-.132.269-.361.368-.686.106-.331.19-.789.249-1.372L40.74 7h4.343v6.076h1.044v2.695h-1.044v-1.76h-5.04v1.78H39Zm1.78-2.715h3.23V7.935h-2.306l-.288 2.953c-.06.604-.14 1.068-.24 1.393-.092.324-.224.573-.397.745v.05Zm8.572 1.064c-.49 0-.921-.112-1.292-.338a2.217 2.217 0 0 1-.855-.954c-.2-.418-.298-.909-.298-1.472 0-.557.099-1.041.298-1.452.199-.418.483-.736.855-.955.37-.225.801-.338 1.292-.338.49 0 .918.113 1.282.338.371.219.656.537.855.955.199.41.298.895.298 1.452 0 .563-.1 1.054-.298 1.472-.199.41-.484.729-.855.954-.364.226-.792.338-1.282.338Zm0-.875c.43 0 .769-.166 1.014-.497.245-.338.368-.802.368-1.392 0-.584-.123-1.041-.368-1.373-.245-.331-.583-.497-1.014-.497-.43 0-.769.166-1.014.497-.245.332-.368.79-.368 1.373 0 .59.123 1.054.368 1.392.245.331.583.497 1.014.497Zm5.92.875c-.497 0-.93-.112-1.302-.338a2.217 2.217 0 0 1-.855-.954c-.198-.418-.298-.905-.298-1.462 0-.557.1-1.045.298-1.462.2-.418.48-.736.845-.955.371-.225.809-.338 1.312-.338.557 0 1.028.136 1.412.408.391.265.646.646.765 1.143h-1.063c-.219-.45-.58-.676-1.084-.676-.45 0-.802.166-1.053.497-.246.332-.368.793-.368 1.383s.122 1.05.368 1.382c.251.331.606.497 1.063.497.279 0 .52-.066.726-.199a.97.97 0 0 0 .417-.567h1.064a1.98 1.98 0 0 1-.795 1.204c-.404.292-.888.437-1.452.437Zm5.535-.129h-1.024V9.635h-1.71V8.76h4.444v.875h-1.71v4.376Zm6.238-5.251h1.044l-1.929 5.65c-.145.424-.301.749-.467.974a1.348 1.348 0 0 1-.616.478c-.245.093-.57.139-.974.139h-.398v-.905h.427c.22 0 .391-.023.517-.07a.641.641 0 0 0 .308-.238 2.38 2.38 0 0 0 .249-.507l.05-.14-2.147-5.38h1.103l1.501 4.008h.05l1.282-4.008Zm3.147 5.251h-1.024v-5.25h4.294v5.25H72.44V9.635h-2.247v4.376Zm8.266-3.103V8.76h1.024v5.251h-1.024v-2.228h-2.326v2.228h-1.024v-5.25h1.024v2.147h2.326Zm4.814 3.232c-.49 0-.92-.112-1.292-.338a2.217 2.217 0 0 1-.855-.954c-.199-.418-.298-.909-.298-1.472 0-.557.1-1.041.298-1.452.199-.418.484-.736.855-.955.371-.225.802-.338 1.292-.338s.918.113 1.283.338c.37.219.656.537.854.955.2.41.299.895.299 1.452 0 .563-.1 1.054-.299 1.472-.198.41-.483.729-.854.954-.365.226-.792.338-1.283.338Zm0-.875c.431 0 .769-.166 1.014-.497.245-.338.368-.802.368-1.392 0-.584-.123-1.041-.368-1.373-.245-.331-.583-.497-1.014-.497-.43 0-.768.166-1.014.497-.245.332-.367.79-.367 1.373 0 .59.122 1.054.367 1.392.246.331.584.497 1.014.497Zm9.703-2.019c.617.213.925.627.925 1.243 0 .465-.169.836-.507 1.114-.338.272-.792.408-1.362.408h-2.356v-5.25h2.297c.53 0 .954.125 1.272.377.325.245.487.57.487.975a1.1 1.1 0 0 1-.199.656 1.26 1.26 0 0 1-.556.428v.05ZM90.7 9.586v1.312h1.253c.232 0 .414-.06.546-.179a.597.597 0 0 0 .21-.477.597.597 0 0 0-.21-.477c-.139-.12-.321-.18-.546-.18H90.7Zm1.312 3.6c.265 0 .474-.07.627-.21a.703.703 0 0 0 .238-.556.674.674 0 0 0-.238-.547c-.153-.14-.362-.209-.627-.209H90.7v1.522h1.312Z" /><path fill-rule="evenodd" d="M19.52 32c-5.43 0-8.146 0-9.833-1.688C8 28.625 8 25.91 8 20.48v-.96c0-5.43 0-8.146 1.687-9.833C11.374 8 14.089 8 19.52 8h.96c5.43 0 8.145 0 9.832 1.687C32 11.374 32 14.089 32 19.52v.96c0 5.43 0 8.145-1.688 9.832C28.625 32 25.91 32 20.48 32h-.96Zm5.387-8.453 1.622.405a1.162 1.162 0 0 0 1.447-1.122v-7.816c0-.663-.454-1.242-1.1-1.403l-4.652-1.162a1.162 1.162 0 0 0-1.446 1.123v1.409l-2.93-.732A1.162 1.162 0 0 0 16.4 15.37v1.41l-2.93-.733a1.162 1.162 0 0 0-1.447 1.123v7.815c0 .664.453 1.242 1.1 1.404l4.651 1.161a1.162 1.162 0 0 0 1.447-1.122v-7.804c0-.66-.417-1.042-.568-1.16a.07.07 0 0 1-.016-.093.082.082 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.969a.473.473 0 0 0 .317.43l1.646.411a1.162 1.162 0 0 0 1.447-1.123v-7.803c0-.66-.416-1.042-.567-1.159a.07.07 0 0 1-.016-.094.083.083 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.968a.47.47 0 0 0 .34.436Z" clip-rule="evenodd" /></symbol>',126,40),gu=(0,Ti.makeIcon)("Icon40RustoreButtonEn","rustore_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="rustore_button_en_40"><path fill-rule="evenodd" d="M63.773 31.4c-1.115 0-2.099-.296-2.952-.89a4.345 4.345 0 0 1-1.689-2.428l1.98-.342c.33.604.699 1.055 1.108 1.351.41.285.933.428 1.57.428.591 0 1.075-.131 1.45-.394a1.29 1.29 0 0 0 .58-1.111c0-.343-.108-.628-.324-.856a2.423 2.423 0 0 0-.82-.581 14.447 14.447 0 0 0-1.313-.496 15.093 15.093 0 0 1-1.876-.736 3.67 3.67 0 0 1-1.263-1.077c-.341-.479-.512-1.095-.512-1.847 0-.696.171-1.3.512-1.813a3.38 3.38 0 0 1 1.416-1.198c.592-.273 1.257-.41 1.996-.41 1.047 0 1.945.274 2.696.821.75.547 1.28 1.3 1.586 2.258l-1.945.325c-.216-.49-.517-.867-.904-1.13-.386-.262-.841-.393-1.364-.393-.535 0-.984.126-1.348.377-.364.25-.546.604-.546 1.06 0 .342.102.627.307.855.216.228.489.416.819.565.33.148.773.319 1.33.513.763.262 1.388.519 1.877.77.49.25.904.615 1.245 1.094.353.479.53 1.089.53 1.83 0 .696-.188 1.306-.564 1.83-.364.525-.864.93-1.5 1.215-.627.273-1.32.41-2.082.41Zm-18.103-.171h2.406l-3.344-4.584c.899-.228 1.615-.667 2.15-1.317.546-.661.819-1.442.819-2.343 0-.741-.182-1.397-.546-1.967a3.65 3.65 0 0 0-1.519-1.351c-.648-.33-1.382-.496-2.2-.496H39v12.058h2.047v-4.43h1.45l3.173 4.43Zm-4.623-6.311v-3.866h2.389c.637 0 1.154.183 1.552.548.41.353.614.815.614 1.385 0 .57-.204 1.038-.614 1.403-.398.353-.915.53-1.552.53h-2.389Zm10.101 6.003c.512.32 1.08.479 1.706.479.535 0 1.035-.131 1.501-.393a3.19 3.19 0 0 0 1.126-1.112l.393 1.334h1.467v-8.894h-1.962v5.148c0 .627-.188 1.146-.563 1.557-.375.399-.847.598-1.416.598-.557 0-1.018-.2-1.382-.598-.352-.4-.529-.918-.529-1.557v-5.148h-1.962v5.37c0 .708.142 1.34.427 1.9.296.558.694.997 1.194 1.316Zm23.933.308.17-1.71h-1.825c-.66 0-.99-.331-.99-.992v-4.482h2.645v-1.71h-2.644V19.77h-1.468l-.494 2.565h-1.45v1.71h1.45v4.482c0 .878.25 1.55.75 2.018.5.456 1.234.684 2.201.684h1.655Zm5.948.171c-.91 0-1.73-.194-2.457-.581a4.415 4.415 0 0 1-1.689-1.642c-.398-.707-.597-1.506-.597-2.395 0-.89.199-1.682.597-2.377a4.257 4.257 0 0 1 1.689-1.642c.728-.4 1.547-.599 2.457-.599.91 0 1.723.2 2.44.599.727.387 1.29.935 1.688 1.642.41.695.614 1.488.614 2.377 0 .89-.204 1.688-.614 2.395a4.263 4.263 0 0 1-1.689 1.642c-.716.387-1.53.581-2.44.581Zm0-1.796c.796 0 1.444-.256 1.945-.77.5-.524.75-1.208.75-2.052 0-.844-.25-1.522-.75-2.035-.501-.525-1.15-.787-1.945-.787-.796 0-1.445.262-1.945.787-.5.513-.75 1.191-.75 2.035 0 .844.25 1.528.75 2.052.5.514 1.148.77 1.945.77Zm8.086-7.269h-1.467v8.894h1.962v-5.25c0-1.175.58-1.762 1.74-1.762h1.126l-.171-1.882h-.375c-.558 0-1.035.097-1.433.29-.387.195-.723.525-1.007.993l-.375-1.283ZM102.3 26.68c0 .172-.011.382-.034.633h-7.131c.09.696.375 1.255.853 1.676.477.41 1.086.616 1.825.616.5 0 .95-.097 1.348-.29.41-.195.722-.457.938-.787l1.843.307a3.645 3.645 0 0 1-1.655 1.899c-.774.445-1.638.667-2.593.667-.887 0-1.684-.194-2.389-.581a4.36 4.36 0 0 1-1.638-1.642c-.386-.707-.58-1.506-.58-2.395 0-.89.194-1.682.58-2.377a4.203 4.203 0 0 1 1.638-1.642c.705-.4 1.502-.599 2.389-.599.887 0 1.677.2 2.371.599a4.086 4.086 0 0 1 1.638 1.625c.398.684.597 1.448.597 2.291Zm-4.606-2.804a2.47 2.47 0 0 0-1.553.513c-.432.342-.728.803-.887 1.385h4.913a2.625 2.625 0 0 0-.92-1.368c-.433-.354-.95-.53-1.553-.53Z" clip-rule="evenodd" /><path d="M45.403 14.371h-1.121l-.546-1.667H40.83l-.555 1.667h-1.092l2.48-6.994h1.34l2.4 6.994Zm-3.135-5.942-1.121 3.353h2.291l-1.09-3.353h-.08Zm6.504 5.942h-1.24l-1.766-5.238h1.082l1.3 4.147h.049l1.399-4.147h1.041l-1.865 5.238Zm4.825-5.367c.628 0 1.117.182 1.468.546.35.363.526.866.526 1.507v3.314h-.804l-.11-.565c-.495.463-1.05.694-1.666.694-.516 0-.932-.149-1.25-.446-.31-.298-.466-.695-.466-1.19 0-.523.195-.933.585-1.231.39-.298.913-.446 1.568-.446h1.12v-.14c0-.39-.088-.687-.267-.892-.172-.205-.42-.308-.744-.308-.205 0-.39.047-.556.14a.803.803 0 0 0-.367.386h-1.061c.119-.443.36-.78.724-1.012.37-.238.803-.357 1.3-.357Zm-1.27 3.81c0 .25.082.453.248.605.172.152.393.228.664.228.225 0 .457-.053.695-.159.238-.106.45-.245.635-.417v-1.11h-1.111c-.35 0-.629.075-.834.227a.745.745 0 0 0-.297.625Zm5.876 1.557H57.18V9.133h1.022v5.238Zm-.506-6.091a.63.63 0 0 1-.466-.179.63.63 0 0 1-.179-.466c0-.192.06-.344.179-.456A.63.63 0 0 1 57.697 7c.192 0 .344.06.456.179.12.112.179.264.179.456a.63.63 0 0 1-.179.466.598.598 0 0 1-.456.179Zm3.198 6.091h-1.021V7.179h1.021v7.192Zm3.695-5.367c.627 0 1.117.182 1.467.546.35.363.526.866.526 1.507v3.314h-.803l-.11-.565c-.496.463-1.051.694-1.666.694-.516 0-.933-.149-1.25-.446-.311-.298-.466-.695-.466-1.19 0-.523.195-.933.585-1.231.39-.298.913-.446 1.567-.446h1.121v-.14c0-.39-.089-.687-.268-.892-.172-.205-.42-.308-.744-.308-.205 0-.39.047-.555.14a.803.803 0 0 0-.367.386h-1.062c.12-.443.36-.78.724-1.012.37-.238.804-.357 1.3-.357Zm-1.27 3.81c0 .25.082.453.247.605.172.152.394.228.665.228a1.7 1.7 0 0 0 .694-.159c.239-.106.45-.245.635-.417v-1.11h-1.11c-.351 0-.63.075-.834.227a.744.744 0 0 0-.298.625Zm7.344-3.81c.443 0 .83.112 1.16.337.331.219.586.533.764.943.179.41.268.886.268 1.428 0 .55-.1 1.035-.297 1.459a2.34 2.34 0 0 1-.814.982c-.35.231-.757.347-1.22.347a2.062 2.062 0 0 1-1.439-.575l-.09.446h-.803V7.179h1.022v2.37c.443-.363.926-.545 1.449-.545Zm-.318 4.633c.456 0 .814-.172 1.072-.516.257-.344.386-.814.386-1.409 0-.569-.122-1.018-.367-1.349a1.147 1.147 0 0 0-.992-.506c-.41 0-.82.166-1.23.496v2.867c.337.278.715.417 1.131.417Zm4.894.734h-1.022V7.179h1.022v7.192Zm6.055-2.768c0 .053-.01.189-.03.407h-3.64c.032.529.171.936.416 1.22.251.278.598.417 1.041.417.232 0 .44-.043.626-.13a.829.829 0 0 0 .406-.386h1.052a1.864 1.864 0 0 1-.774 1.012c-.37.238-.823.357-1.36.357-.489 0-.918-.112-1.289-.337a2.233 2.233 0 0 1-.843-.953c-.198-.416-.298-.903-.298-1.458 0-.556.096-1.038.288-1.448.192-.417.463-.738.814-.963.357-.225.773-.337 1.25-.337.47 0 .88.106 1.23.317.357.212.631.516.823.913.192.39.288.847.288 1.37Zm-2.341-1.766c-.364 0-.658.126-.883.377-.225.245-.367.592-.427 1.042h2.629c-.053-.45-.195-.797-.427-1.042-.225-.251-.522-.377-.892-.377Zm7.239 4.534h-1.022V9.133h1.022v5.238Zm-.506-6.091a.63.63 0 0 1-.466-.179.63.63 0 0 1-.178-.466.6.6 0 0 1 .178-.456.63.63 0 0 1 .466-.179.6.6 0 0 1 .457.179.598.598 0 0 1 .178.456.63.63 0 0 1-.178.466.598.598 0 0 1-.457.179Zm4.618.724c.37 0 .694.086.972.258.284.172.506.42.665.744.158.317.238.691.238 1.121v3.244h-1.022v-3.214c0-.404-.1-.718-.298-.943-.192-.225-.463-.337-.813-.337-.41 0-.804.179-1.18.536v3.958h-1.023V9.133h.804l.1.516a3.24 3.24 0 0 1 .763-.486 1.98 1.98 0 0 1 .794-.159Z" /><path fill-rule="evenodd" d="M19.52 32c-5.43 0-8.146 0-9.833-1.688C8 28.625 8 25.91 8 20.48v-.96c0-5.43 0-8.146 1.687-9.833C11.374 8 14.089 8 19.52 8h.96c5.43 0 8.145 0 9.832 1.687C32 11.374 32 14.089 32 19.52v.96c0 5.43 0 8.145-1.688 9.832C28.625 32 25.91 32 20.48 32h-.96Zm5.387-8.453 1.622.405a1.162 1.162 0 0 0 1.447-1.122v-7.816c0-.663-.454-1.242-1.1-1.403l-4.652-1.162a1.162 1.162 0 0 0-1.446 1.123v1.409l-2.93-.732A1.162 1.162 0 0 0 16.4 15.37v1.41l-2.93-.733a1.162 1.162 0 0 0-1.447 1.123v7.815c0 .664.453 1.242 1.1 1.404l4.651 1.161a1.162 1.162 0 0 0 1.447-1.122v-7.804c0-.66-.417-1.042-.568-1.16a.07.07 0 0 1-.016-.093.082.082 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.969a.473.473 0 0 0 .317.43l1.646.411a1.162 1.162 0 0 0 1.447-1.123v-7.803c0-.66-.416-1.042-.567-1.159a.07.07 0 0 1-.016-.094.083.083 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.968a.47.47 0 0 0 .34.436Z" clip-rule="evenodd" /></symbol>',126,40);var mu;!function(e){e.APP_STORE="appStore",e.GOOGLE_PLAY="googlePlay",e.RU_STORE="ruStore"}(mu||(mu={}));var Cu=function(e){var n=e.onClose,t=e.appMarket,a=rc().getLang,r=t===mu.APP_STORE?yi.OS.IOS:yi.OS.ANDROID;return(0,o.jsx)(yc.BaseModal,(0,i.__assign)({className:"CallsModalMobileAppDownloaded",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__wrap"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__device-img CallsModalMobileAppDownloaded__device-img-"+r},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__qr"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__qrImg CallsModalMobileAppDownloaded__qrImg-"+t},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__title"},{children:function(){switch(r){case yi.OS.IOS:return a("calls_application_for_ios");case yi.OS.ANDROID:return a("calls_application_for_android")}}()}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__text"},{children:a("calls_scan_qr_offer")}),void 0)]}),void 0)]}),void 0)}),void 0)},Eu=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.205 16.205 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.79 22.79 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.215 25.215 0 0 0 .647-1.49l.003-.008a18.66 18.66 0 0 0 .919-3.044.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.538 16.538 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#b)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395v14.068h2.395v-6.026h.598l5.268 6.026h3.153ZM73.52 13.797c1.258-.399 2.156-1.476 2.156-3.053 0-2.294-2.035-3.93-4.909-3.93-2.514 0-4.39 1.257-5.228 3.631l2.255.38c.519-1.098 1.517-1.817 2.913-1.817 1.457 0 2.554.779 2.554 1.916 0 1.157-1.137 1.936-2.733 1.936h-1.776v2.095h1.776c2.075 0 2.973.878 2.973 2.015 0 1.297-1.058 2.115-2.814 2.115-1.636 0-2.554-.698-3.192-2.015l-2.295.379c.579 2.275 2.654 3.831 5.507 3.831 3.313 0 5.248-1.856 5.248-4.21 0-1.756-1.137-2.834-2.434-3.273ZM85.286 15.693c.898-.419 1.477-1.117 1.477-2.195 0-1.636-1.497-2.793-3.652-2.793h-4.968V21.08h5.188c2.235 0 3.791-1.218 3.791-2.874a2.605 2.605 0 0 0-1.836-2.514ZM80.437 12.6h2.674c.798 0 1.357.479 1.357 1.138 0 .658-.559 1.117-1.357 1.117h-2.674V12.6Zm2.894 6.585h-2.894v-2.534h2.894c.898 0 1.496.519 1.496 1.277 0 .758-.598 1.257-1.496 1.257ZM94.16 21.28c3.252 0 5.547-2.235 5.547-5.387 0-3.153-2.295-5.388-5.547-5.388-3.253 0-5.548 2.235-5.548 5.388 0 3.152 2.295 5.387 5.548 5.387Zm0-2.095c-1.876 0-3.153-1.337-3.153-3.292 0-1.956 1.277-3.293 3.153-3.293 1.875 0 3.152 1.337 3.152 3.293 0 1.955-1.277 3.292-3.152 3.292ZM108.646 10.704v4.091h-4.649v-4.09h-2.295V21.08h2.295v-4.19h4.649v4.19h2.295V10.704h-2.295ZM119.975 21.08h3.013l-4.769-5.387 4.37-4.989h-2.734l-3.472 4.031h-.558v-4.03h-2.295V21.08h2.295v-4.13h.558l3.592 4.13ZM124.286 21.08h3.253l3.871-7.702h.319v7.703h2.195V10.704h-3.252l-3.871 7.703h-.32v-7.703h-2.195v10.377Z"},void 0)}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},Su=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#b)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.897 22.897 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.164 25.164 0 0 0 .647-1.49l.003-.008c.412-1.05.711-2.048.919-3.044a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.535 16.535 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#c)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395V21.08h2.395v-6.027h.598l5.268 6.027h3.153ZM72.623 21.28c2.893 0 5.348-1.616 6.345-4.17l-2.374-.4c-.699 1.497-2.155 2.375-3.891 2.375-2.674 0-4.51-2.055-4.51-5.048 0-2.973 1.856-5.029 4.51-5.029 1.716 0 3.112.838 3.791 2.275l2.374-.399c-.957-2.514-3.332-4.07-6.245-4.07-4.03 0-6.924 3.012-6.924 7.223 0 4.23 2.893 7.243 6.924 7.243ZM85.004 10.505c-2.016 0-3.791 1.037-4.31 2.833l2.115.36c.32-.639 1.037-1.238 2.075-1.238 1.257 0 1.995.898 2.095 2.255h-2.235c-3.053 0-4.57 1.337-4.57 3.253 0 1.935 1.497 3.312 3.612 3.312 1.697 0 2.834-.978 3.333-1.836l.479 1.637h1.696v-5.827c0-3.013-1.636-4.75-4.29-4.75Zm-.679 8.84c-1.117 0-1.835-.58-1.835-1.477 0-.798.578-1.357 2.334-1.357H87c0 1.696-1.077 2.834-2.674 2.834ZM91.883 21.08h2.295V7.014h-2.295V21.08ZM96.969 21.08h2.295V7.014h-2.295V21.08ZM105.687 21.28c2.973 0 4.33-1.477 4.33-3.153 0-2.055-1.916-2.674-3.552-3.132-1.217-.34-2.275-.659-2.275-1.497 0-.678.758-1.038 1.616-1.038.958 0 1.676.5 2.056 1.357l2.135-.359c-.579-1.816-2.155-2.953-4.211-2.953-2.115 0-3.971.978-3.971 3.053 0 2.175 1.996 2.753 3.652 3.212 1.177.32 2.195.619 2.195 1.417 0 .818-.878 1.137-1.796 1.137-1.177 0-2.055-.558-2.394-1.536l-2.215.38c.439 1.915 2.075 3.112 4.43 3.112Z"},void 0)}),void 0)]}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h134v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"c"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},Iu=function(e){return"ru"===e.lang?(0,o.jsx)(Eu,{},void 0):(0,o.jsx)(Su,{},void 0)},Tu=t(64372);const Nu=(0,X.makeIcon)("Icon16LogoApple","logo_apple_16","0 0 16 16",'<symbol viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="logo_apple_16"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.833 7.44c-.018-1.774 1.45-2.624 1.516-2.666-.825-1.204-2.11-1.369-2.568-1.388-1.093-.11-2.134.642-2.689.642-.553 0-1.41-.625-2.317-.609-1.192.018-2.29.691-2.904 1.755-1.239 2.143-.318 5.317.89 7.055.59.85 1.293 1.806 2.216 1.772.89-.036 1.225-.574 2.3-.574 1.076 0 1.378.574 2.319.556.957-.018 1.563-.867 2.149-1.72.677-.987.956-1.942.972-1.991-.02-.01-1.866-.714-1.884-2.832Zm-1.768-5.204c.49-.593.82-1.415.73-2.236-.706.029-1.561.469-2.068 1.06-.454.525-.852 1.363-.745 2.167.788.061 1.592-.4 2.083-.991Z" fill="currentColor" /></symbol>',16,16,!1,void 0),xu=(0,Ti.makeIcon)("Icon16LogoWindows","logo_windows_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_windows_16"><path fill="currentColor" d="M2 8V3.677l5-.678V8H2Zm5.5 0H14V2l-6.5.903V8Zm-.5.5H2v3.823L7 13V8.5Zm.5 0v4.597L14 14V8.5H7.5Z" /></symbol>',16,16),yu=(0,Ti.makeIcon)("Icon16LogoLinux","logo_linux_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_linux_16"><path fill="currentColor" d="M12.744 12.112c-.336-.26-.205-.835-.554-1.118.338-1.963-.61-3.693-1.739-4.802-.948-.93-.642-1.836-.642-2.62C9.809 2.322 9.27 1 7.639 1 5.896 1 5.418 2.388 5.401 3.18c-.042 1.903.403 2.398-.764 3.783-1.373 1.63-1.575 3.254-1.265 4.116-.145.161-.34.34-.706.487-1.01.42-.27 1.123-.549 1.622A.884.884 0 0 0 2 13.62c0 .437.364.816 1.026.76.893-.077 1.717.527 2.25.527.47 0 .856-.255 1.036-.607.842-.198 1.88-.173 2.721.034.151.403.56.666 1.016.666.997 0 1.189-1.079 2.332-1.444a.9.9 0 0 0 .619-.868c0-.227-.085-.444-.256-.576Zm-5.59-6.105c-.195 0-.356-.15-.611-.331-.323-.229-.65-.36-.647-.6 0-.166.231-.217.53-.398.322-.194.448-.391.764-.391.324 0 .422.156.862.337.432.18.734.25.734.451 0 .207-.453.355-.708.507-.375.22-.567.425-.924.425Zm1.018-3.042c.539.083.6.987.341 1.432l-.217-.085c.113-.317.11-.838-.266-.871-.239-.021-.393.28-.426.537a1.07 1.07 0 0 0-.32-.074c.039-.538.403-1.013.888-.939Zm-2.08.193c.413-.098.657.36.659.837l-.19.111c-.025-.2-.119-.523-.353-.454-.252.075-.21.632-.07.746l-.188.1c-.256-.413-.256-1.245.142-1.34ZM4.8 14.383c-1.2-.52-1.608-.402-1.837-.402-.475 0-.63-.338-.452-.657.152-.272.105-.556.068-.784-.058-.35-.068-.463.292-.614.498-.201.72-.461.884-.655.463-.547.93.313 1.314 1.079.249.496.738.748.89 1.298.138.508-.435 1.05-1.16.735Zm4.27-1.093c-.846.393-1.924.573-2.73.175-.12-.329-.31-.541-.515-.755.33-.082.574-.474.281-.868-.312-.42-.95-.714-1.595-1.19-.603-.445-.794-1.542.028-2.769-.4 1.087-.167 2.088.034 2.374.042-.576.09-1.539.915-2.692.416-.582.422-1.351.431-1.832l.379.248c.279.196.512.413.847.413.495 0 .769-.272 1.15-.498.15-.088.375-.176.564-.3.318 1.445 1.634 3.182 1.708 4.171.306-.601-.087-2.05-.087-2.05.515.75.556 1.375.578 2.142.36.14.747.506.782.989l-.15-.016c-.077-.537-1.593-1.324-1.73-.315-.726.106-.462 1.205-.608 1.918-.068.326-.192.584-.283.855Zm2.96-.024c-.601.222-1.008.693-1.287.985-.538.564-1.249.293-1.325-.234-.08-.563.22-.87.35-1.501.118-.576-.014-1.462.263-1.557.18 1.023 1.263.593 1.51.314.401 0 .435.13.525.488.056.225.133.414.353.636.255.26.177.661-.388.87ZM7.143 5.68c-.398 0-.696-.253-.938-.45-.124-.099.031-.283.155-.183.237.192.475.394.783.394.37 0 .698-.303 1.14-.47.152-.056.238.167.088.223-.43.162-.775.486-1.228.486Z" /></symbol>',16,16);var bu=function(e){var n=e.icon,t=e.text,a=e.onClick;return(0,o.jsxs)(Ea.default,(0,i.__assign)({appearance:"secondary",className:"CallsAppDownloadBanner--bannerButton",onClick:a},{children:[t,(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonIcon"},{children:n}),void 0)]}),void 0)},Ou=function(){var e=function(){return bi("/calls?act=download_app&type=mac",d.DESKTOP_CALLS_FILENAME[yi.OS.MAC],!0)},n=function(){return bi("/calls?act=download_app&type=windows",d.DESKTOP_CALLS_FILENAME[yi.OS.WINDOWS],!0)},t=function(){return function(e){void 0===e&&(e=d.DESKTOP_CALLS_DOWNLOAD_PAGE);var n=document.createElement("a");n.target="_blank",n.href=e,document.body.appendChild(n),n.click(),n.remove()}("/calls?act=download_app&type=linux")},a=null,r=(0,o.jsx)(o.Fragment,{},void 0);switch(yi.Platform.OS){case yi.OS.WINDOWS:r=(0,o.jsx)(bu,{icon:(0,o.jsx)(xu,{},void 0),text:"Windows",onClick:n},void 0);break;case yi.OS.MAC:r=(0,o.jsx)(bu,{icon:(0,o.jsx)(Nu,{},void 0),text:"Mac",onClick:e},void 0);break;case yi.OS.LINUX:r=(0,o.jsx)(bu,{icon:(0,o.jsx)(yu,{},void 0),text:"Linux",onClick:t},void 0);break;default:r=(0,o.jsx)(bu,{icon:(0,o.jsx)(xu,{},void 0),text:"Windows",onClick:n},void 0),a=(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonsSecond"},{children:[(0,o.jsx)(bu,{icon:(0,o.jsx)(Nu,{},void 0),text:"Mac",onClick:e},void 0),(0,o.jsx)(bu,{icon:(0,o.jsx)(yu,{},void 0),text:"Linux",onClick:t},void 0)]}),void 0)}return{mainButton:r,otherButtons:a}},wu=function(e){var n=e.link,t=e.storeIcon,a=e.onClick;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row"},{children:[(0,o.jsx)(Zd.default,(0,i.__assign)({className:"CallsAppDownloadBanner__link",target:"_blank",href:n,rel:"noreferrer"},{children:t}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink",onClick:a},{children:(0,o.jsx)(_u,{},void 0)}),void 0)]}),void 0)},Mu=function(e){var n=e.onCreateCall,t=rc().getLang,a=(0,Yd.useLocale)().locale;return(0,o.jsx)(Tu.Dropdown,(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown",trigger:"hover",position:"l",dataJsx:function(){var e=(0,i.__read)(t("calls_dropdown_ios_download_disabled_v2").split("{link}"),2),a=e[0],r=e[1];return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__ctx CallsDropdownComponent__in"},{children:[(0,o.jsxs)("p",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__desc"},{children:[a.trim()," ",(0,o.jsx)(Zd.default,(0,i.__assign)({target:"_blank",href:"https://calls.vk.com",rel:"noreferrer"},{children:"calls.vk.com"}),void 0),r?" "+r:""]}),void 0),(0,o.jsx)(Ea.default,(0,i.__assign)({wide:!0,appearance:"primary",size:"s",onClick:function(){return n(ui.CallStatSource.HISTORY_CREATE)}},{children:t("calls_dropdown_ios_call_from_web")}),void 0)]}),void 0)},marginLeft:-221,useFixedPosition:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row","data-platform":"ios"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__link","data-platform":"ios"},{children:ku(a)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink","data-platform":"ios"},{children:(0,o.jsx)(_u,{},void 0)}),void 0)]}),void 0)}),void 0)},Pu=(0,l.memo)((function(e){var n=e.onCreateCall,t=e.useDisabledAppStoreBtn,a=rc().getLang,r=(0,Yd.useLocale)().locale,s=function(){var e=(0,i.__read)((0,l.useState)(!1),2),n=e[0],t=e[1],a=(0,l.useCallback)((function(){t(!1)}),[]);return{openedModal:n,openAppStoreModal:(0,l.useCallback)((function(){t(mu.APP_STORE)}),[]),openGooglePlayModal:(0,l.useCallback)((function(){t(mu.GOOGLE_PLAY)}),[]),openRuStoreModal:(0,l.useCallback)((function(){t(mu.RU_STORE)}),[]),closeModal:a}}(),c=s.openedModal,d=s.openAppStoreModal,u=s.openGooglePlayModal,_=s.openRuStoreModal,v=s.closeModal,p=Ou(),f=p.mainButton,h=p.otherButtons;return(0,o.jsxs)(id.default,(0,i.__assign)({className:"CallsAppDownloadBanner--banner"},{children:[(0,o.jsx)(Iu,{lang:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerDesc"},{children:a("calls_history_desktop_banner_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerSubDesc"},{children:a("calls_history_desktop_banner_sub_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_mobile")}),void 0),t&&(0,o.jsx)(Mu,{onCreateCall:n},void 0),!t&&(0,o.jsx)(wu,{link:"https://apps.apple.com/app/id1612939275",storeIcon:ku(r),onClick:d},void 0),(0,o.jsx)(wu,{link:"https://play.google.com/store/apps/details?id=com.vk.calls",storeIcon:Lu(r),onClick:u},void 0),(0,o.jsx)(wu,{link:"https://apps.rustore.ru/app/com.vk.calls",storeIcon:Du(r),onClick:_},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtons"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_desktop")}),void 0),f,h]}),void 0),c&&(0,o.jsx)(Cu,{appMarket:c,onClose:v},void 0)]}),void 0)}));function ku(e){return"ru"===e?(0,o.jsx)(vu,{},void 0):(0,o.jsx)(pu,{},void 0)}function Lu(e){return"ru"===e?(0,o.jsx)(fu,{},void 0):(0,o.jsx)(hu,{},void 0)}function Du(e){return"ru"===e?(0,o.jsx)(Au,{},void 0):(0,o.jsx)(gu,{},void 0)}var ju=function(){var e=rc().getLang,n=qc((function(e){return e.showCreateCall})),t=function(e){var n=(0,l.useMemo)((function(){return{urlSection:new URLSearchParams(e.search).get("section")||""}}),[e]).urlSection,t=(0,i.__read)((0,l.useState)(n),2);return{section:t[0],setSection:t[1]}}(window.location),a=t.section,r=t.setSection,s=ud(),c=s.onCreateCallClick,d=s.onPlanCalendarEvent,u=_d(),_=u.loading,v=u.setLoading,p=(0,l.useMemo)((function(){return[{id:"",label:e("calls_page_menu_all_calls"),href:"calls",ref:(0,l.createRef)()},{id:"friends",label:e("calls_page_menu_friends_calls"),href:"calls?section=friends",ref:(0,l.createRef)()},{id:"sep1",separator:!0},{id:"current",label:e("calls_page_menu_current_calls"),href:"calls?section=current",ref:(0,l.createRef)()},{id:"scheduled",label:e("calls_scheduled"),href:"calls?section=scheduled",ref:(0,l.createRef)()},{id:"sep2",separator:!0},{id:Qc.HistoryScreenSections.HISTORY,label:e("calls_history"),href:"calls?section="+Qc.HistoryScreenSections.HISTORY,ref:(0,l.createRef)()},{id:"missed",label:e("calls_page_menu_miss_calls"),href:"calls?section=missed",ref:(0,l.createRef)()}]}),[e]),f=(0,l.useCallback)((function(e,n){return(0,ed.changeQuery)(n),r(e),v(!0),window.scrollTo({top:0}),Promise.resolve()}),[]),h=(0,l.useMemo)((function(){return a===Qc.HistoryScreenSections.MISS?(0,o.jsx)(wd,{},void 0):a===Qc.HistoryScreenSections.FRIENDS?(0,o.jsx)(jd,{},void 0):a===Qc.HistoryScreenSections.CURRENT?(0,o.jsx)(Gd,{},void 0):a===Qc.HistoryScreenSections.HISTORY?(0,o.jsx)(uu,{},void 0):a===Qc.HistoryScreenSections.SCHEDULED?(0,o.jsx)(du,{},void 0):(0,o.jsx)(lu,{onMenuItemClick:f},void 0)}),[a]);return(0,o.jsx)(ld,(0,i.__assign)({showCreateCall:n,onCreateCallClick:c,activeMenuItem:a,menuItems:p,onMenuItemClick:f,loading:_,banner:(0,o.jsx)(Pu,{onCreateCall:c},void 0),onPlanCalendarEvent:d},{children:h}),void 0)},Ru=function(){var e=$c(),n=qc((function(e){return e.error})),t=rc().getLang,a=function(){e((0,ed.dispatchSetError)(null))};return(0,o.jsx)(Sr,{title:(0,o.jsxs)(o.Fragment,{children:[(null==n?void 0:n.title)||t("calls_oops")," "]},void 0),onClose:a,actionButtons:(0,o.jsx)(Ea.default,(0,i.__assign)({onClick:a},{children:t("calls_close")}),void 0),text:(0,o.jsx)(o.Fragment,{children:null==n?void 0:n.text},void 0)},void 0)},Bu=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e,n){console.error("Call history crashed:",e,n)},n.prototype.render=function(){return this.state.hasError?(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--error"},{children:(0,o.jsx)(id.default,(0,i.__assign)({title:this.props.getLang("global_error")},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--errorContent"},{children:this.props.getLang("global_unexpected_error_try_later")}),void 0)}),void 0)}),void 0):this.props.children},n}(l.Component),Uu=t(72382),Hu=t(75683),Gu=t(21333),Vu=function(){var e=(0,Bl.useIsMounted)(),n=$c(),t=(0,ue.useLang)().getLang,a=(0,Tc.usePromiseError)().handleError,i=ud().setPlannedCalendarEvent,r=(0,wc.useNotifier)().showText,c=(0,Gu.useFetchData)({cb:nn.messagesEditCall}),d=(0,Gu.useFetchData)({cb:nn.messagesDeleteScheduledCall}),u=(0,Dc.useSendStatsDataCallScheduled)().sendCallScheduled,_=qc((function(e){return e.scheduledEditableCall})),v=qc((function(e){return e.popup})),p=qc((function(e){return e.profiles[e.meId]})),f=qc((function(e){return _?e.profiles[_.caller_id||""]:void 0})),h=(0,l.useMemo)((function(){return(0,kc.getUserSelectOptions)(f)}),[f]),A=(0,Ic.useCalendarEventDetails)({meParticipant:p}).getDescription,g=(0,l.useCallback)((function(){n({type:Qc.HistoryScreenActionTypes.SET_POPUP})}),[]),m=(0,l.useCallback)((function(){n({type:Qc.HistoryScreenActionTypes.SET_POPUP,data:Qc.EHistoryScreenPopup.RescheduleCalendarEvent})}),[]),C=(0,l.useCallback)((function(n){if(_)return c.fetchData((0,kc.mapFormData)(n,_)).then((function(){if(e()){var o=new Date(n.start),l={start:o,title:n.name,repeatRule:n.rrule,join_link:_.vk_join_link||"",call_id:_.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},c=A(l);switch(l.description=c,(0,s.copyTextToClipboard)(c).then((function(){r(t("calls_create_call_by_link_text_copied"))})).catch(a),u({creatorId:_.caller_id,sharingChannel:n.calendar,isEdit:!0}),n.calendar){case Lc.ECalendar.Other:i(l);break;case Lc.ECalendar.Google:var d=(0,kc.google)((0,kc.mapGoogleIcsUrl)(l,t));(0,kc.openLinkInNewTab)(d,o);break;case Lc.ECalendar.iCloud:case Lc.ECalendar.Outlook:d=(0,kc.ics)((0,kc.mapGoogleIcsUrl)(l,t));(0,kc.openLinkInNewTab)(d,o,!1)}g()}})).catch(a)}),[_,c.fetchData]),E=(0,l.useCallback)((function(){_&&d.fetchData({call_id:_.call_id}).then(g)}),[_,d.fetchData]);return _?(0,o.jsxs)(o.Fragment,{children:[v===Qc.EHistoryScreenPopup.EditCalendarEvent&&(0,o.jsx)(Pc.ModalScheduleCall,{onClose:g,headerTitle:t("calls_edit_call_title"),onSubmit:C,call:_,loading:c.loading,myUserId:null==p?void 0:p.id,userSelectOptions:h},void 0),v===Qc.EHistoryScreenPopup.DeleteCalendarEvent&&(0,o.jsx)(Hu.ModalDeleteCall,{call:_,onClose:g,onSubmit:E,onReschedule:m,loading:d.loading},void 0),v===Qc.EHistoryScreenPopup.RescheduleCalendarEvent&&(0,o.jsx)(Uu.ModalRescheduleCall,{call:_,onClose:g,onSubmit:C,loading:c.loading,myUserId:null==p?void 0:p.id,userSelectOptions:h},void 0)]},void 0):((0,Go.handlePromiseError)("Пытаемся показать окно редактирования без выбранного звонка"),null)},Fu=t(68891);const Wu=function(){var e,n,t=rc().getLang,a=qc((function(e){return e.error})),r=qc((function(e){return e.deleteCallId})),s=qc((function(e){return e.popup}));return e=$c(),n=qc((function(e){return e.meId})),(0,l.useEffect)((function(){var t=new Fu.CallsLongpoll(n,(function(n){e({type:Qc.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE,data:n})}));return t.wait(),function(){t.destroy()}}),[n]),(0,o.jsxs)(Bu,(0,i.__assign)({getLang:t},{children:[(0,o.jsx)(ju,{},void 0),r>=0&&(0,o.jsx)(nd,{},void 0),null!==a&&(0,o.jsx)(Ru,{},void 0),(0,Ve.hasIn)(s,Qc.EHistoryScreenPopup.DeleteCalendarEvent,Qc.EHistoryScreenPopup.EditCalendarEvent,Qc.EHistoryScreenPopup.RescheduleCalendarEvent)&&(0,o.jsx)(Vu,{},void 0)]}),void 0)};function Zu(e){var n=e.actionStatCollector,t=e.saveStatlogEvents,a=e.langUtils,l=e.navigateToConvo,u=e.navigateToProfile,_=e.apiWrapperWithAuth,v=e.apiWrapper,p=e.callSounds,f=e.config,h=void 0===f?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,incomingCall:!1,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:f,A=e.eventHandlers,g=e.streamUrlExtractor;return(0,Bc.setApiWrappers)(_,v),{initialized:!1,initializing:!1,eventHandlers:null!=A?A:{},init:function(e){var _,v=this,f=e.callPreview,m=e.callsCredentials,C=e.imHash,S=e.callsOkStaging,I=e.tabIsMaster,T=e.onBeforeCallStart,N=e.onAfterCallFinish,x=e.onError,b=e.toggles,M=void 0===b?{}:b,P=e.friends,k=e.isFriend,L=e.getFriends,D=e.pushToTalkEnabled;if(this.initialized)return this.initializing;if(!(null==m?void 0:m.me))return console.log("Calls were not initialized as there are no callsCredentials.me"),!1;this.initialized=!0,this.isFriend=k,this.getFriends=L;var j=(0,i.__assign)((0,i.__assign)({},h),M);if(!J.browser.isBrowserSupported()){var R=function(){var e=a.getLang("calls_unsupported_browser_error");return x&&x({msg:e}),(null==A?void 0:A.onError)&&A.onError(new Error(e)),console.error(e),Promise.resolve()};return this.call=R,this.startGroupCall=R,this.startCall=R,this.acceptCall=R,this.joinCallByLink=R,this.showJoinPopup=R,this.showCallByNamePopup=R,this.showCreateCallByLinkPopup=R,void(this.showPlanCalendarEventPopup=R)}this.id=window.vk&&window.vk.id||m.me.peerId;var B=I||function(){return!0},U=null!==(_=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY))&&void 0!==_?_:d.VideoResolutionTypes.SD;Ye.GlobalStore.setCallsStore((0,Vc.createStore)(Wc,Fc(m.me,C,f,{isDev:!!m.is_dev,token:m.secret,config:j,localVideoResolution:j.fullHD?U:U===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD,friends:P||[],friendsCache:(0,tn.createFriendsCache)(P||[]),ipSettingEnabled:m.ip_setting_enabled,privacySettings:m.privacySettings,pushToTalkEnabled:D}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));var H=Ye.GlobalStore.getCallsStore();return this.collapseCall=function(){j.enableNavChangeCallCollapse&&(J.debugMessage(J.DebugMessageType.WARN,{message:"[external] bridge.collapseCall called"}),oo({isModalView:h.isModalView,uiMode:H.getState().uiMode,changeUIMode:function(e){H.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})}}),H.dispatch({type:d.E_ACTION.MANAGEMENT,isOpen:!1}))},this.restoreCall=function(){H.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})},this.showStartCallModal=function(e,n,t){v.isInActiveCall||H.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,peerId:e,joinLink:n,entryPoint:t})},this.setPlannedCalendarEvent=function(e){H.dispatch({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:e}),H.dispatch({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})},t&&er(t),n&&w.callStats.setActionStatCollector(n),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:H},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:j},{children:(0,o.jsx)(Gc,{},void 0)}),void 0)}),void 0)}),void 0),zu("calls")),this.initializing=sr(this,J,m,H,a.getLang,S).catch((function(){return!0})).then((function(){!function(e,n,t,a){var o=a.dispatch,r=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];r.forEach((function(e){e.type===d.INCOMING_CALL&&(0,nn.logCallReceived)(e.payload.call_id)}));var l=a.getState();Uc(l,o,e,r,t).then((function(){r.forEach((function(t){switch(t.type){case d.INCOMING_CALL:if(Hc(l,t))a.getState().ipSettingEnabled&&n.forceRelayPolicy(!t.payload.p2p_allowed),n.processPush(t.payload.call_id).then((function(){var e=JSON.parse((0,Za.decodeHTMLEntities)(t.payload.payload)),n=e.is_video?d.CallType.VIDEO:d.CallType.AUDIO,a=(0,Ve.getPeerIdFromLongpoll)(t.payload),r=(0,Ve.isGroupCallEvent)(t);a<0&&(r=e.with_join_link),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.INCOMING,peerId:a<0&&r?0:a,data:(0,i.__assign)((0,i.__assign)({},t.payload),{type:n,payload:e})}),qo({timeStart:Date.now(),startType:n}),w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:t.payload.call_id,peer_id:a,is_group_call:r,reason:e.is_video?d.CallType.VIDEO:d.CallType.AUDIO})})).catch((function(n){if(e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug)if("object"==typeof n){var t=n.hangup,a=n.message;console.error("Push process error",t,a)}else console.error("Push process error",n)}));else if(t.type===d.INCOMING_CALL){var r=function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(new Error(n)),e.debug&&console.warn("Incoming push skipped:",n,t)};switch(!0){case!t.payload.call_id:r("old lib call");break;case l.mode===d.Mode.CALL||l.mode===d.Mode.INCOMING:r("already in a call"),n.processPush(t.payload.call_id).then((function(){e.eventHandlers.onError&&e.eventHandlers.onError(new Error("processPush was incorrect accepted with call_id: "+t.payload.call_id)),e.debug&&console.warn("processPush was incorrect accepted",t.payload.call_id)})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.warn("processPush rejected:",n,t.payload.call_id)}));break;default:r("reason of decline is unknown")}}break;case d.ADD_MESSAGE:var s=a.getState(),c=(0,za.isChatPeer)(s.peer),u=s.callData.callId;if(s.peer!==t.peerId||t.flags&d.FLAG_OUTBOUND||s.me===t.userId||o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),c||!(0,O.isActiveGroupCallMessage)(t))return;var _=t.peerId;if(u===t.kludges.attach1_call_id)return dn(a.getState(),o,_);break;case d.READ_INBOUND:null!==t.chatUnreadCount&&a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t.unread,chatUpToMsgId:t.upToId});break;case d.SET_FLAGS:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&!(t.flags&d.FLAG_OUTBOUND)&&(t.flags&d.FLAG_DELETED||t.flags&d.FLAG_SPAM)&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.DELETE_DIALOG:a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case d.EDIT_MESSAGE:case d.REPLACE_MESSAGE:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&t.kludges.is_expired&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.CONVERSATION_UPDATED:_=t.peerId;var v=t.updateType;if(a.getState().peer!==_)return;if(v!==d.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==a.getState().callData.canFinishCall&&a.getState().callData.hasUrlLink||un(a.getState(),o,_)}}))})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.error("Resource loading error",n),r.forEach((function(e){if(e.type===d.INCOMING_CALL){if(!Hc(l,e))return;o({type:d.E_ACTION.ERROR,text:t("calls_incoming_process_error"),handleType:d.ErrorHandleType.PROCESS,callId:e.payload.call_id})}}))}))};if(e.handleEvent=r,void 0!==window.Notifier){var s=window.Notifier.getLpInstance();s&&s.onData(r)}}(v,J,a.getLang,H);var e=zu("calls");r.unmountComponentAtNode(e),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:H},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:j},{children:(0,o.jsx)(Rc,{bridge:v,SDK:J,tabIsMaster:B,onBeforeCallStart:T,onAfterCallFinish:N,callSounds:p,navigateToConvo:l,onHandCountChanged:null==A?void 0:A.onHandCountChanged,onSuccessFeedback:null==A?void 0:A.onSuccessFeedback,navigateToProfile:u,okPublicKey:m.key,config:j,streamUrlExtractor:g},void 0)}),void 0)}),void 0)}),void 0),e)})),this.initializing.catch((function(e){if(null==A?void 0:A.onError){var n=e?e.message||e.msg:"sdk did not send the reasons for the error",t=e?e.error:"";[401].includes(t)||A.onError(new Error("Could not init calls. "+n+": "+t))}console.error("Could not init calls",e.error,e)}))},showJoinScreen:function(e,s,l,c,d,u,_){void 0===_&&(_=!1);var v=or(c,A);if(!J.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));er(t),w.callStats.setActionStatCollector(n);var p=e.callsAllowCallByName,f=e.callsAllowWaitingHall,g=document.querySelector(s),m=(0,i.__assign)((0,i.__assign)({},h),{allowCallByName:p,allowWaitingHall:f});r.render((0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:m},{children:(0,o.jsx)(mr,(0,i.__assign)({},e,{withPopup:_,bridge:this,entryPoint:l,onError:v,okPublicKey:d,onClose:u}),void 0)}),void 0)}),void 0),g)},showHistoryScreen:function(e,n,s){var d,_;void 0===n&&(n={}),void 0===s&&(s=!0);var v=or(void 0,A);if(!J.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));er(t);var p=(0,Vc.createStore)(Yc,function(e,n){var t,a;return{meId:null!==(t=e.meId)&&void 0!==t?t:0,currentCalls:[],historyCalls:[],deleteCallId:-1,profiles:{},joinLinks:{},isDev:null!==(a=e.isDev)&&void 0!==a&&a,error:null,loading:!0,showCreateCall:!0,config:(0,i.__assign)((0,i.__assign)({},n),e.config||{})}}(n,h),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),f=document.querySelector(e),g={navigateToConvo:l,navigateToProfile:u},m={bridge:this,SDK:J};if(r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:p},{children:(0,o.jsx)(cd.Provider,(0,i.__assign)({value:m},{children:(0,o.jsx)(xd.Provider,(0,i.__assign)({value:g},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:h},{children:(0,o.jsx)(Wu,{},void 0)}),void 0)}),void 0)}),void 0)}),void 0)}),void 0),f),s){var C=document.querySelector("#l_ca");C&&C.classList.contains("AppLeftMenuWithNotify")&&C.classList.remove("AppLeftMenuWithNotify"),C&&C.classList.contains("AppLeftMenuWithNotifyBlueDot")&&C.classList.remove("AppLeftMenuWithNotifyBlueDot")}null===(_=null===(d=window.cur)||void 0===d?void 0:d.destroy)||void 0===_||_.push((function(){f&&r.unmountComponentAtNode(f)}))},debug:!1,setDebug:function(e){this.debug=e,J.debug(e)}}}function zu(e){var n=document.getElementById(e);if(n)return n;var t=document.createElement("section");return t.setAttribute("id",e),document.body.appendChild(t),t}}}]);try{stManager.done("dist/b3c52704711ff506ec36e9c85b864ca9.e602aedfa14655453236.js")}catch(e){}